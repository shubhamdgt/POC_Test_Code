var app = angular.module('myeNovationModule').controller("suggestionsCtrl", ['$scope', '$rootScope', 'appService', '$timeout', '$interval', '$location', 'snackbar', 'sharedService','CONST_RESOURCES', 'CONST_HELP', 'FILTER_RESOURCES',  '$filter', '$compile', '$sce', '$http', 'Auth', '$q', '$translate', '$translatePartialLoader', 'Lightbox', '$window', 'SuggMasterData', 'ExcelExportService', function ($scope, $rootScope, appService, $timeout, $interval, $location, sharedService,snackbar, CONST_RESOURCES, CONST_HELP, FILTER_RESOURCES,  $filter, $compile, $sce, $http, Auth, $q, $translate, $translatePartialLoader, Lightbox, $window, SuggMasterData, ExcelExportService) {
    console.log("Suggestion Controller Loaded");

    SuggMasterData.setEmpBrowniePoints();
    SuggMasterData.getMandetoryField();
    $scope.exportAllKaizen = function (id, filename, orientation) {
        var element = document.getElementById(id);
        if (orientation == 'landscape') {
            var opt = {
                margin: 10,
                filename: filename + '.pdf',
                image: { type: 'jpeg', quality: 1 },
                html2canvas: {
                    allowTaint: true,
                    useCORS: true,
                    dpi: 300,
                    letterRendering: true,
                    logging: false,
                    scale: 4
                },
                jsPDF: { unit: 'mm', format: 'a3', orientation: 'landscape', precision: '12' }
            };
        } else {
            var opt = {
                margin: 10,
                filename: filename + '.pdf',
                image: { type: 'jpeg', quality: 1 },
                html2canvas: {
                    allowTaint: true,
                    useCORS: true,
                    dpi: 300,
                    letterRendering: true,
                    logging: false,
                    scale: 4
                },
                jsPDF: { unit: 'mm', format: [320, 320], orientation: 'portrait', precision: '12' }
            };
        }
        $scope.isDownloading = true;
        html2pdf().set(opt).from(element).save().then(function () {
            $scope.$apply(function () {
                $scope.isDownloading = false;
            })
        }).catch(function (error) {
            $scope.$apply(function () {
                $scope.isDownloading = false;
            })
            snackbar.create($filter('translate')('Error downloading PDF:', error), 5000, "error");
            return;
        });
    }
    $scope.openLightboxModal = function (url) {
        var fileExtension = url.split('.').pop().toLowerCase();

        if (fileExtension === 'jpeg' || fileExtension === 'png' || fileExtension === 'gif' || fileExtension === 'jpg') {
            Lightbox.openModal([{ 'url': url }], 0);
        } else {
            window.open(url, '_blank');
        }
    };
    $scope.orgAlies = $rootScope.empDetails.organization.alies;
    //console.log($scope.orgAlies)
    $scope.loggedInUserBranchId = $rootScope.empDetails.branch.branchId;
    $scope.loggedInUserOrgId = $rootScope.empDetails.organization.orgId
    $scope.loggedInEmpId = $rootScope.empDetails.empId;
    if (!$rootScope.checkMenuAccess('Suggestions')) {
        window.location.href = "template.html#!/homepage";
    }
    var alies = $rootScope.empDetails.organization.alies;
    if (alies != null && !angular.isUndefined(alies) && alies == 'cg') {
        $translatePartialLoader.addPart('kaizen/Suggestion');
    }
    else if (alies != null && !angular.isUndefined(alies) && alies == 'gmr') {
        // Auth.getMasterStatusData();
        $translatePartialLoader.addPart('gmr/Suggestion');
    }
    else {
        $translatePartialLoader.addPart('Suggestion');
    }
    $translate.refresh();
    // $scope.changeLanguage();

    /* Author - Sanket B. (Modifier)
    Date - 08/05/2024
    Output - Target & Benchmark configuration setup in mandatory setup */
    $scope.productOrgConfigList = {};
    $scope.getProductOrgConfig = function () {
        appService.httpGet("getProductOrgConfig/" + parseInt($scope.loggedInUserBranchId)).then(function (response) {
            //console.log(response);
            if (response.result) {
                $scope.productOrgConfigList = response.productOrgConfig;
                $scope.productOrgConfigList.isPriorityMadatory = $scope.productOrgConfigList.isImplmentationPriorityOn == 1 ? true : false;
                $scope.productOrgConfigList.isTargetMandatory = $scope.productOrgConfigList.isTargetMandatory == 1 ? true : false;
                $scope.productOrgConfigList.isBenchmarkMandatory = $scope.productOrgConfigList.isBenchmarkMandatory == 1 ? true : false;
                $scope.productOrgConfigList.isLineMandatory = $scope.productOrgConfigList.isLineMandatory == 1 ? true : false;
                if (!$scope.isEmpty($scope.roleAccess) && $scope.roleAccess.id == 8) {
                    $scope.isEscalation = (response.productOrgConfig.isEvalEscalation == 1 ? true : false);
                }
                //console.log($scope.productOrgConfigList);
                $scope.getCategoryList($rootScope.empDetails.branch.branchId);
            } else {
                $scope.productOrgConfigList = {}
            }
        });
    }
    $scope.getProductOrgConfig();

    $scope.selectedSuggestionTab = "suggestions";

    $scope.suggScreenView = { flag: 'New' };
    $scope.changeUI = function () {
        $('#confirmInitiate').modal({
            backdrop: 'static',
            keyboard: false
        });

    }
    var empDetail = JSON.parse(localStorage.getItem('userDet'));

    var versionObject = {
        'version': "version_1.0",
        'empId': empDetail.empId
    };


    // localStorage.setItem('testObject', JSON.stringify(testObject));
    //console.log(empDetail.empId);

    $scope.newUI = function () {

        window.localStorage.setItem('versionObject', JSON.stringify(versionObject));


        window.location.href = "template.html#!/suggestions";
        window.location.reload();
        $('#confirmInitiate')
            .modal('hide');
    }
    $scope.changePrevious = function () {
        $scope.suggScreenView = { flag: 'New' };
        $('#confirmInitiate')
            .modal('hide');
    }
    $scope.imgViewerScrollConfig = {
        scrollButtons: {
            scrollAmount: 'auto', // scroll amount when button pressed
            enable: true // enable scrolling buttons by default
        },
        axis: 'x', // enable 2 axis scrollbars by default
        theme: 'blue',
        advanced: {
            updateOnContentResize: true
        }
    }

    $scope.suggestionInputDetails = {};
    $scope.suggestionInputDetails.currentDate = $filter('date')(new Date(), 'yyyy-MM-dd');//moment();
    $scope.kaizenExportUrl = $sce.trustAsResourceUrl($rootScope.appDomain + 'downloadFile');
    $scope.analyticsExportUrl = $sce.trustAsResourceUrl($rootScope.appDomain + 'getAllGraphs');

    $scope.suggDetailModel = {
        fromDate: '',
        toDate: '',
        searchModule: false,
        searchById: false,
        isJuryFlag: 'N'
    };

    if ($rootScope.empDetails != null) {
        $scope.loggedInEmpId = $rootScope.empDetails.empId;
        $scope.loggedInName = $rootScope.empDetails.firstName + ' ' + $rootScope.empDetails.lastName;
        $scope.loggedInUserOrgId = $rootScope.empDetails.organization.orgId;
        $scope.loggedInUserDeptId = $rootScope.empDetails.dept.deptId;
        $scope.loggedInUserTeamTypeId = 0;
        $scope.loggedInUserBranchId = $rootScope.empDetails.branch.branchId;
        $scope.loggedInRole = $rootScope.empDetails.roles;
        $scope.orgUrl = $rootScope.empDetails.organization.logo;
    }

    if ($rootScope.empDetails.departmentLevel != null && $rootScope.empDetails.departmentLevel.length > 0) {
        $scope.loggedInUserLevel = $rootScope.empDetails.departmentLevel[0].level;
    } else {
        $scope.loggedInUserLevel = 0;
    }

    /*-----------------------Filter START------------------------------------*/
    /*----18-07-2020----*/
    $scope.flagfillterApply = false;
    $scope.flagapplydata = true;

    $scope.customFilter = function () {
        return function (item) {
            if ($scope.typeFilter == 6) {
                return item.id === 1 || item.id === 5;
            } else {
                return item.id === '' || item.id === 1 || item.id === 2 || item.id === 3 || item.id === 4;
            }
        };
    };
    $scope.searchList = [{
        "id": '',
        "searchBy": "Addon Search"
        // "searchBy": "Search By"
    }, {
        "id": 1,
        "searchBy": (alies == 'gmr' ? "Idea ID" : "Suggestion ID"),
    }, {
        "id": 2,
        "searchBy": (alies == 'gmr' ? "My Created Idea" : "My Created Suggestion"),
    },
    {
        "id": 3,
        "searchBy": "Employee ID"
    }, {
        "id": 4,
        "searchBy": "Employee Name"
    }, {
        "id": 5,
        "searchBy": "Suggestion Title"
    }
    ];
    $scope.sustanceSearchList = [{
        "id": '',
        "searchBy": "Addon Search"
        // "searchBy": "Search By"
    }, {
        "id": 1,
        "searchBy": "Suggestion ID"
    },
    {
        "id": 3,
        "searchBy": "Employee ID"
    }, {
        "id": 4,
        "searchBy": "Employee Name"
    }
    ];
    // 13-8-2020
    $scope.suggestionLevelList = [{
        "id": 1,
        "level": "WITHIN_PLANT",
        "name": "Within Plant"
    }, {
        "id": 2,
        "level": "HD_SUGGESTION",
        "name": "HD Suggestion"
    }];
    $scope.suggDetailModel.searchBy = $scope.searchList[1];
    $scope.suggDetailModel.selectedLevel = $scope.suggestionLevelList[0];
    $scope.isEmpty = function (obj) {
        for (var key in obj) {
            if (obj.hasOwnProperty(key))
                return false;
        }
        return true;
    }
    //console.log("Search List", $scope.seacrhList);

    $scope.isComment = function () {
        var flag = false;
        for (var i = 0; i < $rootScope.empDetails.roles.length; i++) {
            if ($rootScope.empDetails.roles[i].id == 8) {
                flag = true;
                break;
            }
        }
        if (flag) {
            if (!$scope.isEmpty($scope.suggestionDet) && $scope.suggestionDet.sugesstionStatusAudit != null && $scope.suggestionDet.sugesstionStatusAudit.length > 0) {
                var tmpRec = $filter('filter')($scope.suggestionDet.sugesstionStatusAudit, { status_master: { status: $scope.CONST.STATUS.EvaluationRequestAccepted.status } }, true);
                if (tmpRec == null || tmpRec.length == 0) {
                    flag = false;
                }
            }
        }
        return flag;
    }

    $scope.selectedAfterImage = "abc";
    $scope.getFormatedDate = function (year, month, type) {
        var datetype = '';
        if (type == "fristDay") {
            datetype = new Date(year, month, 1);
        } else if (type == "lastDay") {
            datetype = new Date(year, month + 1, 0);
        }
        return datetype;
    }

    $scope.getMonthByMonthAbr = function (month) {
        if (month == "Jan") {
            return 0;
        } else if (month == "Feb") {
            return 1;
        } else if (month == "Mar") {
            return 2;
        } else if (month == "Apr") {
            return 3;
        } else if (month == "May") {
            return 4;
        } else if (month == "Jun") {
            return 5;
        } else if (month == "Jul") {
            return 6;
        } else if (month == "Aug") {
            return 7;
        } else if (month == "Sept") {
            return 8;
        } else if (month == "Oct") {
            return 9;
        } else if (month == "Nov") {
            return 10;
        } else if (month == "Dec") {
            return 11;
        }
    }

    var date = new Date();
    var intYear = date.getFullYear() - 1;
    $scope.prevYear = intYear;
    $scope.curYear = (new Date())
        .getFullYear();

    $scope.arrMonths = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sept", "Oct", "Nov", "Dec"];
    // SET TAB
    $scope.mainTab = 1;
    $scope.setMainTab = function (tabId, token) {
        $scope.mainTab = tabId;
        if ($scope.mainTab == 1) {
            $scope.suggToken = token;
            var data = {
                filterId: 1
            };
            $scope.applyFilter(data);
            $scope.resetWinnigFilter();

        } else if ($scope.mainTab == 2) {
            $scope.accessBranchList = angular.copy($scope.allBranchaccessList);
            $timeout(function () {
                $scope.getDeptWiseCount($scope.from, $scope.to);
                $scope.getCostEffect($scope.from, $scope.to);
                $scope.getBenefitWiseCount($scope.from, $scope.to);
                $scope.getStatusGraph($scope.from, $scope.to);
            }, 2000);
            $scope.resetSuggestionFilter();
            $scope.resetWinnigFilter();
        } else if ($scope.mainTab == 4) {
            $scope.suggToken = token;
            $scope.getsuggestionList("inFlight");
        } else if ($scope.mainTab == 3) {
            $scope.winnerPaginate = true;
            $scope.getWinningList();
            $scope.resetSuggestionFilter();
        }
        $scope.suggDetailModel.searchModule = false;
    };

    $scope.isSetMainTab = function (tabId) {
        return $scope.mainTab === tabId;
    };
    //Multiple images
    // $scope.files = [];
    // $scope.$on("fileSelected", function(event, args) {
    //     var item = args;
    //     $scope.files.push(item);
    //     var reader = new FileReader();

    //     reader.addEventListener("load", function() {
    //         $scope.$apply(function() {
    //             item.src = reader.result;
    //         });
    //     }, false);

    //     if (item.file) {
    //         reader.readAsDataURL(item.file);
    //     }
    // });

    // Priority Setup added by @Jayshri Kolase
    $scope.priorityList = [
        // { id: '0', name: "Select Implementation Priority"},
        { id: 'H', name: "High" },
        { id: 'M', name: "Medium" },
        { id: 'L', name: "Low" }
    ]

    //multiple Impl Images
    /*---------------------config list------------*/
    $scope.getSuggAccessList = function (branchId) {
        // appService.httpGetLocal('LocalJson/suggConfig.json')
        var url;
        if ($rootScope.getOrgByAlies('dcmsugar')) {
            url = "getSuggConfigList/" + $rootScope.empDetails.organization.orgId + "/" + branchId;
        } else {
            url = "getSuggConfigList/" + $rootScope.empDetails.organization.orgId;
        }
        appService.httpGet(url)
            .then(function (response) {
                if (response.result == true) {
                    if ($rootScope.getOrgByAlies('dcmsugar')) {
                        if (response.suggFlowConfig != null && response.suggFlowConfig[0].branchId === $rootScope.empDetails.branch.branchId) {
                            $scope.suggFlowConfig = response.suggFlowConfig[0];
                        } else {
                            response.suggFlowConfig[0].isPlantEnbld = $scope.suggFlowConfig.isPlantEnbld;
                            $scope.suggFlowConfig = response.suggFlowConfig[0];
                        }
                    } else {
                        $scope.suggFlowConfig = response.suggFlowConfig[0];
                    }
                    $scope.tab = $scope.suggFlowConfig.isChgDocEnbld == 'Y' ? 1 : ($scope.suggFlowConfig.isKaizenActEnbld == 'Y') ? 4 : ($scope.suggFlowConfig.isSavingTypeEnbld == 'Y') ? 2 : ($scope.suggFlowConfig.isParticularsEnbld == 'Y') ? 3 : ($scope.suggFlowConfig.isHorizDplymntsEnbld == 'Y') ? 5 : '';
                } else {
                    $scope.suggFlowConfig = {};
                    $scope.suggFlowConfig.isSuggFlowSetupcmpltd = 'N'
                    $scope.tab = 1;
                }
            });
    }
    $scope.getSuggAccessList($rootScope.empDetails.branch.branchId);
    $scope.implFiles = [];
    $scope.getImplFileDetails = function (e) {
        if ($scope.implFiles.length > 0) {
            snackbar.create($filter('translate')('Only one image upload'), 5000, "error");
            return;
        }
        $scope.$apply(function () {
            for (var i = 0; i < e.files.length; i++) {
                var type = e.files[i].type;
                var fileNameWithExtension = e.files[i].name;
                var fileName = fileNameWithExtension.replace(/\.[^/.]+$/, ''); // Regex to remove the extension
                var ext = type.split('/')[1];
                // var ext = e.files[i].name.match(/\.(.+)$/)[1];
                if (angular.lowercase(ext) != 'jpg' && angular.lowercase(ext) != 'jpeg' && angular.lowercase(ext) != 'png') {
                    snackbar.create($filter('translate')('Invalid_file'), 5000, "error");
                    return;
                }
                var fileSize = e.files[i].size;
                if (fileSize > 10 * 1024 * 1024) {
                    snackbar.create($filter('translate')('Image_size_exceeds_limit'), 5000, "error");
                    const resetFile = document.getElementById("file");
                    resetFile.value = '';
                    return;
                }
                e.files[i].fileName = fileName;
                e.files[i].ext = ext;
                $scope.implFiles.push(e.files[i])
            }
        });
    };

    $scope.clearImpleImage = function (index, img) {
        $scope.implFiles.splice(index, 1);
        $scope.implBeforFiles.splice(index, 1);
    };

    $scope.clearResultImage = function (index, img) {
        $scope.resultImageFiles.splice(index, 1);
        $scope.resultImageBeforFiles.splice(index, 1);
    };
    $scope.fileReaderImpl = function (data) {
        var reader = new FileReader();
        reader.onload = function (loadEvent) {
            $scope.$apply(function () {
                data.imgsrcImpl = loadEvent.target.result;
            });
        }
        reader.readAsDataURL(data);
    }

    $scope.scrollToBottom = function (section) {
        // if (section == "suggestionDet") {
        angular.element(section)
            .mCustomScrollbar("update");
        setTimeout(function () {
            angular.element(section)
                .mCustomScrollbar("scrollTo", "bottom");
        }, 100);
        // }
    }

    $scope.ClearListDate = function () {
        $scope.suggestionPagination = {
            fromDt: "",
            toDt: ""
        };
        if ($scope.statusCountFilter == 0) {
            $scope.getsuggestionList('allSuggestion');
        } else {
            $scope.getsuggestionList("onUpdate");
        }
        $scope.getStatusWiseCount();
    }
    //To Datepicker
    $scope.setKnowledgeDate = function () {
        $(function () {
            //Date picker
            $('#frmDate_datepicker')
                .datepicker({
                    format: "yyyy-mm-dd",
                    endDate: "today",
                    autoclose: true
                })
            $('#toDate_datepicker')
                .datepicker({
                    format: "yyyy-mm-dd",
                    endDate: "today",
                    autoclose: true
                })
        });
    }
    $scope.dateSelected = function () {
        localStorage.setItem("portalFormDt", $scope.suggDetailModel.fromDate);
        localStorage.setItem("portalToDt", $scope.suggDetailModel.toDate);
        //  sharedService.prepForBroadcast("Test Message");
        // $scope.suggestionPagination.fromDt=  $scope.suggestionPagination.fromDt;
        // $scope.suggestionPagination.toDt = $scope.suggestionPagination.selectedtoDt;
        $scope.selectedFrDate = $('#toDate_datepicker')
            .datepicker('getFormattedDate');
        // $(function () {
        //     //Date picker
        //     angular.element('#frmDate_datepicker')
        //         .datepicker({
        //             format: "yyyy-mm-dd",
        //             endDate: $scope.selectedFrDate,
        //             autoclose: true
        //         })
        //     angular.element('#frmDate_datepicker')
        //         .datepicker('setEndDate', $scope.selectedFrDate);
        // });
    }

    $(function () {
        var today = new Date() + 1;
        //Date picker
        $('#toDate_datepicker')
            .datepicker({
                format: "yyyy-mm-dd",
                endDate: "today",
                autoclose: true
            })
    }); /*End datepicker*/

    $scope.$watch('suggestionPagination.fromDt', function (newDate, oldDate) {
        if (!$scope.isEmpty($scope.suggestionPagination)) {
            if ($scope.suggestionPagination.hasOwnProperty('fromDt') && $scope.suggestionPagination.fromDt != null && $scope.suggestionPagination.fromDt != undefined && $scope.suggestionPagination.fromDt != '') {
                $scope.suggestionPagination.fromDt = moment(newDate).format('YYYY-MM-DD');
                $scope.dateSelected();
            }
        }
    })
    $scope.$watch('suggestionPagination.toDt', function (newDate, oldDate) {
        if (!$scope.isEmpty($scope.suggestionPagination)) {
            if ($scope.suggestionPagination.hasOwnProperty('toDt') && $scope.suggestionPagination.toDt != null && $scope.suggestionPagination.toDt != undefined && $scope.suggestionPagination.toDt != '') {
                $scope.suggestionPagination.toDt = moment(newDate).format('YYYY-MM-DD');
                $scope.dateSelected();
            }
        }
    })
    $scope.$watch('suggDetailModel.fromDt', function (newDate, oldDate) {
        if (!$scope.isEmpty($scope.suggDetailModel)) {
            if ($scope.suggDetailModel.hasOwnProperty('fromDt') && $scope.suggDetailModel.fromDt != null && $scope.suggDetailModel.fromDt != undefined && $scope.suggDetailModel.fromDt != '') {
                $scope.suggDetailModel.fromDt = moment(newDate).format('YYYY-MM-DD');
                $scope.dateSelected();
            }
        }
    })
    $scope.$watch('suggDetailModel.toDt', function (newDate, oldDate) {
        if (!$scope.isEmpty($scope.suggDetailModel)) {
            if ($scope.suggDetailModel.hasOwnProperty('toDt') && $scope.suggDetailModel.toDt != null && $scope.suggDetailModel.toDt != undefined && $scope.suggDetailModel.toDt != '') {
                $scope.suggDetailModel.toDt = moment(newDate).format('YYYY-MM-DD');
                $scope.dateSelected();
            }
        }
    })
    //From Datepicker 
    $scope.dateSelectedFrom = function () {
        localStorage.setItem("portalFormDt", $scope.suggDetailModel.fromDate);
        localStorage.setItem("portalToDt", $scope.suggDetailModel.toDate);
        $scope.suggestionPagination.fromDt = $scope.suggestionPagination.selectedfromDt;
        $scope.selectedFrDate = $('#frmDate_datepicker')
            .datepicker('getFormattedDate');

        $(function () {
            var today = new Date() + 1;
            angular.element('#toDate_datepicker')
                .datepicker({
                    format: "yyyy-mm-dd",
                    endDate: "today",
                    autoclose: true
                })
            angular.element('#toDate_datepicker')
                .datepicker('setStartDate', $scope.selectedFrDate);
        });
    }

    $(function () {
        //Date picker
        var today = new Date() + 1;

        angular.element('#know_datepicker')
            .datepicker({
                format: "yyyy-mm-dd",
                autoclose: true,
                endDate: today,
            })
    }); /*End datepicker*/


    $(function () {
        var today = new Date() + 1;
        //Date picker
        $('#frmDate_datepicker')
            .datepicker({
                format: "yyyy-mm-dd",
                endDate: "today",
                autoclose: true
            })
    }); /*End datepicker*/

    if (localStorage.getItem("portalFormDt") == '' && localStorage.getItem("portalToDt") == '') {
        $scope.portalFromDt = localStorage.getItem("portalFormDt");
        $scope.portalToDt = localStorage.getItem("portalToDt");
    } else {
        $scope.portalFromDt = (moment()
            .subtract(1, 'months')
            .format('YYYY-MM-DD'));
        $scope.portalToDt = $filter('date')(new Date(), "yyyy-MM-dd");
    }
    $scope.suggDetailModel.fromDate = $scope.portalFromDt;
    $scope.suggDetailModel.toDate = $scope.portalToDt;
    $scope.loggedInName = $scope.loggedInName + " " + localStorage.getItem("lastName");
    $scope.flagTeamDetPopupLoading = false;

    // $scope.flagSuggestionDet = false;
    // $scope.flagSuggestionGraph = true;
    $scope.flagAcceptSugg = false;
    $scope.flagRejectSugg = false;
    $scope.suggestionList = [];
    $scope.suggestion = [];
    $scope.date = [];
    $scope.cardSel = {};
    $scope.flagrejarea = false;
    $scope.flagrejectEvalarea = false;

    $scope.flagrejectonhold = false;
    $scope.flagresumeonhold = false;
    $scope.flagAccPillerLeavel = false;

    $scope.flagAccRejTextarea = false;
    $scope.flagSuggListIndicator = false;
    $scope.flagSuggGraphBoxIndicator = false;
    $scope.flagDeptGraphBoxIndicator = false;
    // $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
    $scope.flagRecSuggSpinner = false;
    $scope.uploadAttachmentModalSpinner = false;
    $scope.flagSuggDetLoader = false;
    $scope.isSelectedSuggestionEdited = false;
    $scope.flagDeptGraphDataNotAvail = false;
    $scope.flagStatusGraphDataNotAvail = false;
    $scope.flagSuggDetBoxIndicator = false;
    $scope.flagSelectTeamMem = false;
    $scope.flagSuggestionFilter = false;
    $scope.flagCloseConcernSpinner = false;
    $scope.flagTeamDetNotAvailMsg = false;
    $scope.flagDeptWiseGraphIndicator = false;
    $scope.flagCatWiseGraphIndicator = false;
    $scope.flagStatusWiseGraphIndicator = false;
    $scope.allSuggestionCount = 0;
    $scope.suggestionPagination = {
        current: 1,
        totalSuggestion: 0,
        suggestionPerPage: 20,
        suggestionPerPageNew: 10,
        selectedCatId: 0,
        selectedDeptId: 0,
        selectedStatus: "",
        fromDt: "",
        toDt: "",
        maxSize: 5
    };


    $scope.staticPagination = {
        currentPage: 1,
        limit: 10,
        maxSize: 6,
        totalCount: 0
    }
    $scope.paginateConfig = {
        itemsPerPage: 10,
        current: 1
    }
    $scope.onPageChanged = function (newPageNumber) {
        $scope.paginateConfig.current = newPageNumber;
    }
    //We use this flag to maintain the executive flow
    //We have used this to send the flag as byExecutive while accepting rejecting suggestion
    $scope.isExecutiveSugg = false;

    $scope.labelsDepartment = [];
    $scope.departmentData = [];
    $scope.statusCountGraphOpt = {};

    //Maintaning below object to hold some formated data for export kaizen functionlaity
    $scope.kaizenExportFormatedData = {
        benefits: ""
    }

    $scope.resetSuggestionFilter = function () {

        $scope.suggestionPagination.current = 1,
            $scope.suggestionPagination.totalSuggestion = 0
        $scope.suggestionPagination.suggestionPerPage = 20,
            $scope.suggestionPagination.selectedCatId = 0;
        $scope.suggestionPagination.selectedDeptId = 0;

    }

    //Spinner Flags
    $scope.flagTeamDetPopupSpinner = false;
    $scope.flagHrAccRejSpinner = false;
    $scope.flagEvalAccRejSpinner = false;
    $scope.isSuggestionAccess = $rootScope.checkSubMenuAccess('Suggestions', 'Suggestions');
    $scope.CONST = CONST_RESOURCES;
    $scope.CONST.STATUS = $rootScope.suggStatus;
    $scope.CONST_HELP_STMT = CONST_HELP;

    $scope.FILTER = FILTER_RESOURCES;
    $scope.filterStatusIds = "";
    if ($scope.CONST.STATUS != null) {
        $scope.sustanaceStatusList = [
            { statusId: $scope.CONST.STATUS.AssignedForSustainanceCheck.statusId, label: $scope.CONST.STATUS.AssignedForSustainanceCheck.label },
            { statusId: $scope.CONST.STATUS.ReassignedToSustenanceAuditor.statusId, label: $scope.CONST.STATUS.ReassignedToSustenanceAuditor.label },
            { statusId: $scope.CONST.STATUS.SustainanceVerificationInProgress.statusId, label: $scope.CONST.STATUS.SustainanceVerificationInProgress.label },
            { statusId: $scope.CONST.STATUS.Sustained.statusId, label: $scope.CONST.STATUS.Sustained.label },
            { statusId: $scope.CONST.STATUS.SustainanceFailed.statusId, label: $scope.CONST.STATUS.SustainanceFailed.label }
        ];
    }

    $scope.$on('handleBroadcast', function () {
        $scope.portalFromDt = localStorage.getItem("portalFormDt");
        $scope.portalToDt = localStorage.getItem("portalToDt");
        if ($scope.statusCountFilter == 0) {
            $scope.getsuggestionList('allSuggestion');
        } else {
            $scope.getsuggestionList("onUpdate");
        }
        $scope.getStatusWiseCount();
    });

    $scope.txtColorPallet = ['txt-green', 'txt-orange', 'txt-blue', 'txt-yellow', 'txt-darkgray', 'txt-pink', 'txt-blue1', 'txt-red', 'txt-darkgray-1', 'txt-purpul'];
    $scope.graphColorPallet = ['#466289', '#FA6121', '#3ba682', '#627894', '#996699', '#8792D6', '#ffbe70', '#DBE8F9', '#A0AEC1', '#8792D6', '#A0AEC1'];
    $scope.bgColorPallet = ['#33C771', '#f68421', '#8776F8', '#E5C212', '#EE428C', '#505050', '#288AEC'];
    $scope.hzBarChartColor = "#33C771";

    $scope.deptChartOpt = {
        legend: {
            display: true,
            position: 'right',
        }
    }

    $scope.isAccess = function (roleId, level) {
        if (level == 0) {
            for (var i = 0; i < $rootScope.empDetails.roles.length; i++) {
                if (roleId == $rootScope.empDetails.roles[i].id) {
                    return true;
                }
            }
        } else if (level > 0) {
            for (var i = 0; i < $rootScope.empDetails.roles.length; i++) {
                if (roleId != "NA") {
                    if ((roleId == $rootScope.empDetails.roles[i].id) && (level == $rootScope.empDetails.departmentLevel[0].level)) {
                        return true;
                    }
                } else {
                    if (level == $rootScope.empDetails.departmentLevel[0].level) {
                        return true;
                    }
                }
            }
        }
        return false;
    }

    $scope.printAnalytics = function () {
        html2canvas(document.getElementById('dashboard'), {
            onrendered: function (canvas) {
                var data = canvas.toDataURL();
                var docDefinition = {
                    content: [{
                        image: data,
                        width: 500,
                    }]
                };
                pdfMake.createPdf(docDefinition)
                    .download("test.pdf");
            }
        });
    }

    /*----------------Slider-------------------*/
    /*------------START FOR CIRCLE WISE CONTROOLER LIST------BY SUNANDA------------------2-1-2020------*/
    $scope.getCircleControllerList = function () {
        $scope.data = {
            branchId: $scope.loggedInUserBranchId,
            levelId: 0
        }
        //console.log($scope.data);
        appService.httpPost($scope.data, "getCircleLevelUserDetails")
            .then(function (response) {
                if (response.result == true) {
                    $scope.circleControllerList = response.circleLevelUsers;
                } else {
                    snackbar.create($filter('translate')('Error_occured_Please_try_again'), 5000, "error");

                }
            });
    }
    /*------------END FOR CIRCLE WISE CONTROOLER LIST------BY SUNANDA------------------2-1-2020------*/

    /*---------------START FOR JURY TOP THREE KIZAN LIST---------BY SUNANDA -----------------6-1-2020*/
    $scope.isSuperAdminForJury = function () {
        var flag = false;
        for (var i = 0; i < $rootScope.empDetails.roles.length; i++) {
            // //console.log($rootScope.empDetails.roles[i].name)
            if ($rootScope.empDetails.roles[i].name == "SUPERADMIN") {
                flag = true;
                break;
            }
        }
        return flag;

    }
    $scope.isPublishDisabled = function () {
        var flag = false;
        var date = new Date();
        var year = date.getFullYear();
        var month = date.getMonth() + 1;
        var day = date.getDay();
        if ($scope.suggestionPagination.selectedMonth != undefined && $scope.suggestionPagination.selectedMonth != null) {
            if (($scope.suggestionPagination.selectedMonth.month == month) && ($scope.suggestionPagination.selectedMonth.year == year)) {
                flag = true;

            }
        }
        return flag;
    }
    $scope.juryCureentMonth = new Date().getMonth() + 1;
    $scope.getJuryTopKiazenList = function () {
        //console.log("========================================")
        appService.httpGet("getCurrentTopKaizen/" + $scope.nominationId)
            .then(function (response) {
                if (response.result == true) {
                    $scope.CurrentTopKaizenList = response.list;
                } else {
                    $scope.CurrentTopKaizenList = [];
                }
            });
    }
    $scope.getJueryStatusList = function () {
        $scope.data = {
            "nomId": $scope.nominationId,
        }
        //console.log($scope.data);
        appService.httpPost($scope.data, "getJuryAssessmentSummary")
            .then(function (response) {
                if (response.result == true) {
                    $scope.juryStatusList = response.list;
                } else {
                    $scope.juryStatusList = [];
                }
            });
    }

    //-----Add 05-03-2020-------
    $scope.enableData = function () {
        var flag = false;
        if ($scope.juryStatusList != null && $scope.juryStatusList.length > 0) {
            for (let i = 0; i < $scope.juryStatusList.length; i++) {
                $scope.juryStatusList[i].totalJury = 0;
                $scope.juryStatusList[i].totalJury = $scope.juryStatusList[i].pendingCount + $scope.juryStatusList[i].completedCount;
                if ($scope.juryStatusList[i].pendingCount == 0 && $scope.juryStatusList[i].completedCount == $scope.juryStatusList[i].totalJury) {
                    flag = true;

                } else if ($scope.juryStatusList[i].pendingCount > 0 && $scope.juryStatusList[i].completedCount != $scope.juryStatusList[i].totalJury && $scope.juryStatusList[i].completedCount > 0) {
                    flag = false;
                }
            }
            return flag;
        }
    }

    $scope.getJuryList = function () {
        appService.httpGet("getSuggestionJurySetup/" + $scope.loggedInUserBranchId)
            .then(function (response) {
                $scope.flagTblemployee = true;
                if (response.result) {
                    $scope.flagJuryDetNotAvail = false;
                    $scope.juryList = response.list;
                    for (var i = 0; i < response.list.length; i++) {
                        $scope.monthNumber = parseInt(response.list[i].month)
                        response.list[i].newMonth = $scope.monthNumber;
                    }
                } else {
                    $scope.juryList = [];
                }
            });
    }

    $scope.juryPasstopeerPopup = function () {
        //console.log($scope.selectedJuryData);
        $("#teamDetModalforJury")
            .modal({
                backdrop: 'static',
                keyboard: false
            });
    }

    $scope.selectTeamJuryOnRowClick = function (rowRdoId) {
        angular.element('.rdoEmpSelect')
            .attr('checked', false);
        angular.element(rowRdoId)
            .attr('checked', true);

        $.each($("input[name='empChk']:checked"), function () {
            $scope.selectedSingleEmpId = parseInt($(this)
                .val());
            //console.log($scope.selectedSingleEmpId);
        });
    }

    $scope.juryPasstopeer = function () {
        $scope.data = {
            "nominationId": $scope.nominationId,
            "fromEmpId": $scope.loggedInEmpId,
            "toEmpId": $scope.selectedSingleEmpId
        }
        appService.httpPost($scope.data, "passToPeerAssessment")
            .then(function (response) {
                if (response.result == true) {
                    $("#teamDetModalforJury")
                        .modal('hide');
                    snackbar.create($filter('translate')('Assigned_to_peer_successfully'), 5000, "success");
                    $scope.getStatusWiseCount();
                    $scope.getsuggestionList();
                    $scope.getJuryTopKiazenList();
                    $scope.getJueryStatusList();

                } else {
                    snackbar.create($filter('translate')('Error_occured_Please_try_again'), 5000, "error");

                }


            });
    }

    $scope.conformPublishTemplate = function () {
        $('#confirmPublishModal')
            .modal({
                backdrop: 'static',
                keyboard: false
            });
    }
    $scope.publishJuryAssesment = function () {
        var data = {
            "nomId": $scope.nominationId,
            "orgId": $scope.loggedInUserOrgId,
            //Add 05-03-2020
            "branchId": $rootScope.empDetails.branch.branchId
        }
        appService.httpPost(data, "publishTopKaizenWinners")
            .then(function (response) {
                $('#confirmPublishModal')
                    .modal('hide');
                if (response.result) {
                    if (response.statusCode == 100) {
                        $scope.statusReason = response.reason;
                        snackbar.create($filter('translate')('Please_complete_pending_assessment'), 3000, "error");
                    } else {
                        snackbar.create($filter('translate')('Assessment_process_completed_and_winners_are_displayed_on_winners_board'), 3000, "success");
                        $scope.getStatusWiseCount();
                        $scope.getsuggestionList();
                        $scope.getJuryTopKiazenList();
                        $scope.getJueryStatusList();
                    }

                } else {
                    snackbar.create($filter('translate')('Oops_Please_try_again'), '3000', 'error');
                }
            })
    }
    /*---------------END FOR JURY TOP THREE KIZAN LIST---------BY SUNANDA -----------------6-1-2020*/
    /*--------------------START FOR SUGGESTION LIST --------------------------- */
    $scope.getsuggestionList = function (token) {
        // if (!$scope.isSuggestionAccess) {
        //     $scope.suggestionList = [];
        //     return;
        // }
        var url = "";
        if (token == "inFlight") {
            $scope.suggestionList = [];
            $scope.data.orgId = $scope.loggedInUserOrgId;
            $scope.data.stsId = 0;
            $scope.flagSuggListBoxIndicator = true;
            $scope.data = {
                branchIds: [],
                orgId: $scope.loggedInUserOrgId,
                // branchId: $scope.loggedInUserBranchId,
                typeId: $scope.statusCountFilter,
                assignedToId: $scope.loggedInEmpId,
                // fromDt: $scope.portalFromDt + ' 00:00:00',
                // toDt: $scope.portalToDt + $filter('date')(new Date(), " HH:mm:ss")
            };
            url = "implementedsuggestion";
        } else if (token == "allSuggestion") {
            $scope.data = {
                branchIds: [],
                orgId: $scope.loggedInUserOrgId,
                //  branchId: $scope.loggedInUserBranchId,
                assignedToId: $scope.loggedInEmpId,
                // fromDt: $scope.portalFromDt + ' 00:00:00',
                // toDt: $scope.portalToDt + $filter('date')(new Date(), " HH:mm:ss")
            };
            /*------------search By (23-06-2020)-----------*/
            // if ($scope.suggDetailModel.hasOwnProperty('searchBy') && !$scope.isEmpty($scope.suggDetailModel.searchBy) && $scope.suggDetailModel.searchBy != '' && $scope.suggDetailModel.searchBy.id == 2) {
            //     // $scope.data.SRCH_BY_EMP_ID = $scope.loggedInEmpId;
            //     $scope.data.srchKey = 'SRCH_BY_EMP_ID';
            // }
            // if ($scope.suggDetailModel.searchById) {
            //     // $scope.data.SRCH_BY_SUGG_NUMBER = $scope.suggDetailModel.suggestionNumber;
            //     $scope.data.srchKey = 'SRCH_BY_SUGG_NUMBER';
            //     $scope.data.suggNum = $scope.suggDetailModel.suggestionNumber
            // }

            url = "getallsuggestion";
        } else {
            $scope.data = {
                branchIds: [],
                orgId: $scope.loggedInUserOrgId,
                typeId: $scope.statusCountFilter,
                assignedToId: $scope.loggedInEmpId,
                // fromDt: $scope.portalFromDt + ' 00:00:00',
                // toDt: $scope.portalToDt + $filter('date')(new Date(), " HH:mm:ss")

            };
            url = "getsuggestionlistnew";
        }
        if ($scope.statusCountFilter == 1) {
            $scope.data.orderByPriority = "Y"
        }
        if ($scope.statusCountFilter == 9) {
            if ($rootScope.empDetails != undefined && $rootScope.empDetails != null) {
                if ($rootScope.empDetails.roles != undefined && $rootScope.empDetails.roles != null && $rootScope.empDetails.roles.length > 0) {
                    for (let index = 0; index < $rootScope.empDetails.roles.length; index++) {
                        if ($rootScope.empDetails.roles[index].name == "SUPERADMIN") {
                            $scope.flagIsSuperAdmin = true;
                            $scope.superadminRoleId = $rootScope.empDetails.roles[index].id;
                        }
                    }
                }
            }
        }
        if ($scope.flagIsSuperAdmin) {
            $scope.data.roleId = $scope.superadminRoleId;
        }

        if ($scope.typeFilter == 5) {
            $scope.data.nominationId = $scope.nominationId;
            $scope.data.monthValue = $scope.suggestionPagination.selectedMonth.month;
            $scope.data.yearValue = $scope.suggestionPagination.selectedMonth.year;
            if ($scope.juryTab == 1) {
                $scope.data.groupName = "GROUP1";
            } else if ($scope.juryTab == 2) {
                $scope.data.groupName = "GROUP2";
            } else if ($scope.juryTab == 3) {
                $scope.data.groupName = "GROUP3";
            } else {
                $scope.data.groupName = "GROUP4";
            }
        }
        if ($scope.statusCountFilter == 5) {
            // $scope.data.nominationId = $scope.nominationId;
            //$scope.data.status = $scope.selectedFilter.status;
            $scope.data.branchId = $scope.loggedInUserBranchId
        }
        // FOR OTHER LIST 
        if ($scope.typeFilter != 7 && $scope.typeFilter != 6 && $scope.typeFilter != 9) {
            if ($scope.suggestionPagination.current == 1) {
                $scope.data.limit = $scope.suggestionPagination.suggestionPerPage;
                $scope.data.offset = 0;
            } else {
                $scope.data.limit = $scope.suggestionPagination.suggestionPerPage;
                $scope.data.offset = ($scope.suggestionPagination.current - 1) * $scope.suggestionPagination.suggestionPerPage;
            }
        }
        // FOR LATERL AND KNOWLEDHGE BANK LIMIT OFFSET
        if ($scope.typeFilter == 7 || $scope.typeFilter == 6 || $scope.typeFilter == 9) {
            if ($scope.suggestionPagination.current == 1) {
                $scope.data.limit = 10;
                $scope.data.offset = 0;
            } else {
                $scope.data.limit = 10;
                $scope.data.offset = ($scope.suggestionPagination.current - 1) * 10;
            }
        }
        /*------------search By (23-06-2020)-----------*/
        // if ($scope.suggDetailModel.hasOwnProperty('searchBy') && !$scope.isEmpty($scope.suggDetailModel.searchBy) && $scope.suggDetailModel.searchBy != '' && $scope.suggDetailModel.searchBy.id == 2) {
        //     // $scope.data.SRCH_BY_EMP_ID = $scope.loggedInEmpId;
        //     $scope.data.srchKey = 'SRCH_BY_EMP_ID';
        // }
        // if ($scope.suggDetailModel.searchById) {
        //     // $scope.data.SRCH_BY_SUGG_NUMBER = $scope.suggDetailModel.suggestionNumber;
        //     $scope.data.srchKey = 'SRCH_BY_SUGG_NUMBER';
        //     $scope.data.suggNum = $scope.suggDetailModel.suggestionNumber
        // }
        if ($scope.suggDetailModel.hasOwnProperty('searchBy') && !$scope.isEmpty($scope.suggDetailModel.searchBy)) {
            if ($scope.suggDetailModel.searchBy != '' && $scope.suggDetailModel.searchBy.id == 2) {
                $scope.data.srchKey = 'SRCH_BY_EMP_ID';
                $scope.data.typeId = $scope.selectedFilter.filterId;
            } else if ($scope.suggDetailModel.searchBy != '' && $scope.suggDetailModel.searchBy.id == 1 && ($scope.suggDetailModel.suggestionNumber != undefined && $scope.suggDetailModel.suggestionNumber != "")) {
                $scope.data.srchKey = 'SRCH_BY_SUGG_NUMBER';
                if ($scope.suggDetailModel.searchById) {
                    $scope.data.suggNum = $scope.suggDetailModel.suggestionNumber;
                    $scope.data.typeId = $scope.selectedFilter.filterId;
                }
            } else if ($scope.suggDetailModel.searchBy != '' && $scope.suggDetailModel.searchBy.id == 3 && ($scope.suggDetailModel.suggestionNumber != undefined && $scope.suggDetailModel.suggestionNumber != "")) {
                $scope.data.srchKey = 'SRCH_BY_COMPANY_EMP_ID';
                if ($scope.suggDetailModel.searchById) {
                    $scope.data.companyEmpNum = ($scope.suggDetailModel.suggestionNumber);
                    $scope.data.typeId = $scope.selectedFilter.filterId;
                }
            } else if ($scope.suggDetailModel.searchBy != '' && $scope.suggDetailModel.searchBy.id == 4 && ($scope.suggDetailModel.suggestionNumber != undefined && $scope.suggDetailModel.suggestionNumber != "")) {
                $scope.data.srchKey = 'SRCH_BY_EMP_NAME';
                if ($scope.suggDetailModel.searchById) {
                    $scope.data.empName = $scope.suggDetailModel.suggestionNumber;
                    $scope.data.typeId = $scope.selectedFilter.filterId;
                }
            } else if ($scope.suggDetailModel.searchBy != '' && $scope.suggDetailModel.searchBy.id == 5 && ($scope.suggDetailModel.suggestionNumber != undefined && $scope.suggDetailModel.suggestionNumber != "")) {
                $scope.data.srchKey = 'SRCH_BY_SUGG_TITLE';
                if ($scope.suggDetailModel.searchById) {
                    $scope.data.suggestionTitle = $scope.suggDetailModel.suggestionNumber;
                    $scope.data.typeId = $scope.selectedFilter.filterId;
                }
            }
        }
        if ($scope.suggestionPagination.selectedCatId > 0) {
            $scope.data.catId = $scope.suggestionPagination.selectedCatId;
        } else {
            delete $scope.data.catId;
            $scope.data.processType = $scope.suggDetailModel.selectedCategoryName;
        }

        if ($scope.data.processType == '' || $scope.data.processType == null || $scope.data.processType == undefined) {
            delete $scope.data.processType;
        }
        if ($scope.suggestionPagination.selectedDeptId > 0) {
            $scope.data.deptId = $scope.suggestionPagination.selectedDeptId;
        }
        if ($scope.statusCountFilter == 9) {
            if ($scope.suggestionPagination.selectedStatus != null && $scope.suggestionPagination.selectedStatus != "" && $scope.suggestionPagination.selectedStatus.statusId != undefined) {
                var data = [$scope.suggestionPagination.selectedStatus.statusId]
                $scope.data.statusIds = data;
            } else {
                delete $scope.data.statusIds;
            }
        } else {
            var statusIds = [];
            if ($scope.suggDetailModel.statusList != null && $filter('filter')($scope.suggDetailModel.statusList, { isSelected: true }, true).length > 0) {
                for (let index = 0; index < $scope.suggDetailModel.statusList.length; index++) {
                    if ($scope.suggDetailModel.statusList[index].isSelected && $scope.suggDetailModel.statusList[index].label != 'All') {
                        statusIds.push($scope.suggDetailModel.statusList[index].statusId);
                    }
                }
                $scope.data.statusIds = statusIds;
            }
        }
        if (token == "onLoad" || token == "allSuggestion") {
            $scope.suggestionList = [];
            $scope.flagSuggListBoxIndicator = true;
        } else if (token == "onUpdate") {
            $scope.flagSuggListLineIndicator = true;
        }
        if ($scope.typeFilter != 6 && $scope.typeFilter != 7 && $scope.typeFilter != 8) {
            if ($scope.accessBranchList != null || $scope.accessBranchList != undefined) {
                for (var index = 0; index < $scope.accessBranchList.length; index++) {
                    if ($scope.accessBranchList[index].isSelected) {
                        $scope.data.branchIds.push(parseInt($scope.accessBranchList[index].branchId));
                    }
                }
            }
        }
        //GuestBranach 4-2-2020 
        if ($scope.typeFilter == 8) {
            if ($scope.guestBranchList != undefined || $scope.guestBranchList != null) {
                for (var index = 0; index < $scope.guestBranchList.length; index++) {
                    if ($scope.guestBranchList[index].isSelected) {
                        $scope.data.branchIds.push(parseInt($scope.guestBranchList[index].branchId));
                    }
                }
            }
        }

        /*------------START FOR LATERLAL & KNWLWDGE SERCH FILTER ------------CHANGE BY SUNANDA---------------5-12-19*/
        /*--------START FOR LATERAL SEARCH ------*/
        if ($scope.typeFilter == 7 || $scope.typeFilter == 6) {
            if ($scope.suggestionPagination.fromDt != "" && $scope.suggestionPagination.toDt != "") {
                $scope.data.fromDt = $scope.suggestionPagination.fromDt + ' 00:00:00',
                    $scope.data.toDt = $scope.suggestionPagination.toDt + $filter('date')(new Date(), " HH:mm:ss")
            }

            if ($scope.listFilter.branchId == null || $scope.listFilter.branchId == undefined || $scope.listFilter.branchId == '') {
                if ($scope.listFilter.accessBranchList != undefined || $scope.listFilter.accessBranchList != null) {
                    for (var index = 0; index < $scope.listFilter.accessBranchList.length; index++) {
                        if ($scope.listFilter.accessBranchList[index].isSelectBranch) {
                            $scope.data.branchIds.push(parseInt($scope.listFilter.accessBranchList[index].branchId));
                        }
                    }
                }
            } else {
                $scope.data.branchIds = [parseInt($scope.listFilter.branchId)];
            }
            if ($scope.listFilter.sourceTypeId != null && $scope.listFilter.sourceTypeId != undefined && $scope.listFilter.sourceTypeId != "") {
                $scope.data.sourceTypes = [];
                $scope.data.sourceTypes = [$scope.listFilter.sourceTypeId];
            }
            if ($scope.listFilter.deptId != null && $scope.listFilter.deptId != undefined && $scope.listFilter.deptId != "") {
                $scope.data.deptIds = [];
                $scope.data.deptIds = [$scope.listFilter.deptId];
            }

            if ($scope.listFilter.catId != null && $scope.listFilter.catId != undefined && $scope.listFilter.catId != "") {
                $scope.data.catIds = $scope.listFilter.catId;
            }

            if ($scope.listFilter.activityId != null && $scope.listFilter.activityId != undefined && $scope.listFilter.activityId != "") {
                $scope.data.activityIds = $scope.listFilter.activityId;
            }

            if ($scope.listFilter.sourceId != null && $scope.listFilter.sourceId != undefined && $scope.listFilter.sourceId != "") {
                $scope.data.suggSource = $scope.listFilter.sourceId;
            }
            //-ADVIK CHNAEG BY SUNANDA 4-3-2020   
            if ($scope.listFilter.circleId != null && $scope.listFilter.circleId != undefined && $scope.listFilter.circleId != "") {
                $scope.data.circleId = $scope.listFilter.circleId;
            }
            if ($scope.listFilter.operationId != null && $scope.listFilter.operationId != undefined && $scope.listFilter.operationId != "") {
                $scope.data.operationId = $scope.listFilter.operationId;
            }
            if ($scope.listFilter.machinePartId != null && $scope.listFilter.machinePartId != undefined && $scope.listFilter.machinePartId != "") {
                $scope.data.machinePartId = $scope.listFilter.machinePartId;
            }
            if ($scope.listFilter.machineId != null && $scope.listFilter.machineId != undefined && $scope.listFilter.machineId != "") {
                $scope.data.machineId = $scope.listFilter.machineId;
            }
            if ($scope.listFilter.stageId != null && $scope.listFilter.stageId != undefined && $scope.listFilter.stageId != "") {
                $scope.data.stageId = $scope.listFilter.stageId;
            }
            if ($scope.listFilter.productId != null && $scope.listFilter.productId != undefined && $scope.listFilter.productId != "") {
                $scope.data.productId = $scope.listFilter.productId;
            }
            if ($scope.listFilter.productNoId != null && $scope.listFilter.productNoId != undefined && $scope.listFilter.productNoId != "") {
                $scope.data.productNoId = $scope.listFilter.productNoId;
            }

        }
        /*------------END OF LATERLAL & KNWLWDGE SERCH FILTER ------------CHANGE BY SUNANDA---------------5-12-19*/

        if ($scope.data.branchIds == null || $scope.data.branchIds.length == 0) {
            $scope.suggestionList = [];
            $scope.flagSuggListBoxIndicator = false;
            return;
        }
        // 13-8-2020
        if ($scope.suggDetailModel.selectedLevel != null && $scope.suggDetailModel.selectedLevel != undefined && $scope.suggDetailModel.selectedLevel != '') {
            $scope.data.suggestionLevel = $scope.suggDetailModel.selectedLevel.level;

            // if ($scope.suggDetailModel.selectedLevel.id == 2) {
            //     $scope.data.branchIds = [];
            //     if ($scope.suggDetailModel.selectBranchForSerch != null && $scope.suggDetailModel.selectBranchForSerch != undefined && $scope.suggDetailModel.selectBranchForSerch != '') {
            //         $scope.data.branchIds = [$scope.suggDetailModel.selectBranchForSerch.branchId];
            //     } else {
            //         if ($scope.allBranchaccessList != undefined || $scope.allBranchaccessList != null) {
            //             for (var index = 0; index < $scope.allBranchaccessList.length; index++) {
            //                 $scope.data.branchIds.push($scope.allBranchaccessList[index].branchId);
            //             }
            //         }
            //     }
            // }
        }
        if ($scope.isFilterApplied && $scope.suggDetailModel.fromDt && $scope.suggDetailModel.toDt) {
            $scope.data.fromDt = moment($scope.suggDetailModel.fromDt).format('YYYY-MM-DD') + ' 00:00:00';
            $scope.data.toDt = moment($scope.suggDetailModel.toDt).format('YYYY-MM-DD') + ' 23:59:59';
        }

        if ($scope.isFilterApplied && $scope.suggDetailModel.suggPriorityFilter != undefined && $scope.suggDetailModel.suggPriorityFilter != '') {
            $scope.data.suggPriority = $scope.suggDetailModel.suggPriorityFilter;
        }

        //console.log($scope.data);
        // appService.httpGetLocal('LocalJson/suggList.json')
        appService.httpPost($scope.data, url)
            .then(function (response) {
                $scope.data = {}
                $scope.listFilter.listdeptIds = [],
                    $scope.listFilter.listactivityIds = [],
                    $scope.listFilter.listcatIds = [],
                    $scope.listFilter.listsourceTypes = [],
                    $scope.listFilter.listsuggSource = []
                if (response.statusCode == 200) {
                    $scope.myPoints = response.empPoints;
                }
                if (token == "onLoad") {
                    $scope.flagSuggListBoxIndicator = false;
                    if (response.sugessionsByEmpIdList == null) {
                        $scope.suggestionList = [];
                        $scope.flagSuggNotAvailMsgBox = true;
                        return;
                    }
                } else if (token == "inFlight") {
                    $scope.flagSuggListBoxIndicator = false;
                    $scope.suggestionList = response.sugessionsByEmpIdList;
                    //$scope.suggestionPagination.totalSuggestion = response.sugessionsByEmpIdList[0].winnerListCount;
                } else if (token == "onUpdate" || token == "onAutoLoad") {
                    $scope.flagSuggListLineIndicator = false;
                    $scope.flagSuggNotAvailMsgBox = false;
                    if (response.sugessionsByEmpIdList == null) {
                        $scope.suggestionList = [];
                        $scope.flagSuggNotAvailMsgBox = true;
                        return;
                    }
                } else if (token == "allSuggestion") {
                    $scope.flagSuggListBoxIndicator = false;
                    $scope.allSuggestionCount = response.sugessionsByEmpIdList.length;
                }
                $scope.suggestionList = response.sugessionsByEmpIdList;
                // START FOR JURY LIST
                if ($scope.statusCountFilter == 5) {
                    if (response.result == true) {
                        var sugessionsByEmpIdFormattedList = [];
                        for (var i = 0; i < response.sugessionsByEmpIdList.length; i++) {
                            var suggData = response.sugessionsByEmpIdList[i];
                            if (suggData.inputType == 'JURY') {
                                suggData.parameterList = angular.copy($scope.suggestionEvalParametersList);

                                for (var j = 0; j < suggData.parameterList.length; j++) {
                                    suggData.parameterList[j].ratingList = angular.copy($scope.suggestionEvalRatingsList);
                                    for (var k = 0; k < suggData.suggestionEvalJuryInput.length; k++) {
                                        if (suggData.parameterList[j].id == suggData.suggestionEvalJuryInput[k].parameterId) {
                                            for (var m = 0; m < suggData.parameterList[j].ratingList.length; m++) {
                                                if (suggData.parameterList[j].ratingList[m].id == suggData.suggestionEvalJuryInput[k].ratingId) {
                                                    suggData.parameterList[j].ratingList[m].isSelected = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                suggData.ratingList = null;
                                sugessionsByEmpIdFormattedList.push(suggData);
                            } else if (suggData.inputType == 'PRODUCTION_HEAD') {
                                suggData.ratingList = angular.copy($scope.suggestionEvalRatingsList);
                                for (var k = 0; k < suggData.ratingList.length; k++) {
                                    if (suggData.ratingList[k].id == suggData.phRatingId) {
                                        suggData.ratingList[k].isSelected = true;
                                    }
                                }
                                sugessionsByEmpIdFormattedList.push(suggData);
                            }
                        }
                        var groups = (sugessionsByEmpIdFormattedList)
                            .reduce(function (obj, x) {
                                var assignedToObj = {
                                    "juryName": x.juryName,
                                    "sugNominationId": x.sugNominationId,
                                    "sugId": x.sugId,
                                    "suggestionTitle": x.suggestionTitle,
                                    "suggestionNumber": x.suggestionNumber,
                                    "empName": x.empName,
                                    "jStatus": x.jStatus,
                                    "jAssinedToId": x.jAssinedToId,
                                    "jTotalRating": x.jTotalRating,
                                    "jUpdatedDate": x.jUpdatedDate,
                                    "juryEmpId": x.juryEmpId,
                                    "suggestionEvalJuryInput": x.suggestionEvalJuryInput,
                                    "parameterList": x.parameterList,
                                    "inputType": x.inputType,
                                    "phRating": x.phRating,
                                    "phRatingId": x.phRatingId,
                                    "ratingList": x.ratingList,
                                    "points": x.points,
                                    "totalJuryScore": x.totalJuryScore,
                                    "totalPoints": x.totalPoints,
                                    "isupdate": (x.jStatus == 'PENDING') ? true : false
                                }
                                obj[x.sugId] = obj[x.sugId] || [];
                                obj[x.sugId].push(assignedToObj);
                                return obj;
                            }, {});
                        var myArray = Object.keys(groups)
                            .map(function (key) {
                                return {
                                    sugId: key,
                                    suggestionTitle: groups[key][0].suggestionTitle,
                                    empName: groups[key][0].empName,
                                    suggestionNumber: groups[key][0].suggestionNumber,
                                    points: groups[key][0].points,
                                    totalJuryScore: groups[key][0].totalJuryScore,
                                    totalPoints: groups[key][0].totalPoints,
                                    assignedJuryList: groups[key]
                                };
                            });
                        $scope.juryData = myArray;
                        //console.log($scope.juryData);
                        for (var i = 0; i < $scope.juryData.length; i++) {
                            for (var j = 0; j < $scope.juryData[i].assignedJuryList.length; j++) {
                                if ($scope.loggedInEmpId == $scope.juryData[i].assignedJuryList[j].juryEmpId && $scope.juryData[i].assignedJuryList[j].jStatus == 'PENDING') {
                                    $scope.checkJuryPending = true;
                                }
                            }
                        }
                    } else {
                        $scope.juryData = [];
                    }
                }
                // END OF JURY LIST
                if ($scope.suggestionList != null && $scope.suggestionList.length > 0) {
                    for (var i = 0; i < $scope.suggestionList.length; i++) {
                        $scope.suggestionList[i].suggestionNumber = $scope.suggestionList[i].suggestionNumber;
                    }
                }
                //CALCULATE FOR PENDING SINCE DAYS-----------------change By sunanda/9-19-2019 
                if ($scope.typeFilter != 5) {
                    // angular.forEach(response.sugessionsByEmpIdList, function (value, key) {
                    //     if (moment(value.assignedDate, 'MM/DD/YYYY', true).isValid()) {
                    //         if (value.assignedDate && value.assignedDate != "0") {
                    //             value.inDays = $rootScope.getNoOfDaysUsingDate(value.assignedDate);
                    //         } else {
                    //             value.inDays = 0;
                    //         }
                    //     } else {
                    //         value.inDays = 0;
                    //     }
                    //     // CHECK FOR SELF IMPLEMNET
                    //     if (value.isSelfImplemented == 1) {
                    //         value.selfImpl = "Self Implemented"
                    //     }
                    // });

                    /*change by Rupendra*/
                    for (var j = 0; j < response.sugessionsByEmpIdList.length; j++) {
                        if ((response.sugessionsByEmpIdList[j].assignedDate != null) && (response.sugessionsByEmpIdList[j].assignedDate.length > 0)) {
                            response.sugessionsByEmpIdList[j].inDays = $rootScope.getNoOfDaysUsingDate(response.sugessionsByEmpIdList[j].assignedDate);
                        } else {
                            response.sugessionsByEmpIdList[j].inDays = 0;
                        }
                        if (response.sugessionsByEmpIdList[j].isSelfImplemented == 1) {
                            response.sugessionsByEmpIdList[j].selfImpl = "Self Implemented"
                        }
                    }
                }
                if ($scope.statusCountFilter == 9) {
                    $scope.sustenanceCount = {
                        liveCount: response.liveCount,
                        failedCount: response.failedCount,
                        sustainedCount: response.sustainedCount,
                        underVerificationCount: response.underVerificationCount

                    }
                }
                $scope.suggestionList = response.sugessionsByEmpIdList;
            });
    }
    /*--------------------END OF SUGGESTION LIST --------------------------- */
    $scope.getSugCount = function (data) {
        var totalCount = 0;
        if (data != null && data.length > 0) {
            for (let index = 0; index < data.length; index++) {
                //totalCount += data[index].jTotalRating;
                if (data[index].inputType == 'PRODUCTION_HEAD') {
                    totalCount += data[index].phRating;
                } else if (data[index].inputType == 'JURY') {
                    totalCount += data[index].jTotalRating;
                }
            }
        }
        return totalCount;
    }
    $scope.onPaginationClick = function (number) {
        $scope.suggestionPagination.current = number;
        $scope.suggestionDet = {};
        if ($scope.statusCountFilter == 0) {
            $scope.getsuggestionList('allSuggestion');
        } else {
            $scope.getsuggestionList('onLoad');
        }
    }
    /*-------------------START FOR SUGGESTION COUNT------------------ */
    $scope.getStatusWiseCount = function () {
        $scope.data = {
            assignedToId: $scope.loggedInEmpId,
            juryBranchId: $rootScope.empDetails.branch.branchId,
            orgId: $rootScope.empDetails.organization.orgId,
            // "branchId": $scope.loggedInUserBranchId,
            "onHoldSugBranchIds": [],
            "allSugBranchIds": [],
            "pendSugBranchIds": [],
            "mySugBranchIds": [],
            "lateralSugBranchIds": [],
            "knowledgeBankBranchIds": [],
            "guestSuggBranchIds": [],
            "sustainKaizenBranchIds": [],
            "typeId": $scope.statusCountFilter,
        };

        if ($rootScope.empDetails != undefined && $rootScope.empDetails != null) {
            if ($rootScope.empDetails.roles != undefined && $rootScope.empDetails.roles != null && $rootScope.empDetails.roles.length > 0) {
                for (let index = 0; index < $rootScope.empDetails.roles.length; index++) {
                    if ($rootScope.empDetails.roles[index].name == "SUPERADMIN") {
                        $scope.flagIsSuperAdmin = true;
                        $scope.superadminRoleId = $rootScope.empDetails.roles[index].id;
                    }
                }
            }
        }
        if ($scope.flagIsSuperAdmin) {
            $scope.data.roleId = $scope.superadminRoleId;
        }
        if ($scope.nominationId != undefined && $scope.nominationId != null && $scope.nominationId != '') {
            $scope.data.nominationId = $scope.nominationId;
        }

        if ($scope.isFilterApplied && $scope.suggDetailModel.fromDt && $scope.suggDetailModel.toDt) {
            $scope.data.fromDt = moment($scope.suggDetailModel.fromDt).format('YYYY-MM-DD') + ' 00:00:00';
            $scope.data.toDt = moment($scope.suggDetailModel.toDt).format('YYYY-MM-DD') + ' 23:59:59';
        }

        if ($scope.suggestionPagination.fromDt != "" && $scope.suggestionPagination.toDt != "") {
            $scope.data.fromDt = $scope.suggestionPagination.fromDt + ' 00:00:00';
            $scope.data.toDt = $scope.suggestionPagination.toDt + $filter('date')(new Date(), " HH:mm:ss");
        }
        if ($scope.suggestionPagination.selectedCatId > 0) {
            $scope.data.catId = $scope.suggestionPagination.selectedCatId;
        } else {
            delete $scope.data.catId;
            $scope.data.processType = $scope.suggDetailModel.selectedCategoryName;
        }

        if ($scope.data.processType == '' || $scope.data.processType == null || $scope.data.processType == undefined) {
            delete $scope.data.processType;
        }

        if ($scope.suggestionPagination.selectedDeptId > 0) {
            $scope.data.deptId = $scope.suggestionPagination.selectedDeptId;
        }

        if ($scope.statusCountFilter == 9) {
            if ($scope.suggestionPagination.selectedStatus != null && $scope.suggestionPagination.selectedStatus != "" && $scope.suggestionPagination.selectedStatus.statusId != undefined) {
                var data = [$scope.suggestionPagination.selectedStatus.statusId]
                $scope.data.statusIds = data;
            } else {
                delete $scope.data.statusIds;
            }
        } else {
            var statusIds = [];
            if ($scope.suggDetailModel.statusList != null && $filter('filter')($scope.suggDetailModel.statusList, { isSelected: true }, true).length > 0) {
                for (let index = 0; index < $scope.suggDetailModel.statusList.length; index++) {
                    if ($scope.suggDetailModel.statusList[index].isSelected && $scope.suggDetailModel.statusList[index].label != 'All') {
                        statusIds.push($scope.suggDetailModel.statusList[index].statusId);
                    }
                }
                $scope.data.statusIds = statusIds;
            }
        }
        if ($scope.pendingBranchlist != undefined || $scope.pendingBranchlist != null) {
            for (var index = 0; index < $scope.pendingBranchlist.length; index++) {
                if ($scope.pendingBranchlist[index].isSelected) {
                    $scope.data.pendSugBranchIds.push($scope.pendingBranchlist[index].branchId);
                }
            }
        }
        if ($scope.mySuggBranchlist != undefined || $scope.mySuggBranchlist != null) {
            for (var index = 0; index < $scope.mySuggBranchlist.length; index++) {
                if ($scope.mySuggBranchlist[index].isSelected) {
                    $scope.data.mySugBranchIds.push($scope.mySuggBranchlist[index].branchId);
                }
            }
        }
        if ($scope.onholdBranchlist != undefined || $scope.onholdBranchlist != null) {
            for (var index = 0; index < $scope.onholdBranchlist.length; index++) {
                if ($scope.onholdBranchlist[index].isSelected) {
                    $scope.data.onHoldSugBranchIds.push($scope.onholdBranchlist[index].branchId);
                }
            }
        }
        if ($scope.allBranchaccessList != undefined || $scope.allBranchaccessList != null) {
            //console.log($scope.allBranchaccessList, $scope.mySuggBranchlist, $scope.pendingBranchlist)
            for (var index = 0; index < $scope.allBranchaccessList.length; index++) {
                if ($scope.allBranchaccessList[index].isSelected) {
                    $scope.data.allSugBranchIds.push($scope.allBranchaccessList[index].branchId);
                }
            }
        }
        if ($scope.sustainKaizenBrancList != undefined || $scope.sustainKaizenBrancList != null) {
            for (var index = 0; index < $scope.sustainKaizenBrancList.length; index++) {
                if ($scope.sustainKaizenBrancList[index].isSelected) {
                    $scope.data.sustainKaizenBranchIds.push($scope.sustainKaizenBrancList[index].branchId);
                }
            }
        }
        //GuestBranach 4-2-2020 
        if ($scope.guestBranchList != undefined || $scope.guestBranchList != null) {
            for (var index = 0; index < $scope.guestBranchList.length; index++) {
                if ($scope.guestBranchList[index].isSelected) {
                    $scope.data.guestSuggBranchIds.push($scope.guestBranchList[index].branchId);
                }
            }
        }

        /*------------START FOR LATERLAL & KNWLWDGE SERCH FILTER ------------CHANGE BY SUNANDA---------------5-12-19*/
        /*--------START FOR KNOWLEDGE BANK SEARCH ----2-1-2020--*/
        // change for konwledgebanck branchId 7-2-2020
        if ($scope.listFilter.branchId == null || $scope.listFilter.branchId == undefined || $scope.listFilter.branchId == '') {
            if ($scope.listFilter.accessBranchList != undefined || $scope.listFilter.accessBranchList != null) {
                for (var index = 0; index < $scope.listFilter.accessBranchList.length; index++) {
                    if ($scope.listFilter.accessBranchList[index].isSelectBranch) {
                        $scope.data.knowledgeBankBranchIds.push($scope.listFilter.accessBranchList[index].branchId);
                    }
                }
            }
        } else {
            $scope.data.knowledgeBankBranchIds.push($scope.listFilter.branchId.toString());
        }


        if ($scope.listFilter.sourceTypeId != null && $scope.listFilter.sourceTypeId != undefined && $scope.listFilter.sourceTypeId != '') {
            $scope.data.sourceTypes = [$scope.listFilter.sourceTypeId];
        }
        /*--------END OF KNOWLEDGE BANK SEARCH ------*/
        // change for Lateral branchId 7-2-2020
        if ($scope.listFilter.branchId == null || $scope.listFilter.branchId == undefined || $scope.listFilter.branchId == '') {
            if ($scope.listFilter.accessBranchList != undefined || $scope.listFilter.accessBranchList != null) {
                for (var index = 0; index < $scope.listFilter.accessBranchList.length; index++) {
                    if ($scope.listFilter.accessBranchList[index].isSelectBranch) {
                        $scope.data.lateralSugBranchIds.push($scope.listFilter.accessBranchList[index].branchId);
                    }
                }
            }
        } else {
            $scope.data.lateralSugBranchIds.push($scope.listFilter.branchId.toString());
        }

        //-ADVIK CHNAEG BY SUNANDA 4-3-2020   
        if ($scope.listFilter.circleId != null && $scope.listFilter.circleId != undefined && $scope.listFilter.circleId != "") {
            $scope.data.circleId = $scope.listFilter.circleId;
        }
        if ($scope.listFilter.operationId != null && $scope.listFilter.operationId != undefined && $scope.listFilter.operationId != "") {
            $scope.data.operationId = $scope.listFilter.operationId;
        }
        if ($scope.listFilter.machinePartId != null && $scope.listFilter.machinePartId != undefined && $scope.listFilter.machinePartId != "") {
            $scope.data.machinePartId = $scope.listFilter.machinePartId;
        }
        if ($scope.listFilter.machineId != null && $scope.listFilter.machineId != undefined && $scope.listFilter.machineId != "") {
            $scope.data.machineId = $scope.listFilter.machineId;
        }
        if ($scope.listFilter.stageId != null && $scope.listFilter.stageId != undefined && $scope.listFilter.stageId != "") {
            $scope.data.stageId = $scope.listFilter.stageId;
        }
        if ($scope.listFilter.productId != null && $scope.listFilter.productId != undefined && $scope.listFilter.productId != "") {
            $scope.data.productId = $scope.listFilter.productId;
        }
        if ($scope.listFilter.productNoId != null && $scope.listFilter.productNoId != undefined && $scope.listFilter.productNoId != "") {
            $scope.data.productNoId = $scope.listFilter.productNoId;
        }

        /*------------search By (23-06-2020)-----------*/
        if ($scope.suggDetailModel.hasOwnProperty('searchBy') && !$scope.isEmpty($scope.suggDetailModel.searchBy)) {
            if ($scope.suggDetailModel.searchBy != '' && $scope.suggDetailModel.searchBy.id == 2) {
                $scope.data.srchKey = 'SRCH_BY_EMP_ID';
                $scope.data.typeId = $scope.selectedFilter.filterId;
            } else if ($scope.suggDetailModel.searchBy != '' && $scope.suggDetailModel.searchBy.id == 1 && ($scope.suggDetailModel.suggestionNumber != undefined && $scope.suggDetailModel.suggestionNumber != "")) {
                $scope.data.srchKey = 'SRCH_BY_SUGG_NUMBER';
                if ($scope.suggDetailModel.searchById) {
                    $scope.data.suggNum = $scope.suggDetailModel.suggestionNumber;
                    $scope.data.typeId = $scope.selectedFilter.filterId;
                }
            } else if ($scope.suggDetailModel.searchBy != '' && $scope.suggDetailModel.searchBy.id == 3 && ($scope.suggDetailModel.suggestionNumber != undefined && $scope.suggDetailModel.suggestionNumber != "")) {
                $scope.data.srchKey = 'SRCH_BY_COMPANY_EMP_ID';
                if ($scope.suggDetailModel.searchById) {
                    $scope.data.companyEmpNum = ($scope.suggDetailModel.suggestionNumber);
                    $scope.data.typeId = $scope.selectedFilter.filterId;
                }
            } else if ($scope.suggDetailModel.searchBy != '' && $scope.suggDetailModel.searchBy.id == 4 && ($scope.suggDetailModel.suggestionNumber != undefined && $scope.suggDetailModel.suggestionNumber != "")) {
                $scope.data.srchKey = 'SRCH_BY_EMP_NAME';
                if ($scope.suggDetailModel.searchById) {
                    $scope.data.empName = $scope.suggDetailModel.suggestionNumber;
                    $scope.data.typeId = $scope.selectedFilter.filterId;
                }
            } else if ($scope.suggDetailModel.searchBy != '' && $scope.suggDetailModel.searchBy.id == 5 && ($scope.suggDetailModel.suggestionNumber != undefined && $scope.suggDetailModel.suggestionNumber != "")) {
                $scope.data.srchKey = 'SRCH_BY_SUGG_TITLE';
                if ($scope.suggDetailModel.searchById) {
                    $scope.data.suggestionTitle = $scope.suggDetailModel.suggestionNumber;
                    $scope.data.typeId = $scope.selectedFilter.filterId;
                }
            }
        }
        if ($scope.suggestionPagination.selectedMonth != undefined && $scope.suggestionPagination.selectedMonth != null) {
            $scope.data.monthValue = $scope.suggestionPagination.selectedMonth.month;
            $scope.data.yearValue = $scope.suggestionPagination.selectedMonth.year;
        }


        //-ADVIK CHNAEG BY SUNANDA 4-3-2020   
        if ($scope.listFilter.circleId != null && $scope.listFilter.circleId != undefined && $scope.listFilter.circleId != "") {
            $scope.data.circleId = $scope.listFilter.circleId;
        }
        if ($scope.listFilter.operationId != null && $scope.listFilter.operationId != undefined && $scope.listFilter.operationId != "") {
            $scope.data.operationId = $scope.listFilter.operationId;
        }
        if ($scope.listFilter.machinePartId != null && $scope.listFilter.machinePartId != undefined && $scope.listFilter.machinePartId != "") {
            $scope.data.machinePartId = $scope.listFilter.machinePartId;
        }
        if ($scope.listFilter.machineId != null && $scope.listFilter.machineId != undefined && $scope.listFilter.machineId != "") {
            $scope.data.machineId = $scope.listFilter.machineId;
        }
        if ($scope.listFilter.stageId != null && $scope.listFilter.stageId != undefined && $scope.listFilter.stageId != "") {
            $scope.data.stageId = $scope.listFilter.stageId;
        }
        if ($scope.listFilter.productId != null && $scope.listFilter.productId != undefined && $scope.listFilter.productId != "") {
            $scope.data.productId = $scope.listFilter.productId;
        }
        if ($scope.listFilter.productNoId != null && $scope.listFilter.productNoId != undefined && $scope.listFilter.productNoId != "") {
            $scope.data.productNoId = $scope.listFilter.productNoId;
        }
        if ($scope.isFilterApplied && $scope.suggDetailModel.suggPriorityFilter != undefined && $scope.suggDetailModel.suggPriorityFilter != '') {
            $scope.data.suggPriority = $scope.suggDetailModel.suggPriorityFilter;
        }
        // 13-8-2020
        if ($scope.suggDetailModel.selectedLevel != null && $scope.suggDetailModel.selectedLevel != undefined && $scope.suggDetailModel.selectedLevel != '') {
            $scope.data.suggestionLevel = $scope.suggDetailModel.selectedLevel.level;
            // if ($scope.suggDetailModel.selectedLevel.id == 2) {
            //     $scope.data.onHoldSugBranchIds = [];
            //     $scope.data.allSugBranchIds = [];
            //     $scope.data.pendSugBranchIds = [];
            //     $scope.data.mySugBranchIds = [];
            //     if ($scope.suggDetailModel.selectBranchForSerch != null && $scope.suggDetailModel.selectBranchForSerch != undefined && $scope.suggDetailModel.selectBranchForSerch != '') {
            //         $scope.data.onHoldSugBranchIds = [$scope.suggDetailModel.selectBranchForSerch.branchId];
            //         $scope.data.allSugBranchIds = [$scope.suggDetailModel.selectBranchForSerch.branchId];
            //         $scope.data.pendSugBranchIds = [$scope.suggDetailModel.selectBranchForSerch.branchId];
            //         $scope.data.mySugBranchIds = [$scope.suggDetailModel.selectBranchForSerch.branchId];
            //     } else {
            //         if ($scope.allBranchaccessList != undefined || $scope.allBranchaccessList != null) {
            //             for (var index = 0; index < $scope.allBranchaccessList.length; index++) {
            //                 $scope.data.mySugBranchIds.push($scope.allBranchaccessList[index].branchId);
            //                 $scope.data.pendSugBranchIds.push($scope.allBranchaccessList[index].branchId);
            //                 $scope.data.allSugBranchIds.push($scope.allBranchaccessList[index].branchId);
            //                 $scope.data.onHoldSugBranchIds.push($scope.allBranchaccessList[index].branchId);
            //             }
            //         }
            //     }
            // }
        }
        /*--------END OF LATERAL SEARCH ------*/

        /*------------END OF LATERLAL & KNWLWDGE SERCH FILTER ------------CHANGE BY SUNANDA---------------5-12-19*/
        // appService.httpGetLocal('LocalJson/suggCountList.json')
        appService.httpPost($scope.data, "getMultiBranchSuggestionCount")
            .then(function (response) {
                $scope.data = {};
                $scope.data.deptId = [];
                $scope.data.sourceTypes = [];
                $scope.listFilter.listdeptIds = [];
                $scope.listFilter.listactivityIds = [];
                $scope.listFilter.listcatIds = [];
                $scope.listFilter.listsourceTypes = [];
                $scope.listFilter.listsuggSource = [];
                $scope.suggestionDet = {};
                SuggMasterData.setEmpBrowniePoints();
                $scope.suggDetailModel.isJuryFlag = (response.isJury) ? response.isJury : 'N';
                $scope.suggDetailModel.isOnholdAuthorityFlag = (response.onholdAuthority) ? response.onholdAuthority : 'N';
                $scope.statusWiseCountList = response.suggestionCountList;
                $scope.totalSuggestionCount = response.totalSuggestionCount;
                $scope.suggestionTotalCount = 0;
                for (var i = 0; i < $scope.statusWiseCountList.length; i++) {
                    // suggFlowConfig.isSuggOnHoldEnbld
                    if ($scope.statusWiseCountList[i].filterId == 4 && $scope.suggDetailModel.isOnholdAuthorityFlag == 'N') {
                        $scope.statusWiseCountList.splice(i, 1);
                    }
                    // //console.log($rootScope.checkSubMenuAccess('Suggestions', 'Knowledge Bank'));
                    // if (($scope.statusWiseCountList[i].filterId == 6) && !$rootScope.checkSubMenuAccess('Suggestions', 'Knowledge Bank')) {
                    //     $scope.statusWiseCountList.splice(i, 1);
                    // }
                    // //console.log($rootScope.checkSubMenuAccess('Suggestions', 'Lateral Suggestion'));
                    // if (($scope.statusWiseCountList[i].filterId == 7) && !$rootScope.checkSubMenuAccess('Suggestions', 'Lateral Suggestion')) {
                    //     $scope.statusWiseCountList.splice(i, 1);
                    // }
                    $scope.suggestionTotalCount += $scope.statusWiseCountList[i].noOfSugesstion;
                    if ($scope.statusWiseCountList[i].filterId == $scope.statusCountFilter) {
                        $scope.suggestionPagination.totalSuggestion = $scope.statusWiseCountList[i].noOfSugesstion;
                    }

                    if ($scope.statusWiseCountList[i].filterId == 5) {
                        $scope.nominationId = $scope.statusWiseCountList[i].nominationId;
                        $scope.flagkizan = true;
                    }
                    $scope.statusWiseCountList[i].viewLabel = $scope.statusWiseCountList[i].filterName;
                    var alies = $rootScope.empDetails.organization.alies;
                    if (alies != null && !angular.isUndefined(alies)) {
                        var labelName = $scope.statusWiseCountList[i].filterName;
                        if (alies == 'cg') {
                            $scope.statusWiseCountList[i].viewLabel = labelName.replace(/suggestion/gi, 'Kaizen');
                        } else if (alies == 'gmr') {
                            if (labelName === 'Lateral Suggestions') {
                                $scope.statusWiseCountList[i].viewLabel = 'IDEAS HORIZONTAL DEPLOYED';
                            } else if (labelName === 'Kaizen Sustenance Monitoring') {
                                $scope.statusWiseCountList[i].viewLabel = 'IDEA SUSTENANCE MONITORING';
                            } else if (labelName === 'Knowledge Bank') {
                                $scope.statusWiseCountList[i].viewLabel = 'IDEA BANK';
                            }
                            else {
                                $scope.statusWiseCountList[i].viewLabel = labelName.replace(/suggestion/gi, 'Idea');
                            }
                        }
                    }
                }
                var k = $scope.statusWiseCountList.length;
                while (k--) {
                    if (($scope.statusWiseCountList[k].filterId == 7) && !$rootScope.checkSubMenuAccess('Suggestions', 'Lateral Suggestion')) {
                        $scope.statusWiseCountList.splice(k, 1);
                    }
                    if (($scope.statusWiseCountList[k].filterId == 6) && !$rootScope.checkSubMenuAccess('Suggestions', 'Knowledge Bank')) {
                        $scope.statusWiseCountList.splice(k, 1);
                    }
                    if (($scope.statusWiseCountList[k].filterId == 5) && !$rootScope.checkSubMenuAccess('Suggestions', 'Suggestions-Nomination') && $scope.suggDetailModel.isJuryFlag == 'N') {
                        $scope.statusWiseCountList.splice(k, 1);
                    }
                }
                if ($scope.statusCountFilter == 0) {
                    $scope.suggestionPagination.totalSuggestion = $scope.totalSuggestionCount[0].noOfSugesstion;
                }
                if ($scope.typeFilter == 1) {
                    $scope.accessBranchList = $scope.pendingBranchlist;
                }
            });
    }
    /*-------------------END OF SUGGESTION COUNT------------------ */
    /*-----------------Start for branch Access List----------------------------------change By sunanda/9-19-2019---------------------*/
    $scope.getBranchAccessSetup = function () {
        appService.httpGet("getBranchAccessSetupByEmpId/" + $rootScope.empDetails.organization.orgId + "/" + $rootScope.empDetails.empId)
            .then(function (response) {
                $scope.accessBranchList = response.branchAccessList;
                if ($scope.accessBranchList != null && $scope.accessBranchList.length > 0) {
                    var found = false;
                    for (var index = 0; index < $scope.accessBranchList.length; index++) {
                        $scope.accessBranchList[index].isSelected = true;
                        if ($scope.accessBranchList[index].branchId == $rootScope.empDetails.branch.branchId) {
                            found = true;
                        }
                    }
                    if (!found) {
                        var tmpData = angular.copy($rootScope.empDetails.branch)
                        tmpData.isSelected = true;
                        tmpData.branchName = $rootScope.empDetails.branch.name;
                        $scope.accessBranchList.push(tmpData);
                    }
                    $scope.selectAllBranch = true;
                } else if ($rootScope.empDetails.branch != null) {
                    var tmpData = angular.copy($rootScope.empDetails.branch)
                    tmpData.isSelected = true;
                    tmpData.branchName = $rootScope.empDetails.branch.name;
                    $scope.accessBranchList = [];
                    $scope.accessBranchList.push(tmpData);
                    $scope.selectAllBranch = true;
                }

                if ($scope.accessBranchList.length > 0) {
                    $scope.selectBranchId = $scope.accessBranchList[0].branchId.toString();
                }
                $scope.allBranchaccessList = angular.copy($scope.accessBranchList);
                $scope.sustainKaizenBrancList = angular.copy($scope.accessBranchList);
                $scope.guestBranchList = angular.copy($scope.accessBranchList); //GuestBranach 4-2-2020 
                $scope.onholdBranchlist = angular.copy($scope.accessBranchList);
                $scope.listFilter.accessBranchList = angular.copy($scope.accessBranchList); //4-12
                $scope.listFilter.accessBranchKnowList = angular.copy($scope.listFilter.accessBranchList);
                $scope.listFilter.accessBranchLateralList = angular.copy($scope.listFilter.accessBranchList);
                $scope.listFilter.branchId = '';
                /*---------------------list for knowledge bank & lateral suggetion--------change by sunanda----------15-11-19*/
                $scope.KnowledgeBankBranchaccessList = angular.copy($scope.accessBranchList);
                $scope.LateralSuggestionsBranchaccessList = angular.copy($scope.accessBranchList);
                $scope.initMasterDataForSugg();
                $scope.getbranchWiseDepartmentList();
                $scope.getRoleList(); //28-1-2020 for points 
            });
    }
    $scope.getBranchAccessSetup();
    /*---------------End for branch Access List----------------------------------change By sunanda/9-19-2019---------------------*/
    $scope.getbranchWiseDepartmentList = function () {
        appService.httpGet("getdepartmentlistbybranchid/" + $scope.selectBranchId)
            .then(function (response) {
                $scope.branchWiseDeptList = response.deptList;
                $scope.selectGraphDeptId = $scope.branchWiseDeptList[0].deptId.toString();
                // $scope.dashboardDetails.deptId = $scope.branchWiseDeptList[0].deptId.toString();
            });
    }

    /*----------multiple branch drupdown----------------------------*/
    $scope.deptToggle = function () {
        $('.deptclass .deptwrapper .list')
            .slideToggle('fast');
    }
    $scope.toggleDeptDiv = function (event) {
        var $trigger = $(".deptclass .deptwrapper");
        if ($trigger !== event.target && !$trigger.has(event.target)
            .length) {
            $(".list").slideUp("fast");
        }
    }

    $scope.rejectionToggle = function () {
        $('.deptwrapper .reasonList')
            .slideToggle('fast');

    }
    $scope.secondRejectionToggle = function () {
        $('.deptwrapper .second-list')
            .slideToggle('fast');

    }
    $scope.implementerRejection = function () {
        $('.deptwrapper .implementerlist')
            .slideToggle('fast');
    }

    $scope.evaluatorRejection = function () {
        $('.deptwrapper .evaluator-list')
            .slideToggle('fast');
    }

    $scope.financeRejection = function () {
        $('.deptwrapper .finance-list')
            .slideToggle('fast');
    }
    $scope.setDeptSelected = function (branch) {
        branch.isSelected = (branch.isSelected) ? false : true;
        for (var i = 0; i < $scope.accessBranchList.length; i++) {
            if (!$scope.accessBranchList.isSelected) {
                $scope.selectAllBranch = false;
            }
        }
        if ($scope.statusCountFilter == 0) {
            $scope.getsuggestionList('allSuggestion');
        } else {
            $scope.getsuggestionList('onLoad');
        }
        if ($filter('filter')($scope.accessBranchList, { isSelected: true }, true).length == 1) {
            var tmpBranch = $filter('filter')($scope.accessBranchList, { isSelected: true }, true);
            if (tmpBranch[0] != null && tmpBranch[0].branchId != undefined) {
                $scope.getDepartmentList(tmpBranch[0].branchId);
                $scope.getCategoryList(tmpBranch[0].branchId);
            }
        }
        $scope.getStatusWiseCount();
        $scope.deptToggle();
    }
    $scope.selectAllDepartment = function () {
        var flag = ($scope.selectAllBranch) ? false : true;
        $scope.selectAllBranch = flag;
        for (var i = 0; i < $scope.accessBranchList.length; i++) {
            $scope.accessBranchList[i].isSelected = $scope.selectAllBranch;
        }
        $scope.getStatusWiseCount();
        if ($scope.statusCountFilter == 0) {
            $scope.getsuggestionList('allSuggestion');
        } else {
            $scope.getsuggestionList('onLoad');
        }
        $scope.deptToggle();
    }

    /*--------End --multiple branch drupdown----------------------------*/
    $scope.setActiveFilter = function (statusDet) {
        $scope.typeFilter = statusDet.filterId;
    }

    $scope.isActiveFilter = function (statusDet) {
        return $scope.typeFilter === statusDet.filterId;
    }
    $scope.applyFilter = function (statusDet) {
        $scope.closedFilter('clearAll');
        $scope.selectedFilter = statusDet;
        $scope.suggDetailModel.suggPriorityFilter = '';
        //Reset Search Filter
        // $scope.suggDetailModel.searchBy = $scope.searchList[0];
        $scope.suggDetailModel.selectedLevel = $scope.suggestionLevelList[0];
        $scope.suggDetailModel.catFilter = '';
        $scope.suggDetailModel.deptFilter = '';
        $scope.suggestionPagination.selectedCatId = 0;
        $scope.suggestionPagination.selectedDeptId = 0;
        $scope.suggDetailModel.selectedCategoryName = '';
        $scope.suggestionPagination.selectedStatus = null;
        if ($scope.suggDetailModel.searchModule) {
            $scope.suggDetailModel.searchModule = false;
            $scope.suggDetailModel.searchById = false;
            // $scope.getStatusWiseCount();
        }
        $scope.suggestionDet = {};
        if (statusDet == 'all') {
            $scope.setActiveFilter('all');
            $scope.statusCountFilter = 0;
            $scope.accessBranchList = $scope.allBranchaccessList;
            $scope.getsuggestionList('allSuggestion');
        } else {
            $scope.setActiveFilter(statusDet);
            if ($scope.typeFilter == 1) {
                $scope.accessBranchList = $scope.pendingBranchlist;
            } else if ($scope.typeFilter == 2) {
                $scope.accessBranchList = $scope.mySuggBranchlist;
            } else if ($scope.typeFilter == 4) {
                $scope.accessBranchList = $scope.onholdBranchlist;
            } else if ($scope.typeFilter == 6) {
                $scope.listFilter.accessBranchList = $scope.listFilter.accessBranchKnowList;
            } else if ($scope.typeFilter == 7) {
                $scope.listFilter.accessBranchList = $scope.listFilter.accessBranchLateralList;
            } else if ($scope.typeFilter == 7 || $scope.typeFilter == 6) {
                $scope.listFilter.catagoryList = $scope.listFilter.catagoryLateralList;
                $scope.listFilter.activityList = $scope.listFilter.activityLateralList;
                $scope.listFilter.suggestionSourceList = $scope.listFilter.suggestionSourceLateralList;
                $scope.listFilter.departmentList = $scope.listFilter.departmentLateralList;
            } else if ($scope.typeFilter == 5) {
                // $scope.getJuryTopKiazenList();
                $scope.getJueryStatusList();
                // $scope.getJuryList();
                $scope.setJuryTab(1);
            } else if ($scope.typeFilter == 8) {
                $scope.accessBranchList = $scope.guestBranchList; //GuestBranach 4-2-2020 
            } else if ($scope.typeFilter == 9) {
                $scope.accessBranchList = $scope.sustainKaizenBrancList; // 9-12-2020 
            }
            if ($scope.typeFilter != 9 && $scope.typeFilter != 6 && $scope.typeFilter != 7) {
                $scope.suggestionPagination.current = 1;
                $scope.suggestionPagination.suggestionPerPage = 20;
            } else {
                $scope.suggestionPagination.current = 1;
                $scope.suggestionPagination.suggestionPerPage = 10;
            }
            $scope.statusCountFilter = statusDet.filterId;
            $scope.suggDetailModel.searchKeyword = '';
            $scope.suggDetailModel.suggestionNumber = '';
            $scope.getsuggestionList('onLoad');
            // serchClear 10-3-1
        }
        $scope.getStatusWiseCount();
        $scope.flagSuggestionFilter = true;
    }

    //Setting default filter as Peding Zero
    $scope.defaultFilter = {
        filterId: $scope.CONST.COUNT_FILTERS.PENDING
    };

    $scope.typeFilter = $scope.defaultFilter.filterId;
    //----------------------------Winning board List--------------------------------//
    $scope.onRepeatEnd = function (token) {
        $timeout(function () {
            if ($scope.getSuggestionDetailsFlag == 'onUpdate') {
                $scope.getSuggestionDetails($scope.selectedSuggId, 'onSuggSelect');
            } else {
                if (token == "suggList") {
                    $scope.getSuggestionDetails($scope.suggestionList[0].sugId, 'onSuggSelect', $scope.suggestionList[0].sourceType);
                }
            }
        }, 1);
    };

    //28-1-2020 for points 
    $scope.getRoleList = function () {
        appService.httpGet("getlistofrole").then(function (response) {
            if (response.reason) {
                $scope.roleList = response.roleList;
            } else {
                $scope.RoleList = [];
            }
        });
    }
    // Reopen Sustenence audit
    $scope.isReopenSugg = function (x) {
        var flag = false;
        if (x) {
            if (x.statusId == $scope.CONST.STATUS.Sustained.statusId || x.statusId == $scope.CONST.STATUS.SustainanceFailed.statusId) {
                flag = true;
            }
        }
        return flag;
    }
    $scope.getSustenaceAuditorList = function () {

        if ($scope.sustenanceAuditorList != null && $filter('filter')($scope.sustenanceAuditorList, { branchId: $scope.selectedSustenaceData.branchId }, true).length > 0) {
            for (let index = 0; index < $scope.sustenanceAuditorList.length; index++) {
                if ($scope.sustenanceAuditorList[index].empId == $scope.selectedSustenaceData.susAuditorId) {
                    $scope.selectedSustenaceData.susAuditorData = $scope.sustenanceAuditorList[index];
                }
            }
        } else {
            var req = {
                "branchId": $scope.selectedSustenaceData.branchId,
                "type": "SUGGESTION",
                // "orgId": $rootScope.empDetails.organization.orgId
            }
            appService.httpPost(req, "getAuditorDetailsNew")
                .then(function (response) {
                    if (response.result) {
                        $scope.sustenanceAuditorList = [];
                        if (response.auditorList != null && response.auditorList.length > 0) {
                            for (let index = 0; index < response.auditorList.length; index++) {
                                if (response.auditorList[index].empId == $scope.selectedSustenaceData.susAuditorId) {
                                    $scope.selectedSustenaceData.susAuditorData = response.auditorList[index];
                                }
                            }
                            $scope.sustenanceAuditorList = response.auditorList;
                        } else {
                            $scope.sustenanceAuditorList = [];
                        }
                    } else {
                        $scope.sustenanceAuditorList = [];
                    }
                });
        }
    }
    $scope.viewAuditorModal = function (x) {
        $scope.selectedSustenaceData = x;
        $scope.getSustenaceAuditorList();
        $("#sustenanceAuditorModal")
            .modal({
                backdrop: 'static',
                keyboard: false
            });
    }
    $scope.submitLoader = false;
    $scope.reopenSustenenceAudit = function () {
        $scope.submitLoader = true;
        var req = {
            "sugId": $scope.selectedSustenaceData.sugId,
            "auditorId": $scope.selectedSustenaceData.susAuditorData.empId,
            "createdBy": $scope.loggedInEmpId,
            "updatedBy": $scope.loggedInEmpId
        }
        //console.log(req);
        // var x = 0;
        // if (x == 0) {
        //     $scope.submitLoader = false;
        //     return;
        // }
        appService.httpPost(req, "ReassignedToSustenanceAuditor")
            .then(function (response) {
                $scope.submitLoader = false;
                if (response.result) {
                    snackbar.create('Suggestion assinged successfully', 3000, "success");
                    $("#sustenanceAuditorModal")
                        .modal('hide');
                    $scope.selectedSustenaceData = {};
                    // $scope.applyFilter($scope.selectedFilter);
                    $scope.getsuggestionList('onUpdate');
                } else {
                    if (response.statusCode == 100) {
                        snackbar.create(response.reason, 3000, "error");
                    } else {
                        snackbar.create('Error occurred while submitting data. Please try again.', 3000, "error");
                    }
                }
            });
    }

    $scope.getBenefitAnalysisList = function (branchId) {
        appService.httpGet("getbenefitanalysislist/0/" + branchId)
            .then(function (response) {
                if (response.result) {
                    if (response.benefitAnalysisList != null && response.benefitAnalysisList.length > 0) {
                        for (let index = 0; index < response.benefitAnalysisList.length; index++) {
                            response.benefitAnalysisList[index].isselect = false;
                            response.benefitAnalysisList[index].isBenefitChecked = false;
                        }
                        $scope.benefitList = response.benefitAnalysisList;
                        $scope.isBenefitBeforChecked();
                    } else {
                        $scope.benefitList = [];
                    }
                } else {
                    $scope.benefitList = [];
                }
            });
    }
    // Get Sustenance Audit -Mahesh 24-02-2020
    $scope.getSustenanceAudit = function () {
        appService.httpGet('getSustenanceAuditParam').then(function (response) {
            if (response.result) {
                if (response.auditParamList != null && response.auditParamList.length > 0) {
                    $scope.suggestionDet.sustenanceAuditData.questions = response.auditParamList;
                } else {
                    $scope.suggestionDet.sustenanceAuditData.questions = [];
                }
            } else {
                $scope.suggestionDet.sustenanceAuditData.questions = [];
            }
        });
    }

    $scope.showkaizenMonitorDetails = function (sugId, onSuggSelect, sourceType, auditorName) {

        $scope.getSuggestionDetails(sugId, onSuggSelect, sourceType);

        $scope.selectedAuditorName = auditorName;
        $("#sustanceModal")
            .modal({
                backdrop: 'static',
                keyboard: false
            });
    }
    $scope.getDocumentsList = function (branchId) {
        appService.httpGet('getdocumentlistbybranchid/' + branchId)
            .then(function (response) {
                if (response.result) {
                    if (response.document != null && response.document.length > 0) {
                        $scope.documentLists = response.document;
                        $scope.isdocumentBeforeCheck();
                    } else {
                        $scope.documentLists = [];
                    }
                } else {
                    $scope.documentLists = [];
                }
            });
    }
    $scope.getSuggCategoryList = function (branchId) {
        appService.httpGet("getcategorylistbyorgid/0/" + branchId)
            .then(function (response) {
                if (response.result) {
                    if (response.catagoryList != null && response.catagoryList.length > 0) {
                        $scope.suggCatbranchwise = response.catagoryList;
                    } else {
                        $scope.suggCatbranchwise = [];
                    }
                } else {
                    $scope.suggCatbranchwise = [];
                }
            });
    }
    $scope.initSuggData = function (branchId) {
        //get Category List
        // $scope.getSuggCategoryList(branchId);
        if ($rootScope.getOrgByAlies('dcmsugar')) {
            $scope.getSuggAccessList(branchId);
        }
        $scope.getDepartmentList(branchId);
        $scope.getDocumentsList(branchId);
    }
    // START FOR SUGGESTION DETAILS 
    $scope.getSuggestionDetails = function (id, event, sourceType) {
        $scope.suggestionDet = {}
        $scope.suggestionBranchConfig = {};
        $scope.selectedsourceType = sourceType;
        $scope.flagrejectEvalarea = false;
        $scope.flagrejarea = false;
        $scope.flagrejectonhold = false;
        $scope.flagresumeonhold = false;
        $scope.flagAccRejTextarea = false;
        $scope.flagAccPillerLeavel = false;
        $scope.flagImpReject = false;
        $scope.isDropdownRejEval = false;
        $scope.isEvaluatorReject = false;
        $scope.isFinanceReject = false;
        $scope.isDropdownRejFc = false;
        $scope.isSubmitFinanace = false;
        $scope.isRejectByEval = false;
        $scope.selectAllRejection = false;
        $scope.suggestionInputDetails = {};
        $scope.suggestionInputDetails.currentDate = $filter('date')(new Date(), 'yyyy-MM-dd');//moment();
        $scope.cfmValue = ''; //cfm
        $scope.selectedEmpList = [];
        $scope.showComment = false;
        $scope.showCommentButon = false
        $scope.flagCheckVerify = false;
        $scope.implData.safetImplactionSummary = null;
        $scope.underFinanceApprovalList = [];
        $scope.cfmValue = '';

        $scope.empInputDet.selectedEmpIds = []; // Store only the current employee's ID
        $scope.empInputDet.selectedEmpId = '';
        $scope.empInputDet.selectedRowId = '';

        // if (!$scope.isSuggestionAccess) {
        //     $scope.suggestionDet = {};
        //     return;
        // }
        if ($scope.mainTab == 1) {
            $scope.inFlightSugg = true;
        } else if ($scope.mainTab == 4) {
            $scope.inFlightSugg = false;
        }

        if (event == "onSuggSelect") {
            $scope.flagSuggDetBoxIndicator = true;
            $scope.suggestionDet = {};
        } else {
            $scope.flagSuggDetLoader = true;
        }

        $scope.setActiveSuggCard(id);
        $scope.selectedSuggId = id;
        $scope.suggestionInputDetails.acceptRejectStatus = '';
        $scope.getSuggestionDetailsFlag = '';

        $scope.analysisRecommendTabsFillStatus = {
            changeDoc: false,
            kaizenActivity: false,
            otherBenefits: false,
            horizontalDeployment: false,
            recommendation: false,
        }

        $scope.tabContentChecked = {
            benefits: false,
            markBenefitsAsClicked: false,
            otherBenefits: false,
            markOtherBenefitsAsClicked: false,
            hzDeployment: false,
            markHzDeployementClicked: false,
            whyAnalysis: false,
            kaizenSustain: false,
            results: false,
            financeVerification: false,
            teamMembers: false,
            markTeamMemberAsClicked: false,
        }

        // appService.httpGetLocal('LocalJson/suggDet.json')
        appService.httpGet("getSuggestionDetails/" + id)
            .then(function (response) {
                $scope.flagSuggDetLoader = false;
                $scope.isExecutiveSugg = false;
                $scope.flagSuggDetBoxIndicator = false;
                $scope.isSelectedSuggestionEdited = false;

                if (response != null && response.status == "success") {
                    //Clearing the models bound to the inputs of suggestion details block
                    $scope.clearSuggDetFields();
                    $scope.suggestionDet.exportCer = "";
                    $scope.suggestionDet = response.sugesstionDetails;
                    $scope.suggestionBranchConfig = response.suggBranchConfig;
                    if (response.data) {
                        $scope.getFCList();
                        $scope.suggestionDet.FCData = response.data;
                        // $scope.isFcAvailable($scope.suggestionDet.FCData);
                    }
                    $scope.checkImplData($scope.suggestionDet);
                    $scope.getRejectionListDetails($scope.suggestionDet.sugId);
                    $scope.dropDownRejectionList();
                    $scope.getEvalcommentDetails();
                    $scope.initSuggData($scope.suggestionDet.branch.branchId);
                    $scope.getHDSuggestionConfigList($scope.suggestionDet.branch.branchId);
                    // Idea/Implementation Award
                    $scope.suggestionDet.recommendationData = {};
                    $scope.suggestionDet.recommendationData.ideaAwardCommentEval = ($scope.suggestionDet.ideaAwardCommentEval) ? $scope.suggestionDet.ideaAwardCommentEval : '';
                    $scope.suggestionDet.recommendationData.ideaAwardRecommEval = ($scope.suggestionDet.ideaAwardRecommEval) ? $scope.suggestionDet.ideaAwardRecommEval : '';
                    $scope.suggestionDet.recommendationData.implAwardCommentEval = ($scope.suggestionDet.implAwardCommentEval) ? $scope.suggestionDet.implAwardCommentEval : '';
                    $scope.suggestionDet.recommendationData.implAwardRecommEval = ($scope.suggestionDet.implAwardRecommEval) ? $scope.suggestionDet.implAwardRecommEval : '';
                    if ($scope.suggestionDet.isCFMRequired != undefined && $scope.suggestionDet.isCFMRequired != "" && $scope.suggestionDet.isCFMRequired == "Y") {
                        $scope.suggestionDet.isCFMRequired = true;
                    } else {
                        $scope.suggestionDet.isCFMRequired = false;
                    }
                    if ($scope.suggestionDet.isCFMApprove != undefined && $scope.suggestionDet.isCFMApprove != "" && $scope.suggestionDet.isCFMApprove == "Y") {
                        $scope.suggestionDet.isCFMApprove = true;
                    } else {
                        $scope.suggestionDet.isCFMApprove = false;
                    }
                    //PARENT KAIZEN DETAILS 3-3-2020 BY SUNANDA

                    if ($scope.suggestionDet.sourceType == 'HD') {
                        if ($scope.suggestionDet.suggestionHD != null) {
                            $scope.suggestionDet.parentSuggestionHDId = $scope.suggestionDet.suggestionHD.parentSuggId;
                        }
                    }
                    //6-3-2020
                    if ($scope.suggestionDet.suggestionTrackerDetails != null) {
                        for (let i = 0; i < $scope.suggestionDet.suggestionTrackerDetails.length; i++) {
                            if ($scope.suggestionDet.suggestionTrackerDetails[i].team_type_master != null) {
                                if ($scope.suggestionDet.suggestionTrackerDetails[i].team_type_master.type == 'Implementation') {
                                    $scope.implwhyWhyAnalysisData = $scope.suggestionDet.suggestionTrackerDetails[i];
                                }
                            }

                        }
                    }


                    if ($scope.suggestionDet.category != null) {
                        // $scope.suggestionDet.hdCatId = $scope.suggestionDet.category.catId.toString();
                        $scope.suggestionDet.hdCatId = (!$scope.isEmpty($scope.suggestionDet.category)) ? $scope.suggestionDet.category : '';
                    } else {
                        $scope.suggestionDet.hdCatId = '';
                    }
                    // 27-1-2020
                    $scope.suggestionDet.suggestionPointAuditList = response.suggestionPointAuditList;

                    $scope.suggestionDet.suggestionHDList = response.suggestionHDList;

                    if (response.suggestionHDList != null) {
                        for (var j = 0; j < response.suggestionHDList.length; j++) {
                            response.suggestionHDList[j].filterCreatedDate = $filter('date')(new Date(response.suggestionHDList[j].createdDate), 'yyyy-MM-dd');
                        }
                    }
                    if ($scope.suggestionDet.sustenanceAuditorId) {
                        $scope.implInputData.sustenanceAuditorId = $scope.suggestionDet.sustenanceAuditorId.toString();
                    }
                    $scope.setExportData(response.sugesstionDetails);
                    $scope.suggestionDet.changeDocInput = '';
                    $scope.suggestionDet.docFileName = '';
                    if ($scope.suggestionDet.pillar != null && !$scope.checkForHdConfig()) {
                        $scope.suggestionDet.activityId = $scope.suggestionDet.pillar.id;
                    }
                    //get Particular Details
                    // $scope.getParticular($scope.suggestionDet.category.catId);
                    $scope.getParticular($scope.suggestionDet.branch.branchId);
                    for (var i = 0; i < ($scope.suggestionDet.evaluationTeamList)
                        .length; i++) {
                        if ($scope.suggestionDet.evaluationTeamList[i].evaluationInputs == 'null') {
                            $scope.suggestionDet.evaluationTeamList[i].evaluationInputs = '';
                        }
                    }

                    for (var i = 0; i < ($scope.suggestionDet.implTeamList)
                        .length; i++) {
                        if ($scope.suggestionDet.implTeamList[i].implInputs == 'null') {
                            $scope.suggestionDet.implTeamList[i].implInputs = '';
                        }
                    }
                    for (var i = 0; i < ($scope.suggestionDet.sugEmpDocDetails)
                        .length; i++) {
                        if ($scope.suggestionDet.sugEmpDocDetails[i].url != null && $scope.suggestionDet.sugEmpDocDetails[i].url.lastIndexOf('.') != null)
                            $scope.suggestionDet.sugEmpDocDetails[i].ext = $scope.suggestionDet.sugEmpDocDetails[i].url.substring($scope.suggestionDet.sugEmpDocDetails[i].url.lastIndexOf('.') + 1);
                    }


                    //Detecting that suggestion is assigned for executive or not [i.e. executive flow is there are not]
                    if ($scope.suggestionDet.isExecutive == 1) {
                        $scope.isExecutiveSugg = true;
                    }

                    //Showing last tab selected in evaluation details block as this is the user whom suggestion is assigned at last
                    $scope.clTab = $scope.suggestionDet.evaluationTeamList.length - 1;
                    $scope.implClTab = $scope.suggestionDet.implTeamList.length - 1;
                    //Holding last status id to show the last suggestion section expanded and in between sections collapsed
                    $scope.lastSuggStatusAuditId = $scope.suggestionDet.sugesstionStatusAudit[$scope.suggestionDet.sugesstionStatusAudit.length - 1].status_master.statusId;

                    if ($scope.suggestionDet.implBenefitAnalysisList.length > 0 && $scope.suggestionDet.implBenefitAnalysisList != null) {
                        var str = [];
                        for (var i = 0; i < $scope.suggestionDet.implBenefitAnalysisList.length; i++) {
                            str.push($scope.suggestionDet.implBenefitAnalysisList[i].benefitAnalysis.benefits);
                        }

                        $scope.kaizenExportFormatedData.benefits = str.toString();
                    }
                    if ($scope.suggestionDet.document != null && $scope.suggestionDet.document.length != 0) {
                        $scope.suggestionDet.doc = {};
                        for (var i = 0; i < $scope.suggestionDet.document.length; i++) {
                            if ($scope.suggestionDet.document[i].fileName != null || $scope.suggestionDet.document[i].fileName != '') {
                                $scope.suggestionDet.doc.fileName = $scope.suggestionDet.document[i].fileName;
                            } else {
                                $scope.suggestionDet.doc.fileName = 'N/A';
                            }
                            if ($scope.suggestionDet.document[i].document.documentName != null || $scope.suggestionDet.document[i].document.documentName != '') {
                                $scope.suggestionDet.doc.docName = $scope.suggestionDet.document[i].document.documentName;
                            } else {
                                $scope.suggestionDet.doc.docName = 'N/A';
                            }
                            if ($scope.suggestionDet.document[i].document.owner.firstName != null || $scope.suggestionDet.document[i].document.owner.firstName != '' || $scope.suggestionDet.document[i].document.owner.lastName != '' || $scope.suggestionDet.document[i].document.owner.lastName != null) {
                                $scope.suggestionDet.doc.ownerName = $scope.suggestionDet.document[i].document.owner.firstName + ' ' + $scope.suggestionDet.document[i].document.owner.lastName;
                            }
                        }
                    } else {
                        $scope.suggestionDet.doc = {};
                    }
                    for (var i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                        //Checking that suggestion is edited or not
                        if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.EditedByCreator.status) {
                            $scope.isSelectedSuggestionEdited = true;
                        }

                        //Maintaining status audit id(Primary Key) of Eval Assigned status for showing only requeired users list in evaluation details block
                        if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.EvaluationAssigned.status) {
                            $scope.evalAssignedStatusAdtId = $scope.suggestionDet.sugesstionStatusAudit[i].stsadtId;
                        }

                        //Maintaining status audit id(Primary Key) of Impl Assigned status for showing only requeired users list in evaluation details block
                        if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.ImplementationAssigned.status) {
                            $scope.evalAssignedStatusAdtId = $scope.suggestionDet.sugesstionStatusAudit[i].stsadtId;
                            $scope.implAssignedStatusAdtId = $scope.suggestionDet.sugesstionStatusAudit[i].stsadtId;
                        }

                        //Maintaining max user level for dept level flow
                        if ($scope.suggestionDet.sugesstionStatusAudit[i].emp_details != null && $scope.suggestionDet.sugesstionStatusAudit[i].emp_details != undefined) {
                            if ($scope.suggestionDet.sugesstionStatusAudit[i].emp_details.departmentLevel != null && $scope.suggestionDet.sugesstionStatusAudit[i].emp_details.departmentLevel.length > 0) {
                                //$scope.suggestionDet.sugesstionStatusAudit[i].emp_details.departmentLevel = $filter('orderBy')($scope.suggestionDet.sugesstionStatusAudit[i].emp_details.departmentLevel, 'id');
                                $scope.maxUserLevel = $scope.suggestionDet.sugesstionStatusAudit[i].emp_details.departmentLevel[0].level;
                            }
                        }
                        if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.Implemented.status) {
                            $scope.suggestionDet.ownerDetails = [];
                            if ($scope.suggestionDet.document != null && $scope.suggestionDet.document.length != 0) {
                                for (var j = 0; j < $scope.suggestionDet.document.length; j++) {
                                    if ($scope.suggestionDet.document[j].status == 'COMPLETED') {
                                        var objt = {
                                            ownerName: $scope.suggestionDet.document[j].document.owner.firstName + ' ' + $scope.suggestionDet.document[j].document.owner.lastName,
                                            docName: $scope.suggestionDet.document[j].document.documentName,
                                            docDate: $scope.suggestionDet.document[j].updatedDate
                                        }
                                        $scope.suggestionDet.ownerDetails.push(objt);
                                    }
                                }
                            }
                            //Sustenance auditor - Mahesh 24-02-2020 
                            $scope.suggestionDet.sustenanceAuditData = {};
                            $scope.getSustenanceAudit();
                        }
                        // if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.EvaluationRequestAccepted.status) {
                        //     // $scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.ImplementationRequestAccepted.status
                        //     if ($scope.suggestionDet.sustenanceAuditorList == null || $scope.suggestionDet.sustenanceAuditorList.length == 0) {
                        //         $scope.getSustenaceAuditor();
                        //     }
                        // }
                        if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.UnderFinanceVerification.status) {
                            $scope.underFinanceApprovalList.push($scope.suggestionDet.sugesstionStatusAudit[i]);
                        }
                    }

                    if ($scope.suggestionDet.evaluationPointsSavingList != null && $scope.suggestionDet.evaluationPointsSavingList.length != 0) {
                        $scope.SavingTypeLists = [];
                        for (let i = 0; i < $scope.suggestionDet.evaluationPointsSavingList.length; i++) {
                            var data = $scope.suggestionDet.evaluationPointsSavingList[i].setPointsForSaving;
                            let objt = {
                                type: data.savingOptions.name,
                                option: data.savingOptionsRole.name,
                                amt: data.amountUpto + '(' + data.currency.code + ')',
                                points: data.points,
                                minutes: data.minutes,
                                tabId: data.savingOptions.id,
                                selectedId: $scope.suggestionDet.evaluationPointsSavingList[i].id,
                                amtId: data.id
                            }
                            $scope.SavingTypeLists.push(objt);
                        }
                    } else {
                        $scope.SavingTypeLists = [];
                    }

                    //Check selected kaizen activity
                    if ($scope.activityList != null && $scope.activityList.length > 0) {
                        for (var k = 0; k < $scope.activityList.length; k++) {
                            $scope.activityList[k].isselect = false;
                        }
                    }

                    if ($scope.suggestionDet.suggestionActivityList != null && $scope.suggestionDet.suggestionActivityList.length > 0) {

                        for (var i = 0; i < $scope.suggestionDet.suggestionActivityList.length; i++) {
                            for (var j = 0; j < $scope.activityList.length; j++) {
                                if ($scope.suggestionDet.suggestionActivityList[i].activity.id == $scope.activityList[j].id) {
                                    $scope.activityList[j].isselect = true;
                                    $scope.activityIdList = $scope.suggestionDet.suggestionActivityList[i].activity.id;
                                    break;
                                }
                            }
                        }
                    }
                    //end check selected kaizen activity
                    //Initialize eval in input
                    for (var i = 0; i < $scope.suggestionDet.suggestionTrackerDetails.length; i++) {
                        if ($scope.suggestionDet.suggestionTrackerDetails[i].team_type_master != null && $scope.suggestionDet.suggestionTrackerDetails[i].team_type_master.teamTypeId == 1) {
                            $scope.suggestionDet.eval = $scope.suggestionDet.suggestionTrackerDetails[i];
                            break;
                        }
                    }
                    //End Initialize Eval in input
                    //check selected benifts
                    for (var k = 0; k < $scope.orgLevelBenefitMasterList.length; k++) {
                        $scope.orgLevelBenefitMasterList[k].isselect = false;
                    }
                    if ($scope.suggestionDet.implBenefitAnalysisList != null && $scope.suggestionDet.implBenefitAnalysisList.length > 0) {
                        for (var i = 0; i < $scope.suggestionDet.implBenefitAnalysisList.length; i++) {
                            for (var j = 0; j < $scope.orgLevelBenefitMasterList.length; j++) {
                                if ($scope.orgLevelBenefitMasterList[j].benfitId == $scope.suggestionDet.implBenefitAnalysisList[i].benefitAnalysis.benfitId) {
                                    $scope.orgLevelBenefitMasterList[j].isselect = true
                                    break;
                                }
                            }
                        }
                    }
                    //end check selected benifts
                    //Document Grouping(Pending doc and verification doc)
                    $scope.setDocumentStatusData();
                    ////console.log($scope.suggestionDet);
                    //grouping multiple Horizotal dept
                    var resGroups = $scope.suggestionDet.sugesstionStatusAudit.reduce(function (obj, item) {
                        if (item.status_master.statusId == $scope.CONST.STATUS.AssignedToImplementorForHorizantalDeployement.statusId) {
                            var statusId = item.status_master.statusId
                            obj[statusId] = obj[statusId] || [];
                            obj[statusId].push(item);
                        } else {

                        }
                        return obj;
                    }, {});

                    var myArray = Object.keys(resGroups)
                        .map(function (key) {
                            return {
                                statusId: key,
                                status_master: $scope.CONST.STATUS.AssignedToImplementorForHorizantalDeployement,
                                status_audit: resGroups[key],
                                emp_details: resGroups[key][0].emp_details,
                                actionStatus: resGroups[key][0].actionStatus
                            };
                        });

                    var horizontalIndex = -1;
                    if (myArray != null && myArray.length > 0) {
                        for (var i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                            var tmpStatus = $scope.suggestionDet.sugesstionStatusAudit[i];
                            if (tmpStatus.status_master.status == $scope.CONST.STATUS.AssignedToImplementorForHorizantalDeployement.status) {
                                if (horizontalIndex == -1) {
                                    $scope.suggestionDet.sugesstionStatusAudit[i] = myArray[0];
                                    horizontalIndex = i;
                                } else {
                                    $scope.suggestionDet.sugesstionStatusAudit.splice(i, 1);
                                }
                            }
                        }
                    }

                    // Horizontal Deployment Grouping 
                    var HorDeptGroups = $scope.suggestionDet.suggestionHorizontalDept.reduce(function (obj, item) {
                        var deptId = item.deptId;
                        obj[deptId] = obj[deptId] || [];
                        obj[deptId].push(item);
                        return obj;
                    }, {});
                    ////console.log("Horizontal Grouping1");
                    ////console.log(HorDeptGroups);
                    $scope.suggestionDet.suggestionHorizontalDeptGroup = [];
                    $scope.suggestionDet.suggestionHorizontalDeptGroup = Object.keys(HorDeptGroups).map(function (key) {
                        var lineList = [];
                        var tmpLineFound = false;

                        angular.forEach(HorDeptGroups[key], function (value, key) {
                            if (value.lineId != null && value.lineId != 0) {
                                tmpLineFound = true;
                                lineList.push({ id: value.id, lineId: value.lineId, name: value.lineName, isselect: true, isEvalselect: true, isImplselect: true }); //9-11
                            }
                        });
                        if (tmpLineFound) {
                            lineList.push({ id: 0, lineId: 0, name: 'All', isselect: true });
                        }
                        return {
                            id: (lineList.length == 0) ? HorDeptGroups[key][0].id : 0,
                            deptId: parseInt(key),
                            deptName: HorDeptGroups[key][0].deptName,
                            lineFound: (lineList.length > 0 ? true : false),
                            lineList: lineList,
                            data: HorDeptGroups[key],
                            isselect: true,
                        };
                    });

                    ////console.log("Horizontal Grouping2");
                    ////console.log($scope.suggestionDet.suggestionHorizontalDeptGroup);
                    //if($scope.suggestionDet.status_master.status==$scope.CONST.STATUS.ImplementationRequestAccepted.status){ 
                    for (var i = 0; i < $scope.departmentList.length; i++) {
                        $scope.departmentList[i].isselect = false; //becuz this is global variable
                        $scope.departmentList[i].isEvalselect = false;
                        $scope.departmentList[i].isImplselect = false;
                        $scope.departmentList[i].lineFound = false;
                        $scope.departmentList[i].lineList = [];
                        var tmpLength = $filter('filter')($scope.suggestionDet.suggestionHorizontalDeptGroup, { deptId: $scope.departmentList[i].deptId }, true).length;
                        if ($scope.departmentList[i].deptName != 'All' && tmpLength > 0) {
                            $scope.departmentList[i].isselect = true;
                            $scope.departmentList[i].isEvalselect = true;
                            $scope.departmentList[i].isImplselect = true;
                            $scope.departmentList[i].lineList = [];
                            for (var j = 0; j < $scope.suggestionDet.suggestionHorizontalDeptGroup.length; j++) {
                                if ($scope.suggestionDet.suggestionHorizontalDeptGroup[j].deptId == $scope.departmentList[i].deptId && $scope.suggestionDet.suggestionHorizontalDeptGroup[j].lineFound) {
                                    $scope.departmentList[i].lineFound = true;
                                    $scope.departmentList[i].lineList = $scope.suggestionDet.suggestionHorizontalDeptGroup[j].lineList;
                                }
                            }
                        }
                    }
                    // }
                    ////console.log("Horizontal Grouping3");
                    ////console.log($filter('filter')($scope.departmentList, { isselect: true }));
                    //check current user is supervisor or levelup
                    // for (var i = 0; i < $rootScope.empDetails.departmentLevel.length; i++) {
                    //     if ($rootScope.empDetails.departmentLevel[i].level == 0) {
                    //         $scope.suggestionDet.supervisorptp = true;
                    //         break;
                    //     } else {
                    //         $scope.suggestionDet.supervisorptp = false;
                    //     }
                    // }
                    //end check current user is supervisor or levelup
                    //Before Image Array
                    if ($scope.suggestionDet.sugEmpDocDetails != null && $filter('filter')($scope.suggestionDet.sugEmpDocDetails, { docType: 'beforeDoc' }, true).length > 0) {
                        $scope.suggestionDet.beforeImgArray = $filter('filter')($scope.suggestionDet.sugEmpDocDetails, { docType: 'beforeDoc' }, true);
                    } else {
                        $scope.suggestionDet.beforeImgArray = [];
                    }
                    //4 block summary
                    $scope.suggestionDet.blocksummery = {};
                    var benefits = [];
                    if ($scope.suggestionDet.sugEmpDocDetails != null && $filter('filter')($scope.suggestionDet.sugEmpDocDetails, { docType: 'beforeDoc' }, true).length > 0) {
                        $scope.suggestionDet.blocksummery.beforeImg = $filter('filter')($scope.suggestionDet.sugEmpDocDetails, { docType: 'beforeDoc' }, true);
                    } else {
                        $scope.suggestionDet.blocksummery.beforeImg = [];
                    }
                    if ($scope.suggestionDet.implBenefitAnalysisList != null && $scope.suggestionDet.implBenefitAnalysisList.length > 0) {
                        for (var i = 0; i < $scope.suggestionDet.implBenefitAnalysisList.length; i++) {
                            benefits.push($scope.suggestionDet.implBenefitAnalysisList[i].benefitAnalysis.benefits);
                        }
                        $scope.suggestionDet.blocksummery.benefits = benefits.join();
                    }
                    //Category
                    var category = [];
                    var text = "";
                    if ($scope.orgLevelBenefitMasterList != null && $scope.orgLevelBenefitMasterList.length > 0) {
                        for (var i = 0; i < $scope.orgLevelBenefitMasterList.length; i++) {
                            //category.push($scope.benefitList[i].benefits[0]);
                            if ($scope.orgLevelBenefitMasterList[i].branch.branchId == $scope.suggestionDet.branch.branchId) {
                                if ($scope.orgLevelBenefitMasterList[i].isselect) {
                                    text += "<span style='width: 30px;border: 1px solid #000;margin: 1px;position: relative;padding:5px;font-weight:bold;'>" + $scope.orgLevelBenefitMasterList[i].benefits[0] + "<div style='position: absolute;right: 0px;top:-3px;'><span style='font-size:12px;color: #615b5b;font-weight:bold;'>&#10003;</span></div></span>";
                                } else {
                                    text += "<span style='width: 30px;border: 1px solid #000;margin: 1px;position: relative;padding:5px;'>" + $scope.orgLevelBenefitMasterList[i].benefits[0] + "</span>";
                                }
                            }
                        }
                        $scope.suggestionDet.blocksummery.category = text;
                    }
                    //Controller
                    for (var i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                        if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.SuggestionAssigned.status) {
                            $scope.suggestionDet.blocksummery.controller = $scope.suggestionDet.sugesstionStatusAudit[i].emp_details;
                        }
                    }
                    //Evaluator
                    var evalNames = [];
                    if ($scope.suggestionDet.evaluationTeamList != null && $scope.suggestionDet.evaluationTeamList.length > 0) {
                        for (var i = 0; i < $scope.suggestionDet.evaluationTeamList.length; i++) {
                            evalNames.push($scope.suggestionDet.evaluationTeamList[i].empName);
                        }
                        $scope.suggestionDet.blocksummery.evaluator = evalNames.join();
                    }
                    //Implementor
                    var implNames = [];
                    if ($scope.suggestionDet.implTeamList != null && $scope.suggestionDet.implTeamList.length > 0) {
                        for (var i = 0; i < $scope.suggestionDet.implTeamList.length; i++) {
                            implNames.push($scope.suggestionDet.implTeamList[i].empName);
                        }
                        $scope.suggestionDet.blocksummery.implementor = implNames.join();
                    }
                    // Document details
                    var documentOwnerName = [];
                    var documentName = [];
                    var documentModifyDate = [];
                    if ($scope.suggestionDet.document != undefined && $scope.suggestionDet.document != null && $scope.suggestionDet.document.length > 0) {
                        for (var doc = 0; doc < $scope.suggestionDet.document.length; doc++) {
                            if ($scope.suggestionDet.document[doc].status == 'COMPLETED') {
                                documentOwnerName.push($scope.suggestionDet.document[doc].document.owner.firstName + ' ' + $scope.suggestionDet.document[doc].document.owner.lastName)

                                documentName.push($scope.suggestionDet.document[doc].document.documentName);
                                documentModifyDate.push($scope.suggestionDet.document[doc].createdDate)
                            }
                        }
                        $scope.suggestionDet.blocksummery.documentOwnerName = documentOwnerName.join();
                        $scope.suggestionDet.blocksummery.documentName = documentName.join();
                        $scope.suggestionDet.blocksummery.documentModifyDate = documentModifyDate.join();
                    }
                    // Implementation team
                    var implementationTeam = [];
                    if ($scope.suggestionDet.sugImplTeam != undefined && $scope.suggestionDet.sugImplTeam != null && $scope.suggestionDet.sugImplTeam.length > 0) {
                        for (var i = 0; i < $scope.suggestionDet.sugImplTeam.length; i++) {
                            implementationTeam.push($scope.suggestionDet.sugImplTeam[i].empName)
                        }
                        $scope.suggestionDet.blocksummery.implementationTeam = implementationTeam.join();
                    }
                    // Annual Savings
                    var implementationSavings = '';
                    if ($scope.suggestionDet.implTeamList != undefined && $scope.suggestionDet.implTeamList != null && $scope.suggestionDet.implTeamList.length > 0) {
                        for (var i = 0; i < $scope.suggestionDet.implTeamList.length; i++) {
                            implementationSavings = $scope.suggestionDet.implTeamList[0].costEffective
                        }
                        $scope.suggestionDet.blocksummery.savingCost = implementationSavings;
                    }
                    //Change 27-1-2020 
                    if ($scope.suggestionDet.sugesstionStatusAudit != null && $scope.suggestionDet.sugesstionStatusAudit.length > 0) {
                        for (var i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                            if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.Implemented.status) {
                                $scope.suggestionDet.kaizenEndDate = $filter('date')(new Date($scope.suggestionDet.sugesstionStatusAudit[i].createdDate), 'd MMM, y');

                                $scope.suggestionDet.implInputs = ($scope.suggestionDet.sugesstionStatusAudit[i].summary) ? $scope.suggestionDet.sugesstionStatusAudit[i].summary : 'N/A';
                            }
                            if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.UnderFinanceApproval.status) {
                                $scope.suggestionDet.blocksummery.financeController = $scope.suggestionDet.sugesstionStatusAudit[i].emp_details.firstName + ' ' + $scope.suggestionDet.sugesstionStatusAudit[i].emp_details.lastName;
                            }
                        }
                    }
                    if ($scope.suggestionDet.sugesstionStatusAudit != null && $scope.suggestionDet.sugesstionStatusAudit.length > 0) {
                        for (var i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                            if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.UnderFinanceVerification.status) {
                                $scope.suggestionDet.blocksummery.financeValidator = $scope.suggestionDet.sugesstionStatusAudit[i].emp_details.firstName + ' ' + $scope.suggestionDet.sugesstionStatusAudit[i].emp_details.lastName;
                            }
                        }
                    }
                    //Change Document
                    var document = [];
                    if ($scope.suggestionDet.document != null && $scope.suggestionDet.document.length > 0) {
                        for (let index = 0; index < $scope.suggestionDet.document.length; index++) {
                            if ($scope.suggestionDet.document[index].status == 'COMPLETED') {
                                var rec = $scope.suggestionDet.document[index];
                                document.push(rec.document.documentName);
                            }
                        }
                        $scope.suggestionDet.blocksummery.document = document.join();
                    }

                    // 25-2-2020 // 21-3-2020 for eval machine hd
                    $scope.machineHDList = [];
                    if ($scope.suggestionDet.suggestionHorizontalDept != null && $scope.suggestionDet.suggestionHorizontalDept.length > 0) {
                        for (var i = 0; i < $scope.suggestionDet.suggestionHorizontalDept.length; i++) {
                            if ($scope.suggestionDet.suggestionHorizontalDept[i].operationId != null && $scope.suggestionDet.suggestionHorizontalDept[i].hdType == "PLANT_LEVEL") {
                                var obj = {
                                    circle: {
                                        id: $scope.suggestionDet.suggestionHorizontalDept[i].circleId,
                                        circleName: $scope.suggestionDet.suggestionHorizontalDept[i].circleName,
                                    },
                                    stage: {
                                        id: $scope.suggestionDet.suggestionHorizontalDept[i].stageId,
                                        stageName: $scope.suggestionDet.suggestionHorizontalDept[i].stageName,
                                    },
                                    product: {
                                        id: $scope.suggestionDet.suggestionHorizontalDept[i].productId,
                                        productName: $scope.suggestionDet.suggestionHorizontalDept[i].productName,
                                    },
                                    machine: {
                                        id: $scope.suggestionDet.suggestionHorizontalDept[i].machineId,
                                        machineName: $scope.suggestionDet.suggestionHorizontalDept[i].machineName,
                                    },
                                    productNo: {
                                        id: $scope.suggestionDet.suggestionHorizontalDept[i].productNoId,
                                        productNo: $scope.suggestionDet.suggestionHorizontalDept[i].productNo,
                                    },
                                    operation: {
                                        id: $scope.suggestionDet.suggestionHorizontalDept[i].operationId,
                                        operationType: $scope.suggestionDet.suggestionHorizontalDept[i].operationType,
                                    }
                                }
                                $scope.machineHDList.push(obj);
                            }

                        }
                    }

                    //console.log($scope.machineHDList);
                    $scope.implMachineHDList = [];
                    // 25-2-2020 // 21-3-2020 for eval machine hd
                    if ($scope.suggestionDet.suggestionHorizontalDept != null && $scope.suggestionDet.suggestionHorizontalDept.length > 0) {
                        for (var i = 0; i < $scope.suggestionDet.suggestionHorizontalDept.length; i++) {
                            if ($scope.suggestionDet.suggestionHorizontalDept[i].operationId != null && $scope.suggestionDet.suggestionHorizontalDept[i].hdType == "PLANT_LEVEL") {
                                var obj = {
                                    id: $scope.suggestionDet.suggestionHorizontalDept[i].id,
                                    circle: {
                                        id: $scope.suggestionDet.suggestionHorizontalDept[i].circleId,
                                        circleName: $scope.suggestionDet.suggestionHorizontalDept[i].circleName,
                                    },
                                    stage: {
                                        id: $scope.suggestionDet.suggestionHorizontalDept[i].stageId,
                                        stageName: $scope.suggestionDet.suggestionHorizontalDept[i].stageName,
                                    },
                                    product: {
                                        id: $scope.suggestionDet.suggestionHorizontalDept[i].productId,
                                        productName: $scope.suggestionDet.suggestionHorizontalDept[i].productName,
                                    },
                                    machine: {
                                        id: $scope.suggestionDet.suggestionHorizontalDept[i].machineId,
                                        machineName: $scope.suggestionDet.suggestionHorizontalDept[i].machineName,
                                    },
                                    productNo: {
                                        id: $scope.suggestionDet.suggestionHorizontalDept[i].productNoId,
                                        productNo: $scope.suggestionDet.suggestionHorizontalDept[i].productNo,
                                    },
                                    operation: {
                                        id: $scope.suggestionDet.suggestionHorizontalDept[i].operationId,
                                        operationType: $scope.suggestionDet.suggestionHorizontalDept[i].operationType,
                                    }
                                }
                                $scope.implMachineHDList.push(obj);
                            }
                        }
                    }

                    //console.log($scope.implMachineHDList);

                    //Check selected Jury activity 05-03-2020------
                    if ($scope.suggestionDet.pillar != null) {
                        if ($scope.activityList != null && $scope.activityList.length > 0) {
                            for (let i = 0; i < $scope.activityList.length; i++) {
                                $scope.activityList[i].isselectjury = false;
                                if ($scope.activityList[i].id == $scope.suggestionDet.pillar.id) {
                                    $scope.activityList[i].isselectjury = true;
                                }
                            }
                        }
                    }
                    //Sustenance Auditor Inputs
                    if ($scope.suggestionDet.sustenanceAuditorInputs != null && $scope.suggestionDet.sustenanceAuditorInputs.length > 0) {
                        for (let index = 0; index < $scope.suggestionDet.sustenanceAuditorInputs.length; index++) {
                            $scope.suggestionDet.sustenanceAuditorInputs[index].createdDate = ($scope.suggestionDet.sustenanceAuditorInputs[index].createdDate) ? $filter('date')(new Date($scope.suggestionDet.sustenanceAuditorInputs[index].createdDate), 'dd/MM/yyyy') : '';
                            $scope.suggestionDet.sustenanceAuditorInputs[index].verificationDt = ($scope.suggestionDet.sustenanceAuditorInputs[index].verificationDt) ? $filter('date')(new Date($scope.suggestionDet.sustenanceAuditorInputs[index].verificationDt), 'dd/MM/yyyy') : '';
                        }
                    }
                } else {
                    $scope.suggestionDet = {};
                    // snackbar.create("Error occurred while retrieving the suggestion details. Please try again.", 4000, "error");
                    snackbar.create($filter('translate')('Oops_Please_try_again'), 4000, "error");

                }

                //If i have clicked on my sugg so first sugg gets shown on sugg det page
                //while loading that first sugg if user selects another suggestion then in that case still the sugg page is loading
                if ($scope.suggestionList.length == 0) {
                    $scope.suggestionDet = {};
                }
                if (!$scope.isEmpty($scope.suggestionDet) && $scope.statusCountFilter != 5 && $scope.typeFilter != 6) {
                    $scope.scrollToBottom('#suggDetailsContainer');
                }
            });
    }
    // END OF SUGGESTION DETAILS 

    $scope.setDocumentStatusData = function () {
        //grouping multiple document owner
        var pendingDocStatus = [];
        var insertindex = -1;
        for (var i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
            var tmpStatus = $scope.suggestionDet.sugesstionStatusAudit[i];
            if (tmpStatus.status_master.status == $scope.CONST.STATUS.PendingDocumentUpdate.status) {
                var docindex = -1;
                for (var k = 0; k < $scope.suggestionDet.document.length; k++) {
                    if ($scope.suggestionDet.document[k].audit.stsadtId == tmpStatus.stsadtId) {
                        docindex = k;
                        insertindex = i;
                        break;
                    }
                }
                if (docindex != -1) {
                    pendingDocStatus.push({
                        audit: tmpStatus,
                        document: $scope.suggestionDet.document[docindex]
                    });
                } else {
                    pendingDocStatus.push({
                        audit: tmpStatus
                    });
                }
            }
        }
        if (pendingDocStatus.length > 0) {
            $scope.suggestionDet.sugesstionStatusAudit[insertindex] = ({
                status_master: pendingDocStatus[0].audit.status_master,
                docList: pendingDocStatus
            });
        }
        //end grouping multiple document owner

        //grouping multiple document verifier
        var resDocGroups = $scope.suggestionDet.sugesstionStatusAudit.reduce(function (obj, item) {
            if (item.status_master.statusId == $scope.CONST.STATUS.DCAssignedForVerification.statusId) {
                var statusId = item.status_master.statusId
                obj[statusId] = obj[statusId] || [];
                obj[statusId].push(item);
            } else {

            }
            return obj;
        }, {});
        ////console.log(resDocGroups);
        var DocArray = Object.keys(resDocGroups).map(function (key) {
            return {
                statusId: key,
                status_master: $scope.CONST.STATUS.DCAssignedForVerification,
                status_audit: resDocGroups[key],
                emp_details: resDocGroups[key][0].emp_details,
                actionStatus: resDocGroups[key][0].actionStatus,
                docList: $scope.suggestionDet.document
            };
        });
        consoleLog("Dock List");
        consoleLog(DocArray)
        var docVerIndex = -1;
        if (DocArray != null && DocArray.length > 0) {
            for (var i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                var tmpStatus = $scope.suggestionDet.sugesstionStatusAudit[i];
                if (tmpStatus.status_master.status == $scope.CONST.STATUS.DCAssignedForVerification.status) {
                    if (docVerIndex == -1) {
                        $scope.suggestionDet.sugesstionStatusAudit[i] = DocArray[0];
                        docVerIndex = i;
                    } else {
                        $scope.suggestionDet.sugesstionStatusAudit.splice(i, 1);
                    }
                }
            }
        }

        if ($scope.suggestionDet.status_master.status == $scope.CONST.STATUS.PendingDocumentUpdate.status || $scope.suggestionDet.status_master.status == $scope.CONST.STATUS.DCAssignedForVerification.status) {

            if ($scope.suggestionDet.status_master.status == $scope.CONST.STATUS.PendingDocumentUpdate.status) {
                if (DocArray.length > 0) {
                    $scope.suggestionDet.sugesstionStatusAudit.push({
                        status_masterDV: $scope.CONST.STATUS.DCAssignedForVerification,
                        docList: DocArray,
                        status_master: $scope.CONST.STATUS.DCAssignedForVerification
                    });
                }
                if (pendingDocStatus.length > 0) {
                    $scope.suggestionDet.sugesstionStatusAudit.push({
                        status_masterDC: pendingDocStatus[0].audit.status_master,
                        docList: pendingDocStatus,
                        status_master: pendingDocStatus[0].audit.status_master
                    });
                }
            } else if ($scope.suggestionDet.status_master.status == $scope.CONST.STATUS.DCAssignedForVerification.status) {

                if (pendingDocStatus.length > 0) {
                    $scope.suggestionDet.sugesstionStatusAudit.push({
                        status_masterDC: pendingDocStatus[0].audit.status_master,
                        docList: pendingDocStatus,
                        status_master: pendingDocStatus[0].audit.status_master
                    });
                }
                if (DocArray.length > 0) {
                    $scope.suggestionDet.sugesstionStatusAudit.push({
                        status_masterDV: $scope.CONST.STATUS.DCAssignedForVerification,
                        docList: DocArray,
                        status_master: $scope.CONST.STATUS.DCAssignedForVerification
                    });
                }
            }
        } else {
            var tmpDCIndex = -1;
            var tmpDVIndex = -1;

            for (var i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                var tmpStatus = $scope.suggestionDet.sugesstionStatusAudit[i];
                if (tmpStatus.status_master.status == $scope.CONST.STATUS.DCAssignedForVerification.status) {
                    if (tmpDVIndex == -1) {
                        tmpDVIndex = i;
                        break;
                    }
                }
            }
            for (var i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                var tmpStatus = $scope.suggestionDet.sugesstionStatusAudit[i];
                if (tmpStatus.status_master.status == $scope.CONST.STATUS.PendingDocumentUpdate.status) {
                    if (tmpDCIndex == -1) {
                        tmpDCIndex = i;
                        break;
                    }
                }
            }

            if (pendingDocStatus.length > 0) {
                $scope.suggestionDet.sugesstionStatusAudit[tmpDCIndex] = ({
                    status_masterDC: pendingDocStatus[0].audit.status_master,
                    docList: pendingDocStatus,
                    status_master: pendingDocStatus[0].audit.status_master
                });
            }
            if (DocArray.length > 0) {
                $scope.suggestionDet.sugesstionStatusAudit[tmpDVIndex] = ({
                    status_masterDV: $scope.CONST.STATUS.DCAssignedForVerification,
                    docList: DocArray,
                    status_master: $scope.CONST.STATUS.DCAssignedForVerification
                });
            }
        }
        $scope.suggestionDetInput.DCStsAdt = {};
        $scope.suggestionDetInput.DVStsAdt = {};
        if ($scope.suggestionDet.sugesstionStatusAudit != null && $scope.suggestionDet.sugesstionStatusAudit.length > 0) {
            var tmpRec = $filter('filter')($scope.suggestionDet.sugesstionStatusAudit, function (value) {
                return (value.hasOwnProperty('status_masterDC') && value.status_masterDC.statusId == $scope.CONST.STATUS.PendingDocumentUpdate.statusId && value.docList != null && value.docList.length > 0);
            });
            var tmpRec1 = $filter('filter')($scope.suggestionDet.sugesstionStatusAudit, function (value) {
                return (value.hasOwnProperty('status_masterDV') && value.status_masterDV.statusId == $scope.CONST.STATUS.DCAssignedForVerification.statusId && value.docList != null && value.docList.length > 0);
            });
            if (tmpRec != null && tmpRec.length > 0) {
                $scope.suggestionDetInput.DCStsAdt = tmpRec[tmpRec.length - 1];
            }
            if (tmpRec1 != null && tmpRec1.length > 0) {
                $scope.suggestionDetInput.DVStsAdt = tmpRec1[tmpRec1.length - 1];
            }
        }
        //console.log($scope.suggestionDetInput);
        consoleLog("Document Verification");
        consoleLog($scope.suggestionDet.sugesstionStatusAudit);
        //end grouping multiple document owner
    }
    $scope.checkCategoryVal = function (id) {
        var flag = false;
        if (id) {
            for (let index = 0; index < $scope.catbranchwise.length; index++) {
                var catName = $scope.catbranchwise[index].categoryName.toLowerCase();
                if ($scope.catbranchwise[index].catId == id && catName == 'cost') {
                    flag = true;
                    break;
                }
            }
        }
        return flag;
    }
    $scope.clearSuggDetFields = function () {
        //Clearing the models bound to the inputs of suggestion details block
        $scope.suggestionInputDetails.acceptRejComment = '';
        $scope.closeConcernComment = '';
        $scope.acceptRejEvalComment = '';
        $scope.suggestionInputDetails.evalEndDate = '';
        $scope.suggestionInputDetails.implEndDate = '';
        $scope.evaluationInputs = '';
        $scope.estimatedCost = '';
        $scope.validation.summary = '';
        $scope.acceptRejImplComment = '';
        $scope.implData.implSummary = '';
        $scope.implData.implactionSummary = '';
        $scope.implData.implementedCost = 0;
        $scope.implData.costEffective = 0;
        $scope.implData.onHoldImplSummary = '';
        $scope.implData.rejectionReason = '';
        //$scope.suggestionDet.closesummery  = '';
        $scope.implData.onholdDate = '';
    }

    /*------------------------------------winner- -----------------------------------------------------------------------*/
    $scope.getMonthIndex = function (val) {
        var months = ["January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"
        ];
        var index = months.indexOf(val);
        return index;
    }


    $scope.getWinnersKaizenList = function (from, to) {
        $scope.data = {
            "empId": $scope.selectedEmp.empId,
            "branchId": $rootScope.empDetails.branch.branchId,
            "fromDt": from, //+ ' 00:00:00',
            "toDt": to //+ ' 23:59:59'
        };

        if ($scope.winningTab == 1) {
            $scope.data.name = "winnersBoard";
        } else {
            $scope.data.name = "EOM";
        }
        appService.httpPost($scope.data, "getWinnersKaizenListByEmpId")
            .then(function (response) {
                $scope.WinnersKaizenList = response.sugessionsByEmpIdList;
                $scope.implement = 0;
                $scope.underImplemented = 0;

                for (var i = 0; i < $scope.WinnersKaizenList.length; i++) {
                    if ($scope.WinnersKaizenList[i].statusId == $rootScope.suggStatus.Implemented.statusId) {
                        $scope.implement += 1;
                    }
                }

                for (var i = 0; i < $scope.WinnersKaizenList.length; i++) {
                    if ($scope.WinnersKaizenList[i].statusId == $rootScope.suggStatus.ImplementationRequestAccepted.statusId) {
                        $scope.underImplemented += 1;
                    }
                }

            });
    }

    $scope.getWinnersBenefitList = function () {
        var selectedMonth = $scope.getMonthIndex($scope.selectedEmp.monthName);
        var selectedYear = $scope.selectedEmp.year;
        var winningFromDt = $scope.getFormatedDate(selectedYear, selectedMonth, "fristDay");
        var winningToDt = $scope.getFormatedDate(selectedYear, selectedMonth, "lastDay");
        winningFromDt = $filter('date')(winningFromDt, 'yyyy-MM-dd');
        winningToDt = $filter('date')(winningToDt, 'yyyy-MM-dd');
        $scope.data = {
            "empId": $scope.selectedEmp.empId,
            "branchId": $rootScope.empDetails.branch.branchId,
            "fromDt": winningFromDt, //+ ' 00:00:00',
            "toDt": winningToDt //+ ' 23:59:59'
        };
        appService.httpPost($scope.data, "getBenefitWiseCountByEmpId")
            .then(function (response) {
                $scope.WinnersBenefitList = response.dataList;
                $scope.getWinnersKaizenList(winningFromDt, winningToDt);

            });
    }

    $scope.getWinnerCount = function (x) {
        if ($scope.winningTab == 1) {
            $scope.title = $filter('translate')('Winner_Analysis');
        } else if ($scope.winningTab == 2) {
            $scope.title = $filter('translate')('Employee_Of_The_Month_Analysis');
        }
        $scope.selectedEmp = x;
        $("#totalSuggCount").modal({
            backdrop: 'static',
            keyboard: false
        });
        $scope.getWinnersBenefitList();

    }

    $scope.getWinnersKaizenMonthList = function () {
        $scope.data = {
            "empId": $scope.selectedEmp.empId,
            "branchId": $rootScope.empDetails.branch.branchId,
            "fromDt": $scope.winningFromDt,
            "toDt": $scope.winningToDt,
        };
        appService.httpPost($scope.data, "getEmployeeOfMonthKaizen")
            .then(function (response) {
                $scope.WinnersKaizenMonthList = response.dataList;
                // $scope.getWinnersBenefitList();
                $scope.getWinnersKaizenMonthList();
            });
    }

    $scope.getMonthCount = function (x) {
        $scope.selectedEmp = x;
        $("#totalMonthCount").modal({
            backdrop: 'static',
            keyboard: false
        });
        $scope.getWinnersBenefitList();
        // $scope.getWinnersKaizenMonthList();
    }
    /*---------------------------Image Viewer---------------------------*/
    $scope.showImageViewer = function (docDet, selectedImgIndex) {
        $scope.selectedDocIndex = selectedImgIndex;
        $scope.viewerImages = docDet;
        $("#imageViewer").modal({
            backdrop: 'static',
            keyboard: false
        });
        $scope.selectedDocSectionName = $scope.viewerImages.section;
        $scope.selectedDocType = $scope.viewerImages.name;
        for (var i = 0; i < $scope.viewerImages.length; i++) {
            if (i == selectedImgIndex) {
                $scope.viewerImages[i].selected = true;
                $("#imageViewer .img-holder")
                    .attr("src", $scope.viewerImages[i]);
            } else
                $scope.viewerImages[i].selected = false;
        }
        $("#imageViewer .img-holder")
            .attr("src", $scope.viewerImages[selectedImgIndex].url);
    }
    /*---------------- After Image Viewer---------------------------*/
    $scope.showImageViewerafter = function (docDet, selectedImgIndex) {
        $scope.selectedDocIndex = selectedImgIndex;
        $scope.viewerImages = docDet;
        $("#imageViewerafter").modal({
            backdrop: 'static',
            keyboard: false
        });
        $scope.selectedDocSectionName = $scope.viewerImages.section;
        $scope.selectedDocType = $scope.viewerImages.name;
        for (var i = 0; i < $scope.viewerImages.length; i++) {
            if (i == selectedImgIndex) {
                $scope.viewerImages[i].selected = true;
                $("#imageViewerafter .img-holder")
                    .attr("src", $scope.viewerImages[i]);
            } else
                $scope.viewerImages[i].selected = false;
        }
        $("#imageViewerafter .img-holder")
            .attr("src", $scope.viewerImages[selectedImgIndex].url);
    }

    /*------------------------ZOOM Image------------------------------------*/
    $scope.zoomIn = function (id) {
        var myImg = document.getElementById(id);
        var currWidth = myImg.clientWidth;
        var currHeight = myImg.clientHeight;
        var currWidth = 100 + "%";
        if ($scope.currWidth >= 865 || $scope.currHeight >= 865) {
            return false;
        } else {
            myImg.style.width = (currWidth + 40) + "px";
            myImg.style.height = (currHeight + 40) + "px";
            $scope.lableVal = $scope.lableVal + 10;
        }
    }

    $scope.lableVal = 100;

    $scope.zoomOut = function (id) {
        var myImg = document.getElementById(id);
        var currWidth = myImg.clientWidth;
        var currHeight = myImg.clientHeight;
        var currWidth = 100 + "%";
        if (currWidth <= 100 || currHeight <= 100) {
            return false;
        } else {
            myImg.style.width = (currWidth - 40) + "px";
            myImg.style.height = (currHeight - 40) + "px";
        }
        $scope.lableVal = $scope.lableVal - 10;
    }

    $scope.onePrint = function (url) {
        var images = [url];
        $scope.printAllImage(images);
    }

    /*----------------------Zoom after image----------------------------------*/

    $scope.zoomInafter = function () {
        var myImgafter = document.getElementById("Imageafter");
        var currWidth = myImgafter.clientWidth;
        var currHeight = myImgafter.clientHeight;
        var currWidth = 100 + "%";
        if ($scope.currWidth >= 865 || $scope.currHeight >= 865) {
            return false;
        } else {
            myImgafter.style.width = (currWidth + 40) + "px";
            myImgafter.style.height = (currHeight + 40) + "px";
            $scope.lableVal = $scope.lableVal + 10;
        }
    }

    $scope.zoomOutafter = function () {
        var myImgafter = document.getElementById("Imageafter");
        var currWidth = myImgafter.clientWidth;
        var currHeight = myImgafter.clientHeight;
        var currWidth = 100 + "%";
        if (currWidth <= 100 || currHeight <= 100) {
            return false;
        } else {
            myImgafter.style.width = (currWidth - 40) + "px";
            myImgafter.style.height = (currHeight - 40) + "px";
        }
        $scope.lableVal = $scope.lableVal - 10;
    }


    /*------------------------------------------------------------------------*/

    $scope.setSelectedViewerImage = function (index) {
        $scope.selectedDocIndex = index;
        $scope.selectedDocIndex = document.getElementById("Image")
            .style.cssText = ' currHeight : 100% ; currWidth : 100%';
        for (var i = 0; i < $scope.viewerImages.length; i++) {
            if (i == index) {
                $scope.viewerImages[i].selected = true;
                $scope.selectedImgUrl = $scope.viewerImages[i].url;
                $("#imageViewer .img-holder")
                    .attr("src", $scope.viewerImages[i].url);
                $("#imageViewerafter .img-holder")
                    .attr("src", $scope.viewerImages[i].url);
            } else
                $scope.viewerImages[i].selected = false;
        }
    }

    $scope.removeDocFromImageViewer = function () {
        $scope.viewerImages[i].splice($scope.selectedDocIndex, 0);
        if ($scope.viewerImages[i].length == 0) {
            $("#imageViewer")
                .modal('hide');
            $("#imageViewerafter")
                .modal('hide');
        }
        $scope.setSelectedViewerImage(0);
    }

    //-------------------------------print function---------------------------
    function ImagetoPrint(imgList) {
        var printString = "<html><head><script>function step1(){";
        printString = printString + "setTimeout('step2()', 10);}";
        printString = printString + "function step2(){window.print();window.close()}";
        printString = printString + "</script></head><body onload='step1()'>";
        for (var i = 0; i < imgList.length; i++) {
            printString = printString + "<img src='" + imgList[i] + "'height='200' width='400'/><br/>";
        }
        printString = printString + "</body></html>";
        return printString;
    }

    $scope.printAllImage = function (imgList) {
        var Pagelink = "about:blank";
        var pwa = window.open(Pagelink, "_new");
        pwa.document.open();
        pwa.document.write(ImagetoPrint(imgList));
        pwa.document.close();
    }

    $scope.clickPrint = function (data) {
        var images = [];
        for (var i = 0; i < data.length; i++) {
            images.push(data[i].url);
        }
        $scope.printAllImage(images);
    }

    $scope.onePrint = function (url) {
        var images = [url];
        $scope.printAllImage(images);
    }

    $scope.showImplFinanceEmpList = function (userTypeId) {
        //userTypeId 1 => Finance Validator
        //userTypeId 2 => Finance Approval
        //userTypeId 3 => Implementer
        $scope.flagTeamDetPopupLoading = true;
        $scope.flagTeamDetNotAvailMsg = false;
        var req = {
            "orgId": $rootScope.empDetails.organization.orgId,
            "branchId": $scope.suggestionDet.branch.branchId,
            "userType": { "id": userTypeId }
        }
        appService.httpPost(req, 'getSuggestionUserDetails').then(function (response) {
            $scope.flagTeamDetPopupLoading = false;
            if (response.result) {
                if (response.list != null && response.list.length > 0) {
                    for (let index = 0; index < response.list.length; index++) {
                        response.list[index].empName = response.list[index].name;
                    }
                    if ($scope.suggestionInputDetails.acceptRejBy == 'byImpl' && $scope.selectedTeamTypeForAssign == 'passToPeer') {
                        var i = response.list.length
                        while (i--) {
                            if (response.list[i].empId == $rootScope.empDetails.empId) {
                                response.list.splice(i, 1);
                            }
                        }
                    }
                    $scope.empListByTeamType = response.list;
                } else {
                    $scope.empListByTeamType = [];
                    $scope.flagTeamDetNotAvailMsg = true;
                    if (userTypeId == 3) {
                        $scope.getEmployeeList($scope.suggestionDet.branch.branchId);
                    }
                }
            } else {
                $scope.empListByTeamType = [];
                $scope.flagTeamDetNotAvailMsg = true;
                if (userTypeId == 3) {
                    $scope.getEmployeeList($scope.suggestionDet.branch.branchId);
                }
            }
        });
    }
    //-------------------------------Print Function End---------------------------
    //Assign to IMPLEMENTER tier-1
    $scope.acceptScrutinizer = function () {
        // $scope.flagTeamDetPopupLoading = true;
        // $scope.flagTeamDetNotAvailMsg = false;
        // var url = "getemplistrolewise/" + $scope.loggedInUserBranchId + "/9";
        $scope.showImplFinanceEmpList(3);
        $scope.popupTitle = "Implementers";
        $("#teamDetModal")
            .modal({
                backdrop: 'static',
                keyboard: false
            });
        // appService.httpGet(url)
        //     .then(function(response) {
        //         $scope.flagTeamDetPopupLoading = false;
        //         if (response.result) {
        //             $scope.empListByTeamType = response.allEmpDetails;
        //             for (var i = 0; i < $scope.empListByTeamType.length; i++) {
        //                 $scope.empListByTeamType[i].empName = $scope.empListByTeamType[i].firstName + ' ' + $scope.empListByTeamType[i].lastName;
        //                 $scope.empListByTeamType[i].deptName = $scope.empListByTeamType[i].dept.deptName;
        //             }
        //             if ($scope.empListByTeamType == null || $scope.empListByTeamType.length == 0) {
        //                 $scope.flagTeamDetNotAvailMsg = true;
        //             }
        //         } else {
        //             $scope.empListByTeamType = [];
        //             $scope.flagTeamDetNotAvailMsg = true;
        //         }
        //     });
    }
    $scope.assignToImpl = function () {
        $scope.flagTeamDetPopupSpinner = true;
        var selectedEmpIds = [];
        if ($scope.suggestionDet.isSelfImplemented == 1 || (($scope.suggestionDet.category.processType == 'Tier-1' && $scope.suggestionBranchConfig.isTierOneSelfImpl == 1) || ($scope.suggestionDet.category.processType == 'Tier-2' && $scope.suggestionBranchConfig.tierTwoSelfImpl == 1))) {
            if ($scope.selectedTeamTypeForAssign == 'passToPeer') {
                // $.each($("input[name='empChk']:checked"), function () {
                //     selectedEmpIds.push(parseInt($(this)
                //         .val()));
                // });
                selectedEmpIds = $scope.empInputDet.selectedEmpIds;
            } else {
                // selectedEmpIds.push($scope.suggestionDet.emp_details.empId);
                if ($scope.suggestionDet.emp_details.hasOwnProperty('empType') && $scope.suggestionDet.emp_details.empType == 'CW') {
                    selectedEmpIds.push($scope.suggestionDet.createdBy.empId);
                } else {
                    selectedEmpIds.push($scope.suggestionDet.emp_details.empId);
                }
            }
        } else {
            // $.each($("input[name='empChk']:checked"), function () {
            //     selectedEmpIds.push(parseInt($(this)
            //         .val()));
            // });
            selectedEmpIds = $scope.empInputDet.selectedEmpIds;
        }
        $scope.data = {
            sugg_id: $scope.selectedSuggId,
            stsId: $scope.CONST.STATUS.ImplementationAssigned.statusId,
            empIds: selectedEmpIds,
            assigned_by: parseInt($scope.loggedInEmpId),
            tmtypeId: $scope.CONST.TEAM_TYPE.IMPLEMENTATION
        }
        if ($scope.suggestionDet.isSelfImplemented != 1) {
            if (selectedEmpIds == null || selectedEmpIds.length == 0) {
                $scope.flagTeamDetPopupSpinner = false;
                angular.element("#errId_team")
                    .text($filter('translate')('Please_select_team_member'));
                return;
            }
        }
        var url = "";
        if ($scope.selectedTeamTypeForAssign == 'passToPeer') {
            url = "passtopeer";
            $scope.data = {
                empId: selectedEmpIds[0],
                sugId: parseInt($scope.selectedSuggId),
                assignedById: parseInt($scope.loggedInEmpId),
                summary: $scope.suggestionDet.passToPeerSummary

            };
            $scope.data.statusId = $scope.CONST.STATUS.PassToPeerImplementer.statusId;
            $scope.data.teamTypeId = 2;
        } else {
            url = "assignSuggestionToImpl";
        }
        //console.log($scope.data);
        appService.httpPost($scope.data, url)
            .then(function (response) {
                $scope.flagTeamDetPopupSpinner = false;
                if (response.result) {
                    $scope.selectedTeamTypeForAssign = "";
                    $("#teamDetModal")
                        .modal("hide");
                    $scope.getSuggestionDetails($scope.selectedSuggId);
                    $scope.getsuggestionList('onLoad');
                    $scope.getStatusWiseCount();
                    if ($scope.suggestionDet.isSelfImplemented == 1) {
                        snackbar.create($filter('translate')('Suggestion_assinged_implementer_implementation'), 6000, "success");
                    } else {
                        snackbar.create($filter('translate')('Suggestion_implementer_successfully'), 6000, "success");
                    }
                } else {
                    snackbar.create($filter('translate')('Oops_Please_try_again'), 6000, "error");
                }
            })
    }
    $scope.showAcceptRejectSection = function (status, accRejBy) {
        var alies = $rootScope.empDetails.organization.alies;
        $scope.suggestionInputDetails.acceptRejectStatus = status;
        $scope.suggestionInputDetails.acceptRejBy = accRejBy;
        $scope.suggestionInputDetails.acceptRejComment = '';
        $scope.evaluationInputs = '';
        $scope.suggestionDet.evaluationInputs = '';
        //eval Date and Impl Date empty if set
        // $scope.suggestionInputDetails.implEndDate = '';
        // $scope.suggestionInputDetails.evalEndDate = '';
        if (status == "accept") {
            $scope.isEvalAcceptSection = false;
            $scope.flagAccRejTextarea = false;
            $scope.textareaLabel = "";
            $scope.flagAccPillerLeavel = true; // change 1 -17-12-19
            $scope.isOther = false;
        } else if (status == "reject") {
            $scope.isEvalAcceptSection = false;
            $scope.flagAccRejTextarea = true;
            $scope.flagrejectEvalarea = true;
            $scope.flagrejarea = true;
            $scope.flagrejectonhold = true;
            $scope.isDropdownRej = true;
            $scope.isDropdownRejImpl = true;
            $scope.isDropdownRejEval = true;
            $scope.isRejectByEval = true;
            //$scope.dropdownForEscalationPerson = true;
            $scope.flagImpReject = true;
            $scope.flagresumeonhold = false;
            $scope.flagFurtherhold = false;
            $scope.flagAccPillerLeavel = false;
            $scope.suggestionInputDetails.acceptRejectStatus = status;
            $scope.isOther = false;
            $scope.isImplementerRej = false;
            $scope.isEvaluatorReject = false;
            // $scope.isSelectAnotherScru = false;
            $scope.textareaLabel = "Reason";
        } else if (status == "reAssignForEdit") {
            $scope.isEvalAcceptSection = false;
            $scope.flagAccRejTextarea = true;
            $scope.flagAccPillerLeavel = false;
            $scope.isOther = true;
            $scope.isDropdownRej = false;
            if (alies == "gmr") {
                $scope.textareaLabel = "Reason for reassigning idea";
            }
            else {
                $scope.textareaLabel = "Reason for reassigning suggestion";
            }
        } else if (status == 'passToPeer') {
            $scope.isEvalAcceptSection = false;
            $scope.flagAccRejTextarea = false;
            $scope.flagAccPillerLeavel = false;
            $scope.textareaLabel = "";
            $scope.isOther = false;
            $scope.showTeamDetPopup('ind', 'passToPeer');
        } else if (status == 'resume') {
            $scope.flagresumeonhold = true;
            $scope.flagFurtherhold = false;
            $scope.flagrejectonhold = false;
            $scope.textareaLabel = "Reason";
        } else if (status == 'onhold') {
            $scope.flagresumeonhold = false;
            $scope.flagrejectonhold = false;
            $scope.flagFurtherhold = true;
        }

        $scope.scrollToBottom('#suggDetailsContainer');
    }

    $scope.setActiveSuggCard = function (id) {
        $scope.activeCard = id;
    }

    $scope.isSuggCardActive = function (id) {
        return $scope.activeCard === id;
    }
    //HR accept/reject

    $scope.change_flag_supervisor = function () {
        // alert("Hello");
        if ($scope.suggestionInputDetails.acceptRejComment == '' || $scope.suggestionInputDetails.acceptRejComment == undefined || $scope.suggestionInputDetails.acceptRejComment == null) {
            $scope.flagRejectSugg = true;
            $scope.flagReassign = false;
        } else {
            $scope.flagRejectSugg = false;
        }
    }
    $scope.change_flag_reassign = function () {
        // alert("Hello");
        if ($scope.suggestionInputDetails.acceptRejCommentacceptRejComment == '' || $scope.suggestionInputDetails.acceptRejComment == undefined || $scope.suggestionInputDetails.acceptRejComment == null) {
            $scope.flagReassign = true;
            $scope.flagRejectSugg = false;
        } else {
            $scope.flagReassign = false;
        }
    }

    //Eval accept/reject
    $scope.change_flag_eval = function () {
        if ($scope.acceptRejEvalComment == '' || $scope.acceptRejEvalComment == undefined || $scope.acceptRejEvalComment == null) {
            $scope.flagRejectSugg = true;
        } else {
            $scope.flagRejectSugg = false;
        }
    }

    $scope.change_flag_evalEndDate = function () {
        consoleLog("inide in eval");
        if ($scope.suggestionDet.sourceType != 'HD') {
            $scope.suggestionInputDetails.acceptRejectStatus = "accept";
            $scope.suggestionInputDetails.acceptRejBy = "byEval";
            if ($scope.suggestionInputDetails.evalEndDate == '' || $scope.suggestionInputDetails.evalEndDate == undefined || $scope.suggestionInputDetails.evalEndDate == null) {
                $scope.flagRejectSugg = true;
            } else {
                $scope.flagRejectSugg = false;
                if ($scope.roleEscalationList == undefined || $scope.roleEscalationList == null) {
                    $scope.getRoleEscalateInfo();
                } else {
                    $scope.calculateTaskTime();
                }
            }
        } else {
            $scope.flagRejectSugg = false;
            $scope.suggestionInputDetails.acceptRejectStatus = "accept";
            $scope.suggestionInputDetails.acceptRejBy = "byEval";
            if ($scope.roleEscalationList == undefined || $scope.roleEscalationList == null) {
                $scope.getRoleEscalateInfo();
            } else {
                $scope.calculateTaskTime();
            }
        }
    }

    $scope.calculateTaskTime = function () {
        var tmpnod = 0;
        var one_day = 1000 * 60 * 60 * 24;

        var targetDate = "";
        if ($scope.suggestionInputDetails.acceptRejBy == "byEval") {
            if ($scope.suggestionDet.sourceType != 'HD') {
                targetDate = $scope.suggestionInputDetails.evalEndDate;
                for (var i = 0; i < $scope.roleEscalationList.length; i++) {
                    if ($scope.roleEscalationList[i].role.id == $scope.CONST.ROLES.EVALUATOR) {
                        tmpnod = $scope.roleEscalationList[i].numberOfDays;
                        break;
                    }
                }
            } else {
                targetDate = $scope.newSug.evalEndDate;
                for (var i = 0; i < $scope.roleEscalationList.length; i++) {
                    if ($scope.roleEscalationList[i].role.id == $scope.CONST.ROLES.EVALUATOR) {
                        tmpnod = $scope.roleEscalationList[i].numberOfDays;
                        break;
                    }
                }
            }
        } else if ($scope.suggestionInputDetails.acceptRejBy == "byImpl") {
            targetDate = $scope.suggestionInputDetails.implEndDate;
            for (var i = 0; i < $scope.roleEscalationList.length; i++) {
                if ($scope.roleEscalationList[i].role.id == $scope.CONST.ROLES.IMPLEMENTER) {
                    tmpnod = $scope.roleEscalationList[i].numberOfDays;
                    break;
                }
            }
        }
        //fiannce controller at eval ----by sunanda-------19-11
        else if ($scope.suggestionInputDetails.acceptRejBy == "byFCEval") {
            targetDate = $scope.suggestionDet.fCEvalEndDate;
            for (var i = 0; i < $scope.roleEscalationList.length; i++) {
                if ($scope.roleEscalationList[i].role.id == $scope.CONST.ROLES.FINANCE_APPROVAL) {
                    tmpnod = $scope.roleEscalationList[i].numberOfDays;
                    break;
                }
            }
        } else if ($scope.suggestionInputDetails.acceptRejBy == "byFCImpl") {
            targetDate = $scope.suggestionDet.fCImplEndDate;
            for (var i = 0; i < $scope.roleEscalationList.length; i++) {
                if ($scope.roleEscalationList[i].role.id == $scope.CONST.ROLES.FINANCE_CONTROLLER) {
                    tmpnod = $scope.roleEscalationList[i].numberOfDays;
                    break;
                }
            }
        } else if ($scope.suggestionInputDetails.acceptRejBy == "byDC") {
            targetDate = $scope.suggestionDet.dcEndDate;
            for (var i = 0; i < $scope.roleEscalationList.length; i++) {
                if ($scope.roleEscalationList[i].role.id == $scope.CONST.ROLES.DOCUMENT_OWNER) {
                    tmpnod = $scope.roleEscalationList[i].numberOfDays;
                    break;
                }
            }
        }
        if (tmpnod > 0) {
            $scope.currentDate = new Date()
                .getTime();
            $scope.taskTime = new Date(targetDate)
                .getTime();
            var takenDays = Math.ceil(($scope.taskTime - $scope.currentDate) / one_day);
            if (takenDays > tmpnod) {
                if ($scope.suggestionInputDetails.acceptRejBy == "byEval") {
                    $scope.suggestionDet.evalTaskDeviation = true;
                    $scope.suggestionDet.extraTimeDeviationDays = tmpnod;
                } else if ($scope.suggestionInputDetails.acceptRejBy == "byImpl") {
                    $scope.suggestionDet.implTaskDeviation = true;
                    $scope.suggestionDet.extraImpleTimeDeviationDays = tmpnod;
                }
                //fiannce controller at eval ----by sunanda-------19-11
                else if ($scope.suggestionInputDetails.acceptRejBy == "byFCEval") {
                    $scope.suggestionDet.fcEvalTaskDeviation = true;
                    $scope.suggestionDet.extraFCEvalTimeDeviationDays = tmpnod;
                } else if ($scope.suggestionInputDetails.acceptRejBy == "byFCImpl") {
                    $scope.suggestionDet.fcImplTaskDeviation = true;
                    $scope.suggestionDet.extrafcImplTimeDeviationDays = tmpnod;
                } else if ($scope.suggestionInputDetails.acceptRejBy == "byDC") {
                    $scope.suggestionDet.dcTaskDeviation = true;
                    $scope.suggestionDet.extraDCTimeDeviationDays = tmpnod;
                }
                $scope.scrollToBottom('#suggDetailsContainer');
            } else {
                if ($scope.suggestionInputDetails.acceptRejBy == "byEval")
                    $scope.suggestionDet.evalTaskDeviation = false;
                else if ($scope.suggestionInputDetails.acceptRejBy == "byImpl")
                    $scope.suggestionDet.implTaskDeviation = false;
                else if ($scope.suggestionInputDetails.acceptRejBy == "byFCEval")
                    $scope.suggestionDet.fcEvalTaskDeviation = false;
                else if ($scope.suggestionInputDetails.acceptRejBy == "byFCImpl")
                    $scope.suggestionDet.fcImplTaskDeviation = false;
                else if ($scope.suggestionInputDetails.acceptRejBy == "byDC")
                    $scope.suggestionDet.dcTaskDeviation = false;
            }

        }
    }

    $scope.getRoleEscalateInfo = function () { //Need Role escalate data  to calculate eval and imple end date
        if ($scope.roleEscalationList != null && $scope.roleEscalationList.size > 0) {
            return;
        }
        appService.httpGet("getroleescalationsetup/" + $scope.suggestionDet.branch.branchId)
            .then(function (response) {
                $scope.flagConfigDetLoading = false;
                $scope.flagConfigDetLineIndicator = false;
                if (response.result) {
                    $scope.roleEscalationList = response.roleEscalationSetupList;
                    $scope.calculateTaskTime();
                }
            });
    }

    //End date impl
    $scope.change_flag_implEndDate = function () {
        $scope.suggestionInputDetails.acceptRejectStatus = "accept";
        $scope.suggestionInputDetails.acceptRejBy = "byImpl";
        if ($scope.suggestionInputDetails.implEndDate == '' || $scope.suggestionInputDetails.implEndDate == undefined || $scope.suggestionInputDetails.implEndDate == null) {
            $scope.flagRejectSugg = true;
        } else {
            if ($scope.roleEscalationList == undefined || $scope.roleEscalationList == null) {
                $scope.getRoleEscalateInfo();
            } else {
                $scope.calculateTaskTime();
            }
            $scope.flagRejectSugg = false;
        }
    }
    $scope.acceptRejectByFC = function (status, by) {
        $scope.suggestionInputDetails.acceptRejectStatus = status;
        $scope.suggestionInputDetails.acceptRejBy = by;
        $scope.acceptRejectSugg();
    }



    // Only Selected Card Upadte API
    $scope.getSuggestionListOnUpdate = function () {
        var req = {
            sugId: $scope.selectedSuggId,
            branchId: $scope.suggestionDet.branch.branchId,
            orgId: $scope.suggestionDet.organization.orgId,
            assignedToId: $scope.loggedInEmpId,
            typeId: 1
        }
        if ($scope.isFilterApplied) {
            if ($scope.suggestionPagination.fromDt != "" && $scope.suggestionPagination.toDt != "") {
                req.fromDt = $scope.suggestionPagination.fromDt + ' 00:00:00';
                req.toDt = $scope.suggestionPagination.toDt + $filter('date')(new Date(), " HH:mm:ss");
            }
        }
        appService.httpPost(req, "getsuggestionlistnew")
            .then(function (response) {
                if (response.result) {
                    if (response.sugessionsByEmpIdList != null && response.sugessionsByEmpIdList.length > 0) {
                        if ($scope.suggestionList != null && $scope.suggestionList.length > 0) {
                            var suggLength = $scope.suggestionList.length - 1;
                            var suggIndex;
                            for (let index = 0; index < $scope.suggestionList.length; index++) {
                                if ($scope.suggestionList[index].sugId == $scope.selectedSuggId) {
                                    $scope.suggestionList[index] = response.sugessionsByEmpIdList[0];
                                    suggIndex = index;
                                    break;
                                }
                            }
                            $scope.getSuggestionDetailsFlag = 'onUpdate';
                            if (suggLength == suggIndex) { } else {
                                $scope.getSuggestionDetails($scope.selectedSuggId, 'onSuggSelect', $scope.selectedsourceType)
                            }
                        }
                    } else { }
                } else {

                }
            });
    }
    $scope.getSuggestionDetailsFlag = '';
    $scope.acceptRejectSugg = function () {
        $scope.suggestionInputDetails.flagHrAccRejSpinner = true;
        if ($scope.suggestionInputDetails.acceptRejectStatus == '' || $scope.suggestionInputDetails.acceptRejBy == '') {
            $scope.suggestionInputDetails.flagHrAccRejSpinner = false;
            return;
        }
        $scope.data = {
            sugg_id: $scope.selectedSuggId,
            updatedBy: parseInt($scope.loggedInEmpId)
        }
        var url = "";
        if ($scope.suggestionInputDetails.acceptRejectStatus == "accept") {
            if ($scope.suggestionInputDetails.acceptRejBy == "byHr") {
                $scope.flagHrAccRejSpinner = true;
                $scope.data.stsId = $scope.CONST.STATUS.HRAccepts.statusId;
                $scope.data.summary = $scope.suggestionInputDetails.acceptRejComment;
                url = "acceptrejectSuggestionByHR";
            } else if ($scope.suggestionInputDetails.acceptRejBy == "bySupervisor") {
                $scope.flagHrAccRejSpinner = true;
                if ($scope.loggedInUserLevel < 2)
                    $scope.data.stsId = $scope.CONST.STATUS.HRAccepts.statusId;
                else {
                    $scope.data.stsId = $scope.CONST.STATUS.AcceptedByScrutinizerLevelUp.statusId;

                    for (var i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                        if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.SuggestionAssigned.status) {
                            if ($scope.suggestionDet.sugesstionStatusAudit[i].emp_details.departmentLevel[0].level == 0) {
                                $scope.data.deptFirstLvlId = $scope.suggestionDet.sugesstionStatusAudit[i].emp_details.empId;
                                break;
                            }
                        }
                    }
                }

                $scope.data.summary = $scope.suggestionInputDetails.acceptRejComment;
                $scope.data.deptId = $scope.loggedInUserDeptId;
                $scope.data.levelId = $scope.loggedInUserLevel;
                $scope.data.orgId = $scope.loggedInUserOrgId;
                url = "acceptrejectSuggestionByHR";
            } else if ($scope.suggestionInputDetails.acceptRejBy == "byEval") {
                if ($scope.suggestionInputDetails.evalEndDate == '' || $scope.suggestionInputDetails.evalEndDate == undefined || $scope.suggestionInputDetails.evalEndDate == null) {
                    $scope.flagRejectSugg = true;
                    $scope.suggestionInputDetails.flagHrAccRejSpinner = false;
                    angular.element("#errId_evalEndDate")
                        .text($filter('translate')('Please_select_estimated_evaluation_time'));
                    return;
                }
                if ($scope.suggestionDet.evalTaskDeviation && ($scope.suggestionDet.evalTaskDeviationInput == undefined || $scope.suggestionDet.evalTaskDeviationInput == null)) {
                    snackbar.create($filter('translate')('Please_capture_reason_timeline_deviation'), 5000, "error");
                    $scope.suggestionInputDetails.flagHrAccRejSpinner = false;
                    return;
                }
                if ($scope.cfmApprove != null && $scope.cfmApprove != undefined || $scope.cfmApprove != '') {
                    $scope.data.isCFMApprove = $scope.cfmApprove;
                }
                else {
                    $scope.data.isCFMApprove = 'N'
                }
                $scope.flagEvalAccRejSpinner = true;
                $scope.data.stsId = $scope.CONST.STATUS.EvaluationRequestAccepted.statusId;
                $scope.data.updatedBy = parseInt($scope.loggedInEmpId);
                $scope.data.updatedByName = $scope.loggedInName;
                $scope.data.summary = $scope.suggestionDet.evalTaskDeviationInput;
                $scope.data.endDate = $scope.suggestionInputDetails.evalEndDate;
                $scope.data.tmtypeId = $scope.loggedInUserTeamTypeId;

                for (var i = 0; i < $scope.suggestionDet.evaluationTeamList.length; i++) {
                    if (parseInt($scope.suggestionDet.evaluationTeamList[i].empId) == parseInt($scope.loggedInEmpId)) {
                        $scope.data.sugTrackId = $scope.suggestionDet.evaluationTeamList[i].sugTrackId;
                    }
                }
                url = "acceptrejectSuggessionByEvalteam";
            } else if ($scope.suggestionInputDetails.acceptRejBy == 'byevalfc') {
                var evalIdForFC = 0;
                for (var i = 0; i <= $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                    // ---- In futuristic committee case to get the latest evalId for FC Approve Or Reassign by @Jayshri Kolase 
                    if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.PassToPeerEvaluator.status) {
                        evalIdForFC = $scope.suggestionDet.sugesstionStatusAudit[i].emp_details.empId;
                        break;
                    }
                    else if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.EvaluationAssigned.status || $scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.EvaluationRequestAccepted.status) {
                        evalIdForFC = $scope.suggestionDet.sugesstionStatusAudit[i].emp_details.empId;
                        break;
                    }
                    // End
                }
                /*if($scope.suggestionDet.evalFCSummary==undefined || $scope.suggestionDet.evalFCSummary==null || $scope.suggestionDet.evalFCSummary==""){
                  snackbar.create("Please enter comments.", 5000, "error");
                  return;
                }*/
                $scope.data = {
                    "assignedById": parseInt($scope.loggedInEmpId),
                    "assignedToId": evalIdForFC,
                    "statusId": $scope.CONST.STATUS.ApprovedByFC.statusId,
                    "sugId": $scope.selectedSuggId,
                    "summary": $scope.suggestionDet.evalFCSummary,
                    "branchId": $scope.suggestionDet.branch.branchId, //$scope.loggedInUserBranchId,
                    "orgId": $scope.loggedInUserOrgId,
                    "amount": $scope.suggestionDet.eval.estimatedCost
                };

                url = "acceptRejectSuggestionFinanceController";
            } else if ($scope.suggestionInputDetails.acceptRejBy == "byImpl") {
                if ($scope.suggestionInputDetails.implEndDate == '' || $scope.suggestionInputDetails.implEndDate == undefined || $scope.suggestionInputDetails.implEndDate == null) {
                    $scope.flagRejectSugg = true;
                    $scope.suggestionInputDetails.flagHrAccRejSpinner = false;
                    angular.element("#errId_implEndDate")
                        .text($filter('translate')('Please_select_estimated_evaluation_time'));
                    return;
                }
                if ($scope.suggestionDet.implTaskDeviation && ($scope.suggestionDet.implTaskDeviationInput == undefined || $scope.suggestionDet.implTaskDeviationInput == null)) {
                    $scope.suggestionInputDetails.flagHrAccRejSpinner = false;
                    snackbar.create($filter('translate')('Please_capture_reason_timeline_deviation'), 5000, "error");
                    return;
                }
                $scope.flagImplAccRejSpinner = true;
                $scope.data.stsId = $scope.CONST.STATUS.ImplementationRequestAccepted.statusId;
                $scope.data.updatedBy = parseInt($scope.loggedInEmpId);
                $scope.data.updatedByName = $scope.loggedInName;
                $scope.data.summary = $scope.suggestionDet.implTaskDeviationInput;
                $scope.data.endDate = $scope.suggestionInputDetails.implEndDate;
                $scope.data.tmtypeId = $scope.loggedInUserTeamTypeId;
                for (var i = 0; i < $scope.suggestionDet.implTeamList.length; i++) {
                    if (parseInt($scope.suggestionDet.implTeamList[i].empId) == parseInt($scope.loggedInEmpId)) {
                        $scope.data.sugTrackId = $scope.suggestionDet.implTeamList[i].sugTrackId;
                    }
                }
                url = "acceptrejectSuggessionByEvalteam";
            }
            // else if ($scope.suggestionInputDetails.acceptRejBy == "byExecutive") {
            //     $scope.flagHrAccRejSpinner = true;
            //     $scope.data.isExecutive = 1;
            //     $scope.data.stsId = $scope.CONST.STATUS.AcceptedByExecutive.statusId;
            //     $scope.data.updatedBy = parseInt($scope.loggedInEmpId);
            //     $scope.data.updatedByName = $scope.loggedInName;
            //     $scope.data.summary = $scope.suggestionInputDetails.acceptRejComment;
            //     $scope.data.orgId = $scope.loggedInUserOrgId;
            //     url = "acceptrejectSuggestionByHR";
            // }
        } else if ($scope.suggestionInputDetails.acceptRejectStatus == "reject") {
            if ($scope.suggestionInputDetails.acceptRejBy == "byHr") {
                if ($scope.suggestionInputDetails.acceptRejComment == '' || $scope.suggestionInputDetails.acceptRejComment == undefined || $scope.suggestionInputDetails.acceptRejComment == null) {
                    $scope.flagRejectSugg = true;
                    $scope.flagReassign = false;
                    $scope.suggestionInputDetails.flagHrAccRejSpinner = false;
                    angular.element("#errId")
                        .text($filter('translate')('Please_enter_reason_for_rejecting_suggestion'));
                    return;
                }
                $scope.flagHrAccRejSpinner = true;
                $scope.data.stsId = $scope.CONST.STATUS.HRRejects.statusId;
                $scope.data.rejectionReason = $scope.suggestionInputDetails.acceptRejComment;
                $scope.data.updatedByName = $scope.loggedInName;
                url = "acceptrejectSuggestionByHR";
            } else if ($scope.suggestionInputDetails.acceptRejBy == "bySupervisor") {
                // if($scope.suggestionInputDetails.acceptRejComment != '' || $scope.suggestionInputDetails.acceptRejComment != undefined || $scope.suggestionInputDetails.acceptRejComment != null)
                // {
                if ($scope.isOther == true) {
                    if (($scope.suggestionInputDetails.acceptRejComment == '' || $scope.suggestionInputDetails.acceptRejComment == undefined || $scope.suggestionInputDetails.acceptRejComment == null)) {
                        $scope.flagRejectSugg = true;
                        $scope.suggestionInputDetails.flagHrAccRejSpinner = false;
                        snackbar.create("Please enter rejection reason", 3000, "error");
                        return;
                    }
                    else {
                        $scope.data.summary = $scope.suggestionInputDetails.acceptRejComment;
                        $scope.selectRejArray.push($scope.data.summary)
                        //console.log($scope.selectRejArray);
                    }
                }
                else if ($scope.isOther == false) {
                    if ($scope.count == 0) {
                        // if($scope.count == 0){
                        $scope.suggestionInputDetails.flagHrAccRejSpinner = false;
                        snackbar.create("Please select rejection reason from list", 3000, "error");
                        return;
                        //}
                    }
                    else {
                        $scope.data.suggReasonIds = $scope.selectRejArray;
                    }
                }
                $scope.flagHrAccRejSpinner = true;
                $scope.data.stsId = $scope.CONST.STATUS.SuggestionDeclined.statusId;
                //$scope.data.summary = $scope.suggestionInputDetails.acceptRejComment;
                //$scope.data.deptId = $scope.loggedInUserDeptId;
                // 20-5
                if ($scope.suggestionDet.dept != null) {
                    $scope.data.deptId = $scope.suggestionDet.dept.deptId;
                }
                //6-3-2020 
                if ($rootScope.empDetails.departmentLevel != null && $rootScope.empDetails.departmentLevel.length > 0) {
                    var setDeptVal = false;
                    angular.forEach($rootScope.empDetails.departmentLevel, function (value, key) {
                        if (!$scope.isEmpty(value.dept) && value.deptId != null && $scope.suggestionDet.dept != null) {
                            if (value.dept.deptId == $scope.suggestionDet.dept.deptId) {
                                $scope.data.levelId = value.level;
                                setDeptVal = true;
                            }
                        }
                    });
                    if (!setDeptVal) {
                        $scope.data.levelId = 0;
                    }
                } else {
                    $scope.data.levelId = 0;
                }
                //$scope.data.levelId = $scope.loggedInUserLevel;
                $scope.data.orgId = $scope.loggedInUserOrgId;
                url = "acceptrejectSuggestionByHR";
            } else if ($scope.suggestionInputDetails.acceptRejBy == "byEval") {
                if ($scope.acceptRejEvalComment == '' || $scope.acceptRejEvalComment == undefined || $scope.acceptRejEvalComment == null) {
                    $scope.flagRejectSugg = true;
                    $scope.suggestionInputDetails.flagHrAccRejSpinner = false;
                    angular.element("#errId_eval")
                        .text($filter('translate')('Please_enter_reason_for_rejecting_suggestion'));
                    return;
                }
                $scope.flagEvalAccRejSpinner = true;
                $scope.data.stsId = $scope.CONST.STATUS.EvaluationRequestDecline.statusId;
                $scope.data.updatedBy = parseInt($scope.loggedInEmpId);
                $scope.data.updatedByName = $scope.loggedInName;
                $scope.data.summary = $scope.acceptRejEvalComment;
                $scope.data.isDecline = 1;
                $scope.data.deptFirstLvlId = 0;

                for (var i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                    if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.HRAccepts.status) {
                        if ($scope.suggestionDet.sugesstionStatusAudit[i].emp_details.departmentLevel != null && $scope.suggestionDet.sugesstionStatusAudit[i].emp_details.departmentLevel.length > 0) {
                            if ($scope.suggestionDet.sugesstionStatusAudit[i].emp_details.departmentLevel[0].level == 0) {
                                $scope.data.deptFirstLvlId = $scope.suggestionDet.sugesstionStatusAudit[i].emp_details.empId;
                                break;
                            }
                        }
                    }
                }

                for (var i = 0; i < $scope.suggestionDet.evaluationTeamList.length; i++) {
                    if (parseInt($scope.suggestionDet.evaluationTeamList[i].empId) == parseInt($scope.loggedInEmpId)) {
                        $scope.data.sugTrackId = $scope.suggestionDet.evaluationTeamList[i].sugTrackId;
                    }
                }

                url = "acceptrejectSuggessionByEvalteam";
            } else if ($scope.suggestionInputDetails.acceptRejBy == 'byevalfc') {
                if ($scope.suggestionDet.evalFCSummary == undefined || $scope.suggestionDet.evalFCSummary == null || $scope.suggestionDet.evalFCSummary == "") {
                    $scope.suggestionInputDetails.flagHrAccRejSpinner = false;
                    snackbar.create($filter('translate')('Please_enter_comments'), 5000, "error");
                    return;
                }
                var evalIdForFC = 0;
                for (var i = 0; i <= $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                    // ---- In futuristic committee case to get the latest evalId for FC Approve Or Reassign by @Jayshri Kolase 
                    if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.PassToPeerEvaluator.status) {
                        evalIdForFC = $scope.suggestionDet.sugesstionStatusAudit[i].emp_details.empId;
                        break;
                    }
                    else if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.EvaluationAssigned.status || $scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.EvaluationRequestAccepted.status) {
                        evalIdForFC = $scope.suggestionDet.sugesstionStatusAudit[i].emp_details.empId;
                        break;
                    }
                }
                $scope.data = {
                    "assignedById": parseInt($scope.loggedInEmpId),
                    "assignedToId": evalIdForFC,
                    "statusId": $scope.CONST.STATUS.DeclinedByFC.statusId,
                    "sugId": $scope.selectedSuggId,
                    "summary": $scope.suggestionDet.evalFCSummary,
                    "branchId": $scope.suggestionDet.branch.branchId, //$scope.loggedInUserBranchId,
                    "orgId": $scope.loggedInUserOrgId
                };
                url = "acceptRejectSuggestionFinanceController";
            } else if ($scope.suggestionInputDetails.acceptRejBy == "byImpl") {
                if ($scope.acceptRejImplComment == '' || $scope.acceptRejImplComment == undefined || $scope.acceptRejImplComment == null) {
                    $scope.flagRejectSugg = true;
                    $scope.suggestionInputDetails.flagHrAccRejSpinner = false;
                    angular.element("#errId_impl")
                        .text($filter('translate')('Please_enter_reason_for_declining_suggestion'));
                    return;
                }

                $scope.flagImplAccRejSpinner = true;
                $scope.data.stsId = $scope.CONST.STATUS.ImplementationRequestDecline.statusId;
                $scope.data.updatedBy = parseInt($scope.loggedInEmpId);
                $scope.data.updatedByName = $scope.loggedInName;
                $scope.data.summary = $scope.acceptRejImplComment;
                $scope.data.tmtypeId = $scope.loggedInUserTeamTypeId;
                $scope.data.isDecline = 1;

                for (var i = 0; i < $scope.suggestionDet.implTeamList.length; i++) {
                    if (parseInt($scope.suggestionDet.implTeamList[i].empId) == parseInt($scope.loggedInEmpId)) {
                        $scope.data.sugTrackId = $scope.suggestionDet.implTeamList[i].sugTrackId;
                    }
                }

                for (var i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                    if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.ImplementationRecommended.status) {
                        $scope.data.evalTeamId = $scope.suggestionDet.sugesstionStatusAudit[i].emp_details.empId;
                        break;
                    }
                }

                url = "acceptrejectSuggessionByEvalteam";
            }
            // else if ($scope.suggestionInputDetails.acceptRejBy == "byExecutive") {
            //     if ($scope.suggestionInputDetails.acceptRejComment == '' || $scope.suggestionInputDetails.acceptRejComment == undefined || $scope.suggestionInputDetails.acceptRejComment == null) {
            //         $scope.flagRejectSugg = true;
            //         $scope.suggestionInputDetails.flagHrAccRejSpinner = false;
            //         angular.element("#errId")
            //             .text($filter('translate')('Please_enter_reason_for_declining_suggestion'));
            //         return;
            //     }
            //     $scope.flagHrAccRejSpinner = true;
            //     $scope.data.stsId = $scope.CONST.STATUS.RejectedByExecutive.statusId;
            //     $scope.data.updatedByName = $scope.loggedInName;
            //     $scope.data.summary = $scope.suggestionInputDetails.acceptRejComment;
            //     $scope.data.orgId = $scope.loggedInUserOrgId;

            //     url = "acceptrejectSuggestionByHR";
            // }
        } else if ($scope.suggestionInputDetails.acceptRejectStatus == "reAssignForEdit") {
            if ($scope.suggestionInputDetails.acceptRejComment == '' || $scope.suggestionInputDetails.acceptRejComment == undefined || $scope.suggestionInputDetails.acceptRejComment == null) {
                $scope.flagReassign = true;
                $scope.flagRejectSugg = false;
                $scope.suggestionInputDetails.flagHrAccRejSpinner = false;
                // angular.element("#errId_reassign")
                //     .text($filter('translate')('Please_enter_reason_for_reassigning_suggestion'));
                snackbar.create($filter('translate')('Please_enter_reason_for_reassigning_suggestion'), 3000, "error");
                return;
            }
            $scope.flagHrAccRejSpinner = true;
            $scope.data.stsId = $scope.CONST.STATUS.AssignedForEdit.statusId;
            $scope.data.summary = $scope.suggestionInputDetails.acceptRejComment;
            // $scope.data.deptId  = $scope.loggedInUserDeptId;
            // $scope.data.levelId = $scope.loggedInUserLevel;
            $scope.data.orgId = $scope.loggedInUserOrgId;
            const lastIndex = $scope.suggestionDet.sugesstionStatusAudit.length - 1;
            if (lastIndex >= 0 && ($scope.suggestionDet.sugesstionStatusAudit[lastIndex].status_master.status == $scope.CONST.STATUS.EvaluationAssigned.status || $scope.suggestionDet.sugesstionStatusAudit[lastIndex].status_master.status == $scope.CONST.STATUS.PassToPeerEvaluator.status)) {
                $scope.data.stsId = $scope.CONST.STATUS.ReassignedByEvaluator.statusId;
                $scope.data.empId = $scope.suggestionDet.createdBy.empId;
                $scope.data.createdBy = $scope.suggestionDet.sugesstionStatusAudit[lastIndex].emp_details.empId;
                $scope.data.updatedBy = $scope.suggestionDet.sugesstionStatusAudit[lastIndex].emp_details.empId;
            } else {
                $scope.data.stsId = $scope.CONST.STATUS.AssignedForEdit.statusId;
            }
            for (var i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                if ($scope.suggestionDet.isSuggOnBehalf == 'Y') {
                    $scope.data.empId = $scope.suggestionDet.createdBy.empId;
                }
                else {
                    if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.Created.status) {
                        $scope.data.empId = $scope.suggestionDet.sugesstionStatusAudit[i].emp_details.empId;
                        break;
                    }
                }
            }

            url = "acceptrejectSuggestionByHR";
        }
        //console.log($scope.data);
        // var x = 0;
        // if (x == 0) {
        //     $scope.flagHrAccRejSpinner = false;
        //     $scope.flagEvalAccRejSpinner = false;
        //     $scope.flagImplAccRejSpinner = false;
        //     $scope.flagRejectSugg = false;
        //     $scope.flagReassign = false;
        //     return;
        // }
        appService.httpPost($scope.data, url)
            .then(function (response) {
                $scope.flagHrAccRejSpinner = false;
                $scope.flagEvalAccRejSpinner = false;
                $scope.flagImplAccRejSpinner = false;
                $scope.flagRejectSugg = false;
                $scope.flagReassign = false;
                $scope.suggestionInputDetails.flagHrAccRejSpinner = false;
                if (response.status == "success") {
                    if ($scope.suggestionInputDetails.acceptRejectStatus == "accept") {
                        snackbar.create($filter('translate')('Suggestion_accepted_successfully'), 5000, "success");
                        $scope.flagAcceptSugg = true;
                        if ($scope.suggestionInputDetails.acceptRejBy == "bySupervisor" || $scope.suggestionInputDetails.acceptRejBy == "byEval" || $scope.suggestionInputDetails.acceptRejBy == "byImpl") {
                            //Get Single card update
                            $scope.getSuggestionListOnUpdate();
                            $scope.isDropdownRejEval = false;
                        } else if ($scope.suggestionInputDetails.acceptRejBy == "byevalfc") {
                            $scope.getStatusWiseCount();
                            $scope.getSuggestionDetailsFlag = '';
                            $scope.getsuggestionList("onUpdate");
                        }
                    } else if ($scope.suggestionInputDetails.acceptRejectStatus == "reAssignForEdit") {
                        $scope.getStatusWiseCount();
                        $scope.suggestionDet = {};
                        $scope.getsuggestionList("onLoad");
                        snackbar.create($filter('translate')('Suggestion_initiator_successfully'), 5000, "success");
                    } else if ($scope.suggestionInputDetails.acceptRejectStatus == "reject") {
                        $scope.getStatusWiseCount();
                        $scope.suggestionDet = {};
                        $scope.getSuggestionDetailsFlag = '';
                        $scope.getsuggestionList("onUpdate");
                        if ($scope.suggestionInputDetails.acceptRejBy == "byevalfc") {
                            snackbar.create($filter('translate')('Suggestion_reassigned_to_evaluator_successfully'), 5000, "success");
                        } else if ($scope.suggestionInputDetails.acceptRejBy == "bySupervisor") {
                            snackbar.create($filter('translate')('Suggestion_is_rejected_by_controller_successfully'), 5000, "success");
                        }
                        else {
                            snackbar.create("Suggestion rejected successfully", 5000, "success");
                        }
                    }
                    //Hiding the textarea block of the accept rejet section after successfult submition
                    $scope.flagAccRejTextarea = false;
                    // $scope.getsuggestionList('allSuggestion');
                } else {
                    $scope.suggestionInputDetails.flagHrAccRejSpinner = false;
                    if ($scope.suggestionInputDetails.acceptRejectStatus == "reject") {
                        snackbar.create($filter('translate')('Oops_Please_try_again'), 5000, "error");
                    } else {
                        snackbar.create($filter('translate')('Oops_Please_try_again'), 5000, "error");
                    }
                }
            });
    }
    //Set Eval Target Date
    $scope.setEvalTargetDate = function () {
        $scope.suggestionInputDetails.evalEndDate = $filter('date')(new Date(), 'yyyy-MM-dd');
        $('.target-date-picker').datepicker({ 'update': $scope.suggestionInputDetails.evalEndDate, 'autoclose': true, 'todayHighlight': true });
    }

    $scope.setEvalTargetDateHD = function () {
        $scope.newSug.evalEndDate = $filter('date')(new Date(), 'yyyy-MM-dd');
        $('.target-date-picker').datepicker({ 'update': $scope.newSug.evalEndDate, 'autoclose': true, 'todayHighlight': true });
    }

    $scope.setImplTargetDate = function () {
        $scope.suggestionInputDetails.implEndDate = $filter('date')(new Date(), 'yyyy-MM-dd');
        $('.target-date-picker').datepicker({ 'update': $scope.suggestionInputDetails.implEndDate, 'autoclose': true, 'todayHighlight': true });
    }

    $scope.$watch('suggestionInputDetails.evalEndDate', function (newDate, oldDate) {
        if (!$scope.isEmpty($scope.suggestionInputDetails)) {
            if ($scope.suggestionInputDetails.hasOwnProperty('evalEndDate') && $scope.suggestionInputDetails.evalEndDate != null && $scope.suggestionInputDetails.evalEndDate != undefined && $scope.suggestionInputDetails.evalEndDate != '') {
                $scope.suggestionInputDetails.evalEndDate = moment(newDate).format('YYYY-MM-DD');
                $scope.change_flag_evalEndDate()
            }
        }
    })
    $scope.$watch('suggestionDet.fCEvalEndDate', function (newDate, oldDate) {
        if (!$scope.isEmpty($scope.suggestionDet)) {
            if ($scope.suggestionDet.hasOwnProperty('fCEvalEndDate') && $scope.suggestionDet.fCEvalEndDate != null && $scope.suggestionDet.fCEvalEndDate != undefined && $scope.suggestionDet.fCEvalEndDate != '') {
                $scope.suggestionDet.fCEvalEndDate = moment(newDate).format('YYYY-MM-DD');
                $scope.change_flag_fcEvalEndDate();
            }
        }
    })
    $scope.$watch('suggestionInputDetails.implEndDate', function (newDate, oldDate) {
        if (!$scope.isEmpty($scope.suggestionInputDetails)) {
            if ($scope.suggestionInputDetails.hasOwnProperty('implEndDate') && $scope.suggestionInputDetails.implEndDate != null && $scope.suggestionInputDetails.implEndDate != undefined && $scope.suggestionInputDetails.implEndDate != '') {
                $scope.suggestionInputDetails.implEndDate = moment(newDate).format('YYYY-MM-DD');
                $scope.change_flag_implEndDate();
            }
        }
    })
    $scope.$watch('implData.onholdDate', function (newDate, oldDate) {
        if (!$scope.isEmpty($scope.implData)) {
            if ($scope.implData.hasOwnProperty('onholdDate') && $scope.implData.onholdDate != null && $scope.implData.onholdDate != undefined && $scope.implData.onholdDate != '') {
                $scope.implData.onholdDate = moment(newDate).format('YYYY-MM-DD');
                // $scope.changonholdDate();
            }
        }
    })

    //Recommended reject
    $scope.change_flag_recommend = function () {
        if ($scope.validation.summary == '' || $scope.validation.summary == undefined || $scope.validation.summary == null) {
            $scope.flagRejectSugg = true;
        } else {
            $scope.flagRejectSugg = false;
        }
    }

    $scope.validation = {
        summary: ''
    }

    $scope.change_flagEval = function (event) {
        $scope.evaluationInputs = event.target.value;
        if ($scope.evaluationInputs == '' || $scope.evaluationInputs == undefined || $scope.evaluationInputs == null) {
            $scope.flagReassigneval = true;
            $scope.flagRejectevalSugg = false;
        } else {
            $scope.flagReassigneval = false;
        }

    }

    $scope.recommendSuggestion = function (statusId, evalDet) {
        $scope.data = {
            statusId: statusId,
            sugId: $scope.selectedSuggId,
            summary: evalDet.evaluationInputs,
            assignedById: parseInt($scope.loggedInEmpId),
            rejectionReason: evalDet.estimatedCost,
            orgId: $rootScope.empDetails.organization.orgId,
            branchId: $rootScope.empDetails.branch.branchId
        }
        if ($scope.flagrejectEvalarea || $scope.flagrejarea) {
            if ($scope.isEvaluatorReject == true) {
                if ($scope.suggestionDet.evaluationInputs == '' || $scope.suggestionDet.evaluationInputs == undefined || $scope.suggestionDet.evaluationInputs == null) {
                    $scope.flagReassigneval = true;
                    angular.element("#errId_reassign")
                        .text("Please enter rejection reason.");
                    return;
                }
                else {
                    $scope.data.summary = $scope.suggestionDet.evaluationInputs;
                    delete $scope.data.suggReasonIds;
                }
                //console.log($scope.data)
            }
            else if ($scope.isEvaluatorReject == false) {
                if ($scope.count == 0) {
                    snackbar.create("Please select rejection reason from list", 3000, "error");
                    return;
                }
                else {
                    $scope.data.suggReasonIds = $scope.selectRejArray;
                    delete $scope.data.summary;
                }
                //console.log($scope.data)
            }
            delete $scope.data.rejectionReason;
        } else {
            if (evalDet.evaluationInputs == '' || evalDet.evaluationInputs == undefined || evalDet.evaluationInputs == null) {
                snackbar.create($filter('translate')('Evaluation_details_are_mandatory'), 6000, "error");
                $scope.flagRejectSugg = true;
                return;
            }
            if ($scope.suggestionDet.sourceType == 'HD') {
                if ($scope.isEmpty($scope.suggestionDet.hdCatId) || $scope.suggestionDet.hdCatId == undefined || $scope.suggestionDet.hdCatId == null || $scope.suggestionDet.hdCatId == '') {
                    snackbar.create($filter('translate')('Please_select_category'), 6000, "error");
                    return;
                } else {
                    $scope.data.catId = parseInt($scope.suggestionDet.hdCatId.catId);
                }
            }
        }
        $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = true;
        appService.httpPost($scope.data, "recommended")
            .then(function (response) {
                $scope.flagrejectEvalarea = false;
                $scope.flagrejarea = false;
                $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                if (response.status == "success") {
                    $scope.suggestionDet = {};
                    $scope.getSuggestionDetails($scope.selectedSuggId);
                    snackbar.create($filter('translate')('Suggestion_rejected_successfully'), 5000, "success");
                    $scope.getsuggestionList('onUpdate');
                    $scope.getStatusWiseCount();
                    // $scope.flagrejectEvalarea = '';
                } else if (response.reason == "Futuristic committee setup not found ") {
                    snackbar.create($filter('translate')('Futuristic Committee setup not found for this department. Please add futuristic committee (Go to Setup & config -> Suggestions -> Configure -> Escalation)'), 5000, "error");
                    $scope.flagrejectEvalarea = true;
                    $scope.flagrejarea = true;
                } else {
                    snackbar.create($filter('translate')('Oops_Please_try_again'), 5000, "error");
                }
            });
    }

    $scope.rejectSuggestion = function (statusId) {

        $scope.data = {
            statusId: statusId,
            sugId: $scope.selectedSuggId,
            //summary: "",
            assignedById: parseInt($scope.loggedInEmpId),
            rejectionReason: 0,
            orgId: $rootScope.empDetails.organization.orgId,
            branchId: $rootScope.empDetails.branch.branchId
        }
        if ($scope.isFinanceReject == true) {
            if (($scope.suggestionInputDetails.acceptRejComment == '' || $scope.suggestionInputDetails.acceptRejComment == undefined || $scope.suggestionInputDetails.acceptRejComment == null)) {
                $scope.flagRejectSugg = true;
                $scope.suggestionInputDetails.flagHrAccRejSpinner = false;
                snackbar.create("Please enter rejection reason", 3000, "error");
                return;
            }
            else {
                $scope.data.summary = $scope.suggestionInputDetails.acceptRejComment;
                $scope.selectRejArray.push($scope.data.summary)
                //console.log($scope.selectRejArray);
            }
        }
        else if ($scope.isFinanceReject == false) {
            if ($scope.count == 0) {
                // if($scope.count == 0){
                snackbar.create("Please select rejection reason from list", 3000, "error");
                return;
                //}
            }
            else {
                $scope.data.suggReasonIds = $scope.selectRejArray;
            }
        }
        //console.log($scope.data);
        $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = true;
        appService.httpPost($scope.data, "recommended")
            .then(function (response) {
                $scope.flagrejectEvalarea = false;
                $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                if (response.status == "success") {
                    $scope.suggestionDet = {};
                    $scope.getSuggestionDetails($scope.selectedSuggId);
                    snackbar.create($filter('translate')('Suggestion_rejected_successfully'), 5000, "success");
                    $scope.getsuggestionList('onUpdate');
                    $scope.getStatusWiseCount();
                }
                else if (response.reason == "Futuristic committee setup not found ") {
                    snackbar.create($filter('translate')('Futuristic Committee setup not found for this department. Please add futuristic committee (Go to Setup & config -> Suggestions -> Configure -> Escalation)'), 5000, "error");
                    $scope.flagrejectEvalarea = true;
                    $scope.flagrejarea = true;
                } else {
                    snackbar.create($filter('translate')('Oops_Please_try_again'), 5000, "error");
                }
            });
    }


    $scope.showAcceptSugg = function () {
        $scope.flagAcceptSugg = true;
        $scope.flagRejectSugg = false;
    }

    $scope.showRejectSugg = function () {
        $scope.flagRejectSugg = true;
        $scope.flagAcceptSugg = false;
    }

    /*------------17/2/2020-----------------*/
    $scope.selectedParticular = function (particularId) {
        angular.element(particularId)
            .prop("checked", false)
            .attr('checked', false);
        angular.element(particularId)
            .prop("checked", true)
            .attr('checked', true);

        $.each($("input[name='particularEvalChk']:checked"), function () {
            $scope.particularDet = parseInt($(this)
                .val());
            //console.log($scope.particularDet);
        });
        if ($scope.particulars != null && $scope.particulars.length > 0) {
            //console.log("particularlist", $scope.particulars);
            for (var i = 0; i < $scope.particulars.length; i++) {
                $scope.particulars[i].isChecked = false;
                if ($scope.particulars[i].id == $scope.particularDet) {
                    $scope.particulars[i].isChecked = true;
                    $scope.particulars[i].newUnit = '';
                    $scope.particulars[i].evalExistingValue = '';
                    $scope.particulars[i].newValue = '';
                    $scope.particulars[i].impactValue = '';
                    $scope.particulars[i].newImpactValue = '';
                    $scope.particulars[i].newInitImpactValue = '';
                }
            }
        }
    }

    $scope.selectedImplParticular = function (particularId) {
        angular.element(particularId)
            .prop("checked", false)
            .attr('checked', false);
        angular.element(particularId)
            .prop("checked", true)
            .attr('checked', true);

        $.each($("input[name='particularChk']:checked"), function () {
            $scope.particularImplDet = parseInt($(this)
                .val());
            //console.log($scope.particularImplDet);
        });

        if ($scope.particulars != null && $scope.particulars.length > 0) {
            //console.log("particularlist", $scope.particulars);
            for (var i = 0; i < $scope.particulars.length; i++) {
                if ($scope.particulars[i].id == $scope.particularImplDet) {
                    $scope.particulars[i].isChecked = true;
                    $scope.particulars[i].newUnit = '';
                    $scope.particulars[i].implExistingValue = '';
                    $scope.particulars[i].newValue = '';
                    $scope.particulars[i].newImpactValue = '';
                    $scope.particulars[i].newInitImpactValue = '';
                    $scope.particulars[i].impactValue = '';
                } else {
                    $scope.particulars[i].isChecked = false;
                }
            }
        }
    }
    $scope.showTeamDetPopup = function (assignType, teamType, evalDet) {
        $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = true;
        $scope.evaluationDet = evalDet;
        $scope.flagTeamDetPopupLoading = true;
        $scope.flagTeamDetNotAvailMsg = false;
        $scope.selectedTeamTypeForAssign = teamType;
        if ($scope.suggestionDet.isHDRequire == true) {
            $scope.isHorizDeployReq = 'NA';
        } else {
            $scope.isHorizDeployReq = 'Y';
        }
        var url = '';
        if (teamType == $scope.CONST.TEAM_TYPE.EVALUATION) {
            $scope.popupTitle = "Evaluators";
            url = "getlistofusersbranchwise/" + $scope.suggestionDet.branch.branchId + '/0/0/8';
            $("#teamDetModalforEval")
                .modal({
                    backdrop: 'static',
                    keyboard: false
                });
        } else if (teamType == $scope.CONST.TEAM_TYPE.IMPLEMENTATION) {
            if ($scope.evaluationDet.evaluationInputs == null || $scope.evaluationDet.evaluationInputs == "") {
                snackbar.create($filter('translate')('Evaluation_details_are_mandatory'), 6000, "error");
                $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                return;
            }
            if ($scope.suggestionDet.sourceType == 'HD') {
                if ($scope.isEmpty($scope.suggestionDet.hdCatId) || $scope.suggestionDet.hdCatId == undefined || $scope.suggestionDet.hdCatId == null || $scope.suggestionDet.hdCatId == '') {
                    snackbar.create($filter('translate')('Please_select_category'), 6000, "error");
                    $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                    return;
                }

            }
            if (!$scope.isEmpty($scope.suggestionDet.hdCatId) && $scope.suggestionDet.hdCatId != undefined && $scope.suggestionDet.hdCatId != null && $scope.suggestionDet.hdCatId != '') {
                $scope.data.catId = parseInt($scope.suggestionDet.hdCatId.catId);
            }
            // 11-8-2020 imp
            // if ($scope.suggFlowConfig.isEvalSapCodeEnbld == 'Y') {
            //     if (($rootScope.empDetails.productOrgConfigDet.isSapCodeMandatory == 1) && ($scope.suggestionDet.category.isSapCodeRequired == 'Y')) {
            //         if ($scope.suggestionDet.sapCode == '' || $scope.suggestionDet.sapCode == undefined || $scope.suggestionDet.sapCode == null) {
            //             snackbar.create("Plese enter SAPCode", 6000, "error");
            //             return;
            //         }
            //     }
            // }

            if ($scope.suggFlowConfig.isEvalSapCodeEnbld == 'Y') {
                if (($rootScope.empDetails.productOrgConfigDet.isSapCodeMandatory == 1)) {
                    for (let index = 0; index < $scope.catbranchwise.length; index++) {
                        if ($scope.catbranchwise[index].catId == $scope.suggestionDet.hdCatId.catId) {
                            if ($scope.catbranchwise[index].isSapCodeRequired == 'Y') {
                                if ($scope.suggestionDet.sapCode == '' || $scope.suggestionDet.sapCode == undefined || $scope.suggestionDet.sapCode == null) {
                                    snackbar.create($filter('translate')('Plese_enter_SAPCode'), 6000, "error");
                                    $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                                    return;
                                }
                            }
                        }
                    }
                }
            }

            if ($scope.suggFlowConfig.isParticularsEnbld == 'Y') {
                if ($scope.suggFlowConfig.kaizenCheckReqEval == 'Y' && $rootScope.empDetails.productOrgConfigDet.isSusAuditRequired == 1 && $scope.suggestionDet.hdCatId.isSusAuditRequired == 'Y') {
                    if ($scope.suggestionDet.evalSustenanceflow == undefined || $scope.suggestionDet.evalSustenanceflow == null || !$scope.suggestionDet.evalSustenanceflow) {
                        snackbar.create($filter('translate')('Sustenance_audit_is_mandatory'), 5000, "error");
                        $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                        return;
                    }
                }
                //Sustenance Check
                if ($scope.suggFlowConfig.kaizenCheckReqEval == 'Y' && $scope.suggestionDet.evalSustenanceflow != undefined && $scope.suggestionDet.evalSustenanceflow != null && $scope.suggestionDet.evalSustenanceflow) {
                    if ($scope.suggestionDet.sustenanceAuditorList == null || $scope.suggestionDet.sustenanceAuditorList.length == 0) {
                        snackbar.create($filter('translate')('Auditor_setup_not_found_for_this_category_Please_add_Auditor'), 6000, "error");
                        $scope.flagSelectTeamMem = true;
                        $scope.flagTeamDetPopupSpinner = false;
                        $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                        return;
                    } else if ($scope.suggestionDet.sustenanceAuditorId == undefined || $scope.suggestionDet.sustenanceAuditorId == null || $scope.suggestionDet.sustenanceAuditorId == '') {
                        snackbar.create($filter('translate')('Please_select_sustenance_auditor'), 6000, "error");
                        $scope.flagSelectTeamMem = true;
                        $scope.flagTeamDetPopupSpinner = false;
                        $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                        return;
                    } else {
                        // 7-12-2020 
                        $scope.data.kaizenSusReqByEval = $scope.suggestionDet.evalSustenanceflow;
                        $scope.data.sustenanceAuditorId = $scope.suggestionDet.sustenanceAuditorId;
                    }
                }
            }
            //console.log($scope.data);
            if ($rootScope.empDetails.productOrgConfigDet.isDocChangeOn == 1 && $scope.suggFlowConfig.isChgDocEnbld == 'Y' && !$scope.suggestionDet.tmpIsDocumentChangeRequire) {
                if ($filter('filter')($scope.documentLists, { isChecked: true }).length == 0) {
                    snackbar.create($filter('translate')('Its_mandatory_to_assign_documents_for_update'), 6000, "error");
                    $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                    return;
                }
            }

            if ($scope.suggFlowConfig.isHorizDplymntsEnbld == 'Y') {
                if (!$scope.suggestionDet.isHDRequire && $scope.suggestionDet.hdSelected) {
                    snackbar.create($filter('translate')('Evaluation_horizontal_deployment_mandatory'), 6000, "error");
                    $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                    return;
                }
            }

            if ($scope.suggFlowConfig.isHorizDplymntsEnbld == 'Y' && $scope.suggFlowConfig.isEvalEnbld == 'Y' && $scope.isHorizDeployReq == 'Y') {
                if ($scope.hdConfigData.hdLevel == 'DEPT') {
                    var lineseleted = undefined;
                    for (var i = 0; i < $scope.departmentList.length; i++) {
                        if ($scope.departmentList[i].isEvalselect && $scope.departmentList[i].lineFound) {
                            lineseleted = [];
                            for (var j = 0; j < $scope.departmentList[i].lineList.length; j++) {
                                lineseleted.push($scope.departmentList[i].lineList);
                                // if ($filter('filter')($scope.departmentList[i].lineList, { isEvalselect: true }).length == 0) {
                                //     snackbar.create($filter('translate')('Please_select_line_horizontal_deployment'), 6000, "error");
                                //     return;
                                // }
                            }
                        }
                    }
                    if ($filter('filter')($scope.departmentList, { isEvalselect: true, lineFound: true }).length > 0 && (lineseleted != undefined && $filter('filter')(lineseleted, { isEvalselect: true }).length == 0)) {
                        snackbar.create($filter('translate')('Please_select_line_horizontal_deployment'), 6000, "error");
                        $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                        return;
                    }
                } else {

                }
            }
            if ($scope.suggFlowConfig.isParticularsEnbld == 'Y' && $rootScope.empDetails.productOrgConfigDet.isPraticularsMandatory == 1) {
                if ($filter('filter')($scope.particulars, { isChecked: true }).length == 0) {
                    snackbar.create($filter('translate')('Particulars_Other_Benefits_is_mandatory'), 5000, "error");
                    $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                    return;
                }
            }
            //Check Selected Suggestion Document
            var suggDocList = [];
            for (var i = 0; i < $scope.documentLists.length; i++) {
                if ($scope.documentLists[i].isChecked) {
                    var objt = {
                        suggestion: {
                            sugId: $scope.selectedSuggId
                        },
                        branch: {
                            branchId: $scope.suggestionDet.branch.branchId, //$scope.loggedInUserBranchId
                        },
                        document: {
                            id: parseInt($scope.documentLists[i].id)
                        }
                    };
                    suggDocList.push(objt)
                }
            }
            $scope.data.document = suggDocList;
            //Check Selected Suggestion Activity
            var selectedActivity = [];
            for (var i = 0; i < $scope.activityList.length; i++) {
                if ($scope.activityList[i].isselect) {
                    var tmp = {
                        id: 0,
                        suggestion: {
                            sugId: $scope.selectedSuggId
                        },
                        activity: $scope.activityList[i]
                    };
                    selectedActivity.push(tmp);
                }
            }
            $scope.data.suggActivity = selectedActivity;
            //Check Selected Suggestion Particulars
            if ($scope.suggFlowConfig.isParticularsEnbld == 'Y') {
                var suggPart = [];
                if ($scope.particulars != null && $scope.particulars.length > 0) {
                    for (var i = 0; i < $scope.particulars.length; i++) {
                        var selectedParticular = $filter('filter')($scope.particulars, { isChecked: true });
                        if (selectedParticular.length > 1) {
                            $scope.flagTeamDetPopupSpinner = false;
                            snackbar.create($filter('translate')('Please_select_only_one_benefit'), 5000, 'error');
                            $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                            return;
                        }
                        if ($scope.particulars[i].isChecked && $scope.particulars[i].tangible) {
                            if (!$scope.particulars[i].hasOwnProperty('newUnit') && !$scope.particulars[i].hasOwnProperty('newValue')) {
                                $scope.flagTeamDetPopupSpinner = false;
                                snackbar.create($filter('translate')('Please_enter_value_and_unit_for_tangible_benefit'), 5000, 'error');
                                $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                                return;
                            }
                            if ($scope.particulars[i].hasOwnProperty('newUnit') && $scope.particulars[i].hasOwnProperty('newValue')) {
                                if ($scope.particulars[i].newUnit == undefined || $scope.particulars[i].newUnit == '' || $scope.isEmpty($scope.particulars[i].newUnit) || $scope.particulars[i].newValue == undefined || $scope.particulars[i].newValue == '') {
                                    $scope.flagTeamDetPopupSpinner = false;
                                    snackbar.create($filter('translate')('Please_enter_value_and_unit_for_tangible_benefit'), 5000, 'error');
                                    $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                                    return;
                                }
                            }
                        }
                        var data = $scope.particulars[i];
                        var objt = {};
                        if ($scope.particulars[i].selectedId == 0 && $scope.particulars[i].isChecked) {
                            objt = {
                                "id": 0,
                                "particular": {
                                    "id": data.id
                                },
                                "suggestion": {
                                    "sugId": $scope.selectedSuggId
                                },
                                "createdById": $scope.loggedInEmpId,
                                "isActive": "Y",
                                "tangible": data.tangible,
                                "recommendedBy": $scope.loggedInEmpId,
                                "action": "ADD",
                                "roleId": 8,
                                "catId": parseInt($scope.suggestionDet.selectedEvalCatId),
                            }
                            if (data.tangible) {
                                // 8-12-2020
                                objt.unit = data.newUnit.unit;
                                objt.masterUnit = {
                                    id: data.newUnit.id
                                };
                                objt.value = data.value;
                                objt.frequency = (data.evalFrequency) ? data.evalFrequency.value : data.frequency;
                                if (data.evalExistingValue && data.evalExistingValue > 0) {
                                    objt.existingValue = data.evalExistingValue;
                                }
                            }
                            if ($scope.suggestionDet.emp_details != null && $scope.suggestionDet.emp_details != undefined) {
                                objt.sugCreatedByEmpId = $scope.suggestionDet.emp_details.empId;
                            }

                            if ($scope.suggestionDet.customEvaluationParticularsList != null && $scope.suggestionDet.customEvaluationParticularsList.length > 0) {
                                for (var m = 0; m < $scope.suggestionDet.customEvaluationParticularsList.length; m++) {
                                    var tmpObj = { id: $scope.suggestionDet.customEvaluationParticularsList[m].id, "action": "DELETE" };
                                    suggPart.push(tmpObj);
                                }
                            }
                            suggPart.push(objt);
                        } else if ($scope.particulars[i].selectedId > 0) {
                            if ($scope.particulars[i].isChecked) {
                                if (data.tangible) {
                                    if ($scope.particulars[i].hasOwnProperty('newUnit') && $scope.particulars[i].hasOwnProperty('newValue')) {
                                        $scope.particulars[i].unit = $scope.particulars[i].newUnit;
                                        $scope.particulars[i].value = $scope.particulars[i].newValue;
                                        $scope.particulars[i].frequency = ($scope.particulars[i].evalFrequency) ? $scope.particulars[i].evalFrequency.value : $scope.particulars[i].frequency;
                                        $scope.particulars[i].existingValue = $scope.particulars[i].evalExistingValue;
                                        if ($scope.checkBenefitsValue($scope.particulars[i])) {
                                            objt = {
                                                "id": data.selectedId,
                                                "particular": {
                                                    "id": data.id
                                                },
                                                "suggestion": {
                                                    "sugId": $scope.selectedSuggId
                                                },
                                                "createdById": $scope.loggedInEmpId,
                                                "isActive": "Y",
                                                "tangible": data.tangible,
                                                "recommendedBy": $scope.loggedInEmpId,
                                                "action": "UPDATE",
                                                "roleId": 8
                                            }
                                            if (data.tangible) {
                                                objt.unit = data.unit.unit;
                                                objt.masterUnit = {
                                                    id: data.unit.id
                                                };
                                                objt.value = data.value;
                                                objt.unit = data.unit.unit;
                                                objt.frequency = data.frequency;
                                                if (data.existingValue && data.existingValue > 0) {
                                                    objt.existingValue = data.existingValue;
                                                }
                                            }
                                            if ($scope.suggestionDet.emp_details != null && $scope.suggestionDet.emp_details != undefined) {
                                                objt.sugCreatedByEmpId = $scope.suggestionDet.emp_details.empId;
                                            }
                                            suggPart.push(objt);
                                        }
                                    }
                                } else {
                                    objt = {
                                        "id": data.selectedId,
                                        "particular": {
                                            "id": data.id
                                        },
                                        "suggestion": {
                                            "sugId": $scope.selectedSuggId
                                        },
                                        "createdById": $scope.loggedInEmpId,
                                        "isActive": "Y",
                                        "tangible": data.tangible,
                                        "recommendedBy": $scope.loggedInEmpId,
                                        "action": "UPDATE",
                                        "roleId": 8
                                    }
                                    if ($scope.suggestionDet.emp_details != null && $scope.suggestionDet.emp_details != undefined) {
                                        objt.sugCreatedByEmpId = $scope.suggestionDet.emp_details.empId;
                                    }
                                    suggPart.push(objt);
                                }
                            } else {
                                // 22-12-2020
                                // objt = {
                                //     "id": data.selectedId,
                                //     "particular": {
                                //         "id": data.id
                                //     },
                                //     "suggestion": {
                                //         "sugId": $scope.selectedSuggId
                                //     },
                                //     "createdById": $scope.loggedInEmpId,
                                //     "recommendedBy": $scope.loggedInEmpId,
                                //     "action": "DELETE",
                                //     "roleId": 8
                                // }
                                // if ($scope.suggestionDet.emp_details != null && $scope.suggestionDet.emp_details != undefined) {
                                //     objt.sugCreatedByEmpId = $scope.suggestionDet.emp_details.empId;
                                // }
                                // suggPart.push(objt);
                            }
                        }
                    }
                }
                $scope.data.suggParticulars = suggPart;
                consoleLog($scope.data.suggParticulars);
            }
            //Added Saving Type
            var suggSaving = [];
            if ($scope.SavingTypeLists != null && $scope.SavingTypeLists.length > 0) {
                for (var i = 0; i < $scope.SavingTypeLists.length; i++) {
                    var objt = {
                        "id": 0,
                        "setPointsForSaving": {
                            "id": parseInt($scope.SavingTypeLists[i].amt.id)
                        },
                        "suggestion": {
                            "sugId": $scope.selectedSuggId
                        },
                        "sugCreatedByEmpId": $scope.suggestionDet.emp_details.empId,
                        "points": $scope.SavingTypeLists[i].points,
                        "createdById": $scope.loggedInEmpId
                    };
                    suggSaving.push(objt);
                }
            }
            if (suggSaving != null && suggSaving.length > 0) {
                $scope.data.evalPoints = suggSaving;
            }

            //Check Mandatory field
            var requeireField = $rootScope.empDetails.productOrgConfigDet;

            if ($scope.suggFlowConfig.isKaizenActEnbld == 'Y' && $scope.suggFlowConfig.isEvalEnbld == 'Y' && requeireField.isActivityOn == 1) {
                if ($scope.data.suggActivity == null || $scope.data.suggActivity.length == 0) {
                    snackbar.create($filter('translate')('Kaizen_activities_are_mandatory'), 6000, "error");
                    $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                    return;
                }
            }
            $scope.popupTitle = "Implementers";
            // url = "getemplistrolewise/" + $scope.loggedInUserBranchId + "/9";
            // if ($scope.evaluationDet.evaluationInputs != '') {
            //     $("#teamDetModal")
            //         .modal({
            //             backdrop: 'static',
            //             keyboard: false
            //         });
            // } else {
            //     $scope.flagEvalText = true;
            // }
            if ($scope.evaluationDet.evaluationInputs == null || $scope.evaluationDet.evaluationInputs == "") {
                snackbar.create($filter('translate')('Evaluation_details_are_mandatory'), 6000, "error");
                $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                $scope.flagEvalText = true;
                return;
            }
            if (($scope.suggestionDet.status_master.status ==
                $scope.CONST.STATUS.EvaluationRequestAccepted.status || $scope.suggestionDet.status_master.status ==
                $scope.CONST.STATUS.ReassignedToEvaluationTeam.status) && $scope.productOrgConfigList.isPriorityMadatory == true && $scope.suggestionDet.suggPriority == null && $scope.suggFlowConfig.isImplPriority == "Y") {
                snackbar.create($filter('translate')('Implementation_Priority_is_mandatory'), 6000, "error");
                $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                return;
            } else {
                $("#implTeamDetModal")
                    .modal({
                        backdrop: 'static',
                        keyboard: false
                    });
                $scope.showImplFinanceEmpList(3);
                return;
            }
        } else if (teamType == $scope.CONST.TEAM_TYPE.APPROVEDBYFC) { //on verified by fc will reassign to impl
            $scope.popupTitle = "Implementers";
            // url = "getemplistrolewise/" + $scope.loggedInUserBranchId + "/9";
            $("#implTeamDetModal")
                .modal({
                    backdrop: 'static',
                    keyboard: false
                });
            $scope.showImplFinanceEmpList(3);
            return;
        } else if (teamType == 'executiveMgmtController') {
            $scope.popupTitle = "Management Controllers";
            url = "getAllEmpListForExecutor/" + $scope.loggedInUserBranchId;
            $("#teamDetModal")
                .modal({
                    backdrop: 'static',
                    keyboard: false
                });
        } else if (teamType == 'passToPeer') {
            if ($scope.suggestionInputDetails.acceptRejBy == 'bySupervisor') {
                $scope.popupTitle = "Controllers";
                /*-- START FOR CIRCLE CHANGE--------BY SUNANDA-------3-1-2020 --*/
                if ($scope.suggestionDet.circle != null) {
                    $scope.getCircleControllerList();
                    $("#teamDetModalforController")
                        .modal({
                            backdrop: 'static',
                            keyboard: false
                        });
                } else {
                    url = "getlistofusersbranchwise/" + $scope.suggestionDet.branch.branchId + '/0/0/6';
                    $("#teamDetModalforController")
                        .modal({
                            backdrop: 'static',
                            keyboard: false
                        });
                }
                /*-- END FOR CIRCLE CHANGE--------BY SUNANDA-------3-1-2020 --*/
            }
            if ($scope.suggestionInputDetails.acceptRejBy == 'byEval') {
                $scope.popupTitle = "Evaluators";
                url = "getlistofusersbranchwise/" + $scope.suggestionDet.branch.branchId + '/0/0/8';
                $("#teamDetModalforEval")
                    .modal({
                        backdrop: 'static',
                        keyboard: false
                    });
            }
            if ($scope.suggestionInputDetails.acceptRejBy == 'byImpl') {
                $scope.popupTitle = "Implementers";
                // url = "getemplistrolewise/" + $scope.loggedInUserBranchId + "/9";
                $("#implTeamDetModal")
                    .modal({
                        backdrop: 'static',
                        keyboard: false
                    });
                $scope.showImplFinanceEmpList(3);
                return;
            }
        } else if (teamType == $scope.CONST.TEAM_TYPE.EVALFC) {
            if ($scope.evaluationDet.evaluationInputs == null || $scope.evaluationDet.evaluationInputs == "") {
                snackbar.create($filter('translate')('Evaluation_details_are_mandatory'), 6000, "error");
                $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                return;
            }
            if ($scope.evaluationDet.estimatedCost == null || $scope.evaluationDet.estimatedCost == "" || $scope.evaluationDet.estimatedCost == 0) {
                snackbar.create($filter('translate')('Budgetary_Cost_is_mandatory'), 6000, "error");
                $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                return;
            }
            if ($scope.suggestionDet.sourceType == 'HD') {
                if ($scope.isEmpty($scope.suggestionDet.hdCatId) || $scope.suggestionDet.hdCatId == undefined || $scope.suggestionDet.hdCatId == null || $scope.suggestionDet.hdCatId == '') {
                    snackbar.create($filter('translate')('Please_select_category'), 6000, "error");
                    $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                    return;
                }
            }
            if (!$scope.isEmpty($scope.suggestionDet.hdCatId) && $scope.suggestionDet.hdCatId != undefined && $scope.suggestionDet.hdCatId != null && $scope.suggestionDet.hdCatId != '') {
                $scope.data.catId = parseInt($scope.suggestionDet.hdCatId.catId);
            }
            // 11-8-2020 imp check
            if ($scope.suggFlowConfig.isEvalSapCodeEnbld == 'Y') {
                if (($rootScope.empDetails.productOrgConfigDet.isSapCodeMandatory == 1)) {
                    for (let index = 0; index < $scope.catbranchwise.length; index++) {
                        if ($scope.catbranchwise[index].catId == $scope.suggestionDet.hdCatId.catId) {
                            if ($scope.catbranchwise[index].isSapCodeRequired == 'Y') {
                                if ($scope.suggestionDet.sapCode == '' || $scope.suggestionDet.sapCode == undefined || $scope.suggestionDet.sapCode == null) {
                                    snackbar.create($filter('translate')('Plese_enter_SAPCode'), 6000, "error");
                                    $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                                    return;
                                }
                            }
                        }
                    }
                }
            }
            //console.log($scope.data);
            if ($scope.suggFlowConfig.isHorizDplymntsEnbld == 'Y') {
                if (!$scope.suggestionDet.isHDRequire && $scope.suggestionDet.hdSelected) {
                    snackbar.create($filter('translate')('Evaluation_horizontal_deployment_mandatory'), 6000, "error");
                    $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                    return;
                }
            }

            if ($rootScope.empDetails.productOrgConfigDet.isDocChangeOn == 1 && $scope.suggFlowConfig.isChgDocEnbld == 'Y' && !$scope.suggestionDet.tmpIsDocumentChangeRequire) {
                if ($filter('filter')($scope.documentLists, { isChecked: true }).length == 0) {
                    snackbar.create($filter('translate')('Its_mandatory_to_assign_documents_for_update'), 6000, "error");
                    $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                    return;
                }
            }

            if ($scope.evaluationDet.estimatedCost == null || $scope.evaluationDet.estimatedCost == "" || $scope.evaluationDet.estimatedCost == 0) {
                snackbar.create($filter('translate')('Budgetary_Cost_is_mandatory'), 6000, "error");
                $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                return;
            }
            if ($scope.suggFlowConfig.isParticularsEnbld == 'Y' && $rootScope.empDetails.productOrgConfigDet.isPraticularsMandatory == 1) {
                if ($filter('filter')($scope.particulars, { isChecked: true }).length == 0) {
                    snackbar.create($filter('translate')('Particulars_Other_Benefits_is_mandatory'), 5000, "error");
                    $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                    return;
                }
            }
            //Check Selected Suggestion Document
            var suggDocList = [];
            for (var i = 0; i < $scope.documentLists.length; i++) {
                if ($scope.documentLists[i].isChecked) {
                    var objt = {
                        suggestion: {
                            sugId: $scope.selectedSuggId
                        },
                        branch: {
                            branchId: $scope.suggestionDet.branch.branchId, //$scope.loggedInUserBranchId
                        },
                        document: {
                            id: parseInt($scope.documentLists[i].id)
                        }
                    };
                    suggDocList.push(objt)
                }

            }
            $scope.data.document = suggDocList;
            //Check Selected Suggestion Activity
            var selectedActivity = [];
            for (var i = 0; i < $scope.activityList.length; i++) {
                if ($scope.activityList[i].isselect) {
                    var tmp = {
                        id: 0,
                        suggestion: {
                            sugId: $scope.selectedSuggId
                        },
                        activity: $scope.activityList[i]
                    };
                    selectedActivity.push(tmp);
                }
            }
            $scope.data.suggActivity = selectedActivity;
            //Check Selected Suggestion Particulars
            if ($scope.suggFlowConfig.isParticularsEnbld == 'Y') {
                var suggPart = [];
                if ($scope.particulars != null && $scope.particulars.length > 0) {
                    for (var i = 0; i < $scope.particulars.length; i++) {
                        var selectedParticular = $filter('filter')($scope.particulars, { isChecked: true });
                        if (selectedParticular.length > 1) {
                            $scope.flagTeamDetPopupSpinner = false;
                            snackbar.create($filter('translate')('Please_select_only_one_benefit'), 5000, 'error');
                            $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                            return;
                        }
                        if ($scope.particulars[i].isChecked && $scope.particulars[i].tangible) {
                            if (!$scope.particulars[i].hasOwnProperty('newUnit') && !$scope.particulars[i].hasOwnProperty('newValue')) {
                                $scope.flagTeamDetPopupSpinner = false;
                                snackbar.create($filter('translate')('Please_enter_value_and_unit_for_tangible_benefit'), 5000, 'error');
                                $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                                return;
                            }
                            if ($scope.particulars[i].hasOwnProperty('newUnit') && $scope.particulars[i].hasOwnProperty('newValue')) {
                                if ($scope.particulars[i].newUnit == undefined || $scope.particulars[i].newUnit == '' || $scope.isEmpty($scope.particulars[i].newUnit) || $scope.particulars[i].newValue == undefined || $scope.particulars[i].newValue == '') {
                                    $scope.flagTeamDetPopupSpinner = false;
                                    snackbar.create($filter('translate')('Please_enter_value_and_unit_for_tangible_benefit'), 5000, 'error');
                                    $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                                    return;
                                }
                            }
                        }
                        var data = $scope.particulars[i];
                        var objt = {};
                        if ($scope.particulars[i].selectedId == 0 && $scope.particulars[i].isChecked) {
                            objt = {
                                "id": 0,
                                "particular": {
                                    "id": data.id
                                },
                                "suggestion": {
                                    "sugId": $scope.selectedSuggId
                                },
                                "createdById": $scope.loggedInEmpId,
                                "isActive": "Y",
                                "tangible": data.tangible,
                                "recommendedBy": $scope.loggedInEmpId,
                                "action": "ADD",
                                "roleId": 8,
                                "catId": parseInt($scope.suggestionDet.selectedEvalCatId),
                            }
                            if (data.tangible) {
                                // 8-12-2020
                                objt.unit = data.newUnit.unit;
                                objt.masterUnit = {
                                    id: data.newUnit.id
                                };
                                objt.value = data.value;
                                objt.frequency = (data.evalFrequency) ? data.evalFrequency.value : data.frequency;
                                if (data.evalExistingValue && data.evalExistingValue > 0) {
                                    objt.existingValue = data.evalExistingValue;
                                }
                            }
                            if ($scope.suggestionDet.emp_details != null && $scope.suggestionDet.emp_details != undefined) {
                                objt.sugCreatedByEmpId = $scope.suggestionDet.emp_details.empId;
                            }

                            if ($scope.suggestionDet.customEvaluationParticularsList != null && $scope.suggestionDet.customEvaluationParticularsList.length > 0) {
                                for (var m = 0; m < $scope.suggestionDet.customEvaluationParticularsList.length; m++) {
                                    var tmpObj = { id: $scope.suggestionDet.customEvaluationParticularsList[m].id, "action": "DELETE" };
                                    suggPart.push(tmpObj);
                                }
                            }
                            suggPart.push(objt);
                        } else if ($scope.particulars[i].selectedId > 0) {
                            if ($scope.particulars[i].isChecked) {
                                if (data.tangible) {
                                    if ($scope.particulars[i].hasOwnProperty('newUnit') && $scope.particulars[i].hasOwnProperty('newValue')) {
                                        $scope.particulars[i].unit = $scope.particulars[i].newUnit;
                                        $scope.particulars[i].value = $scope.particulars[i].newValue;
                                        $scope.particulars[i].frequency = ($scope.particulars[i].evalFrequency) ? $scope.particulars[i].evalFrequency.value : $scope.particulars[i].frequency;
                                        $scope.particulars[i].existingValue = $scope.particulars[i].evalExistingValue;
                                        if ($scope.checkBenefitsValue($scope.particulars[i])) {
                                            objt = {
                                                "id": data.selectedId,
                                                "particular": {
                                                    "id": data.id
                                                },
                                                "suggestion": {
                                                    "sugId": $scope.selectedSuggId
                                                },
                                                "createdById": $scope.loggedInEmpId,
                                                "isActive": "Y",
                                                "tangible": data.tangible,
                                                "recommendedBy": $scope.loggedInEmpId,
                                                "action": "UPDATE",
                                                "roleId": 8
                                            }
                                            if (data.tangible) {
                                                objt.unit = data.unit.unit;
                                                objt.masterUnit = {
                                                    id: data.unit.id
                                                };
                                                objt.value = data.value;
                                                objt.unit = data.unit.unit;
                                                objt.frequency = data.frequency;
                                                if (data.existingValue && data.existingValue > 0) {
                                                    objt.existingValue = data.existingValue;
                                                }
                                            }
                                            if ($scope.suggestionDet.emp_details != null && $scope.suggestionDet.emp_details != undefined) {
                                                objt.sugCreatedByEmpId = $scope.suggestionDet.emp_details.empId;
                                            }
                                            suggPart.push(objt);
                                        }
                                    }
                                } else {
                                    objt = {
                                        "id": data.selectedId,
                                        "particular": {
                                            "id": data.id
                                        },
                                        "suggestion": {
                                            "sugId": $scope.selectedSuggId
                                        },
                                        "createdById": $scope.loggedInEmpId,
                                        "isActive": "Y",
                                        "tangible": data.tangible,
                                        "recommendedBy": $scope.loggedInEmpId,
                                        "action": "UPDATE",
                                        "roleId": 8
                                    }
                                    if ($scope.suggestionDet.emp_details != null && $scope.suggestionDet.emp_details != undefined) {
                                        objt.sugCreatedByEmpId = $scope.suggestionDet.emp_details.empId;
                                    }
                                    suggPart.push(objt);
                                }
                            } else {
                                // 22-12-2020
                                // objt = {
                                //     "id": data.selectedId,
                                //     "particular": {
                                //         "id": data.id
                                //     },
                                //     "suggestion": {
                                //         "sugId": $scope.selectedSuggId
                                //     },
                                //     "createdById": $scope.loggedInEmpId,
                                //     "recommendedBy": $scope.loggedInEmpId,
                                //     "action": "DELETE",
                                //     "roleId": 8
                                // }
                                // if ($scope.suggestionDet.emp_details != null && $scope.suggestionDet.emp_details != undefined) {
                                //     objt.sugCreatedByEmpId = $scope.suggestionDet.emp_details.empId;
                                // }
                                // suggPart.push(objt);
                            }
                        }
                    }
                }
                $scope.data.suggParticulars = suggPart;
                consoleLog($scope.data.suggParticulars);
            }
            $scope.data.suggParticulars = suggPart;
            //Added Saving Type
            var suggSaving = [];
            if ($scope.SavingTypeLists != null && $scope.SavingTypeLists.length > 0) {
                for (var i = 0; i < $scope.SavingTypeLists.length; i++) {
                    var objt = {
                        "id": 0,
                        "setPointsForSaving": {
                            "id": parseInt($scope.SavingTypeLists[i].amt.id)
                        },
                        "suggestion": {
                            "sugId": $scope.selectedSuggId
                        },
                        "sugCreatedByEmpId": $scope.suggestionDet.emp_details.empId,
                        "points": $scope.SavingTypeLists[i].points,
                        "createdById": $scope.loggedInEmpId
                    };
                    suggSaving.push(objt);
                }
            }
            if (suggSaving != null && suggSaving.length > 0) {
                $scope.data.evalPoints = suggSaving;
            }
            //Check Mandatory field
            var requeireField = $rootScope.empDetails.productOrgConfigDet;
            if ($scope.suggFlowConfig.isKaizenActEnbld == 'Y' && $scope.suggFlowConfig.isEvalEnbld == 'Y' && requeireField.isActivityOn == 1) {
                if ($scope.data.suggActivity == null || $scope.data.suggActivity.length == 0) {
                    snackbar.create($filter('translate')('Kaizen_activities_are_mandatory'), 6000, "error");
                    $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                    return;
                }
            }
            if ($scope.suggestionDet.status_master.status ==
                $scope.CONST.STATUS.EvaluationRequestAccepted.status && $scope.productOrgConfigList.isPriorityMadatory == true && $scope.suggestionDet.suggPriority == null && $scope.suggFlowConfig.isImplPriority == "Y") {
                snackbar.create($filter('translate')('Implementation_Priority_is_mandatory'), 6000, "error");
                $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                return;
            }
            $scope.popupTitle = "Finance Approval";
            //url = "getemplistrolewise/" + $scope.loggedInUserBranchId + "/22";
            $("#implTeamDetModal")
                .modal({
                    backdrop: 'static',
                    keyboard: false
                });
            $scope.showImplFinanceEmpList(2);
            return;
        } else if (teamType == 'onHoldToImpl') {
            $scope.popupTitle = "Implementers";
            $scope.flagcancelresumesugg = false;
            if ($scope.implData.onHoldImplSummary == '' || $scope.implData.onHoldImplSummary == undefined || $scope.implData.onHoldImplSummary == null) {
                $scope.flagcancelresumesugg = true;
                return;
            }
            $("#onHoldImplModal")
                .modal({
                    backdrop: 'static',
                    keyboard: false
                });
            $scope.showImplFinanceEmpList(3);
            return;
        }
        //console.log($scope.data);
        // return;
        appService.httpGet(url)
            .then(function (response) {
                $scope.flagTeamDetPopupLoading = false;
                $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                $scope.flagSelectTeamMem = false;
                if (response.result) {
                    $scope.empListByTeamType = [];
                    if (teamType != 'passToPeer') {
                        if (teamType == $scope.CONST.TEAM_TYPE.IMPLEMENTATION || teamType == $scope.CONST.TEAM_TYPE.EVALFC || teamType == $scope.CONST.TEAM_TYPE.APPROVEDBYFC) {
                            $scope.empListByTeamType = response.allEmpDetails;
                            for (var i = 0; i < $scope.empListByTeamType.length; i++) {
                                $scope.empListByTeamType[i].empName = $scope.empListByTeamType[i].firstName + ' ' + $scope.empListByTeamType[i].lastName;
                                if ($scope.empListByTeamType[i].dept != null && $scope.empListByTeamType[i].dept != undefined) {
                                    $scope.empListByTeamType[i].deptName = $scope.empListByTeamType[i].dept.deptName;
                                }
                            }
                            if ($scope.empListByTeamType == null || $scope.empListByTeamType.length == 0) {
                                $scope.flagTeamDetNotAvailMsg = true;
                            }
                        } else if (teamType == $scope.CONST.TEAM_TYPE.EVALUATION) {
                            $scope.pillerWiseEvaluatorList = response.deptlvlusersList;
                            $scope.empListByTeamType = response.deptlvlusersList;
                        } else {
                            $scope.empListByTeamType = response.deptlvlusersList;
                            if ($scope.empListByTeamType == null || $scope.empListByTeamType.length == 0) {
                                $scope.flagTeamDetNotAvailMsg = true;
                            }
                        }
                    } else {
                        if ($scope.suggestionInputDetails.acceptRejBy == 'byImpl') {
                            $scope.empListByTeamType = [];
                            for (var i = 0; i < response.allEmpDetails.length; i++) {
                                var tmpusr = response.allEmpDetails[i];
                                if (tmpusr.empId != $scope.loggedInEmpId) {
                                    var objt = {
                                        empName: tmpusr.firstName + ' ' + tmpusr.lastName,
                                        deptName: tmpusr.dept.deptName
                                    }
                                    var newObjt = Object.assign({}, objt, tmpusr);
                                    $scope.empListByTeamType.push(newObjt);
                                }
                            }
                            if ($scope.empListByTeamType == null || $scope.empListByTeamType.length == 0) {
                                $scope.flagTeamDetNotAvailMsg = true;
                            }
                        } else {
                            $scope.empListByTeamType = [];
                            if (response.deptlvlusersList.length > 0) {
                                if ($scope.suggestionInputDetails.acceptRejBy == 'bySupervisor') {
                                    for (var i = 0; i < response.deptlvlusersList.length; i++) {
                                        var tmpusrlevel = response.deptlvlusersList[i];
                                        if (tmpusrlevel.level == 0) {
                                            if (tmpusrlevel.empId != $scope.loggedInEmpId) {
                                                $scope.empListByTeamType.push(tmpusrlevel);
                                            }
                                        }
                                    }
                                } else {
                                    // 9-7-2020
                                    $scope.empListByTeamType = [];
                                    $scope.pillerWiseEvaluatorList = [];
                                    for (var i = 0; i < response.deptlvlusersList.length; i++) {
                                        var tmpusrlevel = response.deptlvlusersList[i];
                                        if (tmpusrlevel.level == 0) {
                                            if (tmpusrlevel.empId != $scope.loggedInEmpId) {
                                                $scope.empListByTeamType.push(tmpusrlevel);
                                                $scope.pillerWiseEvaluatorList.push(tmpusrlevel);
                                            }
                                        }
                                    }

                                }
                            }
                        }
                    }
                    //console.log($scope.empListByTeamType)

                } else {
                    $scope.flagTeamDetNotAvailMsg = true;
                }
                $scope.flagHdpiller = false;
            });
    }

    $scope.selectTeamMemberOnRowClick = function (rowRdoId) {
        angular.element('.rdoEmpSelect')
            .attr('checked', false);
        angular.element(rowRdoId)
            .attr('checked', true);
    }
    $scope.empInputDet = {};
    $scope.empInputDet.selectedEmpIds = [];
    $scope.isSelectedRow = function (emp) {
        var flag = false;
        // emp.isSelected ? false : true;
        if ($scope.empInputDet.selectedEmpIds != null && $scope.empInputDet.selectedEmpIds.indexOf(emp.empId) > -1) {
            flag = true;
        }
        return flag;
    }
    $scope.checkRow = function (type, emp, array) {
        if (type === 'Single') {
            // Deselect all employees
            array.forEach(function (item) {
                item.isSelected = false; // Set all isSelected flags to false
            });

            // Select only the current employee
            emp.isSelected = true;
            $scope.empInputDet.selectedEmpIds = [emp.empId]; // Store only the current employee's ID
            $scope.empInputDet.selectedEmpId = emp.empId;
            $scope.empInputDet.selectedRowId = emp.id;

        } else if (type === 'Multiple') {
            // Handle Multiple selection
            if ($scope.empInputDet.selectedEmpIds.indexOf(emp.empId) > -1) {
                // If employee is already selected, deselect it
                emp.isSelected = false;
                $scope.empInputDet.selectedEmpIds = $scope.empInputDet.selectedEmpIds.filter(id => id !== emp.empId);
            } else {
                // If employee is not selected, select it
                emp.isSelected = true;
                $scope.empInputDet.selectedEmpIds.push(emp.empId);
            }
        }
        // console.log($scope.empInputDet.selectedEmpIds);
    };

    $scope.change_flag = function () {
        $scope.flagSelectTeamMem = false;
    }

    /*Start new change fince controller list by sunanda 15-1-2020*/
    $scope.getFCList = function () {
        /* if ($scope.FCList != undefined && $scope.FCList.length > 0) {
            return;
        } */
        var req = {
            "orgId": $rootScope.empDetails.organization.orgId,
            "branchId": $scope.suggestionDet.branch.branchId,
            "userType": { "id": 1 }
        }
        //appService.httpGet("getSuggestionUserSetup/" + $scope.loggedInUserBranchId + "/" + $rootScope.empDetails.organization.orgId)
        appService.httpPost(req, 'getSuggestionUserDetails')
            .then(function (response) {
                if (response.result) {
                    if (response.list != null && response.list.length > 0) {
                        $scope.FCList = response.list;
                        if ($scope.suggestionDet.FCData != '' && $scope.suggestionDet.FCData != undefined) {
                            $scope.isFcAvailable($scope.suggestionDet.FCData);
                        }
                    } else {
                        $scope.FCList = [];
                    }
                }
            });
    }
    /* End new change fince controller list by sunanda 15-1-2020*/

    //check for display pending action
    $scope.checkToDisplayPending = function (audit) {
        if (audit.emp_details.empId == $scope.loggedInEmpId && audit.actionStatus == 'PENDING' && audit.status_master.statusId == $scope.suggestionDet.status_master.statusId && $scope.statusCountFilter == $scope.CONST.COUNT_FILTERS.PENDING) {
            return true;
        } else {
            return false;
        }
    }
    //check for display in other action
    $scope.checkToDisplayOther = function (audit) {
        if (audit.actionStatus != 'PENDING' && $scope.statusCountFilter != $scope.CONST.COUNT_FILTERS.PENDING) {
            return true;
        } else {
            return false;
        }
    }

    $scope.callAssignSuggestion = function (teamtype) {
        snackbar.create($filter('translate')('Suggestion_is_assinged_to_FC'), 6000, "success");
        $scope.selectedTeamTypeForAssign = teamtype;
        $scope.assignSuggestion();
    }

    $scope.assignImpl = function () {
        $scope.selectedTeamTypeForAssign = $scope.CONST.TEAM_TYPE.IMPLEMENTATION;
        $scope.assignSuggestion();
    }
    $scope.getCategoryValuefromPrt = function (data) {
        var catObj = {};
        if ($scope.particulars != null && $scope.particulars.length > 0) {
            for (let index = 0; index < $scope.particulars.length; index++) {
                if ($scope.particulars[index].id == data) {
                    catObj = $scope.particulars[index].category;
                }

            }
        }
        return catObj;
    }
    $scope.checkBenefitsValue = function (data) {
        var flag = false;
        if ($scope.suggestionDet.benefitPointsAudit != null && $scope.suggestionDet.benefitPointsAudit.length > 0) {
            var rec = $filter('filter')($scope.suggestionDet.benefitPointsAudit, { particularPoints: { id: data.selectedId } }, true);
            if (rec != null && rec.length > 0) {
                if (rec[0].new_value != data.value || rec[0].oldUnit != data.unit.id) {
                    flag = true;
                }
            }
        }
        return flag;
    }
    $scope.getSustenaceAuditor = function () {
        var catName;
        if ($scope.suggestionDet.sourceType == 'HD') {
            catName = $scope.suggestionDet.hdCatId.categoryName;
        } else {
            catName = $scope.suggestionDet.category.categoryName;
        }
        if ($scope.suggestionDet.sustenanceAuditorList != null && $filter('filter')($scope.suggestionDet.sustenanceAuditorList, { branchId: $scope.suggestionDet.branch.branchId }, true).length > 0) {
            if ($scope.suggestionDet.kaizenSusReqByEval != undefined && $scope.suggestionDet.kaizenSusReqByEval == true) {
                if ($scope.suggestionDet.sustenanceAuditorId != undefined && $scope.suggestionDet.sustenanceAuditorId != null) {
                    $scope.suggestionDet.sustenanceAuditorId = $scope.suggestionDet.sustenanceAuditorId.toString();
                }
            } else {
                if ($scope.suggestionDet.sustenanceAuditorList.length == 1) {
                    $scope.suggestionDet.sustenanceAuditorId = $scope.suggestionDet.sustenanceAuditorList[0].empId.toString();
                } else {
                    let rec = $filter('filter')($scope.suggestionDet.sustenanceAuditorList, { categoryName: catName }, true);
                    if (rec != null && rec.length > 0) {
                        $scope.suggestionDet.sustenanceAuditorId = rec[0].empId.toString();
                    } else {
                        $scope.suggestionDet.sustenanceAuditorId = $scope.suggestionDet.sustenanceAuditorList[0].empId.toString();
                    }
                }
            }
        } else {
            var req = {
                "branchId": $scope.suggestionDet.branch.branchId,
                "type": "SUGGESTION",
                // "orgId": $rootScope.empDetails.organization.orgId
            }
            appService.httpPost(req, "getAuditorDetailsNew")
                .then(function (response) {
                    if (response.result) {
                        $scope.suggestionDet.sustenanceAuditorList = [];
                        if (response.auditorList != null && response.auditorList.length > 0) {
                            for (let index = 0; index < response.auditorList.length; index++) {
                                if (response.auditorList[index].categoryName == catName) {
                                    $scope.suggestionDet.sustenanceAuditorList.push(response.auditorList[index]);
                                }
                            }
                            if ($scope.suggestionDet.kaizenSusReqByEval != undefined && $scope.suggestionDet.kaizenSusReqByEval == true) {
                                if ($scope.suggestionDet.sustenanceAuditorId != undefined && $scope.suggestionDet.sustenanceAuditorId != null) {
                                    $scope.suggestionDet.sustenanceAuditorId = $scope.suggestionDet.sustenanceAuditorId.toString();
                                }
                            } else {
                                if (response.auditorList.length == 1) {
                                    $scope.suggestionDet.sustenanceAuditorId = response.auditorList[0].empId.toString();
                                } else {
                                    let rec = $filter('filter')(response.auditorList, { categoryName: catName }, true);
                                    if (rec != null && rec.length > 0) {
                                        $scope.suggestionDet.sustenanceAuditorId = rec[0].empId.toString();
                                    } else {
                                        $scope.suggestionDet.sustenanceAuditorId = response.auditorList[0].empId.toString();
                                    }
                                }
                            }
                        } else {
                            $scope.suggestionDet.sustenanceAuditorList = [];
                        }
                    } else {
                        $scope.suggestionDet.sustenanceAuditorList = [];
                    }
                });
        }
    }
    $scope.assignSuggestion = function () {
        /*----------START-FOR FC CHANGE BY SUNANDA 12-10*/
        if ($scope.suggestionDet.isHDRequire == true) {
            $scope.isHorizDeployReq = 'NA';
        } else {
            $scope.isHorizDeployReq = 'Y';
        }
        /*-----------END-FOR FC CHANGE BY SUNANDA 12-10*/

        $scope.flagTeamDetPopupSpinner = true;
        var url = '';
        if ($scope.selectedTeamTypeForAssign != 'passToPeer') {
            var selectedEmpIds = [];
            var selectedSingleEmpId = 0;
            var url = 'assignSuggestioneval';
            if ($scope.suggestionDet.sourceType != 'HD') {
                if ($scope.selectedTeamTypeForAssign == $scope.CONST.TEAM_TYPE.IMPLEMENTATION && ($scope.suggestionDet.isSelfImplemented == 1 || (($scope.suggestionDet.category.processType == 'Tier-1' && $scope.suggestionBranchConfig.isTierOneSelfImpl == 1) || ($scope.suggestionDet.category.processType == 'Tier-2' && $scope.suggestionBranchConfig.tierTwoSelfImpl == 1)))) {
                    // selectedEmpIds.push($scope.suggestionDet.emp_details.empId);
                    if ($scope.suggestionDet.emp_details.hasOwnProperty('empType') && $scope.suggestionDet.emp_details.empType == 'CW') {
                        selectedEmpIds.push($scope.suggestionDet.createdBy.empId);
                    } else {
                        selectedEmpIds.push($scope.suggestionDet.emp_details.empId);
                    }
                } else {
                    /* $.each($("input[name='empChk']:checked"), function () {
                        selectedEmpIds.push(parseInt($(this)
                            .val()));
                        selectedSingleEmpId = parseInt($(this)
                            .val());
                    }); */
                    selectedEmpIds = $scope.empInputDet.selectedEmpIds;
                    selectedSingleEmpId = $scope.empInputDet.selectedEmpIds[0];
                }
            } else {
                /* $.each($("input[name='empChk']:checked"), function () {
                    selectedEmpIds.push(parseInt($(this)
                        .val()));
                    selectedSingleEmpId = parseInt($(this)
                        .val());
                }); */
                selectedEmpIds = $scope.empInputDet.selectedEmpIds;
                selectedSingleEmpId = $scope.empInputDet.selectedEmpIds[0];
            }
            $scope.data = {
                "sugg_id": parseInt($scope.selectedSuggId),
                "empIds": selectedEmpIds,
                "assigned_by": parseInt($scope.loggedInEmpId),
                "tmtypeId": $scope.selectedTeamTypeForAssign,
                "isHorizDeployReq": $scope.suggestionDet.isHorizDeployReq, //11-11
            };
            if ($scope.suggestionDet.pcrNumber && $scope.suggFlowConfig.isPCRNoEnbld == "Y") {
                $scope.data.pcrNo = $scope.suggestionDet.pcrNumber;
                // 26-01.2024 by Jayshri Kolase (Request body updated to capture PCR no.)
            }
            delete $scope.data.isHorizDeployReq;
            if ($scope.suggestionDet.status_master.status ==
                $scope.CONST.STATUS.EvaluationRequestAccepted.status || $scope.suggestionDet.status_master.status ==
                $scope.CONST.STATUS.ReassignedToEvaluationTeam.status) {
                if ($scope.productOrgConfigList.isPriorityMadatory == true && $scope.suggestionDet.suggPriority != null && $scope.suggestionDet.suggPriority != '') {
                    if ($scope.suggFlowConfig.isImplPriority == "Y" && $scope.suggestionDet.suggPriority.id) {
                        $scope.data.suggPriority = $scope.suggestionDet.suggPriority.id;
                    }
                    else if ($scope.suggFlowConfig.isImplPriority == "Y") {
                        $scope.data.suggPriority = $scope.suggestionDet.suggPriority;
                    }

                }
                else if ($scope.suggFlowConfig.isImplPriority == "Y" && $scope.suggestionDet.suggPriority != null && $scope.suggestionDet.suggPriority != '') {
                    if ($scope.suggestionDet.suggPriority.id) {
                        $scope.data.suggPriority = $scope.suggestionDet.suggPriority.id;
                    }
                    else {
                        $scope.data.suggPriority = $scope.suggestionDet.suggPriority;
                    }
                }
            }
            if (selectedEmpIds.length == 0 && $scope.selectedTeamTypeForAssign != 'reassignToFC') {
                $scope.flagSelectTeamMem = true;
                $scope.flagTeamDetPopupSpinner = false;
                $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                angular.element("#errId_team")
                    .text($filter('translate')('Please_select_team_member'));
                return;
            }
            if ($scope.selectedTeamTypeForAssign == $scope.CONST.TEAM_TYPE.EVALUATION) {
                $scope.data.stsId = $scope.CONST.STATUS.EvaluationAssigned.statusId;
                if ($scope.suggestionDet.evalSummary != null && $scope.suggestionDet.evalSummary != undefined || $scope.suggestionDet.summary != '') {
                    $scope.data.summary = $scope.suggestionDet.evalSummary;
                }
                if ($scope.cfmValue != null && $scope.cfmValue != undefined && $scope.cfmValue != '' && $scope.cfmValue == 'Y') {
                    $scope.data.isCFMRequired = $scope.cfmValue;
                }
                else {
                    $scope.data.isCFMRequired = 'N'
                }
            } else if ($scope.selectedTeamTypeForAssign == $scope.CONST.TEAM_TYPE.IMPLEMENTATION) {
                $scope.data.stsId = $scope.CONST.STATUS.ImplementationAssigned.statusId;
                if ($scope.suggestionDet.isSelfImplemented == 1 && $scope.selectedAudit.status_master.statusId == $scope.CONST.STATUS.ApprovedByFC.statusId) {
                    var tempTrackId = 0;
                    for (var i = 0; i < $scope.suggestionDet.evaluationTeamList.length; i++) {
                        if ($scope.suggestionDet.evaluationTeamList[i].empId == $scope.loggedInEmpId) {
                            tempTrackId = $scope.suggestionDet.evaluationTeamList[i].sugTrackId;
                        }
                    }
                    $scope.data.sugTrackId = tempTrackId;
                    // 12-8-2020
                    if ($scope.evaluationDet != null && $scope.evaluationDet != undefined) {
                        $scope.data.estimatedCost = $scope.evaluationDet.estimatedCost;
                    }
                } else {
                    //Check Selected Suggestion Document
                    var suggDocList = [];
                    for (var i = 0; i < $scope.documentLists.length; i++) {
                        if ($scope.documentLists[i].isChecked) {
                            var objt = {
                                suggestion: {
                                    sugId: $scope.selectedSuggId
                                },
                                branch: {
                                    branchId: $scope.suggestionDet.branch.branchId, //$scope.loggedInUserBranchId
                                },
                                document: {
                                    id: parseInt($scope.documentLists[i].id)
                                },
                                isDeactive: 0
                            };
                            suggDocList.push(objt)
                        }
                    }
                    for (var i = 0; i < $scope.documentLists.length; i++) {
                        if (!$scope.documentLists[i].isChecked) {
                            if ($scope.suggestionDet.document != null && $scope.suggestionDet.document.length > 0) {
                                for (let j = 0; j < $scope.suggestionDet.document.length; j++) {
                                    if ($scope.suggestionDet.document[j].document.id == $scope.documentLists[i].id) {
                                        var objt = {
                                            suggestion: {
                                                sugId: $scope.selectedSuggId
                                            },
                                            branch: {
                                                branchId: $scope.suggestionDet.branch.branchId, //$scope.loggedInUserBranchId
                                            },
                                            document: {
                                                id: parseInt($scope.documentLists[i].id)
                                            },
                                            isDeactive: 1,
                                            id: $scope.suggestionDet.document[j].id
                                        };
                                        suggDocList.push(objt)
                                    }
                                }
                            }

                        }
                    }
                    $scope.data.document = suggDocList;
                    //Check Selected Suggestion Activity
                    var selectedActivity = [];
                    for (var i = 0; i < $scope.activityList.length; i++) {
                        if ($scope.activityList[i].isselect) {
                            var tmp = {
                                id: 0,
                                suggestion: {
                                    sugId: $scope.selectedSuggId
                                },
                                activity: $scope.activityList[i]
                            };
                            selectedActivity.push(tmp);
                        }
                    }
                    $scope.data.suggActivity = selectedActivity;
                    //Check Selected Suggestion Particulars
                    var suggPart = [];
                    if ($scope.particulars != null && $scope.particulars.length > 0) {
                        for (var i = 0; i < $scope.particulars.length; i++) {
                            var selectedParticular = $filter('filter')($scope.particulars, { isChecked: true });
                            if (selectedParticular.length > 1) {
                                $scope.flagSelectTeamMem = true;
                                $scope.flagTeamDetPopupSpinner = false;
                                $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                                snackbar.create($filter('translate')('Please_select_only_one_benefit'), 5000, 'error')
                                return;
                            }
                            if ($scope.particulars[i].isChecked && $scope.particulars[i].tangible) {
                                if (!$scope.particulars[i].hasOwnProperty('newUnit') && !$scope.particulars[i].hasOwnProperty('newValue')) {
                                    $scope.flagSelectTeamMem = true;
                                    $scope.flagTeamDetPopupSpinner = false;
                                    $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                                    snackbar.create($filter('translate')('Please_enter_value_and_unit_for_tangible_benefit'), 5000, 'error')
                                    return;
                                }

                                if ($scope.particulars[i].hasOwnProperty('newUnit') && $scope.particulars[i].hasOwnProperty('newValue')) {
                                    if ($scope.particulars[i].newUnit == undefined || $scope.particulars[i].newUnit == '' || $scope.isEmpty($scope.particulars[i].newUnit) || $scope.particulars[i].newValue == undefined || $scope.particulars[i].newValue == '') {
                                        $scope.flagSelectTeamMem = true;
                                        $scope.flagTeamDetPopupSpinner = false;
                                        $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                                        snackbar.create($filter('translate')('Please_enter_value_and_unit_for_tangible_benefit'), 5000, 'error')
                                        return;
                                    }
                                }
                            }
                            var data = $scope.particulars[i];
                            var objt = {};
                            if ($scope.particulars[i].selectedId == 0 && $scope.particulars[i].isChecked) {
                                objt = {
                                    "id": 0,
                                    "particular": {
                                        "id": data.id
                                    },
                                    "suggestion": {
                                        "sugId": $scope.selectedSuggId
                                    },
                                    "createdById": $scope.loggedInEmpId,
                                    "isActive": "Y",
                                    "tangible": data.tangible,
                                    "recommendedBy": $scope.loggedInEmpId,
                                    "action": "ADD",
                                    "roleId": 8,
                                    "catId": parseInt($scope.suggestionDet.selectedEvalCatId)
                                }
                                if (data.tangible) {
                                    // 8-12-2020
                                    objt.unit = data.newUnit.unit;
                                    objt.masterUnit = {
                                        id: data.newUnit.id
                                    };
                                    objt.value = data.newValue;
                                    objt.frequency = (data.evalFrequency) ? data.evalFrequency.value : data.frequency;
                                    if (data.evalExistingValue && data.evalExistingValue > 0) {
                                        objt.existingValue = data.evalExistingValue;
                                    }
                                }
                                if ($scope.suggestionDet.emp_details != null && $scope.suggestionDet.emp_details != undefined) {
                                    objt.sugCreatedByEmpId = $scope.suggestionDet.emp_details.empId;
                                }

                                if ($scope.suggestionDet.customEvaluationParticularsList != null && $scope.suggestionDet.customEvaluationParticularsList.length > 0) {
                                    for (var m = 0; m < $scope.suggestionDet.customEvaluationParticularsList.length; m++) {
                                        var tmpObj = { id: $scope.suggestionDet.customEvaluationParticularsList[m].id, "action": "DELETE" };
                                        suggPart.push(tmpObj);
                                    }
                                }
                                suggPart.push(objt);
                            } else if ($scope.particulars[i].selectedId > 0) {
                                if ($scope.particulars[i].isChecked) {
                                    if (data.tangible) {
                                        if ($scope.particulars[i].hasOwnProperty('newUnit') && $scope.particulars[i].hasOwnProperty('newValue')) {
                                            $scope.particulars[i].unit = $scope.particulars[i].newUnit;
                                            $scope.particulars[i].value = $scope.particulars[i].newValue;
                                            $scope.particulars[i].frequency = ($scope.particulars[i].evalFrequency) ? $scope.particulars[i].evalFrequency.value : $scope.particulars[i].frequency;
                                            $scope.particulars[i].existingValue = $scope.particulars[i].evalExistingValue;
                                            if ($scope.checkBenefitsValue($scope.particulars[i])) {
                                                objt = {
                                                    "id": data.selectedId,
                                                    "particular": {
                                                        "id": data.id
                                                    },
                                                    "suggestion": {
                                                        "sugId": $scope.selectedSuggId
                                                    },
                                                    "createdById": $scope.loggedInEmpId,
                                                    "isActive": "Y",
                                                    "tangible": data.tangible,
                                                    "recommendedBy": $scope.loggedInEmpId,
                                                    "action": "UPDATE",
                                                    "roleId": 8
                                                }
                                                if (data.tangible) {
                                                    objt.unit = data.unit.unit;
                                                    objt.masterUnit = {
                                                        id: data.unit.id
                                                    };
                                                    objt.value = data.value;
                                                    objt.unit = data.unit.unit;
                                                    objt.frequency = data.frequency;
                                                    if (data.existingValue && data.existingValue > 0) {
                                                        objt.existingValue = data.existingValue;
                                                    }
                                                }
                                                if ($scope.suggestionDet.emp_details != null && $scope.suggestionDet.emp_details != undefined) {
                                                    objt.sugCreatedByEmpId = $scope.suggestionDet.emp_details.empId;
                                                }
                                                suggPart.push(objt);
                                            }
                                        }
                                    } else {
                                        objt = {
                                            "id": data.selectedId,
                                            "particular": {
                                                "id": data.id
                                            },
                                            "suggestion": {
                                                "sugId": $scope.selectedSuggId
                                            },
                                            "createdById": $scope.loggedInEmpId,
                                            "isActive": "Y",
                                            "tangible": data.tangible,
                                            "recommendedBy": $scope.loggedInEmpId,
                                            "action": "UPDATE",
                                            "roleId": 8
                                        }
                                        if ($scope.suggestionDet.emp_details != null && $scope.suggestionDet.emp_details != undefined) {
                                            objt.sugCreatedByEmpId = $scope.suggestionDet.emp_details.empId;
                                        }
                                        suggPart.push(objt);
                                    }
                                } else {
                                    // 22-12-2020
                                    // objt = {
                                    //     "id": data.selectedId,
                                    //     "particular": {
                                    //         "id": data.id
                                    //     },
                                    //     "suggestion": {
                                    //         "sugId": $scope.selectedSuggId
                                    //     },
                                    //     "createdById": $scope.loggedInEmpId,
                                    //     "recommendedBy": $scope.loggedInEmpId,
                                    //     "action": "DELETE",
                                    //     "roleId": 8
                                    // }
                                    // if ($scope.suggestionDet.emp_details != null && $scope.suggestionDet.emp_details != undefined) {
                                    //     objt.sugCreatedByEmpId = $scope.suggestionDet.emp_details.empId;
                                    // }
                                    // suggPart.push(objt);
                                }
                            }
                        }
                    }

                    $scope.data.suggParticulars = suggPart;
                    //Added Saving Type
                    var suggSaving = [];
                    if ($scope.SavingTypeLists != null && $scope.SavingTypeLists.length > 0) {
                        for (var i = 0; i < $scope.SavingTypeLists.length; i++) {
                            var objt = {
                                "id": 0,
                                "setPointsForSaving": {
                                    "id": parseInt($scope.SavingTypeLists[i].amt.id)
                                },
                                "suggestion": {
                                    "sugId": $scope.selectedSuggId
                                },
                                "sugCreatedByEmpId": $scope.suggestionDet.emp_details.empId,
                                "points": $scope.SavingTypeLists[i].points,
                                "createdById": $scope.loggedInEmpId
                            };
                            suggSaving.push(objt);
                        }
                    }
                    if (suggSaving != null && suggSaving.length > 0) {
                        $scope.data.evalPoints = suggSaving;
                    }
                    //Add Horizonatal Deployment
                    /*------------START FOR PILLER LEVEL HORIZONATL DEPLOYEMENT---------------------------CHANGE BY SUNANDA --------------24-2-2020*/
                    // START FOR MODIFIED HORIZANATL DEPLOYEMENT MODIFIED FOR EVALUTION  BY SUNANDA 9-11
                    /*-----START FOR  HD CONFIG AT DEPT LEVEL------ */
                    if ($scope.suggestionDet.dept != null && $scope.suggestionDet.sourceType != 'HD') {
                        var deptList = [];
                        if ($scope.departmentList != null && $scope.departmentList.length > 0) {
                            for (var i = 0; i < $scope.departmentList.length; i++) {
                                var dept = $scope.departmentList[i]; //&& $scope.suggestionDet.dept.deptId != $scope.departmentList[i].deptId removed for hd
                                if ($scope.departmentList[i].isEvalselect) {
                                    if ($scope.departmentList[i].lineFound) {
                                        for (var j = 0; j < $scope.departmentList[i].lineList.length; j++) {
                                            var line = $scope.departmentList[i].lineList[j];
                                            if ($scope.departmentList[i].lineList[j].isEvalselect) {
                                                if (dept.deptName == 'All' && line.name == 'All') { } else {
                                                    deptList.push({
                                                        "deptId": dept.deptId,
                                                        "suggestionDet": {
                                                            "sugId": $scope.selectedSuggId
                                                        },
                                                        "lineId": line.id
                                                    })
                                                }
                                            }
                                        }
                                    } else {
                                        deptList.push({
                                            "deptId": dept.deptId,
                                            "suggestionDet": {
                                                "sugId": $scope.selectedSuggId
                                            },
                                        })
                                    }

                                }
                            }

                            if (deptList != null && deptList.length > 0) {
                                $scope.data.suggestionHorizontalDept = deptList;
                            }
                        }
                        //END OF MODIFIED HORIZANATL DEPLOYEMENT BY SUNANDA 9-11
                    }
                    /*-----END OF  HD CONFIG AT DEPT LEVEL-------- */
                    /*-----START FOR  HD CONFIG AT PILLAR LEVEL------ */
                    if ($scope.suggestionDet.circle != null && $scope.suggestionDet.sourceType != 'HD') {
                        $scope.pillarList = [];
                        if ($scope.machineHDList != null && $scope.machineHDList.length > 0) {
                            for (var i = 0; i < $scope.machineHDList.length; i++) {
                                var obj;
                                obj = {
                                    "circleId": $scope.machineHDList[i].circle.id,
                                    "stageId": $scope.machineHDList[i].stage.id,
                                    "productId": $scope.machineHDList[i].product.id,
                                    "machineId": 0,
                                    "operationId": $scope.machineHDList[i].operation.id,
                                    "productNoId": $scope.machineHDList[i].productNo.id,
                                    "suggestionDet": {
                                        "sugId": $scope.selectedSuggId
                                    }
                                }
                                if ($scope.machineHDList[i].machine != null && $scope.machineHDList[i].machine != undefined) {
                                    obj.machineId = $scope.machineHDList[i].machine.id;
                                }
                                $scope.pillarList.push(obj);
                            }
                        }
                        if ($scope.pillarList != null && $scope.pillarList.length > 0) {
                            $scope.data.suggestionHorizontalDept = $scope.pillarList;
                            //console.log($scope.data.suggestionHorizontalDept);
                        }
                        //console.log($scope.pillarList);

                    }
                    if ($scope.parentSuggType != null && $scope.parentSuggType != undefined) {
                        if ($scope.parentSuggType.deptId != 0 && $scope.suggestionDet.sourceType == 'HD') {
                            var deptList = [];
                            if ($scope.departmentList != null && $scope.departmentList.length > 0) {
                                for (var i = 0; i < $scope.departmentList.length; i++) {
                                    var dept = $scope.departmentList[i]; //&& $scope.suggestionDet.dept.deptId != $scope.departmentList[i].deptId removed for hd
                                    if ($scope.departmentList[i].isEvalselect) {
                                        if ($scope.departmentList[i].lineFound) {
                                            for (var j = 0; j < $scope.departmentList[i].lineList.length; j++) {
                                                var line = $scope.departmentList[i].lineList[j];
                                                if ($scope.departmentList[i].lineList[j].isEvalselect) {
                                                    if (dept.deptName == 'All' || line.name == 'All') { } else {
                                                        deptList.push({
                                                            "deptId": dept.deptId,
                                                            "suggestionDet": {
                                                                "sugId": $scope.selectedSuggId
                                                            },
                                                            "lineId": line.id
                                                        })
                                                    }
                                                }
                                            }
                                        } else {
                                            deptList.push({
                                                "deptId": dept.deptId,
                                                "suggestionDet": {
                                                    "sugId": $scope.selectedSuggId
                                                },
                                            })
                                        }

                                    }
                                }

                                if (deptList != null && deptList.length > 0) {
                                    $scope.data.suggestionHorizontalDept = deptList;
                                }
                            }
                            //END OF MODIFIED HORIZANATL DEPLOYEMENT BY SUNANDA 9-11
                        }
                        /*-----END OF  HD CONFIG AT DEPT LEVEL-------- */
                        /*-----START FOR  HD CONFIG AT PILLAR LEVEL------ */
                        if ($scope.parentSuggType.circleId != 0 && $scope.suggestionDet.sourceType == 'HD') {
                            $scope.pillarList = [];
                            if ($scope.machineHDList != null && $scope.machineHDList.length > 0) {
                                for (var i = 0; i < $scope.machineHDList.length; i++) {
                                    var obj;
                                    obj = {
                                        "circleId": $scope.machineHDList[i].circle.id,
                                        "stageId": $scope.machineHDList[i].stage.id,
                                        "productId": $scope.machineHDList[i].product.id,
                                        "machineId": 0,
                                        "operationId": $scope.machineHDList[i].operation.id,
                                        "productNoId": $scope.machineHDList[i].productNo.id,
                                        "suggestionDet": {
                                            "sugId": $scope.selectedSuggId
                                        }
                                    }
                                    if ($scope.machineHDList[i].machine != null && $scope.machineHDList[i].machine != undefined) {
                                        obj.machineId = $scope.machineHDList[i].machine.id;
                                    }
                                    $scope.pillarList.push(obj);
                                }
                            }
                            if ($scope.pillarList != null && $scope.pillarList.length > 0) {
                                $scope.data.suggestionHorizontalDept = $scope.pillarList;
                                //console.log($scope.data.suggestionHorizontalDept);
                            }
                            //console.log($scope.pillarList);
                        }
                    }
                    /*-----START FOR  HD CONFIG AT PLANT LEVEL------ */
                    if ($scope.hdConfigData.hdOptions == 'OPT_FOR_OTH_PLANTS') {
                        if ($scope.data.suggestionHorizontalDept == null || $scope.data.suggestionHorizontalDept == undefined) {
                            $scope.data.suggestionHorizontalDept = [];
                        }
                        $scope.data.branchIds = []
                        if ($scope.hDBranchList != null && $scope.hDBranchList.length > 0) {
                            for (let i = 0; i < $scope.hDBranchList.length; i++) {
                                if ($scope.hDBranchList[i].isEvalPlantselect) {
                                    $scope.data.suggestionHorizontalDept.push({
                                        "branchId": $scope.hDBranchList[i].branchId,
                                        "suggestionDet": {
                                            "sugId": $scope.selectedSuggId
                                        },
                                    });
                                }
                            }

                        }
                    }
                    //console.log($scope.data);
                    /*-----END OF  HD CONFIG AT PILLAR LEVEL-------- */

                    /*-----------END OF PILLER LEVEL HORIZONATL DEPLOYEMENT---------------------------CHANGE BY SUNANDA --------------24-2-2020*/
                    if ($scope.suggestionDet.isHDRequire == true && ($scope.data.suggestionHorizontalDept == null || $scope.data.suggestionHorizontalDept.length == 0)) {
                        $scope.data.isHorizDeployReq = 'NA';
                    } else {
                        $scope.data.isHorizDeployReq = 'Y';
                        // if ($scope.data.suggestionHorizontalDept != null && $scope.data.suggestionHorizontalDept.length > 0) {
                        //     $scope.data.isHorizDeployReq = 'Y';
                        // } else {

                        // }
                    }

                    if ($scope.suggestionDet.tmpIsDocumentChangeRequire == true && ($scope.data.document == null || $scope.data.document.length == 0)) {
                        $scope.data.isDocumentChangeRequire = 'NA';
                    } else {
                        $scope.data.isDocumentChangeRequire = 'Y';
                        // if ($scope.data.document != null && $scope.data.document.length > 0) {
                        //     $scope.data.isDocumentChangeRequire = 'Y';
                        // } else {

                        // }
                    }
                    // START FOR MODIFIED HORIZANATL DEPLOYEMENT MODIFIED FOR EVALUTION BY SUNANDA 9-11
                    if ($scope.suggestionDet.dept != null) {
                        if ($scope.suggFlowConfig.isHorizDplymntsEnbld == 'Y' && $scope.suggFlowConfig.isEvalEnbld == 'Y' && $scope.isHorizDeployReq == 'Y') {
                            for (var i = 0; i < $scope.departmentList.length; i++) {
                                if ($scope.departmentList[i].isEvalselect && $scope.departmentList[i].lineFound) {
                                    for (var j = 0; j < $scope.departmentList[i].lineList.length; j++) {

                                        if ($filter('filter')($scope.departmentList[i].lineList, { isEvalselect: true }).length == 0) {
                                            $scope.flagSelectTeamMem = true;
                                            $scope.flagTeamDetPopupSpinner = false;
                                            $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                                            snackbar.create($filter('translate')('Please_select_line_horizontal_deployment'), 6000, "error");
                                            return;
                                        }
                                    }
                                }
                            }
                        }
                    }
                    // END FOR MODIFIED HORIZANATL DEPLOYEMENT MODIFIED FOR EVALUTION BY SUNANDA 9-11
                    //Check Mandatory field
                    var requeireField = $rootScope.empDetails.productOrgConfigDet;
                    if ($scope.suggFlowConfig.isKaizenActEnbld == 'Y' && $scope.suggFlowConfig.isEvalEnbld == 'Y' && requeireField.isActivityOn == 1) {
                        if ($scope.data.suggActivity == null || $scope.data.suggActivity.length == 0) {
                            snackbar.create($filter('translate')('Kaizen_activities_are_mandatory'), 6000, "error");
                            $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                            $scope.flagSelectTeamMem = true;
                            $scope.flagTeamDetPopupSpinner = false;
                            return;
                        }
                    }

                    var tmpSelectParticular = $filter('filter')($scope.particulars, { isChecked: true });
                    if ($scope.suggFlowConfig.isEvalEnbld == 'Y' && $scope.suggFlowConfig.isParticularsEnbld == 'Y' && requeireField.isPraticularsMandatory == 1) {
                        if ((tmpSelectParticular == null || tmpSelectParticular.length == 0) && ($scope.data.suggParticulars == null || $scope.data.suggParticulars.length == 0)) {
                            snackbar.create($filter('translate')('Other_benefits_are_mandatory'), 6000, "error");
                            $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                            $scope.flagSelectTeamMem = true;
                            $scope.flagTeamDetPopupSpinner = false;
                            return;
                        }
                    }
                    if ($scope.isEmpty($scope.suggestionDet.hdCatId) || $scope.suggestionDet.hdCatId == undefined || $scope.suggestionDet.hdCatId == null || $scope.suggestionDet.hdCatId == '') {
                        $scope.flagSelectTeamMem = true;
                        $scope.flagTeamDetPopupSpinner = false;
                        $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                        snackbar.create($filter('translate')('Please_select_category'), 6000, "error");
                        return;
                    }
                    // if ($scope.suggestionDet.sourceType == 'HD') {
                    if (!$scope.isEmpty($scope.suggestionDet.hdCatId) && $scope.suggestionDet.hdCatId != undefined && $scope.suggestionDet.hdCatId != null && $scope.suggestionDet.hdCatId != '') {
                        $scope.data.catId = parseInt($scope.suggestionDet.hdCatId.catId);
                    }
                    //}
                    // 11-8-2020 imp Mandatory
                    if ($scope.suggFlowConfig.isEvalSapCodeEnbld == 'Y') {
                        if (($rootScope.empDetails.productOrgConfigDet.isSapCodeMandatory == 1)) {
                            for (let index = 0; index < $scope.catbranchwise.length; index++) {
                                if ($scope.catbranchwise[index].catId == $scope.suggestionDet.hdCatId.catId) {
                                    if ($scope.catbranchwise[index].isSapCodeRequired == 'Y') {
                                        if ($scope.suggestionDet.sapCode == '' || $scope.suggestionDet.sapCode == undefined || $scope.suggestionDet.sapCode == null) {
                                            snackbar.create($filter('translate')('Plese_enter_SAPCode'), 6000, "error");
                                            $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                                            $scope.flagSelectTeamMem = true;
                                            $scope.flagTeamDetPopupSpinner = false;
                                            return;
                                        }
                                    }
                                }
                            }
                        }
                        if ($scope.suggestionDet.sapCode != '' && $scope.suggestionDet.sapCode != undefined && $scope.suggestionDet.sapCode != null) {
                            $scope.data.sapCode = $scope.suggestionDet.sapCode;
                        }
                    }
                    $scope.data.estimatedCost = $scope.evaluationDet.estimatedCost;
                    $scope.data.summary = $scope.evaluationDet.evaluationInputs;
                    $scope.data.sugTrackId = $scope.evaluationDet.sugTrackId;

                    /*--- START FOR CIRCLE CHANGE--------BY SUNANDA-------3-1-2020 --*/

                    if ($scope.suggestionDet.whyWhyAnalysis != null && $scope.suggestionDet.whyWhyAnalysis != undefined && $scope.suggestionDet.whyWhyAnalysis != '') {
                        $scope.data.whyWhyAnalysis = $scope.suggestionDet.whyWhyAnalysis;
                    }
                    if ($scope.suggestionDet.whatToDo != null && $scope.suggestionDet.whatToDo != undefined && $scope.suggestionDet.whatToDo != '') {
                        $scope.data.whatToDo = $scope.suggestionDet.whatToDo;
                    }
                    if ($scope.suggestionDet.howToDo != null && $scope.suggestionDet.howToDo != undefined && $scope.suggestionDet.howToDo != '') {
                        $scope.data.howToDo = $scope.suggestionDet.howToDo;
                    }
                    if ($scope.suggestionDet.benefits != null && $scope.suggestionDet.benefits != undefined && $scope.suggestionDet.benefits != '') {
                        $scope.data.benefits = $scope.suggestionDet.benefits;
                    }
                    if ($scope.suggestionDet.results != null && $scope.suggestionDet.results != undefined && $scope.suggestionDet.results != '') {
                        $scope.data.results = $scope.suggestionDet.results;
                    }
                    if ($scope.suggestionDet.kaizenIdea != null && $scope.suggestionDet.kaizenIdea != undefined && $scope.suggestionDet.kaizenIdea != '') {
                        $scope.data.kaizenIdea = $scope.suggestionDet.kaizenIdea;
                    }
                    if ($scope.suggestionDet.frquency != null && $scope.suggestionDet.frquency != undefined && $scope.suggestionDet.frquency != '') {
                        $scope.data.frquency = $scope.suggestionDet.frquency;
                    }
                    if ($scope.suggestionDet.counterMeasures != null && $scope.suggestionDet.counterMeasures != undefined && $scope.suggestionDet.counterMeasures != '') {
                        $scope.data.counterMeasures = $scope.suggestionDet.counterMeasures;
                    }
                    if ($scope.suggestionDet.rootCause != null && $scope.suggestionDet.rootCause != undefined && $scope.suggestionDet.rootCause != '') {
                        $scope.data.rootCause = $scope.suggestionDet.rootCause;
                    }

                    /*--- END OF CIRCLE CHANGE--------BY SUNANDA-------3-1-2020 -----*/

                    //Sustenance Check
                    if ($scope.suggFlowConfig.isParticularsEnbld == 'Y') {
                        if ($scope.suggFlowConfig.kaizenCheckReqEval == 'Y' && $scope.suggestionDet.evalSustenanceflow != undefined && $scope.suggestionDet.evalSustenanceflow != null && $scope.suggestionDet.evalSustenanceflow) {
                            if ($scope.suggestionDet.sustenanceAuditorList == null || $scope.suggestionDet.sustenanceAuditorList.length == 0) {
                                snackbar.create($filter('translate')('Auditor_setup_not_found_for_this_category_Please_add_Auditor'), 6000, "error");
                                $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                                $scope.flagSelectTeamMem = true;
                                $scope.flagTeamDetPopupSpinner = false;
                                return;
                            } else if ($scope.suggestionDet.sustenanceAuditorId == undefined || $scope.suggestionDet.sustenanceAuditorId == null || $scope.suggestionDet.sustenanceAuditorId == '') {
                                snackbar.create($filter('translate')('Please_select_sustenance_auditor'), 6000, "error");
                                $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                                $scope.flagSelectTeamMem = true;
                                $scope.flagTeamDetPopupSpinner = false;
                                return;
                            } else {
                                // 7-12-2020 
                                $scope.data.kaizenSusReqByEval = $scope.suggestionDet.evalSustenanceflow;
                                $scope.data.sustenanceAuditorId = $scope.suggestionDet.sustenanceAuditorId;
                            }
                        }
                    }
                    // Idea/Implementation Award
                    if ($scope.suggFlowConfig.evalIdeaAward == 'Y' || $scope.suggFlowConfig.evalImpleAward == 'Y') {
                        if ($scope.suggestionDet.sugesstionStatusAudit != null && $scope.suggestionDet.sugesstionStatusAudit.length > 0) {
                            var stsadtId = 0;
                            for (var stsAdt = 0; stsAdt < $scope.suggestionDet.sugesstionStatusAudit.length; stsAdt++) {
                                if ($scope.suggestionDet.sugesstionStatusAudit[stsAdt].status_master.status == $scope.CONST.STATUS.EvaluationRequestAccepted.status) {
                                    stsadtId = $scope.suggestionDet.sugesstionStatusAudit[stsAdt].stsadtId;
                                    break;
                                }
                            }
                            if (stsadtId != 0) {
                                $scope.data.statusAuditId = stsadtId;
                            }
                        }
                    }
                    if ($scope.suggFlowConfig.evalIdeaAward == 'Y') {
                        $scope.data.ideaAwardRecommEval = ($scope.suggestionDet.recommendationData.ideaAwardRecommEval) ? true : false;
                        if ($scope.suggestionDet.recommendationData.ideaAwardRecommEval) {
                            if ($scope.suggestionDet.recommendationData.ideaAwardCommentEval == null || $scope.suggestionDet.recommendationData.ideaAwardCommentEval == undefined || $scope.suggestionDet.recommendationData.ideaAwardCommentEval.trim().length == 0) {
                                // snackbar.create($filter('translate')('Please_enter_comments'), 3000, "error");
                                // $scope.flagSelectTeamMem = true;
                                // $scope.flagTeamDetPopupSpinner = false;
                                // return;
                            } else {
                                $scope.data.ideaAwardCommentEval = $scope.suggestionDet.recommendationData.ideaAwardCommentEval;
                            }
                        }
                    }
                    if ($scope.suggFlowConfig.evalImpleAward == 'Y') {
                        $scope.data.implAwardRecommEval = ($scope.suggestionDet.recommendationData.implAwardRecommEval) ? true : false;
                        if ($scope.suggestionDet.recommendationData.implAwardRecommEval) {
                            if ($scope.suggestionDet.recommendationData.implAwardCommentEval == null || $scope.suggestionDet.recommendationData.implAwardCommentEval == undefined || $scope.suggestionDet.recommendationData.implAwardCommentEval.trim().length == 0) {
                                // snackbar.create($filter('translate')('Please_enter_comments'), 3000, "error");
                                // $scope.flagSelectTeamMem = true;
                                // $scope.flagTeamDetPopupSpinner = false;
                                // return;
                            } else {
                                $scope.data.implAwardCommentEval = $scope.suggestionDet.recommendationData.implAwardCommentEval;
                            }
                        }
                    }
                }
                //$scope.data.tmtypeId = $scope.selectedTeamTypeForAssign;
            } else if ($scope.selectedTeamTypeForAssign == $scope.CONST.TEAM_TYPE.APPROVEDBYFC) {
                $scope.data.stsId = $scope.CONST.STATUS.ImplementationAssigned.statusId;
                $scope.data.tmtypeId = 2;
            } else if ($scope.selectedTeamTypeForAssign == $scope.CONST.TEAM_TYPE.EVALFC) {
                if ($scope.evaluationDet.evaluationInputs == null || $scope.evaluationDet.evaluationInputs == "") {
                    // snackbar.create("Evaluation details are mandatory.", 6000, "error");
                    snackbar.create($filter('translate')('Evaluation_details_are_mandatory'), 6000, "error");
                    $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                    $scope.flagSelectTeamMem = true;
                    $scope.flagTeamDetPopupSpinner = false;
                    return;
                }
                if ($scope.evaluationDet.estimatedCost == null || $scope.evaluationDet.estimatedCost == "" || $scope.evaluationDet.estimatedCost == 0) {
                    // snackbar.create("Budgetary Cost is mandatory.", 6000, "error");
                    snackbar.create($filter('translate')('Budgetary_Cost_is_mandatory'), 6000, "error");
                    $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                    $scope.flagSelectTeamMem = true;
                    $scope.flagTeamDetPopupSpinner = false;
                    return;
                }
                if (($scope.suggestionDet.status_master.status ==
                    $scope.CONST.STATUS.EvaluationRequestAccepted.status || $scope.suggestionDet.status_master.status ==
                    $scope.CONST.STATUS.ReassignedToEvaluationTeam.status) && $scope.productOrgConfigList.isPriorityMadatory == true && $scope.suggestionDet.suggPriority == null && $scope.suggFlowConfig.isImplPriority == "Y") {
                    snackbar.create($filter('translate')('Implementation_Priority_is_mandatory'), 6000, "error");
                    $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                    return;
                }
                $scope.data = {
                    "sugId": parseInt($scope.selectedSuggId),
                    "statusId": $scope.CONST.STATUS.AssignedForFCApproval.statusId,
                    "assignedById": selectedSingleEmpId,
                    "summary": $scope.evaluationDet.evaluationInputs,
                    "amount": $scope.evaluationDet.estimatedCost,
                    "branchId": $scope.suggestionDet.branch.branchId, //$scope.loggedInUserBranchId,
                    "orgId": $scope.loggedInUserOrgId,
                    "sugTrackId": $scope.evaluationDet.sugTrackId,
                    "teamTypeId": 1
                };
                if ($scope.suggestionDet.status_master.status ==
                    $scope.CONST.STATUS.EvaluationRequestAccepted.status || $scope.suggestionDet.status_master.status ==
                    $scope.CONST.STATUS.ReassignedToEvaluationTeam.status) {
                    if ($scope.productOrgConfigList.isPriorityMadatory == true && $scope.suggestionDet.suggPriority != null && $scope.suggestionDet.suggPriority != '') {
                        if ($scope.suggFlowConfig.isImplPriority == "Y" && $scope.suggestionDet.suggPriority.id) {
                            $scope.data.suggPriority = $scope.suggestionDet.suggPriority.id;
                        }
                        else if ($scope.suggFlowConfig.isImplPriority == "Y") {
                            $scope.data.suggPriority = $scope.suggestionDet.suggPriority;
                        }

                    }
                    else if ($scope.suggFlowConfig.isImplPriority == "Y" && $scope.suggestionDet.suggPriority != null && $scope.suggestionDet.suggPriority != '') {
                        if ($scope.suggestionDet.suggPriority.id) {
                            $scope.data.suggPriority = $scope.suggestionDet.suggPriority.id;
                        }
                        else {
                            $scope.data.suggPriority = $scope.suggestionDet.suggPriority;
                        }
                    }
                }

                //Check Selected Suggestion Document
                var suggDocList = [];
                for (var i = 0; i < $scope.documentLists.length; i++) {
                    if ($scope.documentLists[i].isChecked) {
                        var objt = {
                            suggestion: {
                                sugId: $scope.selectedSuggId
                            },
                            branch: {
                                branchId: $scope.suggestionDet.branch.branchId, //$scope.loggedInUserBranchId
                            },
                            document: {
                                id: parseInt($scope.documentLists[i].id)
                            },
                            isDeactive: 0
                        };
                        suggDocList.push(objt)
                    }
                }
                for (var i = 0; i < $scope.documentLists.length; i++) {
                    if (!$scope.documentLists[i].isChecked) {
                        if ($scope.suggestionDet.document != null && $scope.suggestionDet.document.length > 0) {
                            for (let j = 0; j < $scope.suggestionDet.document.length; j++) {
                                if ($scope.suggestionDet.document[j].document.id == $scope.documentLists[i].id) {
                                    var objt = {
                                        suggestion: {
                                            sugId: $scope.selectedSuggId
                                        },
                                        branch: {
                                            branchId: $scope.suggestionDet.branch.branchId, //$scope.loggedInUserBranchId
                                        },
                                        document: {
                                            id: parseInt($scope.documentLists[i].id)
                                        },
                                        isDeactive: 1,
                                        id: $scope.suggestionDet.document[j].id
                                    };
                                    suggDocList.push(objt)
                                }
                            }
                        }

                    }
                }
                $scope.data.document = suggDocList;
                //Check Selected Suggestion Activity
                var selectedActivity = [];
                for (var i = 0; i < $scope.activityList.length; i++) {
                    if ($scope.activityList[i].isselect) {
                        var tmp = {
                            id: 0,
                            suggestion: {
                                sugId: $scope.suggestionDet.sugId
                            },
                            activity: $scope.activityList[i]
                        };
                        selectedActivity.push(tmp);
                    }
                }
                $scope.data.suggActivity = selectedActivity;
                //Check Selected Suggestion Particulars
                var suggPart = [];
                if ($scope.particulars != null && $scope.particulars.length > 0) {
                    for (var i = 0; i < $scope.particulars.length; i++) {
                        var selectedParticular = $filter('filter')($scope.particulars, { isChecked: true });
                        if (selectedParticular.length > 1) {
                            $scope.flagSelectTeamMem = true;
                            $scope.flagTeamDetPopupSpinner = false;
                            $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                            snackbar.create($filter('translate')('Please_select_only_one_benefit'), 5000, 'error')
                            return;
                        }
                        if ($scope.particulars[i].isChecked && $scope.particulars[i].tangible) {
                            if (!$scope.particulars[i].hasOwnProperty('newUnit') && !$scope.particulars[i].hasOwnProperty('newValue')) {
                                $scope.flagSelectTeamMem = true;
                                $scope.flagTeamDetPopupSpinner = false;
                                $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                                snackbar.create($filter('translate')('Please_enter_value_and_unit_for_tangible_benefit'), 5000, 'error')
                                return;
                            }
                            if ($scope.particulars[i].hasOwnProperty('newUnit') && $scope.particulars[i].hasOwnProperty('newValue')) {
                                if ($scope.particulars[i].newUnit == undefined || $scope.particulars[i].newUnit == '' || $scope.isEmpty($scope.particulars[i].newUnit) || $scope.particulars[i].newValue == undefined || $scope.particulars[i].newValue == '') {
                                    $scope.flagSelectTeamMem = true;
                                    $scope.flagTeamDetPopupSpinner = false;
                                    $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                                    snackbar.create($filter('translate')('Please_enter_value_and_unit_for_tangible_benefit'), 5000, 'error')
                                    return;
                                }
                            }
                        }
                        var data = $scope.particulars[i];
                        var objt = {};
                        if ($scope.particulars[i].selectedId == 0 && $scope.particulars[i].isChecked) {
                            objt = {
                                "id": 0,
                                "particular": {
                                    "id": data.id
                                },
                                "suggestion": {
                                    "sugId": $scope.selectedSuggId
                                },
                                "createdById": $scope.loggedInEmpId,
                                "isActive": "Y",
                                "tangible": data.tangible,
                                "recommendedBy": $scope.loggedInEmpId,
                                "action": "ADD",
                                "roleId": 8,
                                "catId": parseInt($scope.suggestionDet.selectedEvalCatId),
                            }
                            if (data.tangible) {
                                // 8-12-2020
                                objt.unit = data.newUnit.unit;
                                objt.masterUnit = {
                                    id: data.newUnit.id
                                };
                                if (data.newValue && data.newValue > 0) {
                                    objt.value = data.newValue;
                                }
                                objt.frequency = (data.evalFrequency) ? data.evalFrequency.value : data.frequency;
                                if (data.evalExistingValue && data.evalExistingValue > 0) {
                                    objt.existingValue = data.evalExistingValue;
                                }
                            }
                            if ($scope.suggestionDet.emp_details != null && $scope.suggestionDet.emp_details != undefined) {
                                objt.sugCreatedByEmpId = $scope.suggestionDet.emp_details.empId;
                            }

                            if ($scope.suggestionDet.customEvaluationParticularsList != null && $scope.suggestionDet.customEvaluationParticularsList.length > 0) {
                                for (var m = 0; m < $scope.suggestionDet.customEvaluationParticularsList.length; m++) {
                                    var tmpObj = { id: $scope.suggestionDet.customEvaluationParticularsList[m].id, "action": "DELETE" };
                                    suggPart.push(tmpObj);
                                }
                            }
                            suggPart.push(objt);
                        } else if ($scope.particulars[i].selectedId > 0) {
                            if ($scope.particulars[i].isChecked) {
                                if (data.tangible) {
                                    if ($scope.particulars[i].hasOwnProperty('newUnit') && $scope.particulars[i].hasOwnProperty('newValue')) {
                                        $scope.particulars[i].unit = $scope.particulars[i].newUnit;
                                        $scope.particulars[i].value = $scope.particulars[i].newValue;
                                        $scope.particulars[i].frequency = ($scope.particulars[i].evalFrequency) ? $scope.particulars[i].evalFrequency.value : $scope.particulars[i].frequency;
                                        $scope.particulars[i].existingValue = $scope.particulars[i].evalExistingValue;
                                        if ($scope.checkBenefitsValue($scope.particulars[i])) {
                                            objt = {
                                                "id": data.selectedId,
                                                "particular": {
                                                    "id": data.id
                                                },
                                                "suggestion": {
                                                    "sugId": $scope.selectedSuggId
                                                },
                                                "createdById": $scope.loggedInEmpId,
                                                "isActive": "Y",
                                                "tangible": data.tangible,
                                                "recommendedBy": $scope.loggedInEmpId,
                                                "action": "UPDATE",
                                                "roleId": 8
                                            }
                                            if (data.tangible) {
                                                objt.unit = data.unit.unit;
                                                objt.masterUnit = {
                                                    id: data.unit.id
                                                };
                                                objt.value = data.value;
                                                objt.unit = data.unit.unit;
                                                objt.frequency = data.frequency;
                                                if (data.existingValue && data.existingValue > 0) {
                                                    objt.existingValue = data.existingValue;
                                                }
                                            }
                                        }
                                    }
                                } else {
                                    objt = {
                                        "id": data.selectedId,
                                        "particular": {
                                            "id": data.id
                                        },
                                        "suggestion": {
                                            "sugId": $scope.selectedSuggId
                                        },
                                        "createdById": $scope.loggedInEmpId,
                                        "isActive": "Y",
                                        "tangible": data.tangible,
                                        "recommendedBy": $scope.loggedInEmpId,
                                        "action": "UPDATE",
                                        "roleId": 8
                                    }
                                }
                            } else {
                                // 22-12-2020
                                // objt = {
                                //     "id": data.selectedId,
                                //     "particular": {
                                //         "id": data.id
                                //     },
                                //     "suggestion": {
                                //         "sugId": $scope.selectedSuggId
                                //     },
                                //     "createdById": $scope.loggedInEmpId,
                                //     "recommendedBy": $scope.loggedInEmpId,
                                //     "action": "DELETE",
                                //     "roleId": 8
                                // }
                                // if ($scope.suggestionDet.emp_details != null && $scope.suggestionDet.emp_details != undefined) {
                                //     objt.sugCreatedByEmpId = $scope.suggestionDet.emp_details.empId;
                                // }
                                // suggPart.push(objt);
                            }
                            if ($scope.suggestionDet.emp_details != null && $scope.suggestionDet.emp_details != undefined) {
                                objt.sugCreatedByEmpId = $scope.suggestionDet.emp_details.empId;
                            }
                            suggPart.push(objt)
                        }
                    }
                }
                $scope.data.suggParticulars = suggPart;
                //Added Saving Type
                var suggSaving = [];
                for (var i = 0; i < $scope.SavingTypeLists.length; i++) {
                    var objt = {
                        "id": 0,
                        "setPointsForSaving": {
                            "id": parseInt($scope.SavingTypeLists[i].amt.id)
                        },
                        "suggestion": {
                            "sugId": $scope.selectedSuggId
                        },
                        "sugCreatedByEmpId": $scope.suggestionDet.emp_details.empId,
                        "points": $scope.SavingTypeLists[i].points,
                        "createdById": $scope.loggedInEmpId
                    };
                    suggSaving.push(objt);
                }
                if (suggSaving != null && suggSaving.length > 0) {
                    $scope.data.evalPoints = suggSaving;
                }
                //Add Horizonatal Deployment
                var deptList = [];
                // START FOR MODIFIED HORIZANATL DEPLOYEMENT MODIFIED FOR EVALUTION BY SUNANDA 9-11
                /*-----START FOR  HD CONFIG AT DEPT LEVEL------ */
                if ($scope.suggestionDet.dept != null && $scope.suggestionDet.sourceType != 'HD') {
                    var deptList = [];
                    if ($scope.departmentList != null && $scope.departmentList.length > 0) {
                        for (var i = 0; i < $scope.departmentList.length; i++) {
                            var dept = $scope.departmentList[i]; // && $scope.suggestionDet.dept.deptId != $scope.departmentList[i].deptId
                            if ($scope.departmentList[i].isEvalselect) {
                                if ($scope.departmentList[i].lineFound) {
                                    for (var j = 0; j < $scope.departmentList[i].lineList.length; j++) {
                                        var line = $scope.departmentList[i].lineList[j];
                                        if ($scope.departmentList[i].lineList[j].isEvalselect) {
                                            if (dept.deptName == 'All' || line.name == 'All') { } else {
                                                deptList.push({
                                                    "deptId": dept.deptId,
                                                    "suggestionDet": {
                                                        "sugId": $scope.selectedSuggId
                                                    },
                                                    "lineId": line.id
                                                })
                                            }
                                        }
                                    }
                                } else {
                                    deptList.push({
                                        "deptId": dept.deptId,
                                        "suggestionDet": {
                                            "sugId": $scope.selectedSuggId
                                        },
                                    })
                                }

                            }
                        }

                        if (deptList != null && deptList.length > 0) {
                            $scope.data.suggestionHorizontalDept = deptList;
                            ////console.log($scope.data.suggestionHorizontalDept);
                        }
                    }
                }
                /*-----END OF  HD CONFIG AT DEPT LEVEL-------- */
                /*-----START FOR  HD CONFIG AT PILLAR LEVEL------ */
                if ($scope.suggestionDet.circle != null && $scope.suggestionDet.sourceType != 'HD') {
                    $scope.pillarList = [];
                    if ($scope.machineHDList != null && $scope.machineHDList.length > 0) {
                        for (var i = 0; i < $scope.machineHDList.length; i++) {
                            var obj;
                            obj = {
                                "circleId": $scope.machineHDList[i].circle.id,
                                "stageId": $scope.machineHDList[i].stage.id,
                                "productId": $scope.machineHDList[i].product.id,
                                "machineId": 0,
                                "operationId": $scope.machineHDList[i].operation.id,
                                "productNoId": $scope.machineHDList[i].productNo.id,
                                "suggestionDet": {
                                    "sugId": $scope.selectedSuggId
                                }
                            }
                            if ($scope.machineHDList[i].machine != null && $scope.machineHDList[i].machine != undefined) {
                                obj.machineId = $scope.machineHDList[i].machine.id;
                            }
                            $scope.pillarList.push(obj);
                        }
                    }
                    if ($scope.pillarList != null && $scope.pillarList.length > 0) {
                        $scope.data.suggestionHorizontalDept = $scope.pillarList;
                        //console.log($scope.data.suggestionHorizontalDept);
                    }
                    //console.log($scope.pillarList);
                }

                if ($scope.parentSuggType != null && $scope.parentSuggType != undefined) {
                    if ($scope.parentSuggType.deptId != 0 && $scope.suggestionDet.sourceType == 'HD') {
                        var deptList = [];
                        if ($scope.departmentList != null && $scope.departmentList.length > 0) {
                            for (var i = 0; i < $scope.departmentList.length; i++) {
                                var dept = $scope.departmentList[i]; //&& $scope.suggestionDet.dept.deptId != $scope.departmentList[i].deptId removed for hd
                                if ($scope.departmentList[i].isEvalselect) {
                                    if ($scope.departmentList[i].lineFound) {
                                        for (var j = 0; j < $scope.departmentList[i].lineList.length; j++) {
                                            var line = $scope.departmentList[i].lineList[j];
                                            if ($scope.departmentList[i].lineList[j].isEvalselect) {
                                                if (dept.deptName == 'All' && line.name == 'All') { } else {
                                                    deptList.push({
                                                        "deptId": dept.deptId,
                                                        "suggestionDet": {
                                                            "sugId": $scope.selectedSuggId
                                                        },
                                                        "lineId": line.id
                                                    })
                                                }
                                            }
                                        }
                                    } else {
                                        deptList.push({
                                            "deptId": dept.deptId,
                                            "suggestionDet": {
                                                "sugId": $scope.selectedSuggId
                                            },
                                        })
                                    }

                                }

                            }

                            if (deptList != null && deptList.length > 0) {
                                $scope.data.suggestionHorizontalDept = deptList;
                                ////console.log($scope.data.suggestionHorizontalDept);
                            }
                        }

                        //END OF MODIFIED HORIZANATL DEPLOYEMENT BY SUNANDA 9-11


                    }
                    /*-----END OF  HD CONFIG AT DEPT LEVEL-------- */
                    /*-----START FOR  HD CONFIG AT PILLAR LEVEL------ */
                    if ($scope.parentSuggType.circleId != 0 && $scope.suggestionDet.sourceType == 'HD') {
                        $scope.pillarList = [];
                        if ($scope.machineHDList != null && $scope.machineHDList.length > 0) {
                            for (var i = 0; i < $scope.machineHDList.length; i++) {
                                var obj;
                                obj = {
                                    "circleId": $scope.machineHDList[i].circle.id,
                                    "stageId": $scope.machineHDList[i].stage.id,
                                    "productId": $scope.machineHDList[i].product.id,
                                    "machineId": $scope.machineHDList[i].machine.id,
                                    "suggestionDet": {
                                        "sugId": $scope.selectedSuggId
                                    }
                                }
                                $scope.pillarList.push(obj);
                            }
                        }
                        if ($scope.pillarList != null && $scope.pillarList.length > 0) {
                            $scope.data.suggestionHorizontalDept = $scope.pillarList;
                            //console.log($scope.data.suggestionHorizontalDept);
                        }
                        //console.log($scope.pillarList);
                    }
                }
                /*-----START FOR  HD CONFIG AT PLANT LEVEL------ */
                if ($scope.hdConfigData.hdOptions == 'OPT_FOR_OTH_PLANTS') {
                    if ($scope.data.suggestionHorizontalDept == null || $scope.data.suggestionHorizontalDept == undefined) {
                        $scope.data.suggestionHorizontalDept = [];
                    }
                    $scope.data.branchIds = []
                    for (let i = 0; i < $scope.hDBranchList.length; i++) {
                        if ($scope.hDBranchList[i].isEvalPlantselect) {
                            $scope.data.suggestionHorizontalDept.push({
                                "branchId": $scope.hDBranchList[i].branchId,
                                "suggestionDet": {
                                    "sugId": $scope.selectedSuggId
                                },
                            });
                        }
                    }
                }
                // 11-8-2020  For FC Mandatory
                if ($scope.isEmpty($scope.suggestionDet.hdCatId) || $scope.suggestionDet.hdCatId == undefined || $scope.suggestionDet.hdCatId == null || $scope.suggestionDet.hdCatId == '') {
                    snackbar.create($filter('translate')('Please_select_category'), 6000, "error");
                    $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                    $scope.flagSelectTeamMem = true;
                    $scope.flagTeamDetPopupSpinner = false;
                    return;
                }
                if ($scope.suggFlowConfig.isEvalSapCodeEnbld == 'Y') {
                    if (($rootScope.empDetails.productOrgConfigDet.isSapCodeMandatory == 1)) {
                        for (let index = 0; index < $scope.catbranchwise.length; index++) {
                            if ($scope.catbranchwise[index].catId == $scope.suggestionDet.hdCatId.catId) {
                                if ($scope.catbranchwise[index].isSapCodeRequired == 'Y') {
                                    if ($scope.suggestionDet.sapCode == '' || $scope.suggestionDet.sapCode == undefined || $scope.suggestionDet.sapCode == null) {
                                        $scope.flagSelectTeamMem = true;
                                        $scope.flagTeamDetPopupSpinner = false;
                                        $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                                        snackbar.create($filter('translate')('Plese_enter_SAPCode'), 6000, "error");
                                        return;
                                    }
                                }
                            }
                        }
                    }
                    if ($scope.suggestionDet.sapCode != '' && $scope.suggestionDet.sapCode != undefined && $scope.suggestionDet.sapCode != null) {
                        $scope.data.sapCode = $scope.suggestionDet.sapCode;
                    }
                }
                //console.log($scope.data);
                /*-----END OF  HD CONFIG AT PILLAR LEVEL-------- */

                /*-----------END OF PILLER LEVEL HORIZONATL DEPLOYEMENT---------------------------CHANGE BY SUNANDA --------------24-2-2020*/


                //END OF MODIFIED HORIZANATL DEPLOYEMENT BY SUNANDA 9-11
                /*----------START-FOR FC CHANGE BY SUNANDA 12-10*/
                if ($scope.suggestionDet.isHDRequire == true && ($scope.data.suggestionHorizontalDept == null || $scope.data.suggestionHorizontalDept.length == 0)) {
                    $scope.data.isHorizDeployReq = 'NA';
                } else {
                    $scope.data.isHorizDeployReq = 'Y';
                    // if ($scope.data.suggestionHorizontalDept != null && $scope.data.suggestionHorizontalDept.length > 0) {
                    //     $scope.data.isHorizDeployReq = 'Y';
                    // } else {

                    // }
                }
                if ($scope.suggestionDet.tmpIsDocumentChangeRequire == true && ($scope.data.document == null || $scope.data.document.length == 0)) {
                    $scope.data.isDocumentChangeRequire = 'NA';
                } else {
                    $scope.data.isDocumentChangeRequire = 'Y';
                    // if ($scope.data.document != null && $scope.data.document.length > 0) {
                    //     $scope.data.isDocumentChangeRequire = 'Y';
                    // } else {

                    // }
                }

                //Check Mandatory field
                var requeireField = $rootScope.empDetails.productOrgConfigDet;
                if ($scope.suggFlowConfig.isHorizDplymntsEnbld == 'Y' && $scope.suggFlowConfig.isEvalEnbld == 'Y' && $scope.isHorizDeployReq == 'Y' && $scope.data.suggestionHorizontalDept == null) {
                    $scope.flagSelectTeamMem = true;
                    $scope.flagTeamDetPopupSpinner = false;
                    $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                    // snackbar.create("Evaluation of horizontal deployment is mandatory.", 6000, "error");
                    snackbar.create($filter('translate')('Evaluation_horizontal_deployment_mandatory'), 6000, "error");
                    return;
                }
                // START FOR MODIFIED HORIZANATL DEPLOYEMENT MODIFIED FOR EVALUTION BY SUNANDA 9-11
                if ($scope.suggestionDet.dept != null) {
                    for (var i = 0; i < $scope.departmentList.length; i++) {
                        if ($scope.departmentList[i].isEvalselect && $scope.departmentList[i].lineFound) {
                            for (var j = 0; j < $scope.departmentList[i].lineList.length; j++) {
                                if ($filter('filter')($scope.departmentList[i].lineList, { isEvalselect: true }).length == 0) {
                                    $scope.flagSelectTeamMem = true;
                                    $scope.flagTeamDetPopupSpinner = false;
                                    $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                                    snackbar.create($filter('translate')('Please_select_line_horizontal_deployment'), 6000, "error");
                                    return;
                                }
                            }
                        }
                    }
                }

                // START FOR MODIFIED HORIZANATL DEPLOYEMENT MODIFIED FOR EVALUTION BY SUNANDA 9-11
                /*----------END-FOR FC CHANGE BY SUNANDA 12-10*/
                if ($scope.suggFlowConfig.isKaizenActEnbld == 'Y' && $scope.suggFlowConfig.isEvalEnbld == 'Y' && requeireField.isActivityOn == 1) {
                    if ($scope.data.suggActivity == null || $scope.data.suggActivity.length == 0) {
                        snackbar.create($filter('translate')('Kaizen_activities_are_mandatory'), 6000, "error");
                        $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                        $scope.flagSelectTeamMem = true;
                        $scope.flagTeamDetPopupSpinner = false;
                        return;
                    }
                }
                if ($scope.suggFlowConfig.isEvalEnbld == 'Y' && $scope.suggFlowConfig.isParticularsEnbld == 'Y' && requeireField.isPraticularsMandatory == 1) {
                    if ($scope.data.suggParticulars == null || $scope.data.suggParticulars.length == 0) {
                        snackbar.create($filter('translate')('Other_benefits_are_mandatory'), 6000, "error");
                        $scope.flagSelectTeamMem = true;
                        $scope.flagTeamDetPopupSpinner = false;
                        $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                        return;
                    }
                }
                /*--- START FOR CIRCLE CHANGE--------BY SUNANDA-------3-1-2020 --*/
                if ($scope.suggestionDet.whyWhyAnalysis != null && $scope.suggestionDet.whyWhyAnalysis != undefined && $scope.suggestionDet.whyWhyAnalysis != '') {
                    $scope.data.whyWhyAnalysis = $scope.suggestionDet.whyWhyAnalysis;
                }
                if ($scope.suggestionDet.whatToDo != null && $scope.suggestionDet.whatToDo != undefined && $scope.suggestionDet.whatToDo != '') {
                    $scope.data.whatToDo = $scope.suggestionDet.whatToDo;
                }
                if ($scope.suggestionDet.howToDo != null && $scope.suggestionDet.howToDo != undefined && $scope.suggestionDet.howToDo != '') {
                    $scope.data.howToDo = $scope.suggestionDet.howToDo;
                }
                if ($scope.suggestionDet.benefits != null && $scope.suggestionDet.benefits != undefined && $scope.suggestionDet.benefits != '') {
                    $scope.data.benefits = $scope.suggestionDet.benefits;
                }
                if ($scope.suggestionDet.results != null && $scope.suggestionDet.results != undefined && $scope.suggestionDet.results != '') {
                    $scope.data.results = $scope.suggestionDet.results;
                }
                if ($scope.suggestionDet.kaizenIdea != null && $scope.suggestionDet.kaizenIdea != undefined && $scope.suggestionDet.kaizenIdea != '') {
                    $scope.data.kaizenIdea = $scope.suggestionDet.kaizenIdea;
                }
                if ($scope.suggestionDet.frquency != null && $scope.suggestionDet.frquency != undefined && $scope.suggestionDet.frquency != '') {
                    $scope.data.frquency = $scope.suggestionDet.frquency;
                }
                if ($scope.suggestionDet.counterMeasures != null && $scope.suggestionDet.counterMeasures != undefined && $scope.suggestionDet.counterMeasures != '') {
                    $scope.data.counterMeasures = $scope.suggestionDet.counterMeasures;
                }
                if ($scope.suggestionDet.rootCause != null && $scope.suggestionDet.rootCause != undefined && $scope.suggestionDet.rootCause != '') {
                    $scope.data.rootCause = $scope.suggestionDet.rootCause;
                }
                // 22-01.2024 by Jayshri Kolase. (Request body updated to capture PCR no.)
                if ($scope.suggestionDet.pcrNumber != null && $scope.suggestionDet.pcrNumber != '' && $scope.suggFlowConfig.isPCRNoEnbld == "Y") {
                    $scope.data.pcrNo = $scope.suggestionDet.pcrNumber;
                }
                consoleLog($scope.data);
                if ($scope.isEmpty($scope.suggestionDet.hdCatId) || $scope.suggestionDet.hdCatId == undefined || $scope.suggestionDet.hdCatId == null || $scope.suggestionDet.hdCatId == '') {
                    $scope.flagSelectTeamMem = true;
                    $scope.flagTeamDetPopupSpinner = false;
                    $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                    snackbar.create($filter('translate')('Please_select_category'), 6000, "error");
                    return;
                }
                //  if ($scope.suggestionDet.sourceType == 'HD') {
                if (!$scope.isEmpty($scope.suggestionDet.hdCatId) && $scope.suggestionDet.hdCatId != undefined && $scope.suggestionDet.hdCatId != null && $scope.suggestionDet.hdCatId != '') {
                    $scope.data.catId = parseInt($scope.suggestionDet.hdCatId.catId);
                }
                // Idea/Implementation Award
                if ($scope.suggFlowConfig.evalIdeaAward == 'Y' || $scope.suggFlowConfig.evalImpleAward == 'Y') {
                    if ($scope.suggestionDet.sugesstionStatusAudit != null && $scope.suggestionDet.sugesstionStatusAudit.length > 0) {
                        var stsadtId = 0;
                        for (var stsAdt = 0; stsAdt < $scope.suggestionDet.sugesstionStatusAudit.length; stsAdt++) {
                            if ($scope.suggestionDet.sugesstionStatusAudit[stsAdt].status_master.status == $scope.CONST.STATUS.EvaluationRequestAccepted.status) {
                                stsadtId = $scope.suggestionDet.sugesstionStatusAudit[stsAdt].stsadtId;
                                break;
                            }
                        }
                        if (stsadtId != 0) {
                            $scope.data.statusAuditId = stsadtId;
                        }
                    }
                }
                if ($scope.suggFlowConfig.evalIdeaAward == 'Y') {
                    $scope.data.ideaAwardRecommEval = ($scope.suggestionDet.recommendationData.ideaAwardRecommEval) ? true : false;
                    if ($scope.suggestionDet.recommendationData.ideaAwardRecomm) {
                        if ($scope.suggestionDet.recommendationData.ideaAwardCommentEval == null || $scope.suggestionDet.recommendationData.ideaAwardCommentEval == undefined || $scope.suggestionDet.recommendationData.ideaAwardCommentEval.trim().length == 0) {
                            // snackbar.create($filter('translate')('Please_enter_idea_award_comment'), 3000, "error");
                            // $scope.flagSelectTeamMem = true;
                            // $scope.flagTeamDetPopupSpinner = false;
                            // return;
                        } else {
                            $scope.data.ideaAwardCommentEval = $scope.suggestionDet.recommendationData.ideaAwardCommentEval;
                        }
                    }
                }
                if ($scope.suggFlowConfig.evalImpleAward == 'Y') {
                    $scope.data.implAwardRecommEval = ($scope.suggestionDet.recommendationData.implAwardRecommEval) ? true : false;
                    if ($scope.suggestionDet.recommendationData.implAwardRecommEval) {
                        if ($scope.suggestionDet.recommendationData.implAwardCommentEval == null || $scope.suggestionDet.recommendationData.implAwardCommentEval == undefined || $scope.suggestionDet.recommendationData.implAwardCommentEval.trim().length == 0) {
                            // snackbar.create($filter('translate')('Please_enter_implementation_award_comment'), 3000, "error");
                            // $scope.flagSelectTeamMem = true;
                            // $scope.flagTeamDetPopupSpinner = false;
                            // return;
                        } else {
                            $scope.data.implAwardCommentEval = $scope.suggestionDet.recommendationData.implAwardCommentEval;
                        }
                    }
                }
                //  }
                /*--- END OF CIRCLE CHANGE--------BY SUNANDA-------3-1-2020 -----*/
                url = "suggestionAssignToFinanceController";
            } else if ($scope.selectedTeamTypeForAssign == 'reassignToFC') {
                var fcid = 0;
                for (var i = 0; i <= $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                    if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.AssignedForFCApproval.status) {
                        fcid = $scope.suggestionDet.sugesstionStatusAudit[i].emp_details.empId;
                        break;
                    }
                }
                if ($scope.suggestionDet.eval == undefined || $scope.suggestionDet.eval.estimatedCost == null || $scope.suggestionDet.eval.estimatedCost == "" || $scope.suggestionDet.eval.estimatedCost == 0) {
                    snackbar.create($filter('translate')('Budgetary_Cost_is_mandatory'), 6000, "error");
                    $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                    $scope.flagSelectTeamMem = true;
                    $scope.flagTeamDetPopupSpinner = false;
                    return;
                }
                $scope.data = {
                    "sugId": parseInt($scope.selectedSuggId),
                    "statusId": $scope.CONST.STATUS.AssignedForFCApproval.statusId,
                    "assignedById": fcid,
                    // "summary":$scope.suggestionDet.eval.evaluationInputs,
                    "amount": $scope.suggestionDet.eval.estimatedCost,
                    "branchId": $scope.suggestionDet.branch.branchId, //$scope.loggedInUserBranchId,
                    "orgId": $scope.loggedInUserOrgId,
                    "sugTrackId": $scope.suggestionDet.evaluationTeamList[0].sugTrackId,
                    "teamTypeId": 1,
                };
                url = "suggestionAssignToFinanceController";
            }
            // else {
            //     $scope.data.stsId = $scope.CONST.STATUS.AssignedConcernToController.statusId;
            //     $scope.data.isConcern = 1;
            //     for (var i = 0; i < $scope.empListByTeamType.length; i++) {
            //         if (selectedEmpIds[0] == $scope.empListByTeamType[i].empId) {
            //             if ($scope.empListByTeamType[i].teamDetails != null) {
            //                 $scope.selectedTeamTypeForAssign = $scope.empListByTeamType[i].teamDetails[0].teamTypeId;
            //                 break;
            //             } else {
            //                 $scope.selectedTeamTypeForAssign = 0;
            //                 break;
            //             }
            //         }
            //     }
            //     if ($scope.data.tmtypeId == null || $scope.data.tmtypeId == "")
            //         $scope.data.tmtypeId = $scope.selectedTeamTypeForAssign;
            // }
        } else {
            url = 'passtopeer';
            var empId;
            // $.each($("input[name='empChk']:checked"), function () {
            //     empId = parseInt($(this)
            //         .val())
            // });
            empId = ($scope.empInputDet.selectedEmpIds != null && $scope.empInputDet.selectedEmpIds.length > 0) ? $scope.empInputDet.selectedEmpIds[0] : '';
            if (empId == null || empId == '' || angular.isUndefined(empId)) {
                $scope.flagSelectTeamMem = true;
                $scope.flagTeamDetPopupSpinner = false;
                $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                angular.element("#errId_team")
                    .text("Please select team member.");
                return;
            }
            $scope.data = {
                empId: empId,
                sugId: parseInt($scope.selectedSuggId),
                assignedById: parseInt($scope.loggedInEmpId),
                summary: $scope.suggestionDet.passToPeerSummary

            }
            if ($scope.suggestionInputDetails.acceptRejBy == 'byEval') {
                $scope.data.statusId = $scope.CONST.STATUS.PassToPeerEvaluator.statusId;
                $scope.data.teamTypeId = 1;
            }
            if ($scope.suggestionInputDetails.acceptRejBy == 'bySupervisor') {
                $scope.data.statusId = $scope.CONST.STATUS.PassToPeerController.statusId;
            }
            if ($scope.suggestionInputDetails.acceptRejBy == 'byImpl') {
                $scope.data.statusId = $scope.CONST.STATUS.PassToPeerImplementer.statusId;
                $scope.data.teamTypeId = 2;
            }
        }
        //console.log($scope.data);
        // var x = 0;
        // if (x == 0) {
        //     $scope.flagTeamDetPopupSpinner = false;
        //     return;
        // }
        appService.httpPost($scope.data, url)
            .then(function (response) {
                $scope.flagSelectTeamMem = true;
                $scope.flagTeamDetPopupSpinner = false;
                $scope.flagTeamDetPopupSpinner = false;
                $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                if (response.status == "success") {
                    $scope.machineHDList = [];
                    $scope.suggestionDet = {};
                    $("#teamDetModal")
                        .modal("hide");
                    $("#implTeamDetModal")
                        .modal("hide");
                    $scope.flagAccPillerLeavel = false;
                    $scope.getsuggestionList('onUpdate');
                    $scope.getStatusWiseCount();

                    if ($scope.selectedTeamTypeForAssign == $scope.CONST.TEAM_TYPE.EVALUATION) {
                        $("#teamDetModalforEval")
                            .modal("hide");
                        snackbar.create($filter('translate')('Suggestion_assinged_evaluator_successfully'), 6000, "success");
                    } else if ($scope.selectedTeamTypeForAssign == $scope.CONST.TEAM_TYPE.IMPLEMENTATION) {
                        if ($scope.suggestionDet.isSelfImplemented == 1) {
                            snackbar.create($filter('translate')('Suggestion_assinged_implementer_implementation'), 6000, "success");
                        } else {
                            snackbar.create($filter('translate')('Suggestion_implementer_successfully'), 6000, "success");
                            $scope.lineListNew = [];
                        }
                    }
                    else if ($scope.selectedTeamTypeForAssign == 'passToPeer') {
                        $("#teamDetModalforEval")
                            .modal("hide");
                        $("#teamDetModalforController")
                            .modal("hide");
                        snackbar.create($filter('translate')('Suggestion_assigned_to_peer_successfully'), 6000, "success");
                    } else if ($scope.selectedTeamTypeForAssign == $scope.CONST.TEAM_TYPE.EVALFC) {
                        snackbar.create($filter('translate')('Suggestion_is_assinged_to_FC'), 6000, "success");
                    }
                    else if ($scope.selectedTeamTypeForAssign == $scope.CONST.TEAM_TYPE.APPROVEDBYFC) {
                        snackbar.create($filter('translate')('Suggestion_implementer_successfully'), 6000, "success");
                    }
                }
                else if (response.status == "fail") {
                    snackbar.create($filter('translate')('Oops_Please_try_again'), 5000, "error");
                }
            });
    }

    $scope.setClTab = function (tab) {
        $scope.clTab = tab;
    }

    $scope.isSetClTab = function (tab) {
        return $scope.clTab === tab;
    }

    $scope.setImplClTab = function (tab) {
        $scope.implClTab = tab;
    }

    $scope.isSetImplClTab = function (tab) {
        return $scope.implClTab === tab;
    }


    $scope.change_flag_evalText = function (data) {
        // alert("Hello");
        if ($scope.data == '' || $scope.data == undefined || $scope.data == null) {
            $scope.flagEvalText = true;
        } else {
            $scope.flagEvalText = false;
        }
    }

    $scope.change_flag_implText = function (data) {
        // alert("Hello");
        if ($scope.data == '' || $scope.data == undefined || $scope.data == null) {
            $scope.flagImplText = true;
        } else {
            $scope.flagImplText = false;

        }
    }

    $scope.regx = /[^0-9]/g;

    $scope.change_flag_evalInputs = function (data) {
        if ((data != undefined && data != '') && ($scope.regx.test(data))) {
            $scope.flagevalInputs = true;
        } else {
            $scope.flagevalInputs = false;
        }
    }

    $scope.change_flag_implInputs = function (data, type) {
        if (type == 'actual') {
            if ((data != undefined && data != '') && (data.match($scope.regx) != null)) {
                $scope.flagimplInputs = true;
            } else {
                $scope.flagimplInputs = false;
            }
        } else {
            if ((data != undefined && data != '') && (data.match($scope.regx) != null)) {
                $scope.flageffectiveimplInputs = true;
            } else {
                $scope.flageffectiveimplInputs = false;
            }
        }
    }
    // ---------------------------------Initial Inputs-------------------------------
    $scope.submitInitialInputs = function (type, x, isValid) {
        if (type == "eval") {
            $scope.flagEvalText = false;
            if (x.evaluationInputs == '' || x.evaluationInputs == undefined || x.evaluationInputs == null) {
                $scope.flagEvalText = true;
                angular.element("#errId_evalText")
                    .text($filter('translate')('Please_enter_evaluation_details'));
                return;
            }


            if ((x.estimatedCost != undefined && x.estimatedCost != '') && (x.estimatedCost.match($scope.regx) != null)) {
                $scope.flagevalInputs = true;
                angular.element("#errId_evalInputs")
                    .text($filter('translate')('Please_enter_numbers_only'));
                return;
            }

            $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = true;
            $scope.data = {
                statusId: parseInt($scope.CONST.STATUS.EvaluationInputSubmitted.statusId),
                suggtrackId: parseInt(x.sugTrackId),
                evaluationInputs: x.evaluationInputs,
                /*costEffective  : parseInt(x.costEffective),*/
                estimatedCost: parseInt(x.estimatedCost),
                /*improvement    : parseInt(x.improvement),*/
                startDate: "2018-11-25",
                // endDate       : x.endDate,
                updatedById: parseInt($scope.loggedInEmpId),
                sugId: parseInt($scope.selectedSuggId),
                // levelId          : $scope.browniePointsList.levelId,
                // points           : tempPonits
                levelId: 1,
                points: 10
            };
        } else if (type == "impl") {

            $scope.flagImplText = false;
            if (x.implInputs == '' || x.implInputs == undefined || x.implInputs == null) {
                $scope.flagImplText = true;
                angular.element("#errId_implText")
                    .text($filter('translate')('Please_enter_implementation_details'));
                return;
            }

            if ((x.implementedCost != undefined && x.implementedCost != '') && (x.implementedCost.match($scope.regx) != null)) {
                $scope.flagimplInputs = true;
                angular.element("#errId_implInputs")
                    .text($filter('translate')('Please_enter_numbers_only'));
                return;
            }
            if ((x.costEffective != undefined && x.costEffective != '') && (x.costEffective.match($scope.regx) != null)) {
                $scope.flageffectiveimplInputs = true;
                angular.element("#errId_effectiveimplInputs")
                    .text($filter('translate')('Please_enter_numbers_only'));
                return;
            }
            $scope.flagImplInputSubmitSpinner = true;
            $scope.data = {
                statusId: parseInt($scope.CONST.STATUS.ImplementationInputSubmitted.statusId),
                suggtrackId: parseInt(x.sugTrackId),
                implementedCost: parseInt(x.implementedCost),
                costEffective: parseInt(x.costEffective),
                implInputs: x.implInputs,
                startDate: "2018-11-25",
                //endDate        : x.endDate,
                updatedById: parseInt($scope.loggedInEmpId),
                sugId: parseInt($scope.selectedSuggId),
                levelId: 1,
                points: 10
            };
        }

        appService.httpPost($scope.data, "submitEvaluationInitialInputs")
            .then(function (response) {
                $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                $scope.flagImplInputSubmitSpinner = false;
                if (response.status == "success") {
                    $scope.suggestionDet = {};
                    // $scope.getSuggestionDetails($scope.selectedSuggId);
                    $scope.getsuggestionList('onUpdate');
                    $scope.getStatusWiseCount();
                    snackbar.create($filter('translate')('Inputs_submitted_successfully'), 5000, "success");
                } else if (response.status == "fail") {
                    snackbar.create($filter('translate')('Oops_Please_try_again'), 5000, "error");
                }
            });
    }

    $scope.catFilter = {
        categoryName: "All"
    };
    $scope.deptFilter = {
        deptName: "All"
    };

    $scope.selectedDept = function () {
        if ($scope.suggDetailModel.deptFilter.deptName != "All") {
            $scope.suggestionPagination.selectedDeptId = $scope.suggDetailModel.deptFilter.deptId;
            $scope.suggDetailModel.selectedDeptName = $scope.suggDetailModel.deptFilter.deptName;
        } else {
            $scope.suggestionPagination.selectedDeptId = 0;
            $scope.suggDetailModel.selectedDeptName = '';
        }
        if ($scope.statusCountFilter == 0) {
            $scope.getsuggestionList('allSuggestion');
        } else {
            $scope.getsuggestionList('onLoad');
        }
        $scope.getStatusWiseCount()

    }

    $scope.selectedCategory = function () {
        if ($scope.suggDetailModel.catFilter.categoryName != "All") {
            $scope.suggestionPagination.selectedCatId = $scope.suggDetailModel.catFilter.catId;
            $scope.suggDetailModel.selectedCategoryName = $scope.suggDetailModel.catFilter.categoryName;
        } else {
            $scope.suggestionPagination.selectedCatId = 0;
            $scope.suggDetailModel.selectedCategoryName = '';
        }
        if ($scope.statusCountFilter == 0) {
            $scope.getsuggestionList('allSuggestion');
        } else {
            $scope.getsuggestionList('onLoad');
        }
        $scope.getStatusWiseCount()
    }
    $scope.selectedStatusSearch = function () {
        if ($scope.statusCountFilter == 0) {
            $scope.getsuggestionList('allSuggestion');
        } else {
            $scope.getsuggestionList('onLoad');
        }
        $scope.getStatusWiseCount()
    }


    $scope.selectedStatus = function () {
        $scope.selectedStatusName = $scope.statusFilter.status;
    }

    $scope.isSelectedHorizontal = function (deptId) {
        var flag = false;
        if ($scope.suggestionDet.suggestionHorizontalDept != null && $scope.suggestionDet.suggestionHorizontalDept.length > 0) {
            for (var i = 0; i < $scope.suggestionDet.suggestionHorizontalDept.length; i++) {
                if ($scope.suggestionDet.suggestionHorizontalDept[i].deptId == deptId) {
                    flag = true;
                    break;
                }
            }
        }
        return flag;
    }
    $scope.getDepartmentList = function (branchId) {
        $scope.departmentList = [];
        appService.httpGet("getdepartmentlistbybranchid/" + branchId)
            .then(function (response) {
                $scope.departmentList = [];
                $scope.departmentList.push({
                    deptName: "All"
                });

                for (var i = 0; i < response.deptList.length; i++) {
                    $scope.departmentList.push(response.deptList[i]);
                }
                if ($scope.departmentList.length > 0) {
                    for (var k = 0; k < $scope.departmentList.length; k++) {
                        $scope.departmentList[k].isselect = false;
                    }
                }
                $scope.suggDetailModel.deptFilter = $scope.departmentList[0];
                //$scope.departmentList = response.deptList;
                if ($scope.suggestionDet.sugesstionStatusAudit != null && $scope.suggestionDet.sugesstionStatusAudit.length > 0) {
                    for (let i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                        if (($scope.suggestionDet.sugesstionStatusAudit[i].actionStatus == "PENDING" || $scope.suggestionDet.sugesstionStatusAudit[i].status_master.status != $scope.CONST.STATUS.Implemented.status) && $scope.suggestionDet.sugesstionStatusAudit[i].status_master.status != $scope.CONST.STATUS.ImplementationRequestAccepted.status) {
                            $scope.isHdDeptBeforeCheck();
                        }
                        /* if (($scope.suggestionDet.sugesstionStatusAudit[i].actionStatus == "PENDING" || $scope.suggestionDet.sugesstionStatusAudit[i].status_master.status != $scope.CONST.STATUS.Implemented.status) && $scope.suggestionDet.sugesstionStatusAudit[i].status_master.status != $scope.CONST.STATUS.ImplementationRequestAccepted.status) {
                            $scope.isHdDeptBeforeCheck();
                        } */
                    }
                }
            });
    }


    $scope.getCategoryList = function (branchId) {
        appService.httpGet("getcategorylistbyorgid/0/" + branchId)
            .then(function (response) {
                $scope.catagoryList = [];

                $scope.catagoryList.push({
                    categoryName: "All"
                });
                $scope.catagoryList.push({
                    catId: 0,
                    categoryName: 'Tier-1',
                    processType: 'Tier-1'
                }, {
                    catId: 0,
                    categoryName: 'Tier-2',
                    processType: 'Tier-2'
                });
                for (var i = 0; i < response.catagoryList.length; i++) {
                    $scope.catagoryList.push(response.catagoryList[i]);
                }
                $scope.suggDetailModel.catFilter = $scope.catagoryList[0];
                $scope.listFilter.catagoryList = angular.copy($scope.catagoryList); //4-12
                //console.log("categoryList", $scope.catagoryList);
                // $scope.catbranchwise = response.catagoryList;

            });
    }
    $scope.expandCollapse = function (tab) {
        if (angular.element("#collapseContent" + tab)
            .hasClass('closeCollapseTab')) {
            $("#collapseContent" + tab)
                .removeClass("closeCollapseTab");
            $("#btnExpColllapse" + tab)
                .removeClass("fa-angle-down");
            $("#btnExpColllapse" + tab)
                .addClass("fa-angle-up");
        } else {
            $("#collapseContent" + tab)
                .addClass("closeCollapseTab");
            $("#btnExpColllapse" + tab)
                .removeClass("fa-angle-up");
            $("#btnExpColllapse" + tab)
                .addClass("fa-angle-down");
        }
    }
    $scope.setTab = function (tabId) {
        $scope.tab = tabId;
    };

    $scope.isSet = function (tabId) {
        return $scope.tab === tabId;
    };
    $scope.implTab = 1;

    $scope.setImplTab = function (tabId) {
        $scope.implTab = tabId;
    };

    $scope.isImplSet = function (tabId) {
        return $scope.implTab === tabId;
    };

    $scope.implData = {};

    $scope.changeonhold = function () {
        if ($scope.implData.onHoldImplSummary == '') {
            $scope.flaghold = true;
        } else {
            $scope.flaghold = false;
        }
    }

    $scope.cancelsugg = function () {
        if ($scope.implData.rejectionReason == '') {
            $scope.flagcancelsugg = true;
        } else {
            $scope.flagcancelsugg = false;
        }
    }
    // ADVIK 7-3-2020  DATE CHANGE 
    $scope.savesuggestionHorizontalDate = function (x) {
        $scope.submitSpinner = true;
        if (x.targetDate == null || x.targetDate == '' || x.targetDate == undefined) {
            snackbar.create($filter('translate')('Please_enter_target_date'), 5000, "error");
            $scope.submitSpinner = false;
            return;
        }
        var req = {
            "targetDate": x.targetDate,
            "id": x.id
        }
        //console.log(req);
        appService.httpPost(req, 'updateHdTargetDate')
            .then(function (response) {
                $scope.submitSpinner = false;
                if (response.result) {
                    $scope.suggestionDet = {};
                    $scope.getSuggestionDetails($scope.selectedSuggId);
                    snackbar.create($filter('translate')('Target_date_saved_successfully'), 5000, "success");
                } else {
                    snackbar.create($filter('translate')('Oops_Please_try_again'), 5000, "error");
                }
            })

    }
    $scope.suggestionHorizontalImpl = function () {
        var req = {
            "sugId": $scope.selectedSuggId,
            "suggestionHorizontalDept": [],
            "statusId": $scope.CONST.STATUS.AssignedToImplementorForHorizantalDeployement.statusId,
            "branchId": $scope.suggestionDet.branch.branchId, //$scope.loggedInUserBranchId,
            "orgId": $rootScope.empDetails.organization.orgId
        }
        for (var i = 0; i < $scope.suggestionDet.suggestionHorizontalDept.length; i++) {
            if ($scope.suggestionDet.suggestionHorizontalDept[i].isselect && $scope.suggestionDet.suggestionHorizontalDept[i].actionStatus == 'PENDING') {
                if (!$scope.suggestionDet.suggestionHorizontalDept[i].istarget) {
                    snackbar.create($filter('translate')('Please_capture_target_date'), 5000, "error");
                    return
                }
                req.suggestionHorizontalDept.push({
                    id: $scope.suggestionDet.suggestionHorizontalDept[i].id
                })
            }
        }
        if (req.suggestionHorizontalDept.length == 0) {
            if ($scope.checkForHdConfig()) {
                snackbar.create($filter('translate')('Please_select_implemented_department_cell'), 5000, "error");
                return
            } else {
                snackbar.create($filter('translate')('Please_select_implemented_circle'), 5000, "error");
                return
            }
        }
        //console.log(req);
        if (req.suggestionHorizontalDept != null && req.suggestionHorizontalDept.length > 0) {
            $scope.uploadAttachmentModalSpinner = true;
            appService.httpPost(req, 'implementHorizantalDeploymentProcess')
                .then(function (response) {
                    $scope.uploadAttachmentModalSpinner = false;
                    if (response.result) {
                        $scope.suggestionDet = {};
                        if (response.statusId == $scope.CONST.STATUS.AssignedToImplementorForHorizantalDeployement.statusId) {
                            $scope.getSuggestionDetails($scope.selectedSuggId);
                        } else if (response.statusId == $scope.CONST.STATUS.Implemented.statusId) {
                            $('#assignedHDImplModal').modal('hide');
                            $scope.suggestionDetInput = {};
                            $scope.getsuggestionList('onUpdate');
                            $scope.getStatusWiseCount();
                        } else {
                            $('#assignedHDImplModal').modal('hide');
                            $scope.suggestionDetInput = {};
                            $scope.getsuggestionList('onLoad');
                            $scope.getStatusWiseCount();
                        }
                        if (response.statusId == $scope.CONST.STATUS.AssignedForSustainanceCheck.statusId) {
                            snackbar.create($filter('translate')('Suggestion_assigned_for_sustainance_check_successfully'), 3000, "success");
                        } else {
                            snackbar.create($filter('translate')('Suggestion_implemented_successfully'), 3000, "success");
                        }
                    } else {
                        snackbar.create($filter('translate')('Oops_Please_try_again'), 5000, "error");
                    }
                })
        }
    }
    $scope.suggestionImplemented = function (statusId) {
        var formData = new FormData($("#upload-file-form")[0]);
        var tempStsTrackId = 0;
        for (var i = 0; i < $scope.suggestionDet.implTeamList.length; i++) {
            if ($scope.suggestionDet.implTeamList[i].statusAuditId == $scope.implAssignedStatusAdtId) {
                tempStsTrackId = $scope.suggestionDet.implTeamList[i].sugTrackId;
            }
        }
        // if ($scope.suggestionDet.implfinanceflow && $scope.CONST.STATUS.Implemented.statusId == statusId && (($scope.implData.implementedCost == null || $scope.implData.implementedCost == 0) && ($scope.implData.costEffective == null || $scope.implData.costEffective == 0))) {
        //     snackbar.create($filter('translate')('Actual_Implementation_mandatory'), 6000, "error");
        //     return;
        // }

        let lastElement;
        if (Array.isArray($scope.implData)) {
            lastElement = $scope.implData[$scope.implData.length - 1];
        } else {
            lastElement = $scope.implData;
        }
        if (
            $scope.suggestionDet.implfinanceflow &&
            $scope.CONST.STATUS.Implemented.statusId == statusId &&
            (
                (lastElement.implementedCost == null || lastElement.implementedCost == 0) &&
                (lastElement.costEffective == null || lastElement.costEffective == 0)
            )
        ) {
            snackbar.create($filter('translate')('Actual_Implementation_mandatory'), 6000, "error");
            return;
        }

        // if ($scope.CONST.STATUS.AssignedForFCVerification.statusId == statusId && (($scope.suggestionDet.implTeamList[0].implementedCost == null || $scope.suggestionDet.implTeamList[0].implementedCost == 0) && ($scope.suggestionDet.implTeamList[0].costEffective == null || $scope.suggestionDet.implTeamList[0].costEffective == 0))) {
        //     snackbar.create($filter('translate')('Actual_Implementation_mandatory'), 6000, "error");
        //     return;
        // }
        let lastElementSecond;
        if (Array.isArray($scope.suggestionDet.implTeamList)) {
            lastElementSecond = $scope.suggestionDet.implTeamList[$scope.suggestionDet.implTeamList.length - 1];
        } else {
            lastElementSecond = $scope.suggestionDet.implTeamList;
        }
        if (
            $scope.CONST.STATUS.AssignedForFCVerification.statusId == statusId &&
            (
                (lastElementSecond.implementedCost == null || lastElementSecond.implementedCost == 0) &&
                (lastElementSecond.costEffective == null || lastElementSecond.costEffective == 0)
            )
        ) {
            snackbar.create($filter('translate')('Actual_Implementation_mandatory'), 6000, "error");
            return;
        }

        if ($scope.CONST.STATUS.Implemented.statusId == statusId && $scope.suggestionDet.implfinanceflow && ($scope.suggestionDet.implfc == undefined || $scope.suggestionDet.implfc == null)) {
            snackbar.create($filter('translate')('Please_Select_FC'), 6000, "error");
            return;
        }
        //Check Particulars mandetory
        if ($scope.implTab == 1 && $scope.suggFlowConfig.isImplParticularsEnbld == 'Y' && $scope.CONST.STATUS.Implemented.statusId == statusId && $rootScope.empDetails.productOrgConfigDet.isPraticularsMandatory == 1) {
            if ($filter('filter')($scope.particulars, { isChecked: true }).length == 0) {
                snackbar.create($filter('translate')('Other_bebefits_is_mandatory'), 5000, "error");
                return;
            }
        }

        var selectedbenefitId = [];
        if ($scope.benefitList != null && $scope.benefitList.length > 0) {
            for (var beneIndex = 0; beneIndex < $scope.benefitList.length; beneIndex++) {
                if ($scope.benefitList[beneIndex].hasOwnProperty('isBenefitChecked') && $scope.benefitList[beneIndex].isBenefitChecked) {
                    selectedbenefitId.push($scope.benefitList[beneIndex].benfitId);
                }
            }
        }
        // $.each($("input[name='benefitIds']:checked"), function () {
        //     selectedbenefitId.push(
        //         parseInt($(this)
        //             .val())
        //     );
        // });

        //Check Benefits mandetory
        if ($scope.implTab == 1 && $rootScope.empDetails.productOrgConfigDet.isBenefitsMandatory == 1 && $scope.CONST.STATUS.Implemented.statusId == statusId && $scope.suggFlowConfig.isBenefitsEnbld == 'Y') {
            if (selectedbenefitId == null || selectedbenefitId.length == 0) {
                snackbar.create($filter('translate')('Benefit_is_mandatory'), 5000, "error");
                return;
            }
        }
        if (selectedbenefitId != null && selectedbenefitId.length > 0) {
            var benifitcount = 0;
            for (var i in selectedbenefitId) {
                formData.append("benefitIds[" + benifitcount + "]", selectedbenefitId[i]);
                benifitcount++;
            }
        }
        //check sustenance audit mandatory
        if ($scope.implTab == 1 && $scope.suggFlowConfig.isImplParticularsEnbld == 'Y') {
            if ($scope.suggFlowConfig.kaizenCheckReqImpl == 'Y' && $rootScope.empDetails.productOrgConfigDet.isSusAuditRequired == 1 && $scope.CONST.STATUS.Implemented.statusId == statusId && $scope.suggestionDet.category.isSusAuditRequired == 'Y') {
                if ($scope.suggestionDet.implSustenanceflow == undefined || $scope.suggestionDet.implSustenanceflow == null || !$scope.suggestionDet.implSustenanceflow) {
                    snackbar.create($filter('translate')('Sustenance_audit_is_mandatory'), 5000, "error");
                    return;
                }
            }
        }

        $scope.uploadAttachmentModalSpinner = true;
        //$scope.flagUploadImageSpinner = true;

        formData.append("branchId", $scope.suggestionDet.branch.branchId);
        formData.append("statusId", statusId);
        formData.append("teamTypeId", $scope.CONST.TEAM_TYPE.IMPLEMENTATION);
        formData.append("sugId", $scope.selectedSuggId);
        // formData.append("orgId", $scope.loggedInUserOrgId);
        if ($scope.suggestionDet.sourceType != 'HD' && $scope.suggestionDet.sourceType != 'GUEST_SUGGESTION') {
            formData.append("empId", $scope.suggestionDet.emp_details.empId);
        }
        formData.append("docUpdateStatus", false);
        var fcids = [];
        if ($scope.suggestionDet.implfinanceflow) {
            fcids.push(parseInt($scope.suggestionDet.implfc.empId));
            formData.append("fcIds", fcids);
        }
        if ($scope.CONST.STATUS.AssignedForFCVerification.statusId == statusId) {
            var implementerId = 0;
            for (var i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.ImplementationRequestAccepted.status) {
                    implementerId = $scope.suggestionDet.sugesstionStatusAudit[i].emp_details.empId;
                    break;
                }
            }
            formData.append("implementedbyId", implementerId);
            formData.append("updatedBy", implementerId);
            // change 11-5-2020 by sunanda
            if ($scope.suggestionInputDetails.fcvarifycomment != null && $scope.suggestionInputDetails.fcvarifycomment != undefined && $scope.suggestionInputDetails.fcvarifycomment != '') {
                formData.append("fvComment", $scope.suggestionInputDetails.fcvarifycomment);
            }
            for (var i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.UnderFinanceVerification.status && $scope.suggestionDet.sugesstionStatusAudit[i].actionStatus == "PENDING") {
                    formData.append("stsAuditId", $scope.suggestionDet.sugesstionStatusAudit[i].stsadtId);
                }
            }
            formData.append("implementedCost", $scope.suggestionDet.implTeamList[0].implementedCost);
            formData.append("costEffective", $scope.suggestionDet.implTeamList[0].costEffective);
            formData.append("suggtrackId", parseInt(tempStsTrackId));
        } else {
            var implementerId = 0;
            for (var i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.ImplementationRequestAccepted.status) {
                    implementerId = $scope.suggestionDet.sugesstionStatusAudit[i].emp_details.empId;
                    break;
                }
            }
            formData.append("implementedbyId", implementerId);
            formData.append("updatedBy", implementerId);
        }
        for (var i in $scope.implFiles) {
            formData.append("sugImg", $scope.implFiles[i]);
        }
        if ($scope.implTab == 1 && $scope.CONST.STATUS.AssignedForFCVerification.statusId != statusId) {
            if ($scope.suggestionDet.ehsbenefit) {
                if ($scope.implData.safetImplactionSummary != null || $scope.implData.safetImplactionSummary != undefined) {
                    formData.append("safetyImplemention", $scope.implData.safetImplactionSummary);
                    formData.append("EHSBenefit", "Yes");
                }
                else {
                    snackbar.create($filter('translate')('EHS Benefit comment is mandatory'), 5000, "error");
                    $scope.uploadAttachmentModalSpinner = false;
                    return;
                }
            }
            else {
                formData.append("EHSBenefit", "No");
            }
            formData.append("summary", $scope.implData.implSummary);
            if ($scope.suggFlowConfig.isImplActionEnbld == 'Y') {
                formData.append("implementationAction", $scope.implData.implactionSummary);
            }
            formData.append("implementedCost", $scope.implData.implementedCost);
            formData.append("costEffective", $scope.implData.costEffective);
            formData.append("suggtrackId", parseInt(tempStsTrackId));

            // START FOR ADD TEAM MEMBER FOR IMPLEMENTION CHANGE BY SUNANDA 1-11
            var empIdforImplement = [];
            if ($scope.selectedEmpList != null && $scope.selectedEmpList.length > 0) {
                for (var i = 0; i < $scope.selectedEmpList.length; i++) {
                    if ($scope.selectedEmpList[i].isSelected == true) {
                        empIdforImplement.push($scope.selectedEmpList[i].empId);
                    }
                }
            }

            if (empIdforImplement != null && empIdforImplement.length > 0) {
                for (var i in empIdforImplement) {
                    formData.append("empIds[" + i + "]", empIdforImplement[i]);
                }
            }

            // END OF ADD TEAM MEMBER FOR IMPLEMENTION CHANGE BY SUNANDA 1-11
            //Horizontal Deployment
            // START FOR IMPLEMENTATION HORIZANTAL DEPLOYMENT CHANGE BY SUNANDA 9-11
            var horiCount = 0;
            if ($scope.suggestionDet.dept != null && $scope.suggestionDet.sourceType != 'HD') {
                for (var k = 0; k < $scope.departmentList.length; k++) {
                    if ($scope.departmentList[k].lineFound != null && $scope.departmentList[k].lineList != null && $scope.departmentList[k].lineList.length > 0) {
                        for (var l = 0; l < $scope.departmentList[k].lineList.length; l++) {
                            var lineFound = false;
                            if ($scope.suggestionDet.suggestionHorizontalDept != null) {
                                for (var m = 0; m < $scope.suggestionDet.suggestionHorizontalDept.length; m++) {
                                    if ($scope.departmentList[k].deptId == $scope.suggestionDet.suggestionHorizontalDept[m].deptId &&
                                        $scope.departmentList[k].lineList[l].lineId == $scope.suggestionDet.suggestionHorizontalDept[m].lineId) {
                                        lineFound = true;
                                    }
                                }
                            }
                            if (!lineFound && $scope.departmentList[k].lineList[l].isImplselect && $scope.departmentList[k].lineList[l].name != 'All') {
                                formData.append("suggestionHorizontalDept[" + horiCount + "].lineId", $scope.departmentList[k].lineList[l].lineId);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].deptId", $scope.departmentList[k].deptId);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].suggestionDet.sugId", $scope.suggestionDet.sugId);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].isAdd", 1);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].isDelete", 0);
                                horiCount++;
                            }
                        }
                    } else {
                        var deptFound = false;
                        if ($scope.suggestionDet.suggestionHorizontalDept != null) {
                            for (var m = 0; m < $scope.suggestionDet.suggestionHorizontalDept.length; m++) {
                                if ($scope.departmentList[k].deptId == $scope.suggestionDet.suggestionHorizontalDept[m].deptId &&
                                    $scope.suggestionDet.suggestionHorizontalDept[m].lineId == 0) {
                                    deptFound = true;
                                }
                            }
                        }
                        if (!deptFound && $scope.departmentList[k].isImplselect && $scope.departmentList[k].deptName != 'All') {
                            formData.append("suggestionHorizontalDept[" + horiCount + "].deptId", $scope.departmentList[k].deptId);
                            formData.append("suggestionHorizontalDept[" + horiCount + "].suggestionDet.sugId", $scope.suggestionDet.sugId);
                            formData.append("suggestionHorizontalDept[" + horiCount + "].isAdd", 1);
                            formData.append("suggestionHorizontalDept[" + horiCount + "].isDelete", 0);
                            horiCount++;
                        }
                    }
                }

                //delete impl horizontal deployment
                if ($scope.suggestionDet.suggestionHorizontalDept != null) {
                    for (var j = 0; j < $scope.departmentList.length; j++) {
                        if ($scope.departmentList[j].isImplselect == false) {
                            for (var m = 0; m < $scope.suggestionDet.suggestionHorizontalDept.length; m++) {
                                if ($scope.suggestionDet.suggestionHorizontalDept[m].deptId == $scope.departmentList[j].deptId) {
                                    if ($scope.suggestionDet.suggestionHorizontalDept[m].deptId > 0 &&
                                        $scope.suggestionDet.suggestionHorizontalDept[m].lineId > 0 &&
                                        $scope.suggestionDet.suggestionHorizontalDept[m].id > 0) {

                                        // Additional condition to check if deptId matches
                                        formData.append("suggestionHorizontalDept[" + horiCount + "].id", $scope.suggestionDet.suggestionHorizontalDept[m].id);
                                        formData.append("suggestionHorizontalDept[" + horiCount + "].lineId", $scope.suggestionDet.suggestionHorizontalDept[m].lineId);
                                        formData.append("suggestionHorizontalDept[" + horiCount + "].deptId", $scope.suggestionDet.suggestionHorizontalDept[m].deptId);
                                        formData.append("suggestionHorizontalDept[" + horiCount + "].suggestionDet.sugId", $scope.suggestionDet.sugId);
                                        formData.append("suggestionHorizontalDept[" + horiCount + "].isAdd", 0);
                                        formData.append("suggestionHorizontalDept[" + horiCount + "].isDelete", 1);
                                        horiCount++;
                                    }
                                }
                            }
                        }
                    }
                }
                if ($scope.suggestionDet.suggestionHorizontalDept != null) {
                    for (var m = 0; m < $scope.suggestionDet.suggestionHorizontalDept.length; m++) {
                        if ($scope.suggestionDet.suggestionHorizontalDept[m].lineId > 0) {
                            var islineDelete = false;
                            for (var k = 0; k < $scope.departmentList.length; k++) {
                                if ($scope.departmentList[k].lineFound != null && $scope.departmentList[k].lineList != null) {
                                    for (var l = 0; l < $scope.departmentList[k].lineList.length; l++) {
                                        if ($scope.departmentList[k].deptId == $scope.suggestionDet.suggestionHorizontalDept[m].deptId &&
                                            $scope.departmentList[k].lineList[l].lineId == $scope.suggestionDet.suggestionHorizontalDept[m].lineId) {
                                            if (!$scope.departmentList[k].lineList[l].isImplselect) {
                                                islineDelete = true;
                                            }
                                        }
                                    }
                                }
                            }
                            if (islineDelete) {
                                formData.append("suggestionHorizontalDept[" + horiCount + "].id", $scope.suggestionDet.suggestionHorizontalDept[m].id);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].deptId", $scope.suggestionDet.suggestionHorizontalDept[m].deptId);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].suggestionDet.sugId", $scope.suggestionDet.sugId);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].isAdd", 0);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].isDelete", 1);
                                horiCount++;
                            }
                        } else {
                            var islineDelete = false;
                            for (var k = 0; k < $scope.departmentList.length; k++) {
                                if ($scope.departmentList[k].deptId == $scope.suggestionDet.suggestionHorizontalDept[m].deptId &&
                                    $scope.suggestionDet.suggestionHorizontalDept[m].lineId == 0) {
                                    if (!$scope.departmentList[k].isImplselect) {
                                        islineDelete = true;
                                    }
                                }
                            }
                            if (islineDelete) {
                                formData.append("suggestionHorizontalDept[" + horiCount + "].id", $scope.suggestionDet.suggestionHorizontalDept[m].id);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].deptId", $scope.suggestionDet.suggestionHorizontalDept[m].deptId);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].suggestionDet.sugId", $scope.suggestionDet.sugId);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].isAdd", 0);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].isDelete", 1);
                                horiCount++;
                            }
                        }
                    }
                }
                for (var i = 0; i < $scope.departmentList.length; i++) {
                    if ($scope.departmentList[i].isImplselect && $scope.departmentList[i].lineFound) {
                        for (var j = 0; j < $scope.departmentList[i].lineList.length; j++) {
                            if ($filter('filter')($scope.departmentList[i].lineList, { isImplselect: true }).length == 0) {
                                $scope.uploadAttachmentModalSpinner = false;
                                $scope.onHoldImplementationSpinner = true;
                                $scope.cancleImplementationSpinner = false;
                                snackbar.create($filter('translate')('Please_select_line_horizontal_deployment'), 6000, "error");
                                return;
                            }
                        }
                    }
                }
            }
            // 21-3-2020
            if ($scope.suggestionDet.circle != null && $scope.suggestionDet.sourceType != 'HD') {
                if ($scope.implMachineHDList != null && $scope.implMachineHDList.length > 0) {
                    for (var l = 0; l < $scope.implMachineHDList.length; l++) {
                        $scope.implMachineHDList[l].machineFound = false;
                        for (let i = 0; i < $scope.suggestionDet.suggestionHorizontalDept.length; i++) {
                            if ($scope.suggestionDet.suggestionHorizontalDept[i].operationId == $scope.implMachineHDList[l].operation.id) {
                                $scope.implMachineHDList[l].machineFound = true;
                            }
                        }
                        if (!$scope.implMachineHDList[l].machineFound) {
                            if ($scope.implMachineHDList[l].machine != null && $scope.implMachineHDList[l].machine != undefined) {
                                formData.append("suggestionHorizontalDept[" + horiCount + "].machineId", $scope.implMachineHDList[l].machine.id);
                            } else {
                                formData.append("suggestionHorizontalDept[" + horiCount + "].machineId", 0);
                            }
                            formData.append("suggestionHorizontalDept[" + horiCount + "].circleId", $scope.implMachineHDList[l].circle.id);
                            formData.append("suggestionHorizontalDept[" + horiCount + "].productId", $scope.implMachineHDList[l].product.id);
                            formData.append("suggestionHorizontalDept[" + horiCount + "].stageId", $scope.implMachineHDList[l].stage.id);
                            formData.append("suggestionHorizontalDept[" + horiCount + "].productNoId", $scope.implMachineHDList[l].productNo.id);
                            formData.append("suggestionHorizontalDept[" + horiCount + "].operationId", $scope.implMachineHDList[l].operation.id);
                            formData.append("suggestionHorizontalDept[" + horiCount + "].suggestionDet.sugId", $scope.suggestionDet.sugId);
                            formData.append("suggestionHorizontalDept[" + horiCount + "].isAdd", 1);
                            formData.append("suggestionHorizontalDept[" + horiCount + "].isDelete", 0);
                            horiCount++;
                        }
                    }
                }
            }
            if ($scope.suggestionDet.circle != null && $scope.suggestionDet.sourceType != 'HD') {
                if ($scope.implMachineHDList != null && $scope.implMachineHDList.length > 0) {
                    for (let i = 0; i < $scope.suggestionDet.suggestionHorizontalDept.length; i++) {
                        $scope.suggestionDet.suggestionHorizontalDept[i].isMachineDelete = false;
                        for (var l = 0; l < $scope.implMachineHDList.length; l++) {
                            if ($scope.suggestionDet.suggestionHorizontalDept[i].operationId == $scope.implMachineHDList[l].operation.id) {
                                $scope.suggestionDet.suggestionHorizontalDept[i].isMachineDelete = true
                            }
                        }
                        if (!$scope.suggestionDet.suggestionHorizontalDept[i].isMachineDelete && $scope.suggestionDet.suggestionHorizontalDept[i].operationId > 0) {
                            formData.append("suggestionHorizontalDept[" + horiCount + "].id", $scope.suggestionDet.suggestionHorizontalDept[i].id);
                            formData.append("suggestionHorizontalDept[" + horiCount + "].machineId", $scope.suggestionDet.suggestionHorizontalDept[i].machineId);
                            formData.append("suggestionHorizontalDept[" + horiCount + "].circleId", $scope.suggestionDet.suggestionHorizontalDept[i].circleId);
                            formData.append("suggestionHorizontalDept[" + horiCount + "].productId", $scope.suggestionDet.suggestionHorizontalDept[i].productId);
                            formData.append("suggestionHorizontalDept[" + horiCount + "].productNoId", $scope.suggestionDet.suggestionHorizontalDept[i].productNoId);
                            formData.append("suggestionHorizontalDept[" + horiCount + "].operationId", $scope.suggestionDet.suggestionHorizontalDept[i].operationId);
                            formData.append("suggestionHorizontalDept[" + horiCount + "].stageId", $scope.suggestionDet.suggestionHorizontalDept[i].stageId);
                            formData.append("suggestionHorizontalDept[" + horiCount + "].suggestionDet.sugId", $scope.suggestionDet.sugId);
                            formData.append("suggestionHorizontalDept[" + horiCount + "].isAdd", 0);
                            formData.append("suggestionHorizontalDept[" + horiCount + "].isDelete", 1);
                            horiCount++;
                        }
                    }

                }
            }
            if ($scope.parentSuggType != null && $scope.parentSuggType != undefined) {
                if ($scope.parentSuggType.deptId != 0 && $scope.suggestionDet.sourceType == 'HD') {
                    for (var k = 0; k < $scope.departmentList.length; k++) {
                        if ($scope.departmentList[k].lineFound != null && $scope.departmentList[k].lineList != null && $scope.departmentList[k].lineList.length > 0) {
                            for (var l = 0; l < $scope.departmentList[k].lineList.length; l++) {
                                var lineFound = false;
                                if ($scope.suggestionDet.suggestionHorizontalDept != null) {
                                    for (var m = 0; m < $scope.suggestionDet.suggestionHorizontalDept.length; m++) {
                                        if ($scope.departmentList[k].deptId == $scope.suggestionDet.suggestionHorizontalDept[m].deptId &&
                                            $scope.departmentList[k].lineList[l].lineId == $scope.suggestionDet.suggestionHorizontalDept[m].lineId) {
                                            lineFound = true;
                                        }
                                    }
                                }
                                if (!lineFound && $scope.departmentList[k].lineList[l].isImplselect && $scope.departmentList[k].lineList[l].name != 'All') {
                                    formData.append("suggestionHorizontalDept[" + horiCount + "].lineId", $scope.departmentList[k].lineList[l].lineId);
                                    formData.append("suggestionHorizontalDept[" + horiCount + "].deptId", $scope.departmentList[k].deptId);
                                    formData.append("suggestionHorizontalDept[" + horiCount + "].suggestionDet.sugId", $scope.suggestionDet.sugId);
                                    formData.append("suggestionHorizontalDept[" + horiCount + "].isAdd", 1);
                                    formData.append("suggestionHorizontalDept[" + horiCount + "].isDelete", 0);
                                    horiCount++;
                                }
                            }
                        } else {
                            var deptFound = false;
                            if ($scope.suggestionDet.suggestionHorizontalDept != null) {
                                for (var m = 0; m < $scope.suggestionDet.suggestionHorizontalDept.length; m++) {
                                    if ($scope.departmentList[k].deptId == $scope.suggestionDet.suggestionHorizontalDept[m].deptId &&
                                        $scope.suggestionDet.suggestionHorizontalDept[m].lineId == 0) {
                                        deptFound = true;
                                    }
                                }
                            }
                            if (!deptFound && $scope.departmentList[k].isImplselect && $scope.departmentList[k].deptName != 'All') {
                                formData.append("suggestionHorizontalDept[" + horiCount + "].deptId", $scope.departmentList[k].deptId);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].suggestionDet.sugId", $scope.suggestionDet.sugId);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].isAdd", 1);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].isDelete", 0);
                                horiCount++;
                            }
                        }
                    }

                    //delete impl horizontal deployment
                    if ($scope.suggestionDet.suggestionHorizontalDept != null) {
                        for (var j = 0; j < $scope.departmentList.length; j++) {
                            if ($scope.departmentList[j].isImplselect == false) {
                                for (var m = 0; m < $scope.suggestionDet.suggestionHorizontalDept.length; m++) {
                                    if ($scope.suggestionDet.suggestionHorizontalDept[m].deptId == $scope.departmentList[j].deptId) {
                                        if ($scope.suggestionDet.suggestionHorizontalDept[m].deptId > 0 &&
                                            $scope.suggestionDet.suggestionHorizontalDept[m].lineId > 0 &&
                                            $scope.suggestionDet.suggestionHorizontalDept[m].id > 0) {

                                            // Additional condition to check if deptId matches
                                            formData.append("suggestionHorizontalDept[" + horiCount + "].id", $scope.suggestionDet.suggestionHorizontalDept[m].id);
                                            formData.append("suggestionHorizontalDept[" + horiCount + "].lineId", $scope.suggestionDet.suggestionHorizontalDept[m].lineId);
                                            formData.append("suggestionHorizontalDept[" + horiCount + "].deptId", $scope.suggestionDet.suggestionHorizontalDept[m].deptId);
                                            formData.append("suggestionHorizontalDept[" + horiCount + "].suggestionDet.sugId", $scope.suggestionDet.sugId);
                                            formData.append("suggestionHorizontalDept[" + horiCount + "].isAdd", 0);
                                            formData.append("suggestionHorizontalDept[" + horiCount + "].isDelete", 1);
                                            horiCount++;
                                        }
                                    }
                                }
                            }
                        }
                    }
                    if ($scope.suggestionDet.suggestionHorizontalDept != null) {
                        for (var m = 0; m < $scope.suggestionDet.suggestionHorizontalDept.length; m++) {
                            if ($scope.suggestionDet.suggestionHorizontalDept[m].lineId > 0) {
                                var islineDelete = false;
                                for (var k = 0; k < $scope.departmentList.length; k++) {
                                    if ($scope.departmentList[k].lineFound != null && $scope.departmentList[k].lineList != null) {
                                        for (var l = 0; l < $scope.departmentList[k].lineList.length; l++) {
                                            if ($scope.departmentList[k].deptId == $scope.suggestionDet.suggestionHorizontalDept[m].deptId &&
                                                $scope.departmentList[k].lineList[l].lineId == $scope.suggestionDet.suggestionHorizontalDept[m].lineId) {
                                                if (!$scope.departmentList[k].lineList[l].isImplselect) {
                                                    islineDelete = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (islineDelete) {
                                    formData.append("suggestionHorizontalDept[" + horiCount + "].id", $scope.suggestionDet.suggestionHorizontalDept[m].id);
                                    formData.append("suggestionHorizontalDept[" + horiCount + "].deptId", $scope.suggestionDet.suggestionHorizontalDept[m].deptId);
                                    formData.append("suggestionHorizontalDept[" + horiCount + "].suggestionDet.sugId", $scope.suggestionDet.sugId);
                                    formData.append("suggestionHorizontalDept[" + horiCount + "].isAdd", 0);
                                    formData.append("suggestionHorizontalDept[" + horiCount + "].isDelete", 1);
                                    horiCount++;
                                }
                            } else {
                                var islineDelete = false;
                                for (var k = 0; k < $scope.departmentList.length; k++) {
                                    if ($scope.departmentList[k].deptId == $scope.suggestionDet.suggestionHorizontalDept[m].deptId &&
                                        $scope.suggestionDet.suggestionHorizontalDept[m].lineId == 0) {
                                        if (!$scope.departmentList[k].isImplselect) {
                                            islineDelete = true;
                                        }
                                    }
                                }
                                if (islineDelete) {
                                    formData.append("suggestionHorizontalDept[" + horiCount + "].id", $scope.suggestionDet.suggestionHorizontalDept[m].id);
                                    formData.append("suggestionHorizontalDept[" + horiCount + "].deptId", $scope.suggestionDet.suggestionHorizontalDept[m].deptId);
                                    formData.append("suggestionHorizontalDept[" + horiCount + "].suggestionDet.sugId", $scope.suggestionDet.sugId);
                                    formData.append("suggestionHorizontalDept[" + horiCount + "].isAdd", 0);
                                    formData.append("suggestionHorizontalDept[" + horiCount + "].isDelete", 1);
                                    horiCount++;
                                }
                            }
                        }
                    }
                    for (var i = 0; i < $scope.departmentList.length; i++) {
                        if ($scope.departmentList[i].isImplselect && $scope.departmentList[i].lineFound) {
                            for (var j = 0; j < $scope.departmentList[i].lineList.length; j++) {
                                if ($filter('filter')($scope.departmentList[i].lineList, { isImplselect: true }).length == 0) {
                                    $scope.uploadAttachmentModalSpinner = false;
                                    $scope.onHoldImplementationSpinner = true;
                                    $scope.cancleImplementationSpinner = false;
                                    snackbar.create($filter('translate')('Please_select_line_horizontal_deployment'), 6000, "error");
                                    return;
                                }
                            }
                        }
                    }
                }
                // 21-3-2020
                if ($scope.parentSuggType.circleId != 0 && $scope.suggestionDet.sourceType == 'HD') {
                    if ($scope.implMachineHDList != null && $scope.implMachineHDList.length > 0) {
                        for (var l = 0; l < $scope.implMachineHDList.length; l++) {
                            $scope.implMachineHDList[l].machineFound = false;
                            for (let i = 0; i < $scope.suggestionDet.suggestionHorizontalDept.length; i++) {
                                if ($scope.suggestionDet.suggestionHorizontalDept[i].operationId == $scope.implMachineHDList[l].operation.id) {
                                    $scope.implMachineHDList[l].machineFound = true;
                                }
                            }
                            if (!$scope.implMachineHDList[l].machineFound) {
                                if ($scope.implMachineHDList[l].machine != null && $scope.implMachineHDList[l].machine != undefined) {
                                    formData.append("suggestionHorizontalDept[" + horiCount + "].machineId", $scope.implMachineHDList[l].machine.id);
                                } else {
                                    formData.append("suggestionHorizontalDept[" + horiCount + "].machineId", 0);
                                }
                                formData.append("suggestionHorizontalDept[" + horiCount + "].circleId", $scope.implMachineHDList[l].circle.id);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].productId", $scope.implMachineHDList[l].product.id);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].stageId", $scope.implMachineHDList[l].stage.id);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].productNoId", $scope.implMachineHDList[l].productNo.id);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].operationId", $scope.implMachineHDList[l].operation.id);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].suggestionDet.sugId", $scope.suggestionDet.sugId);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].isAdd", 1);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].isDelete", 0);
                                horiCount++;
                            }
                        }
                    }
                }
                if ($scope.parentSuggType.circleId != 0 && $scope.suggestionDet.sourceType == 'HD') {
                    if ($scope.implMachineHDList != null && $scope.implMachineHDList.length > 0) {
                        for (let i = 0; i < $scope.suggestionDet.suggestionHorizontalDept.length; i++) {
                            $scope.suggestionDet.suggestionHorizontalDept[i].isMachineDelete = false;
                            for (var l = 0; l < $scope.implMachineHDList.length; l++) {
                                if ($scope.suggestionDet.suggestionHorizontalDept[i].operationId == $scope.implMachineHDList[l].operation.id) {
                                    $scope.suggestionDet.suggestionHorizontalDept[i].isMachineDelete = true
                                }
                            }
                            if (!$scope.suggestionDet.suggestionHorizontalDept[i].isMachineDelete && $scope.suggestionDet.suggestionHorizontalDept[i].operationId > 0) {
                                formData.append("suggestionHorizontalDept[" + horiCount + "].id", $scope.suggestionDet.suggestionHorizontalDept[i].id);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].machineId", $scope.suggestionDet.suggestionHorizontalDept[i].machineId);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].circleId", $scope.suggestionDet.suggestionHorizontalDept[i].circleId);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].productId", $scope.suggestionDet.suggestionHorizontalDept[i].productId);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].productNoId", $scope.suggestionDet.suggestionHorizontalDept[i].productNoId);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].operationId", $scope.suggestionDet.suggestionHorizontalDept[i].operationId);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].stageId", $scope.suggestionDet.suggestionHorizontalDept[i].stageId);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].suggestionDet.sugId", $scope.suggestionDet.sugId);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].isAdd", 0);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].isDelete", 1);
                                horiCount++;
                            }
                        }
                    }
                }
            }

            // END OF  IMPLEMENTATION HORIZANTAL DEPLOYMENT CHANGE BY SUNANDA 9-11
            if ($scope.particulars != null && $scope.particulars.length > 0) {
                var dataParticular = [];
                var selectedParticulars = $filter('filter')($scope.particulars, { isChecked: true });
                if (selectedParticulars.length > 1) {
                    snackbar.create($filter('translate')('implementer_Can_select_only_one_benefit'), 5000, 'error');
                    $scope.uploadAttachmentModalSpinner = false;
                    $scope.onHoldImplementationSpinner = true;
                    $scope.cancleImplementationSpinner = false;
                    return
                }
                for (let index = 0; index < selectedParticulars.length; index++) {
                    if (selectedParticulars[index].tangible) {
                        var rec = selectedParticulars[index];
                        if (rec.hasOwnProperty('newUnit') && rec.hasOwnProperty('newValue')) {
                            if (rec.newUnit == undefined || rec.newUnit == '' || $scope.isEmpty(rec.newUnit) || rec.newValue == undefined || rec.newValue == '') {
                                snackbar.create($filter('translate')('Please_enter_value_and_unit_for_tangible_benefit'), 5000, 'error');
                                $scope.uploadAttachmentModalSpinner = false;
                                $scope.onHoldImplementationSpinner = true;
                                $scope.cancleImplementationSpinner = false;
                                return;
                            }
                        }
                    }
                }
                for (var i = 0; i < selectedParticulars.length; i++) {
                    if ($scope.suggestionDet.customEvaluationParticularsList != null && $scope.suggestionDet.customEvaluationParticularsList.length > 0) {
                        if ($filter('filter')($scope.suggestionDet.customEvaluationParticularsList, { particular: { id: selectedParticulars[i].id } }).length == 0) {
                            var objt = {
                                id: 0,
                                createdById: $scope.loggedInEmpId,
                                updatedById: 0,
                                points: selectedParticulars[i].points,
                                particular: selectedParticulars[i].id,
                                suggestion: $scope.suggestionDet.sugId,
                                stsId: $scope.CONST.STATUS.ImplementationRequestAccepted.statusId,
                                isActive: 'Y',
                                action: 'ADD',
                                recommendedBy: $scope.loggedInEmpId,
                                roleId: 9,
                                catId: $scope.suggestionDet.selectedEvalCatId,
                                tangible: selectedParticulars[i].tangible
                            }
                            if (selectedParticulars[i].tangible) {
                                objt.unit = selectedParticulars[i].newUnit.unit;
                                objt.masterUnit = {
                                    id: selectedParticulars[i].newUnit.id
                                }
                                objt.value = selectedParticulars[i].newValue;
                                objt.frequency = (selectedParticulars[i].implFrequency) ? selectedParticulars[i].implFrequency.value : selectedParticulars[i].frequency;
                                objt.existingValue = selectedParticulars[i].implExistingValue;
                            }
                            dataParticular.push(objt);

                            // if ($scope.suggestionDet.customEvaluationParticularsList != null && $scope.suggestionDet.customEvaluationParticularsList.length > 0) {
                            //     for (var m = 0; m < $scope.suggestionDet.customEvaluationParticularsList.length; m++) {
                            //         var tmpObj = { id: $scope.suggestionDet.customEvaluationParticularsList[m].id, "action": "DELETE", roleId: 9 };
                            //         tmpObj.recommendedBy = $scope.loggedInEmpId;
                            //         tmpObj.updatedById = $scope.loggedInEmpId;
                            //         tmpObj.isActive = 'N';
                            //         dataParticular.push(tmpObj);
                            //     }
                            // }

                        } else if ($filter('filter')($scope.suggestionDet.customEvaluationParticularsList, { particular: { id: selectedParticulars[i].id } }).length > 0) {
                            if (selectedParticulars[i].tangible) {
                                if (selectedParticulars[i].hasOwnProperty('newUnit') && selectedParticulars[i].hasOwnProperty('newValue')) {
                                    selectedParticulars[i].unit = selectedParticulars[i].newUnit;
                                    selectedParticulars[i].value = selectedParticulars[i].newValue;
                                    selectedParticulars[i].frequency = (selectedParticulars[i].implFrequency) ? selectedParticulars[i].implFrequency.value : selectedParticulars[i].frequency;
                                    selectedParticulars[i].existingValue = selectedParticulars[i].implExistingValue;
                                    if ($scope.checkBenefitsValue(selectedParticulars[i])) {
                                        var objt = {
                                            id: selectedParticulars[i].selectedId,
                                            createdById: $scope.loggedInEmpId,
                                            updatedById: $scope.loggedInEmpId,
                                            points: selectedParticulars[i].points,
                                            particular: selectedParticulars[i].id,
                                            suggestion: $scope.suggestionDet.sugId,
                                            stsId: $scope.CONST.STATUS.ImplementationRequestAccepted.statusId,
                                            isActive: 'Y',
                                            action: 'UPDATE',
                                            recommendedBy: $scope.loggedInEmpId,
                                            roleId: 9,
                                            tangible: selectedParticulars[i].tangible,
                                            unit: selectedParticulars[i].unit.unit,
                                            masterUnit: {
                                                id: selectedParticulars[i].unit.id //unit 8-12-2020
                                            },
                                            value: selectedParticulars[i].value,
                                            frequency: selectedParticulars[i].frequency,
                                            existingValue: selectedParticulars[i].existingValue
                                        }
                                        dataParticular.push(objt);
                                    }
                                }
                            } else {
                                var objt = {
                                    id: selectedParticulars[i].selectedId,
                                    createdById: $scope.loggedInEmpId,
                                    updatedById: $scope.loggedInEmpId,
                                    points: selectedParticulars[i].points,
                                    particular: selectedParticulars[i].id,
                                    suggestion: $scope.suggestionDet.sugId,
                                    stsId: $scope.CONST.STATUS.ImplementationRequestAccepted.statusId,
                                    isActive: 'Y',
                                    action: 'UPDATE',
                                    recommendedBy: $scope.loggedInEmpId,
                                    roleId: 9,
                                    tangible: selectedParticulars[i].tangible
                                }
                                dataParticular.push(objt);
                            }
                        }
                    } else {
                        var objt = {
                            id: 0,
                            createdById: $scope.loggedInEmpId,
                            updatedById: 0,
                            points: selectedParticulars[i].points,
                            particular: selectedParticulars[i].id,
                            suggestion: $scope.suggestionDet.sugId,
                            stsId: $scope.CONST.STATUS.ImplementationRequestAccepted.statusId,
                            isActive: 'Y',
                            action: 'ADD',
                            catId: $scope.suggestionDet.selectedEvalCatId,
                            recommendedBy: $scope.loggedInEmpId,
                            roleId: 9,
                            tangible: selectedParticulars[i].tangible
                        };
                        if (selectedParticulars[i].tangible) {
                            objt.unit = selectedParticulars[i].newUnit.unit;
                            objt.masterUnit = {
                                id: selectedParticulars[i].newUnit.id //unit 8-12-2020
                            }
                            objt.value = selectedParticulars[i].newValue;
                            objt.frequency = selectedParticulars[i].frequency;
                            objt.existingValue = selectedParticulars[i].implExistingValue;
                        }
                        dataParticular.push(objt);
                    }
                }

                if ($scope.suggestionDet.customEvaluationParticularsList != null && $scope.suggestionDet.customEvaluationParticularsList.length > 0) {
                    for (var j = 0; j < $scope.suggestionDet.customEvaluationParticularsList.length; j++) {
                        var obj = $scope.suggestionDet.customEvaluationParticularsList[j].particular;
                        if ($filter('filter')(selectedParticulars, { id: obj.id }).length == 0) {
                            dataParticular.push({
                                id: $scope.suggestionDet.customEvaluationParticularsList[j].id,
                                updatedById: $scope.loggedInEmpId,
                                isActive: 'N',
                                action: 'DELETE',
                                recommendedBy: $scope.loggedInEmpId,
                                roleId: 9
                            });
                        }
                    }
                }
                //console.log(dataParticular);
                // var x = 0;
                // if (x == 0) {
                //     $scope.uploadAttachmentModalSpinner = false;
                //     $scope.onHoldImplementationSpinner = true;
                //     $scope.cancleImplementationSpinner = false;
                //     return;
                // }
                for (var k = 0; k < dataParticular.length; k++) {
                    formData.append("suggParticulars[" + k + "].id", dataParticular[k].id);
                    formData.append("suggParticulars[" + k + "].action", dataParticular[k].action);
                    formData.append("suggParticulars[" + k + "].recommendedBy", dataParticular[k].recommendedBy);
                    if (dataParticular[k].action == "ADD") {
                        formData.append("suggParticulars[" + k + "].catId", dataParticular[k].catId);
                    }
                    formData.append("suggParticulars[" + k + "].roleId", dataParticular[k].roleId);
                    if (dataParticular[k].isActive == 'Y') {
                        formData.append("suggParticulars[" + k + "].createdById", dataParticular[k].createdById);
                        formData.append("suggParticulars[" + k + "].updatedById", dataParticular[k].updatedById);
                        formData.append("suggParticulars[" + k + "].particular.id", dataParticular[k].particular);
                        formData.append("suggParticulars[" + k + "].suggestion.sugId", dataParticular[k].suggestion);
                        formData.append("suggParticulars[" + k + "].stsId", dataParticular[k].stsId);
                        formData.append("suggParticulars[" + k + "].tangible", dataParticular[k].tangible);
                        if (dataParticular[k].tangible) {
                            formData.append("suggParticulars[" + k + "].unit", dataParticular[k].unit);
                            formData.append("suggParticulars[" + k + "].masterUnit.id", dataParticular[k].masterUnit.id);
                            formData.append("suggParticulars[" + k + "].value", dataParticular[k].value);
                            formData.append("suggParticulars[" + k + "].masterUnit.id", dataParticular[k].masterUnit.id);
                            formData.append("suggParticulars[" + k + "].frequency", dataParticular[k].frequency);
                            if (dataParticular[k].existingValue && dataParticular[k].existingValue > 0) {
                                formData.append("suggParticulars[" + k + "].existingValue", dataParticular[k].existingValue);
                            }
                        }
                    }
                    formData.append("suggParticulars[" + k + "].isActive", dataParticular[k].isActive);
                }
            }
            /*-------------------------------finace varicfication require ------------change by sunanda ------------------12-11*/
            if ($scope.suggestionDet.sourceType != 'HD' && $scope.suggestionDet.sourceType != 'GUEST_SUGGESTION') {

                if ($scope.suggFlowConfig.isFinVerifEnbld === 'Y') {
                    if (($rootScope.empDetails.productOrgConfigDet.isThemeCostMandate == 1) && ($scope.suggestionDet.category.isFCVRequired == 'Y') && ($scope.suggestionDet.implfc == undefined || $scope.suggestionDet.implfc == null || !$scope.suggestionDet.implfinanceflow)) {
                        snackbar.create($filter('translate')('Finance_verification_is_require'), 6000, "error");
                        $scope.uploadAttachmentModalSpinner = false;
                        $scope.onHoldImplementationSpinner = true;
                        $scope.cancleImplementationSpinner = false;
                        return;
                    }
                }
            }
            //After Image Manadatory or not 01-04-2024 by @Jayshri Kolase
            if ($scope.implFiles == '' && $rootScope.empDetails.productOrgConfigDet.isBeforeUploadImageOn == 1 && $scope.implBeforFiles == '') {
                snackbar.create($filter('translate')('Please_select_image'), 3000, "error");
                $scope.uploadAttachmentModalSpinner = false;
                $scope.onHoldImplementationSpinner = true;
                $scope.cancleImplementationSpinner = false;
                return;

            }
            //change result & impl action mandatory 7-2-2020

            if (($scope.checkForHdConfig()) && ($scope.implData.implSummary == null || $scope.implData.implSummary == undefined || $scope.implData.implSummary == '')) {
                snackbar.create($filter('translate')('Please_enter_result'), 6000, "error");
                $scope.uploadAttachmentModalSpinner = false;
                $scope.onHoldImplementationSpinner = true;
                $scope.cancleImplementationSpinner = false;
                return;
            }

            if (($scope.implData.implactionSummary == null || $scope.implData.implactionSummary == undefined || $scope.implData.implactionSummary == '') && $scope.suggFlowConfig.isImplActionEnbld == 'Y') {
                snackbar.create($filter('translate')('Please_enter_implementation_action'), 6000, "error");
                $scope.uploadAttachmentModalSpinner = false;
                $scope.onHoldImplementationSpinner = true;
                $scope.cancleImplementationSpinner = false;
                return;
            }
            if (empIdforImplement == null || empIdforImplement == undefined || empIdforImplement == '') {
                snackbar.create($filter('translate')('Please_select_team_members'), 6000, "error");
                $scope.uploadAttachmentModalSpinner = false;
                $scope.onHoldImplementationSpinner = true;
                $scope.cancleImplementationSpinner = false;
                return;
            }

            // ADVIK CHNAEG BY SUNANDA 4-3-2020  
            if ($scope.whyWhyAnalysisforImpl != null) {
                //GMR CHANGE BY @JAYSHRI KOLASE 11-01-2024
                // AAD WHY WHY ANALYSIS
                for (var k = 0; k < $scope.whyWhyAnalysisforImpl.length; k++) {
                    if ($scope.whyWhyAnalysisforImpl[k].whyWhyAnalysis != '') {
                        if ($scope.suggestionDet.suggestionWhyWhyAnalysis != null && $scope.suggestionDet.suggestionWhyWhyAnalysis.length > 0) {
                            for (let h = 0; h < $scope.suggestionDet.suggestionWhyWhyAnalysis.length; h++) {
                                if ($scope.suggestionDet.suggestionWhyWhyAnalysis[h].id == $scope.whyWhyAnalysisforImpl[k].id) {
                                    formData.append("suggestionWhyWhyAnalysis[" + k + "].suggestionWhyWhy.sugId", $scope.suggestionDet.sugId);
                                    formData.append("suggestionWhyWhyAnalysis[" + k + "].createdById", $scope.loggedInEmpId);
                                    formData.append("suggestionWhyWhyAnalysis[" + k + "].stsId", $scope.CONST.STATUS.Implemented.statusId);
                                    formData.append("suggestionWhyWhyAnalysis[" + k + "].name", $scope.whyWhyAnalysisforImpl[k].whyWhyAnalysis);
                                    formData.append("suggestionWhyWhyAnalysis[" + k + "].id", $scope.whyWhyAnalysisforImpl[k].id);
                                    formData.append("suggestionWhyWhyAnalysis[" + k + "].isActived", "Y");
                                }
                                else {
                                    formData.append("suggestionWhyWhyAnalysis[" + k + "].suggestionWhyWhy.sugId", $scope.suggestionDet.sugId);
                                    formData.append("suggestionWhyWhyAnalysis[" + k + "].createdById", $scope.loggedInEmpId);
                                    formData.append("suggestionWhyWhyAnalysis[" + k + "].stsId", $scope.CONST.STATUS.Implemented.statusId);
                                    formData.append("suggestionWhyWhyAnalysis[" + k + "].name", $scope.whyWhyAnalysisforImpl[k].whyWhyAnalysis);
                                    formData.append("suggestionWhyWhyAnalysis[" + k + "].isActived", "Y");
                                }
                            }
                        } else {
                            formData.append("suggestionWhyWhyAnalysis[" + k + "].suggestionWhyWhy.sugId", $scope.suggestionDet.sugId);
                            formData.append("suggestionWhyWhyAnalysis[" + k + "].createdById", $scope.loggedInEmpId);
                            formData.append("suggestionWhyWhyAnalysis[" + k + "].stsId", $scope.CONST.STATUS.Implemented.statusId);
                            formData.append("suggestionWhyWhyAnalysis[" + k + "].name", $scope.whyWhyAnalysisforImpl[k].whyWhyAnalysis);
                            formData.append("suggestionWhyWhyAnalysis[" + k + "].isActived", "Y");
                        }
                    }
                }
                //GMR CHANGE BY @JAYSHRI KOLASE 11-01-2024
                // DELETE WHY WHY ANALYSIS
                if ($scope.suggestionDet.suggestionWhyWhyAnalysis && $scope.suggestionDet.suggestionWhyWhyAnalysis.length > 0) {
                    for (let h = 0; h < $scope.suggestionDet.suggestionWhyWhyAnalysis.length; h++) {
                        const isPresentInWhyWhyAnalysisforImpl = $scope.whyWhyAnalysisforImpl && $scope.whyWhyAnalysisforImpl.some(impl => impl.id === $scope.suggestionDet.suggestionWhyWhyAnalysis[h].id);
                        if (!isPresentInWhyWhyAnalysisforImpl) {
                            // If the element is not present in $scope.whyWhyAnalysisforImpl, deactivate it
                            formData.append("suggestionWhyWhyAnalysis[" + h + "].suggestionWhyWhy.sugId", $scope.suggestionDet.sugId);
                            formData.append("suggestionWhyWhyAnalysis[" + h + "].createdById", $scope.loggedInEmpId);
                            formData.append("suggestionWhyWhyAnalysis[" + h + "].stsId", $scope.CONST.STATUS.Implemented.statusId);
                            formData.append("suggestionWhyWhyAnalysis[" + h + "].name", $scope.suggestionDet.suggestionWhyWhyAnalysis[h].name);
                            formData.append("suggestionWhyWhyAnalysis[" + h + "].id", $scope.suggestionDet.suggestionWhyWhyAnalysis[h].id);
                            formData.append("suggestionWhyWhyAnalysis[" + h + "].isActived", "N");
                        }
                    }
                }
            }
            if ($scope.suggestionDet.whatToDo != null && $scope.suggestionDet.whatToDo != undefined && $scope.suggestionDet.whatToDo != '') {
                formData.append("whatToDo", $scope.suggestionDet.whatToDo);
            }
            if ($scope.suggestionDet.howToDo != null && $scope.suggestionDet.howToDo != undefined && $scope.suggestionDet.howToDo != '') {
                formData.append("howToDo", $scope.suggestionDet.howToDo);
            }
            if ($scope.suggestionDet.benefits != null && $scope.suggestionDet.benefits != undefined && $scope.suggestionDet.benefits != '') {
                formData.append("benefits", $scope.suggestionDet.benefits);
            }
            if ($scope.suggestionDet.results != null && $scope.suggestionDet.results != undefined && $scope.suggestionDet.results != '') {
                formData.append("results", $scope.suggestionDet.results);
            }
            if ($scope.suggestionDet.kaizenIdea != null && $scope.suggestionDet.kaizenIdea != undefined && $scope.suggestionDet.kaizenIdea != '') {
                formData.append("kaizenIdea", $scope.suggestionDet.kaizenIdea);
            }
            if ($scope.suggestionDet.frquency != null && $scope.suggestionDet.frquency != undefined && $scope.suggestionDet.frquency != '') {
                formData.append("frquency", $scope.suggestionDet.frquency);
            }
            if ($scope.suggestionDet.counterMeasures != null && $scope.suggestionDet.counterMeasures != undefined && $scope.suggestionDet.counterMeasures != '') {
                formData.append("counterMeasures", $scope.suggestionDet.counterMeasures);
            }
            if ($scope.suggestionDet.rootCause != null && $scope.suggestionDet.rootCause != undefined && $scope.suggestionDet.rootCause != '') {
                formData.append("rootCause", $scope.suggestionDet.rootCause);
            }
            if ($scope.suggestionDet.pcnNumber && $scope.suggFlowConfig.isPCNNoEnbld == "Y") {
                formData.append("pcnNo", $scope.suggestionDet.pcnNumber);
                // 26-01.2024 by Jayshri Kolase. (Request body updated to capture PCN no.)
            }
            // ADVIK 7-3-2020  RESULT IMAGE CHANGE 
            if ($scope.resultImageFiles.length > 0) {
                for (var i in $scope.resultImageFiles) {
                    formData.append("resultDoc", $scope.resultImageFiles[i]);
                }
            }
            var canvas = $("#resultImageGraph").get(0);
            if (canvas != null && canvas != undefined && canvas != '') {
                var dataURL = canvas.toDataURL();
                formData.append("resultImageBase64", dataURL);
            }
            //Sustenance Check
            if ($scope.suggFlowConfig.kaizenCheckReqImpl == 'Y' && $scope.suggestionDet.implSustenanceflow != undefined && $scope.suggestionDet.implSustenanceflow != null && $scope.suggestionDet.implSustenanceflow) {
                if ($scope.suggestionDet.sustenanceAuditorId == undefined || $scope.suggestionDet.sustenanceAuditorId == null || $scope.suggestionDet.sustenanceAuditorId == '') {
                    snackbar.create($filter('translate')('Please_select_sustenance_auditor'), 6000, "error");
                    $scope.flagTeamDetPopupSpinner = false;
                    $scope.uploadAttachmentModalSpinner = false;
                    return;
                } else {
                    // 7-12-2020
                    formData.append("kaizenSusReqByImplementer", $scope.suggestionDet.implSustenanceflow);
                    formData.append("sustenanceAuditorId", $scope.suggestionDet.sustenanceAuditorId);
                }
            }
        } else if ($scope.implTab == 2) {
            $scope.flaghold = false;
            if ($scope.implData.onHoldImplSummary == '' || $scope.implData.onHoldImplSummary == undefined || $scope.implData.onHoldImplSummary == null) {
                $scope.flaghold = true;
                angular.element("#holdId")
                    .text($filter('translate')('Please_enter_on_hold_comment'));
                return;
            }
            $scope.onHoldImplementationSpinner = true;
            formData.append("summary", $scope.implData.onHoldImplSummary);
        } else if ($scope.implTab == 3) {
            $scope.flagcancelsugg = false;
            if ($scope.implData.rejectionReason == '' || $scope.implData.rejectionReason == undefined || $scope.implData.rejectionReason == null) {
                $scope.flagcancelsugg = true;
                angular.element("#cancelId")
                    .text($filter('translate')('Please_enter_reject_suggestion_comment'));
                return;
            }
            $scope.cancleImplementationSpinner = true;
            formData.append("rejectionReason", $scope.implData.rejectionReason);
        }

        /* Change 5 */

        $scope.isBeforeUploadImageOn = $rootScope.empDetails.productOrgConfigDet.isBeforeUploadImageOn;
        if ($scope.CONST.STATUS.Implemented.statusId == statusId && ($scope.implFiles == '' && $scope.implBeforFiles == '') && $rootScope.empDetails.productOrgConfigDet.isBeforeUploadImageOn == 1) {
            // snackbar.create("Please select image", 3000, "error");
            snackbar.create($filter('translate')('Please_select_image'), 3000, "error");
            $scope.uploadAttachmentModalSpinner = false;
            return;
        }
        //console.log($scope.suggestionHorizontalDept);
        // Display the key/value pairs
        // for (var pair of formData.entries()) {
        //     //console.log(pair[0] + ', ' + pair[1]);
        // }
        // var x = 0;
        // if (x == 0) {
        //     $scope.uploadAttachmentModalSpinner = false;
        //     $scope.onHoldImplementationSpinner = true;
        //     $scope.cancleImplementationSpinner = false;
        //     return;
        // }
        formData.append("stsAuditId", $scope.suggestionDet.sugesstionStatusAudit[$scope.suggestionDet.sugesstionStatusAudit.length - 1].stsadtId);
        formData.append("orgId", $rootScope.empDetails.organization.orgId);
        $scope.implUrl = "";
        if ($scope.suggestionDet.sugesstionStatusAudit[$scope.suggestionDet.sugesstionStatusAudit.length - 1].status_master.status == $scope.CONST.STATUS.ReassignedToImplPostVerification.status) {
            //console.log($scope.suggestionDet)
            $scope.implUrl = "reassignImplSubmission";
        }
        else {
            $scope.implUrl = "implement";
        }
        // let x = 0;
        // if (x === 0) {
        //     console.log($scope.implUrl);
        //     return;
        // }
        appService.uploadFileToUrl(formData, $scope.implUrl)
            .then(function (response) {
                $scope.implMachineHDList = [];
                $scope.implData.safetImplactionSummary = null;
                $scope.uploadAttachmentModalSpinner = false;
                $scope.onHoldImplementationSpinner = true;
                $scope.cancleImplementationSpinner = false;
                if (response.data.result) {
                    $('#implementedModal').modal('hide');
                    $(".modal-backdrop").remove();
                    $scope.whyWhyAnalysisforImpl = [{
                        whyWhyAnalysis: ''
                    }];
                    $scope.resultImageFiles = [];
                    $scope.implFiles = [];
                    if ($scope.implTab == 1) {
                        if (response.data.statusId == $scope.CONST.STATUS.PendingDocumentUpdate.statusId) {
                            snackbar.create($filter('translate')('Suggestion_implemented_document_update'), 5000, "success");
                        } else if (response.data.statusId == $scope.CONST.STATUS.AssignedForFCVerification.statusId) {
                            snackbar.create($filter('translate')('Suggestion_assigned_to_Finance_Controller_successfully'), 5000, "success");
                        } else if (response.data.statusId == $scope.CONST.STATUS.AssignedToImplementorForHorizantalDeployement.statusId) {
                            snackbar.create($filter('translate')('Suggestion_successfully_assigned_deployment'), 5000, "success");
                        } else if (response.data.statusId == $scope.CONST.STATUS.AssignedForSustainanceCheck.statusId) {
                            snackbar.create($filter('translate')('Suggestion_assigned_for_sustainance_check'), 5000, "success");
                        } else {
                            if ($scope.suggFlowConfig.isImplVerifEnbld == "Y") {
                                snackbar.create($filter('translate')('Suggestion_assigned_for_implementation_verification_successfully'), 5000, "success");
                            } else {
                                snackbar.create($filter('translate')('Suggestion_implemented_successfully'), 5000, "success");
                            }

                        }
                        $scope.implFiles = [];
                        $scope.selectedEmpList = [];

                        // 11-11 chnage
                        for (var i = 0; i < $scope.employeeList.length; i++) {
                            $scope.employeeList[i].isSelected = false;
                        }

                    }
                    if ($scope.implTab == 2) {
                        snackbar.create($filter('translate')('Suggestion_is_on_hold'), 5000, "success");
                    }
                    if ($scope.implTab == 3) {
                        snackbar.create($filter('translate')('Suggestion_cancelled_successfully'), 5000, "success");
                    }
                    $scope.dashboardData = {}
                    $scope.dashboardData.selectedTypeId = $scope.graphTypeList[0];
                    if ($scope.departmentList != null && $scope.departmentList.length > 0) {
                        for (let i = 0; i < $scope.departmentList.length; i++) {
                            $scope.departmentList[i].isImplselect = false;
                        }
                    }
                    // $scope.getSuggestionDetails($scope.selectedSuggId);
                    $scope.getsuggestionList('onUpdate');
                    $scope.getStatusWiseCount();
                }
                else if (response.data.reason == "Implementation Verifier Setup Not Found") {
                    snackbar.create($filter('translate')('Implementation Verifier setup not found for this department. Please add implementation verifier (Go to Setup & config -> Suggestions -> Implementation Verification)'), 5000, "error");

                } else {
                    if (response.data.statusCode == 100) {
                        snackbar.create(response.data.reason, 5000, "error");
                    } else {
                        snackbar.create('Error occured while submitting data. Please try again.', 5000, "error");
                    }
                    // if ($scope.implTab == 1) {
                    //     snackbar.create($filter('translate')('Oops_Please_try_again'), 5000, "error");
                    // } else if ($scope.implTab == 2) {
                    //     snackbar.create($filter('translate')('Oops_Please_try_again'), 5000, "error");
                    // } else if ($scope.implTab == 3) {
                    //     snackbar.create($filter('translate')('Oops_Please_try_again'), 5000, "error");
                    // }
                }
            });
    }

    /*-------------------Onhold-------------------------------*/

    $scope.change_flagonhlodreject = function () {
        if ($scope.implData.onHoldImplSummary == '') {
            $scope.flagcancelholdsugg = true;
        } else {
            $scope.flagcancelholdsugg = false;
        }
    }

    $scope.change_flagonhlodresume = function () {
        if ($scope.implData.onHoldImplSummary == '') {
            $scope.flagcancelresumesugg = true;
        } else {
            $scope.flagcancelresumesugg = false;
        }
    }

    $scope.changefurtheronhold = function () {
        var today = new Date();
        var nextDay = new Date(today);
        nextDay.setDate(today.getDate() + 1);
        angular.element('.toDate_datepicker')
            .datepicker({
                format: "yyyy-mm-dd",
                startDate: nextDay,
                autoclose: true
            })
        angular.element('.toDate_datepicker')
            .datepicker('setStartDate', nextDay);

    }

    $scope.suggestionhold = function (statusId) {
        if ($scope.implTab == 2) {
            $scope.flaghold = false;
            if ($scope.implData.onHoldImplSummary == '' || $scope.implData.onHoldImplSummary == undefined || $scope.implData.onHoldImplSummary == null) {
                $scope.flaghold = true;
                // angular.element("#holdId")
                //     .text("Please enter on hold comment");
                return;
            }

            $scope.flagonhold = false;
            if ($scope.implData.onholdDate == '' || $scope.implData.onholdDate == undefined || $scope.implData.onholdDate == null) {
                $scope.flagonhold = true;
                // angular.element("#errId_hold")
                //     .text("Please select on hold date.");
                return;
            }
        }

        if ($scope.flagrejectonhold) {
            $scope.flagcancelholdsugg = false;
            if ($scope.implData.onHoldImplSummary == '' || $scope.implData.onHoldImplSummary == undefined || $scope.implData.onHoldImplSummary == null) {
                $scope.flagcancelholdsugg = true;
                // angular.element("#rejectonhold")
                //     .text("Please enter rejection reason.");
                return;
            }
        }
        var selectedEmpId = '';
        if ($scope.flagresumeonhold) {
            $scope.flagcancelresumesugg = false;
            if ($scope.implData.onHoldImplSummary == '' || $scope.implData.onHoldImplSummary == undefined || $scope.implData.onHoldImplSummary == null) {
                $scope.flagcancelresumesugg = true;
                // angular.element("#resume_hold")
                //     .text("Please enter resume reason.");
                return;
            }
            // $.each($("input[name='onHoldEmpChk']:checked"), function () {
            //     selectedEmpId = parseInt($(this).val());
            // });
            selectedEmpId = ($scope.empInputDet.selectedEmpIds != null && $scope.empInputDet.selectedEmpIds.length > 0) ? $scope.empInputDet.selectedEmpIds[0] : '';
            if (selectedEmpId == '') {
                $scope.flagSelectTeamMem = true;
                return;
                //snackbar.create('Please select employee', 3000, "error");
            }
        } else {
            selectedEmpId = parseInt($scope.loggedInEmpId);
        }

        if ($scope.flagFurtherhold) {
            $scope.flagfurtherhold = false;
            if ($scope.implData.onHoldImplSummary == '' || $scope.implData.onHoldImplSummary == undefined || $scope.implData.onHoldImplSummary == null) {
                $scope.flagfurtherhold = true;
                // angular.element("#holdId")
                //     .text("Please enter on hold comment");
                return;
            }

            $scope.flagfurtherholddate = false;
            if ($scope.implData.onholdDate == '' || $scope.implData.onholdDate == undefined || $scope.implData.onholdDate == null) {
                $scope.flagfurtherholddate = true;
                // angular.element("#errId_hold")
                //     .text("Please select on hold date.");
                return;
            }
        }


        $scope.data = {
            "branchId": $scope.suggestionDet.branch.branchId, //$scope.loggedInUserBranchId,
            "statusId": statusId,
            "sugId": $scope.selectedSuggId,
            "onHoldDateString": $filter('date')(new Date($scope.implData.onholdDate), 'yyyy-MM-dd'),
            "empId": $rootScope.empDetails.empId,
            "assignedById": selectedEmpId, //parseInt($scope.loggedInEmpId),
            "summary": $scope.implData.onHoldImplSummary
        };
        $scope.onHoldImplSpinner = true;
        appService.httpPost($scope.data, "onHoldSuggestionFlow")
            .then(function (response) {
                $scope.onHoldImplSpinner = false;
                $scope.flagFurtherhold = false;
                if (response.result) {
                    if (statusId == 110) {
                        snackbar.create($filter('translate')('Suggestion_accepted_for_on_hold'), 5000, "success");
                    } else if (statusId == 113) {
                        snackbar.create($filter('translate')('On_hold_suggestion_rejected_successfully'), 5000, "success");
                    } else if (statusId == 111) {
                        snackbar.create($filter('translate')('On_hold_suggestion_resume_successfully'), 5000, "success");
                        $('#onHoldImplModal').modal('hide');
                    } else if (statusId == 21) {
                        snackbar.create($filter('translate')('Suggestion_kept_on_hold_successfully'), 5000, "success");
                    }
                    $('#onHoldModal').modal('hide');
                    // $scope.getSuggestionDetails($scope.selectedSuggId);
                    $scope.getsuggestionList('onUpdate');
                    $scope.getStatusWiseCount();
                } else {
                    snackbar.create($filter('translate')('Oops_Please_try_again'), 5000, "error");
                }
            });
    }

    /*---------------Onhold PersonList--------------------*/
    $scope.getonholdsetuplist = function () {
        $scope.flagEmployeeListSpinner = true;
        appService.httpGet("getSugOnHoldSetupList/" + $rootScope.empDetails.branch.branchId)
            .then(function (response) {
                $scope.flagEmployeeListSpinner = false;
                $scope.flagTblemployee = true;
                if (response.result) {
                    $scope.onholdList = response.list;
                    for (var i = 0; i < $scope.onholdList.length; i++) {
                        if ($scope.onholdList[i].empId == $scope.loggedInEmpId) {
                            $scope.onholdflag = true;
                        }
                    }
                } else {
                    $scope.onholdList = [];
                }
            });
    }
    /*---------------------------------------------------------------------------------*/
    $scope.change_flag_changeDoc = function (input) {
        if (input == '' || input == undefined || input == null) {
            $scope.flagChangeDocText = true;
        } else {
            $scope.flagChangeDocText = false;
        }
    }

    $scope.change_flag_fileName = function (input) {
        if (input == '' || input == undefined || input == null) {
            $scope.flagChangeDocName = true;
        } else {
            $scope.flagChangeDocName = false;
        }
    }

    $scope.documentChanged = function (data) {
        var formData = new FormData();
        var tempStsTrackId = 0;

        if (data.document.fileName == '' || data.document.fileName == undefined || data.document.fileName == null) {
            snackbar.create($filter('translate')('Please_enter_file_name'), 5000, "error");
            return
        } else {
            $scope.flagChangeDocName = false;
        }
        if (data.document.summary == '' || data.document.summary == undefined || data.document.summary == null) {
            snackbar.create($filter('translate')('Please_enter_document_details'), 5000, "error");
            return;
        } else {
            $scope.flagChangeDocText = false;
        }
        for (var i = 0; i < $scope.suggestionDet.implTeamList.length; i++) {
            if ($scope.suggestionDet.implTeamList[i].statusAuditId == $scope.implAssignedStatusAdtId) {
                tempStsTrackId = $scope.suggestionDet.implTeamList[i].sugTrackId;
            }
        }
        var implementerId = 0;
        for (var i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
            if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.ImplementationRequestAccepted.status) {
                implementerId = $scope.suggestionDet.sugesstionStatusAudit[i].emp_details.empId;
                break;
            }
        }
        formData.append("statusId", $scope.CONST.STATUS.PendingDocumentUpdate.statusId);
        formData.append("teamTypeId", $scope.CONST.TEAM_TYPE.IMPLEMENTATION);
        formData.append("sugId", $scope.selectedSuggId);
        formData.append("implementedbyId", implementerId);
        formData.append("updatedBy", implementerId);
        formData.append("empId", $scope.suggestionDet.emp_details.empId);
        formData.append("suggtrackId", tempStsTrackId);
        formData.append("docUpdateStatus", true);
        formData.append("branchId", $scope.suggestionDet.branch.branchId);
        formData.append("fileName", data.document.fileName);
        formData.append("summary", data.document.summary);
        formData.append("auditId", data.audit.stsadtId);
        formData.append("documentId", data.document.id);
        // formData.append("orgId", $scope.loggedInUserOrgId);
        $scope.changesCompleted = true;
        appService.uploadFileToUrl(formData, "implement")
            .then(function (response) {
                $scope.changesCompleted = false;
                if (response.data.result) {
                    if ($scope.CONST.STATUS.PendingDocumentUpdate.statusId == response.data.statusId) {
                        snackbar.create($filter('translate')('Document_updated_successfully'), 5000, "success");
                    } else if (response.data.statusId == $scope.CONST.STATUS.AssignedForFCVerification.statusId) {
                        snackbar.create($filter('translate')('Suggestion_assigned_to_Finance_Controller_successfully'), 5000, "success");
                    } else {
                        snackbar.create($filter('translate')('Suggestion_implemented_successfully_document_change'), 5000, "success");
                    }
                    $scope.implFiles = [];
                    // $scope.getSuggestionDetails($scope.selectedSuggId);
                    $scope.getsuggestionList('onUpdate');
                    $scope.getStatusWiseCount();
                } else {
                    if (response.data.statusCode == 100) {
                        snackbar.create(response.reason, 5000, "error");
                    } else {
                        snackbar.create($filter('translate')('Oops_Please_try_again'), 5000, "error");
                    }
                }
            });

    }

    //Auto Refresh after 8 sec
    // setInterval(function(){
    //     $scope.getStatusWiseCount();
    //     $scope.getsuggestionList('onAutoLoad');
    // }, 11000); // 8 seconds

    $scope.rejectSugg = function () {
        if ($scope.suggestionDet.closesummery == '') {
            $scope.flagreject = true;
        } else {
            $scope.flagreject = false;
        }
    }

    $scope.suggestionRequestClosed = function () {
        $scope.flagcancleImplementationSpinner = true;
        $scope.data = {
            statusId: $scope.CONST.STATUS.ImplementationRequestRejected.statusId,
            sugId: $scope.selectedSuggId,
            assignedById: parseInt($scope.loggedInEmpId),
            // summary: $scope.suggestionDet.closesummery,
            // suggReasonIds: $scope.selectRejArray
        }
        if ($scope.isImplementerRej == true) {
            if ($scope.suggestionDet.closesummery == '' || $scope.suggestionDet.closesummery == null || $scope.suggestionDet.closesummery == undefined) {
                $scope.flagreject = true;
                angular.element("#cancelIddata")
                    .text("Please enter rejection reason.");
                return;
            }
            else {
                $scope.data.summary = $scope.suggestionDet.closesummery
            }
        }
        else if ($scope.isImplementerRej == false) {
            if ($scope.count == 0) {
                // if($scope.count == 0){
                snackbar.create("Please select rejection reason from list", 3000, "error");
                return;
                //}
            }
            else {
                $scope.data.suggReasonIds = $scope.selectRejArray;
            }
        }
        //console.log($scope.data);
        appService.httpPost($scope.data, "closedSuggestion").then(function (response) {
            $scope.flagcancleImplementationSpinner = false;
            $scope.flagreject = false;
            if (response.result) {
                $("#implRejectedModal")
                    .modal('hide');
                $(".modal-backdrop").remove();
                snackbar.create($filter('translate')('Suggestion_closed_successfully'), 5000, "success");
                $scope.suggestionDet = {};
                $scope.getsuggestionList('onUpdate');
                $scope.getStatusWiseCount();
            } else {
                if (response.statusCode == 100) {
                    snackbar.create(response.reason, 5000, "error");
                } else {
                    snackbar.create($filter('translate')('Oops_Please_try_again'), 5000, "error");
                }
            }
        });
    }
    $scope.exportDatePicker = {
        fromDt: moment().subtract(6, 'months'),
        toDt: moment(),
        currentDate: moment()
    }
    $scope.exportDatePickerOpt = {
        fromOpt: {
            "singleDatePicker": true,
            "maxDate": moment(),
            "locale": {
                format: "YYYY-MM-DD"
            },
            eventHandlers: {
                'hide.daterangepicker': function (event, picker) {
                    if ($scope.exportDatePicker.fromDt) {
                        var fromdate = moment($scope.exportDatePicker.fromDt);
                        // $scope.exportDatePicker.fromCurrentDate = moment($scope.exportDatePicker.fromDt).add(6, 'months');
                        // var toDate = moment($scope.exportDatePicker.fromDt).add(6, 'months');
                        // if ($scope.exportDatePicker.currentDate.diff(toDate) >= 0) {
                        //     $scope.exportDatePicker.toDt = moment(toDate).format('YYYY-MM-DD');
                        // } else {
                        //     $scope.exportDatePicker.toDt = moment().format('YYYY-MM-DD');
                        // }
                    }
                }
            }
        },
        toOpt: {
            "singleDatePicker": true,
            "maxDate": moment(),
            "locale": {
                format: "YYYY-MM-DD"
            },
            eventHandlers: {
                'hide.daterangepicker': function (event, picker) {
                    // if ($scope.exportDatePicker.toDt) {
                    //     $scope.exportDatePicker.fromDt = moment($scope.exportDatePicker.toDt).subtract(6, 'months').format('YYYY-MM-DD');
                    // }
                }
            }
        },
    };
    $scope.openExportSuggModal = function () {
        //console.log($scope.suggDetailModel.fromDt + '==' + $scope.suggDetailModel.toDt);
        $scope.exportModalSpinner = false;
        if ($scope.suggDetailModel.fromDt && $scope.suggDetailModel.toDt) {
            var fromDt = moment($scope.suggDetailModel.fromDt);
            var toDt = moment($scope.suggDetailModel.toDt);
            var diffInMonths = toDt.diff(fromDt, 'months');
            if (diffInMonths < 6 || diffInMonths == 6) {
                $scope.exportDatePicker.fromDt = $scope.suggDetailModel.fromDt;
                $scope.exportDatePicker.toDt = $scope.suggDetailModel.toDt;
            } else {
                //console.log('Check which date select');
                $scope.setFromDate();
                $scope.setToDate();
            }
        } else {
            //console.log('Set default 6 month Date');
            $scope.setFromDate();
            $scope.setToDate();
        }
        // $scope.exportDatePicker.fromDt = moment().subtract(6, 'months');
        // $scope.exportDatePicker.toDt = moment();
        $("#exportSuggModal").modal({
            backdrop: 'static',
            keyboard: false
        });
    }
    $scope.setFromDate = function () {
        $('#fromDate').datepicker({
            format: "yyyy-mm-dd",
            autoclose: true,
        }).on('changeDate', function (e) {
            var selectedDate = new Date($('#fromDate').datepicker('getDate'));
            $scope.exportDatePicker.fromDt = moment(selectedDate).format('YYYY-MM-DD');
        });
        var fromDate = moment().subtract(6, 'months').format('YYYY-MM-DD');
        $('#fromDate').val(fromDate);
    };

    $scope.setToDate = function () {
        $('#toDate').datepicker({
            format: "yyyy-mm-dd",
            autoclose: true,
        }).on('changeDate', function (e) {
            var selectedDate = new Date($('#toDate').datepicker('getDate'));
            $scope.exportDatePicker.toDt = moment(selectedDate).format('YYYY-MM-DD');
        });
        var toDate = moment().format('YYYY-MM-DD');
        $('#toDate').val(toDate);
    };
    $scope.exportData = function () {
        if ($scope.exportDatePicker.fromDt && $scope.exportDatePicker.toDt) {
            var fromDt = moment($scope.exportDatePicker.fromDt);
            var toDt = moment($scope.exportDatePicker.toDt);
            var diffInMonths = toDt.diff(fromDt, 'months');
            if (diffInMonths < 6 || diffInMonths == 6) {
                var today = new Date();
                var date = today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate();
                var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
                var dateTime = date + ' ' + time;
                var exportDataTmp = [];
                var data = {
                    orgId: $scope.loggedInUserOrgId,
                    typeId: $scope.statusCountFilter,
                    assignedToId: $scope.loggedInEmpId,
                    catId: 0,
                    deptId: 0,
                    //statusIds: [],
                    branchIds: [],
                };
                if ($scope.exportDatePicker.fromDt && $scope.exportDatePicker.toDt) {
                    data.fromDt = moment($scope.exportDatePicker.fromDt).format('YYYY-MM-DD') + ' 00:00:00';
                    data.toDt = moment($scope.exportDatePicker.toDt).format('YYYY-MM-DD') + ' 23:59:59';
                }
                if ($scope.statusCountFilter == 2 || $scope.statusCountFilter == 4) {
                    data.type = 'EXCEL_EXPORT';
                }
                var exporturl = "";
                if ($scope.statusCountFilter > 0) {
                    exporturl = "getsuggestionlistnew";
                } else {
                    exporturl = "getallsuggestion";
                }
                if ($scope.suggestionPagination.selectedCatId > 0) {
                    data.catId = $scope.suggestionPagination.selectedCatId;
                } else {
                    delete data.catId;
                    data.processType = " ",
                        data.processType = $scope.suggDetailModel.selectedCategoryName;
                }
                if (data.processType == '' || data.processType == null || data.processType == undefined) {
                    delete data.processType;
                }
                if ($scope.suggestionPagination.selectedDeptId > 0) {
                    data.deptId = $scope.suggestionPagination.selectedDeptId;
                } else {
                    delete data.deptId;
                }

                if ($scope.statusCountFilter == 9) {
                    if ($scope.suggestionPagination.selectedStatus != null && $scope.suggestionPagination.selectedStatus != "" && $scope.suggestionPagination.selectedStatus.statusId != undefined) {
                        var data = [$scope.suggestionPagination.selectedStatus.statusId]
                        $scope.data.statusIds = data;
                    } else {
                        delete $scope.data.statusIds;
                    }
                } else {
                    var statusIds = [];
                    if ($scope.suggDetailModel.statusList != null && $filter('filter')($scope.suggDetailModel.statusList, { isSelected: true }, true).length > 0) {
                        for (let index = 0; index < $scope.suggDetailModel.statusList.length; index++) {
                            if ($scope.suggDetailModel.statusList[index].isSelected && $scope.suggDetailModel.statusList[index].label != 'All') {
                                statusIds.push($scope.suggDetailModel.statusList[index].statusId);
                            }
                        }
                        $scope.data.statusIds = statusIds;
                    }
                }
                if ($scope.accessBranchList != null || $scope.accessBranchList != undefined) {
                    for (var index = 0; index < $scope.accessBranchList.length; index++) {
                        if ($scope.accessBranchList[index].isSelected) {
                            data.branchIds.push($scope.accessBranchList[index].branchId);
                        }
                    }
                } else {
                    data.branchIds.push($scope.loggedInUserBranchId);
                }
                if ($scope.suggDetailModel.selectedLevel != null && $scope.suggDetailModel.selectedLevel != undefined && $scope.suggDetailModel.selectedLevel != '') {
                    data.suggestionLevel = $scope.suggDetailModel.selectedLevel.level;
                }
                // if ($scope.suggDetailModel.hasOwnProperty('searchBy') && !$scope.isEmpty($scope.suggDetailModel.searchBy) && $scope.suggDetailModel.searchBy != '' && $scope.suggDetailModel.searchBy.id == 2) {
                //     data.srchKey = 'SRCH_BY_EMP_ID';
                // }
                // if ($scope.suggDetailModel.searchById) {
                //     data.srchKey = 'SRCH_BY_SUGG_NUMBER';
                //     data.suggNum = $scope.suggDetailModel.suggestionNumber
                // }
                if ($scope.suggDetailModel.hasOwnProperty('searchBy') && !$scope.isEmpty($scope.suggDetailModel.searchBy)) {
                    if ($scope.suggDetailModel.searchBy != '' && $scope.suggDetailModel.searchBy.id == 2) {
                        data.srchKey = 'SRCH_BY_EMP_ID';
                        data.typeId = $scope.selectedFilter.filterId;
                    } else if ($scope.suggDetailModel.searchBy != '' && $scope.suggDetailModel.searchBy.id == 1 && ($scope.suggDetailModel.suggestionNumber != undefined && $scope.suggDetailModel.suggestionNumber != "")) {
                        data.srchKey = 'SRCH_BY_SUGG_NUMBER';
                        if ($scope.suggDetailModel.searchById) {
                            data.suggNum = $scope.suggDetailModel.suggestionNumber;
                            data.typeId = $scope.selectedFilter.filterId;
                        }
                    } else if ($scope.suggDetailModel.searchBy != '' && $scope.suggDetailModel.searchBy.id == 3 && ($scope.suggDetailModel.suggestionNumber != undefined && $scope.suggDetailModel.suggestionNumber != "")) {
                        data.srchKey = 'SRCH_BY_COMPANY_EMP_ID';
                        if ($scope.suggDetailModel.searchById) {
                            data.companyEmpNum = ($scope.suggDetailModel.suggestionNumber);
                            data.typeId = $scope.selectedFilter.filterId;
                        }
                    } else if ($scope.suggDetailModel.searchBy != '' && $scope.suggDetailModel.searchBy.id == 4 && ($scope.suggDetailModel.suggestionNumber != undefined && $scope.suggDetailModel.suggestionNumber != "")) {
                        data.srchKey = 'SRCH_BY_EMP_NAME';
                        if ($scope.suggDetailModel.searchById) {
                            data.empName = $scope.suggDetailModel.suggestionNumber;
                            data.typeId = $scope.selectedFilter.filterId;
                        }
                    } else if ($scope.suggDetailModel.searchBy != '' && $scope.suggDetailModel.searchBy.id == 5 && ($scope.suggDetailModel.suggestionNumber != undefined && $scope.suggDetailModel.suggestionNumber != "")) {
                        data.srchKey = 'SRCH_BY_SUGG_TITLE';
                        if ($scope.suggDetailModel.searchById) {
                            data.suggestionTitle = $scope.suggDetailModel.suggestionNumber;
                            data.typeId = $scope.selectedFilter.filterId;
                        }
                    }
                }
                var suggestionListExport = [];
                $scope.exportModalSpinner = true;
                appService.httpPost(data, exporturl)
                    .then(function (response) {
                        // $scope.exportModalSpinner = false;
                        if (response.result) {
                            // $scope.exportDatePicker.fromDt = "";
                            // $scope.exportDatePicker.toDt = "";
                            suggestionListExport = response.sugessionsByEmpIdList;
                            if ($scope.selectedFilter.filterId == 9) {

                                for (var i = 0; i < suggestionListExport.length; i++) {
                                    if (suggestionListExport[i].kaizenVerificationDate != null && suggestionListExport[i].kaizenVerificationDate != undefined) {
                                        suggestionListExport[i].kaizenVerificationDate = $filter('date')(new Date(suggestionListExport[i].kaizenVerificationDate), 'dd/MM/yyyy');
                                    } else {
                                        suggestionListExport[i].kaizenVerificationDate = ''
                                    }
                                    if (suggestionListExport[i].iskaizenExist != null && suggestionListExport[i].iskaizenExist != undefined && suggestionListExport[i].iskaizenExist == 'Y') {
                                        suggestionListExport[i].iskaizenExist = 'Live';
                                    } else {
                                        suggestionListExport[i].iskaizenExist = "Doesn't Exist"
                                    }
                                    if (suggestionListExport[i].lastConfirmationDate != undefined && suggestionListExport[i].lastConfirmationDate != null && suggestionListExport[i].lastConfirmationDate != '') {
                                        suggestionListExport[i].lastConfirmationDate = $filter('date')(new Date(suggestionListExport[i].lastConfirmationDate), "dd-MM-yyyy")
                                    } else {
                                        suggestionListExport[i].lastConfirmationDate = '-';
                                    }
                                    var auditorName = suggestionListExport[i].susAuditorName;
                                    if (!auditorName || auditorName == " ") {
                                        auditorName = " -";
                                    }
                                    exportDataTmp.push({
                                        "Plant Name": suggestionListExport[i].branchName || " -",
                                        "Suggestion For Department": suggestionListExport[i].deptName || " -",
                                        "Suggestion For Cell/Line": suggestionListExport[i].lineName || " -",
                                        "Suggestion ID": suggestionListExport[i].suggestionNumber || " -",
                                        "Suggestion Desc": suggestionListExport[i].suggestion || " -",
                                        "Existence": suggestionListExport[i].iskaizenExist || " -",
                                        "Status": suggestionListExport[i].label || " -",
                                        "Verification Due Date": suggestionListExport[i].kaizenVerificationDate || " -",
                                        // "Auditor Name": suggestionListExport[i].susAuditorName || " -",
                                        "Auditor Name": auditorName,
                                        "Category / Result Area": suggestionListExport[i].catName || " -",
                                        "Benefit": suggestionListExport[i].particulars || " -",
                                        "Unit": suggestionListExport[i].unitName || " -",
                                        "Claim By Initiator": suggestionListExport[i].claimByInit || " -",
                                        "Claim By Evaluator": suggestionListExport[i].claimByEval || " -",
                                        "Claim By Implementor": suggestionListExport[i].claimByImpl || " -",
                                        "Value Confirmed By Auditor": suggestionListExport[i].claimByAuditor || " -",
                                        "Last Confirmation Date": suggestionListExport[i].lastConfirmationDate || " -",
                                    });
                                }
                                //alasql('SELECT * INTO XLSX("SuggestionList' + dateTime + '.xlsx",{headers:true}) FROM ?', [exportDataTmp]);
                                ExcelExportService.exportDataToExcel(exportDataTmp, 'Suggestion_List-' + dateTime, 'Suggestion_List-' + dateTime);
                            } else {
                                for (var i = 0; i < suggestionListExport.length; i++) {
                                    if (suggestionListExport[i].createdDate != null && suggestionListExport[i].createdDate != undefined && suggestionListExport[i].createdDate != "") {
                                        suggestionListExport[i].createdDate = $filter('date')(new Date(suggestionListExport[i].createdDate), 'dd/MM/yyyy');
                                    } else {
                                        suggestionListExport[i].createdDate = ''
                                    }
                                    if (suggestionListExport[i].updatedDate != null && suggestionListExport[i].updatedDate != undefined && suggestionListExport[i].updatedDate != "") {
                                        suggestionListExport[i].updatedDate = $filter('date')(new Date(suggestionListExport[i].updatedDate), 'dd/MM/yyyy');
                                    } else {
                                        suggestionListExport[i].updatedDate = ''
                                    }
                                    if (suggestionListExport[i].assignedDate != null && suggestionListExport[i].assignedDate != undefined && suggestionListExport[i].assignedDate != "") {
                                        suggestionListExport[i].assignedDate = $filter('date')(new Date(suggestionListExport[i].assignedDate), 'dd/MM/yyyy');
                                    } else {
                                        suggestionListExport[i].assignedDate = '-'
                                    }
                                    if (suggestionListExport[i].deptName == null || suggestionListExport[i].deptName == 'null')
                                        suggestionListExport.deptName = 'Executive Suggestion';
                                    if (suggestionListExport[i].isSelfImplemented == 1)
                                        suggestionListExport[i].isSelfImplemented = "Yes";
                                    else
                                        suggestionListExport[i].isSelfImplemented = " No";

                                    if (suggestionListExport[i].createdBy != null && suggestionListExport[i].createdBy.firstName != null) {
                                        suggestionListExport[i].createdByFirstName = suggestionListExport[i].createdBy.firstName;
                                    } else {
                                        suggestionListExport[i].createdByFirstName = '';
                                    }
                                    if (suggestionListExport[i].createdBy != null && suggestionListExport[i].createdBy.lastName != null) {
                                        suggestionListExport[i].createdByLastName = suggestionListExport[i].createdBy.lastName;
                                    } else {
                                        suggestionListExport[i].createdByLastName = '';
                                    }
                                    var createdBy = '';

                                    if (suggestionListExport[i].createdBy && suggestionListExport[i].createdBy.cmpyEmpId) {
                                        createdBy = suggestionListExport[i].createdByFirstName ? suggestionListExport[i].createdByFirstName + ' ' : '';
                                        createdBy += suggestionListExport[i].createdByLastName ? suggestionListExport[i].createdByLastName + '(' + suggestionListExport[i].createdBy.cmpyEmpId + ')' : '';
                                        createdBy = createdBy.trim();
                                    } else {
                                        createdBy = " -";
                                    }
                                    var assignedTo = suggestionListExport[i].assignToEmpName;

                                    if (assignedTo && assignedTo !== null && assignedTo !== undefined && assignedTo !== " ") {
                                        assignedTo = suggestionListExport[i].assignToEmpName;
                                    } else {
                                        assignedTo = " -";
                                    }

                                    var assigneeDepartment = suggestionListExport[i].asignToEmpDept || " -";
                                    if (assigneeDepartment && assigneeDepartment !== null && assigneeDepartment !== undefined && assigneeDepartment !== "" && assigneeDepartment !== 'N/A') {
                                        assigneeDepartment = suggestionListExport[i].asignToEmpDept;
                                    } else {
                                        assigneeDepartment = " -";
                                    }

                                    exportDataTmp.push({
                                        "Suggestion ID": suggestionListExport[i].suggestionNumber || " -",
                                        "Branch Name": suggestionListExport[i].branchName || " -",
                                        "Suggestion For Department": suggestionListExport[i].deptName || " -",
                                        "Suggestion For Cell/Line": (suggestionListExport[i].lineName) || " -",
                                        "Category / Result Area": suggestionListExport[i].catName || " -",
                                        "Employee Type": suggestionListExport[i].empType || " -",
                                        "Employee ID": suggestionListExport[i].cmpyEmpId || " -",
                                        "Employee Name": suggestionListExport[i].empName || " -",
                                        "Employee Department": suggestionListExport[i].empDeptName || " -",
                                        "Suggestion Title / Theme": suggestionListExport[i].suggestionTitle || " -",
                                        "Suggestion Source": suggestionListExport[i].suggestionSource || " -", // Aniket :- Change then key name 
                                        "Suggestion": suggestionListExport[i].suggestion || " -",
                                        "Present Problem": suggestionListExport[i].problemAnalysis || " -",
                                        "Brownie Points": suggestionListExport[i].points || " -",
                                        "Created Date": suggestionListExport[i].createdDate || " -",
                                        "Assigned Date": suggestionListExport[i].assignedDate || " -",
                                        // "Assigned To": suggestionListExport[i].assignToEmpName || " -",
                                        "Assigned To": assignedTo,
                                        // "Assignee Department": suggestionListExport[i].asignToEmpDept || " -",
                                        "Assignee Department": assigneeDepartment,
                                        "Time Taken": suggestionListExport[i].meanTime || " -",
                                        "Status": suggestionListExport[i].label || " -",
                                        "Implementation Date": suggestionListExport[i].implementationDate ? $filter('date')(new Date(suggestionListExport[i].implementationDate), "dd-MM-yyyy h:mm a") : '-', // Requirement from Sanden Vikas :- Implementation Date, Result & Action in "All Suggestion, Lateral Suggestion, Knowledge bank", by Sanket B on  2nd April 2024.
                                        "Result": (suggestionListExport[i].result) ? suggestionListExport[i].result : '-',
                                        "Implementation Action": (suggestionListExport[i].implementationAction) || " -",
                                        "Self Implemented": suggestionListExport[i].isSelfImplemented || " -",
                                        // <!-- /* Author - Aniket G. Purpose - Add value of isEHSBenefit in export function.*/ -->
                                        // "EHS Benefit": suggestionListExport[i].isEHSBenefit,
                                        "EHS Benefit": suggestionListExport[i].isEHSBenefit !== null ? suggestionListExport[i].isEHSBenefit : 'No',
                                        "EHS Benefit Details": suggestionListExport[i].ehsBenefitDetails ? suggestionListExport[i].ehsBenefitDetails : '-',
                                        'OnBehalf': (suggestionListExport[i].isSuggOnBehalf === 'Y' ? 'Yes' : (suggestionListExport[i].isSuggOnBehalf === 'N' ? 'No' : '-')),
                                        // "Created By(Emp ID)": suggestionListExport[i].createdByFirstName + ' ' + suggestionListExport[i].createdByLastName + '(' + suggestionListExport[i].createdBy.cmpyEmpId + ')' || " -",
                                        "Created By(Emp ID)": createdBy,
                                        "Implementation Team": (suggestionListExport[i].implTeam) ? suggestionListExport[i].implTeam : '-'
                                        //ONBEHALF SUGGESTION---------------CHANGE BY SUNANDA 31-10
                                        // "Name(OnBehalf)": suggestionListExport[i].onBehalfEmpName
                                    });
                                }
                                // alasql('SELECT * INTO XLSX("SuggestionList' + dateTime + '.xlsx",{headers:true}) FROM ?', [exportDataTmp]);
                                ExcelExportService.exportDataToExcel(exportDataTmp, 'Suggestion_List-' + dateTime, 'Suggestion_List-' + dateTime);
                            }
                            $("#exportSuggModal")
                                .modal('hide');
                        } else {
                            if (response.statusCode == 100) {
                                snackbar.create(response.reason, 3000, 'error');
                            } else {
                                snackbar.create('Data not found', 3000, 'error');
                            }
                        }
                    });
            } else {
                snackbar.create("At a time you may export data only for 6 months.", 3000, 'error');
            }
        }
    };

    $scope.ClearExportDate = function () {
        $scope.exportDatePicker.fromDt = '';
        $scope.exportDatePicker.toDt = '';
    }
    // Certificate export
    $scope.exportCertificate = function (name) {
        var name = name;
        if (name == "") {
            return;
        }
        // $scope.suggestionDet.exportCer = name;
        var formData = new FormData();
        var content = angular.element('#expCertDetails')
            .val();
        formData.append("content", content);
        $rootScope.flagpageloadindicator = true;
        var d = $q.defer();
        $http.post($scope.kaizenExportUrl, formData, {
            transformRequest: angular.identity,
            responseType: 'arraybuffer',
            headers: {
                'Content-Type': undefined,
                'Authorization': Auth.getToken()
            }
        })
            .then(function (response) {
                $rootScope.flagpageloadindicator = false;
                var a = document.createElement("a");
                document.body.appendChild(a);
                a.style = "display: none";
                var fileName = name + $scope.suggestionDet.suggestionNumber + '.pdf';
                var blob = new Blob([response.data], {
                    type: 'application/pdf'
                });
                var url = URL.createObjectURL(blob);
                a.href = url;
                a.download = fileName;
                a.click();
                window.URL.revokeObjectURL(url);
                d.resolve(response);
                $scope.suggestionDet.exportCer = "";
            })
            .catch(function (error) {
                $rootScope.flagpageloadindicator = false;
                d.resolve(error.data);
            });
        return d.promise;
    }
    $scope.setExportCertificate = function (name) {
        $scope.suggestionDet.exportCer = name;
        $timeout(function () {
            $scope.exportCertificate(name);
        }, 1000);
    }

    $scope.downloadKaizenCert = function (name, dept) {
        var name = name; // need to replace
        var dept = dept; // need to replace
        var canvas = document.createElement("canvas");
        var src = "";
        var img = new Image();
        canvas = document.createElement("canvas");
        var ctx = canvas.getContext("2d");
        if ($rootScope.empDetails.organization.logo != null) {
            src = $rootScope.empDetails.organization.logo;
            img.src = src;
            img.crossOrigin = "Anonymous";
        } else {

            $scope.PrintKaizenCert(null, name, dept);
        }


        img.onload = function () {
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);
            $scope.PrintKaizenCert(canvas.toDataURL("image/png"), name, dept);
        }

        if (img.complete || img.complete === undefined) {
            img.src = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";
            img.src = src;
        }
    }

    $scope.PrintKaizenCert = function (imgData, name, dept) {

        var doc = new jsPDF();

        doc.setDrawColor(118, 161, 252);
        doc.setFontType("bold");
        doc.setFontSize(22);
        doc.setFont("roboto");
        doc.setTextColor(45, 179, 220);
        doc.text("Certificate of Appreciation", 105, 30, 'center');
        if (imgData == null) {
            imgData = new Image();
            imgData.src = 'dist/icons/app_logo.png';
            doc.addImage(imgData, 'png', 90, 40, 28, 0);
        } else {
            doc.addImage(imgData, 'png', 80, 40, 50, 0);
        }
        doc.setFontSize(14);
        doc.setFontType("normal");
        doc.setTextColor(0, 0, 0);
        doc.text("Presented to", 107, 80, 'center');
        doc.setFontSize(18);
        doc.text("" + name, 107, 95, 'center');
        doc.setFontSize(14);
        doc.text(40, 120, 'For the valuable suggestion and successful implementation of Kaizen');
        doc.text(32, 125, 'at deptartment -' + dept);
        doc.text(32, 132, 'We look forward to many such innovative inputs from you.');
        doc.text(150, 205, 'Plant Head');
        doc.text(32, 205, 'Kaizen Team');
        doc.rect(10, 10, 190, 280); // empty square
        doc.save(name + ' certificate.pdf');
    }

    $scope.newSug = {};
    $scope.suggImages = [];
    $scope.setEditSuggData = function () {
        if ($scope.isEditSugg) {
            $scope.newSug.circleId = $scope.suggestionDet.circle;
            $scope.newSug.stageId = $scope.suggestionDet.stage;
            $scope.newSug.productId = $scope.suggestionDet.productFamily;
            $scope.newSug.productNoId = $scope.suggestionDet.masterProductNo;
            $scope.newSug.machineId = $scope.suggestionDet.machine;
            $scope.newSug.opertionId = $scope.suggestionDet.operation;
        }
    }
    $scope.editSuggestion = function () {
        $("#createNewSugg").modal({
            backdrop: 'static',
            keyboard: false
        });
        $scope.getAllBranchList();
        $scope.getCWAgencyList();
        $scope.files = [];
        $scope.docFiles = [];
        $scope.suggImages = [];
        $scope.createNewSuggTitle = "Modify Suggestion - Suggestion ID : " + $scope.suggestionDet.suggestionNumber;
        $scope.showDeptExesec('department');
        $scope.isEditSugg = true;
        $scope.newSug.deptId = $scope.suggestionDet.dept;
        if ($scope.newSug.deptId != null) {
            $scope.getLineNameList($scope.suggestionDet.dept.deptId);
        }
        $scope.newSug.catId = $scope.suggestionDet.category;
        if ($scope.suggestionDet.pillar != null) {
            $scope.newSug.activityId = $scope.suggestionDet.pillar;
        }
        if ($scope.suggestionDet.circle != null) {
            $scope.newSug.circleId = $scope.suggestionDet.circle;
        }
        if ($scope.suggestionDet.stage != null) {
            $scope.newSug.stageId = $scope.suggestionDet.stage;
        }
        if ($scope.suggestionDet.productFamily != null) {
            $scope.newSug.productId = $scope.suggestionDet.productFamily;
        }
        if ($scope.suggestionDet.machine != null) {
            $scope.newSug.machineId = $scope.suggestionDet.machine;
        }
        if ($scope.suggestionDet.operation != null) {
            $scope.newSug.opertionId = $scope.suggestionDet.operation;
        }
        if ($scope.suggestionDet.masterProductNo != null) {
            $scope.newSug.productNoId = $scope.suggestionDet.masterProductNo;
        }
        //16-7-2020 
        if ($scope.suggestionDet.circle != null) {
            // $scope.getMasterStageListByCircleId($scope.newSug.circleId.id);
            // $scope.getMasterProductFamilyListByStageId($scope.newSug.stageId.id);
            // $scope.getMasterProductNumberListByproductId($scope.newSug.productId.id);
            // $scope.getmachineListByproductNoId($scope.newSug.productNoId.id);
            // $scope.getMasterOperationList($scope.newSug.productNoId.id, $scope.newSug.machineId.id);
        }
        /*----13-07-2020---*/
        $scope.newSug.benchmark = $scope.suggestionDet.benchmark;
        $scope.newSug.target = $scope.suggestionDet.target;
        $scope.newSug.suggestionTitle = $scope.suggestionDet.suggestionTitle;
        $scope.newSug.problemAnalysis = $scope.suggestionDet.problemAnalysis;
        $scope.newSug.sugession = $scope.suggestionDet.sugession;
        $scope.suggImages = $scope.suggestionDet.sugEmpDocDetails;
        $scope.suggestionSource.id = $scope.suggestionDet.suggestionSource;
        $scope.suggestionDet.branch.branchName = $scope.suggestionDet.branch.name;
        $scope.newSug.branchId = $scope.suggestionDet.branch;
        $scope.isSelfImplemented = $scope.suggestionDet.isSelfImplemented == 1 ? true : false;
        $scope.newSug.isOnBehalf = $scope.suggestionDet.isSuggOnBehalf == 'Y' ? true : false;
        if ($scope.newSug.isOnBehalf) {
            $scope.newSug.isOnBehalfType = ($scope.suggestionDet.emp_details.empType == "CW") ? 'cw' : 'emp';
            var name = '';
            if ($scope.suggestionDet.emp_details.firstName) {
                name += $scope.suggestionDet.emp_details.firstName;
            }
            if ($scope.suggestionDet.emp_details.lastName) {
                if ($scope.suggestionDet.emp_details.firstName) {
                    name += ' ';
                }
                name += $scope.suggestionDet.emp_details.lastName;
            }
            if ($scope.suggestionDet.emp_details.empType == "CW") {
                $scope.getCwEmpList($scope.suggestionDet.emp_details.cwAgency);
                // $scope.newSug.cwId = $scope.suggestionDet.emp_details.cmpyEmpId;
                $scope.newSug.selectedCwEmp = {
                    empName: name,
                    cmpyEmpId: $scope.suggestionDet.emp_details.cmpyEmpId,
                    contactNo: $scope.suggestionDet.emp_details.contactNo,
                    agencyName: $scope.suggestionDet.emp_details.cwAgency.name,
                    agencyId: $scope.suggestionDet.emp_details.cwAgency.id,
                    empId: $scope.suggestionDet.emp_details.empId
                };
                // $scope.newSug.cwMobile = $scope.suggestionDet.emp_details.contactNo;
                $scope.newSug.selectedAgency = $scope.suggestionDet.emp_details.cwAgency;
            } else {
                if ($scope.suggestionDet.emp_details.cmpyEmpId) {
                    name += ' (' + $scope.suggestionDet.emp_details.cmpyEmpId + ')'
                }
                if ($scope.suggestionDet.status_master.status == $scope.CONST.STATUS.ReassignedByEvaluator.status) {
                    $scope.newSug.selectedEmp = {
                        empName: name,
                        empId: $scope.suggestionDet.emp_details.empId
                    };
                }
                else {
                    $scope.newSug.selectedEmp = {
                        empName: name,
                        empId: $scope.suggestionDet.emp_details.empId
                    };
                }
            }
        }
        if ($scope.suggestionDet.status_master.status == $scope.CONST.STATUS.ReassignedByEvaluator.status) {
            const filteredItems = [];
            for (let i = 0; i < $scope.catbranchwise.length; i++) {
                if ($scope.catbranchwise[i].hasOwnProperty('processType')) {
                    if ($scope.catbranchwise[i].processType !== 'Tier-1') {
                        filteredItems.push($scope.catbranchwise[i]);
                    }
                } else {
                    filteredItems.push($scope.catbranchwise[i]);
                }
            }
            $scope.catbranchwise = filteredItems;
        }
        // $scope.setEditSuggData();
    }

    $scope.removeImgOfCreatedSugg = function (imgId) {
        appService.httpGet("removesugesstiondoc/" + imgId)
            .then(function (response) {
                if (response.result) {
                    $scope.getSuggestionDetails($scope.selectedSuggId);
                    for (var i = 0; i < $scope.suggImages.length; i++) {
                        if ($scope.suggImages[i].sugEmpDocId == imgId) {
                            $scope.suggImages.splice(i, 1);
                        }
                    }
                    snackbar.create('Document remove successfully.', 3000, "success");
                } else {
                    if (response.statusCode == 100) {
                        snackbar.create(response.reason, 3000, "error");
                    } else {
                        snackbar.create('Error occurred while removing document. Please try again', 3000, "error");
                    }
                }
            });
    }
    //---------------------------------------------selfimplement----------------------------
    $scope.selfImplementmodel = function (x, stsAdt) {
        $scope.suggestionDet.closeGuest = false;
        $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = true;
        $scope.selectedAudit = stsAdt;
        $scope.evaluationDet = x;
        $scope.selectedTeamTypeForAssign = $scope.CONST.TEAM_TYPE.IMPLEMENTATION;
        if (stsAdt.status_master.status == $scope.CONST.STATUS.ApprovedByFC.status) {
            $scope.assignSuggestion();
        } else {
            // 12-8-2020
            if ($scope.evaluationDet != null && $scope.evaluationDet != undefined) {
                if ($scope.evaluationDet.evaluationInputs == null || $scope.evaluationDet.evaluationInputs == "") {
                    snackbar.create($filter('translate')('Evaluation_details_are_mandatory'), 6000, "error");
                    $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                    return;
                }
            }
            if ($scope.suggFlowConfig.isParticularsEnbld == 'Y' && $rootScope.empDetails.productOrgConfigDet.isPraticularsMandatory == 1) {
                if ($filter('filter')($scope.particulars, { isChecked: true }).length == 0) {
                    snackbar.create($filter('translate')('Particulars_Other_Benefits_is_mandatory'), 5000, "error");
                    $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                    return;
                } else {
                    if ($scope.particulars != null && $scope.particulars.length > 0) {
                        for (let i = 0; i < $scope.particulars.length; i++) {
                            if ($scope.particulars[i].selectedId > 0) {
                                if ($scope.particulars[i].isChecked && $scope.particulars[i].tangible) {
                                    if (!$scope.particulars[i].hasOwnProperty('newUnit') && !$scope.particulars[i].hasOwnProperty('newValue')) {
                                        snackbar.create($filter('translate')('Please_enter_value_and_unit_for_tangible_benefit'), 5000, 'error');
                                        $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                                        return;
                                    }
                                }
                            }
                        }
                    }
                }
            }
            if ($scope.isEmpty($scope.suggestionDet.hdCatId) || $scope.suggestionDet.hdCatId == undefined || $scope.suggestionDet.hdCatId == null || $scope.suggestionDet.hdCatId == '') {
                $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                snackbar.create($filter('translate')('Please_select_category'), 6000, "error");
                return;
            }

            //Sustenance Check
            if ($scope.suggFlowConfig.isParticularsEnbld == 'Y') {
                if ($scope.suggFlowConfig.kaizenCheckReqEval == 'Y' && $rootScope.empDetails.productOrgConfigDet.isSusAuditRequired == 1 && $scope.suggestionDet.hdCatId.isSusAuditRequired == 'Y') {
                    if ($scope.suggestionDet.evalSustenanceflow == undefined || $scope.suggestionDet.evalSustenanceflow == null || !$scope.suggestionDet.evalSustenanceflow) {
                        snackbar.create($filter('translate')('Sustenance_audit_is_mandatory'), 5000, "error");
                        $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                        return;
                    }
                }
                if ($scope.suggFlowConfig.kaizenCheckReqEval == 'Y' && $scope.suggestionDet.evalSustenanceflow != undefined && $scope.suggestionDet.evalSustenanceflow != null && $scope.suggestionDet.evalSustenanceflow) {
                    if ($scope.suggestionDet.sustenanceAuditorList == null || $scope.suggestionDet.sustenanceAuditorList.length == 0) {
                        snackbar.create($filter('translate')('Auditor_setup_not_found_for_this_category_Please_add_Auditor'), 6000, "error");
                        $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                        return;
                    } else if ($scope.suggestionDet.sustenanceAuditorId == undefined || $scope.suggestionDet.sustenanceAuditorId == null || $scope.suggestionDet.sustenanceAuditorId == '') {
                        snackbar.create($filter('translate')('Please_select_sustenance_auditor'), 6000, "error");
                        $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                        return;
                    }
                }
            }
            if ($rootScope.empDetails.productOrgConfigDet.isDocChangeOn == 1 && $scope.suggFlowConfig.isChgDocEnbld == 'Y' && !$scope.suggestionDet.tmpIsDocumentChangeRequire) {
                if ($filter('filter')($scope.documentLists, { isChecked: true }).length == 0) {
                    snackbar.create($filter('translate')('Its_mandatory_to_assign_documents_for_update'), 6000, "error");
                    $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                    return;
                }
            }

            if ($scope.suggFlowConfig.isHorizDplymntsEnbld == 'Y') {
                if (!$scope.suggestionDet.isHDRequire && $scope.suggestionDet.hdSelected) {
                    snackbar.create($filter('translate')('Evaluation_horizontal_deployment_mandatory'), 6000, "error");
                    $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                    return;
                }
            }
            if (($scope.suggestionDet.status_master.status ==
                $scope.CONST.STATUS.EvaluationRequestAccepted.status || $scope.suggestionDet.status_master.status ==
                $scope.CONST.STATUS.ReassignedToEvaluationTeam.status) && $scope.productOrgConfigList.isPriorityMadatory == true && $scope.suggestionDet.suggPriority == null && $scope.suggFlowConfig.isImplPriority == "Y") {
                snackbar.create($filter('translate')('Implementation_Priority_is_mandatory'), 6000, "error");
                $scope.suggestionInputDetails.flagEvalInputSubmitSpinner = false;
                return;
            }
            $scope.assignSuggestion();
        }
    }
    //---------------------------------Create new suggestion---------------------------------

    $scope.files = [];
    $scope.getFileDetails = function (e) {
        $scope.$apply(function () {

            if ($scope.files.length > 0) {
                snackbar.create($filter('translate')('Only_one_image_upload'), 5000, "error");
                return;
            }
            for (var i = 0; i < e.files.length; i++) {
                // var ext = e.files[i].name.match(/\.(.+)$/)[1];
                var type = e.files[i].type;
                var fileNameWithExtension = e.files[i].name;
                var fileName = fileNameWithExtension.replace(/\.[^/.]+$/, ''); // Regex to remove the extension
                var ext = type.split('/')[1];
                if (angular.lowercase(ext) != 'jpg' && angular.lowercase(ext) != 'jpeg' && angular.lowercase(ext) != 'png') {
                    snackbar.create($filter('translate')('Invalid_file'), 5000, "error");
                    return;
                }

                //Udated Doc vaidation File size in bytes at 23-01-2024 by @Jayshri
                var fileSize = e.files[i].size;
                if (fileSize > 10 * 1024 * 1024) {
                    snackbar.create($filter('translate')('Image_size_exceeds_limit'), 5000, "error");
                    const resetFile = document.getElementById("file");
                    resetFile.value = '';
                    return;
                }
                e.files[i].fileName = fileName;
                e.files[i].ext = ext;
                $scope.files.push(e.files[i])
            }
        });
    };
    $scope.docFiles = [];
    $scope.getFileDetailsDoc = function (e) {
        $scope.$apply(function () {
            for (var i = 0; i < e.files.length; i++) {
                var ext = e.files[i].name.match(/\.(.+)$/)[1];
                e.files[i].ext = ext;
                $scope.docFiles.push(e.files[i]);
            }
        });
    };
    $scope.fileReader = function (data) {
        var reader = new FileReader();
        reader.onload = function (loadEvent) {
            $scope.$apply(function () {
                data.imgsrc = loadEvent.target.result;
                data.src = loadEvent.target.result;
                data.imgsrcImpl = loadEvent.target.result; // Change 19-3-2020
            });
        }
        reader.readAsDataURL(data);
    }

    $scope.getDeptBranchWise = function () {
        appService.httpGet("getDepartmentListForSuggestion/" + $scope.loggedInUserBranchId)
            .then(function (response) {
                $scope.deptbranchwise = response.deptList;
            });
    }
    $scope.suggestionSource = {
        id: null
    }
    /* Author - Sanket B. (Modifier)
    Date - 26/02/2024
    Output - If the conditions alies, orgId & branchId are met, then $scope.suggestionSourceList will contain the filtered list. Requirement from Magna Chennai Plant */
    $scope.getSuggestionSource = function () {
        appService.httpGet("getSuggestionSourceList").then(function (response) {
            if (response.result) {
                if (alies == 'magna' && $scope.loggedInUserOrgId == 34 && $scope.loggedInUserBranchId == 150) {
                    $scope.suggestionSourceList = response.suggestionSourceList.filter(function (item) {
                        return item.id === 17 || item.id === 18;
                    });
                } else {
                    $scope.suggestionSourceList = response.suggestionSourceList;
                }
                //console.log($scope.suggestionSourceList);
                $scope.listFilter.suggestionSourceList = angular.copy($scope.suggestionSourceList);
            }
        });
    }
    $scope.getSuggestionSource();

    $scope.getLineNameList = function (deptid) {
        if (deptid) {
            appService.httpGet("getLineNameList/" + deptid)
                .then(function (response) {
                    /*----30-03-2020---*/
                    $scope.linefocus = true;
                    if (response.result) {
                        if (response.lineList != null && response.lineList.length > 0) {
                            var newData = [];
                            var lineData = $filter('filter')(response.lineList, { isActive: '!N' }, true);
                            for (let index = 0; index < lineData.length; index++) {
                                if (lineData[index].isActive != 'N') {
                                    newData.push(lineData[index]);
                                    if ($scope.isEditSugg) {
                                        if ($scope.suggestionDet.lineId == lineData[index].id) {
                                            $scope.newSug.line = lineData[index];
                                        }
                                    }
                                }
                            }
                            $scope.lineNameList = newData;
                        } else {
                            $scope.lineNameList = [];
                        }
                    } else {
                        $scope.lineNameList = [];
                    }
                });
        }
    }
    $scope.deptLineList = [];
    $scope.checkAndSetDeptLineList = function (dept) {
        if (dept) {
            appService.httpGet("getLineNameList/" + dept.deptId).then(function (response) {
                if (response.result) {
                    for (var i = 0; i < $scope.departmentList.length; i++) {
                        if ($scope.departmentList[i].deptId == dept.deptId) {
                            var lineData = $filter('filter')(response.lineList, { isActive: '!N' }, true);
                            $scope.departmentList[i].lineList = lineData; //response.lineList;
                            for (let j = 0; j < $scope.departmentList[i].lineList.length; j++) {
                                // 9-7-2020
                                if ($scope.suggestionDet.suggestionHorizontalDept != null && $scope.suggestionDet.suggestionHorizontalDept.length > 0) {
                                    for (let k = 0; k < $scope.suggestionDet.suggestionHorizontalDept.length; k++) {
                                        if ($scope.departmentList[i].lineList[j].id == $scope.suggestionDet.suggestionHorizontalDept[k].lineId) {
                                            $scope.departmentList[i].lineList[j].isEvalselect = true;
                                            $scope.departmentList[i].lineList[j].isImplselect = true;
                                            $scope.departmentList[i].isEvalselect = true;
                                            $scope.departmentList[i].isImplselect = true;
                                        }
                                    }
                                }
                                $scope.departmentList[i].lineList[j].lineId = $scope.departmentList[i].lineList[j].id;
                            }
                            $scope.departmentList[i].lineList.push({
                                name: "All",
                                id: 0
                            });
                            $scope.departmentList[i].lineFound = true;
                        }
                    }
                }
            });
        }
    }
    // 11-3-2020 checkforCircle
    $scope.checkCircleforPillarList = function (selectedpillarId) {
        appService.httpGet("getCircleList/" + $scope.loggedInUserBranchId)
            .then(function (response) {
                if (response.result == true) {
                    $scope.circleList = response.circleList;
                    for (var i = 0; i < $scope.circleList.length; i++) {
                        if ($scope.circleList[i].piller.id == selectedpillarId) {
                            for (var j = 0; j < $scope.activityList.length; j++) {
                                if ($scope.activityList[j].id == selectedpillarId) {
                                    $scope.activityList[j].circleFound = true;
                                }
                            }
                        }
                    }
                } else {
                    $scope.circleList = [];
                }
            });
    }

    $scope.checkCircleforPillarListAtImpl = function (selectedpillarId) {
        appService.httpGet("getCircleList/" + $scope.loggedInUserBranchId)
            .then(function (response) {
                if (response.result == true) {
                    $scope.circleList = response.circleList;
                    for (var i = 0; i < $scope.circleList.length; i++) {
                        if ($scope.circleList[i].piller.id == selectedpillarId) {
                            for (var j = 0; j < $scope.activityList.length; j++) {
                                if ($scope.activityList[j].id == selectedpillarId) {
                                    $scope.activityList[j].circleFound = true;
                                }
                            }
                        }
                        for (var k = 0; k < $scope.suggestionDet.suggestionHorizontalDept.length; k++) {
                            if ($scope.suggestionDet.suggestionHorizontalDept[k].circleId == $scope.circleList[i].id) {
                                $scope.circleList[i].isEvalCircleselect = true;
                                $scope.circleList[i].isImplCircleselect = true;
                            }

                        }
                    }
                } else {
                    $scope.circleList = [];
                }
            });
    }

    $scope.checkAndSetDeptLineListforLateral = function (dept) {
        if (dept) {
            appService.httpGet("getLineNameList/" + dept).then(function (response) {
                if (response.result) {
                    for (var i = 0; i < $scope.departmentList.length; i++) {
                        if ($scope.departmentList[i].deptId == dept) {
                            var lineData = $filter('filter')(response.lineList, { isActive: '!N' }, true);
                            $scope.departmentList[i].lineList = lineData; //response.lineList;
                            $scope.departmentList[i].lineList.push({
                                name: "All",
                                id: 0
                            });
                            $scope.departmentList[i].lineFound = true;
                        }
                    }
                }
            });
        }
    }
    $scope.getDeptLineList = function (dept) {
        if (dept) {
            appService.httpGet("getLineNameList/" + dept.deptId).then(function (response) {
                if (response.result) {
                    var lineData = $filter('filter')(response.lineList, { isActive: '!N' }, true);
                    dept.lineList = lineData; //response.lineList;
                    dept.lineList.push({
                        name: "All",
                        id: 0
                    });
                    dept.lineFound = true;
                } else {
                    dept.lineFound = false;
                }
            });
        }
    }

    $scope.getImplDeptLineList = function (dept, fetchType) {
        if (dept) {
            appService.httpGet("getLineNameList/" + dept.deptId).then(function (response) {
                if (!dept.isImplselect) {
                    return;
                }
                if (!dept.lineFound) {
                    dept.lineList = [];
                    dept.lineList.push({ lineId: 0, name: 'All', isImplselect: false });
                }
                dept.getMore = false;
                if (response.result) {
                    var lineData = $filter('filter')(response.lineList, { isActive: '!N' }, true);
                    for (var i = 0; i < lineData.length; i++) {
                        var newLineFound = false;
                        if (dept.lineList != null) {
                            for (var j = 0; j < dept.lineList.length; j++) {
                                if (dept.lineList[j].lineId == lineData[i].id) {
                                    newLineFound = true;
                                }
                            }
                        }
                        if (!newLineFound) {
                            dept.lineList.push({ lineId: lineData[i].id, name: lineData[i].name, isImplselect: false })
                        }
                    }
                    dept.lineFound = true;
                    if ($scope.suggestionDet.suggestionHorizontalDept != null && $scope.suggestionDet.suggestionHorizontalDept.length > 0) {
                        if (dept.lineList != null && dept.lineList.length > 0) {
                            for (let i = 0; i < dept.lineList.length; i++) {
                                for (let j = 0; j < $scope.suggestionDet.suggestionHorizontalDept.length; j++) {
                                    if (dept.lineList[i].lineId == $scope.suggestionDet.suggestionHorizontalDept[j].lineId && $scope.suggestionDet.suggestionHorizontalDept[j].lineId != 0 && (dept.lineList[i].isImplselect != true || dept.lineList[i].isEvalselect != true)) {
                                        dept.lineList[i].isImplselect = true;
                                        dept.lineList[i].isEvalselect = true;
                                    }
                                }
                            }
                        }
                        // for (let i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                        //     if (
                        //         $scope.suggestionDet.sugesstionStatusAudit[i].actionStatus == "PENDING" &&
                        //         (
                        //             $scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.ReassignedToImplPostVerification.status ||
                        //             $scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.ReassignedToEvaluationTeam.status ||
                        //             $scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.AssignedForImplVerification.status || $scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.ImplementationRequestAccepted.status
                        //         )
                        //     ) {
                        //         for (let i = 0; i < dept.lineList.length; i++) {
                        //             for (let j = 0; j < $scope.suggestionDet.suggestionHorizontalDept.length; j++) {
                        //                 if (dept.lineList[i].lineId == $scope.suggestionDet.suggestionHorizontalDept[j].lineId && $scope.suggestionDet.suggestionHorizontalDept[j].lineId != 0 && (dept.lineList[i].isImplselect != true || dept.lineList[i].isEvalselect != true)) {
                        //                     dept.lineList[i].isImplselect = true;
                        //                     dept.lineList[i].isEvalselect = true;
                        //                 }
                        //             }
                        //         }
                        //     }
                        // }
                    }
                    //console.log(dept.lineList)

                } else {
                    dept.lineFound = false;
                }
            });
        }
    }
    $scope.showDeptExesec = function (status) {
        $scope.status = status;

        if (status == "department") {
            $scope.departmentSection = true;
            $scope.managementSection = false;
            $scope.departmentLabel = "Department";
            $scope.categoryLabel = "Category";
            $scope.suggTitleLabel = "Suggestion Title";
            $scope.suggDescLabel = "Current Problem";
            $scope.suggestionLabel = "Suggestion";
            $scope.DocumentLabel = "Documents and images";
            $scope.categoryLabelVal = "Please Select Category";

        } else if (status == "management") {
            $scope.managementSection = true;
            $scope.departmentSection = false;
            $scope.exeLabel = "Executive";
            $scope.categoryLabel = "Concern/Suggestion Category";
            $scope.suggTitleLabel = "Concern/Suggestion Title";
            $scope.suggestionLabel = "Concern/Suggestion Description";
            $scope.DocumentLabel = "Documents and images";
            $scope.categoryLabelVal = "Please Select Concern/Suggestion Category";
        }

    }

    $scope.showDeptExesec("department");
    $scope.getMasterUnitsList = function () {
        var data = {
            // branchId: $rootScope.empDetails.branch.branchId
        }
        appService.httpGet("getMasterUnits").then(function (response) {
            if (response.result) {
                if (response.unitList != null && response.unitList.length > 0) {
                    $scope.unitlistForparticular = response.unitList;
                } else {
                    $scope.unitlistForparticular = [];
                }
            } else {
                $scope.unitlistForparticular = [];
            }
        });
    }
    $scope.getMasterUnitsList();

    $scope.getUnitDet = function (id) {
        var obj = {};
        if ($scope.unitlistForparticular != null && $scope.unitlistForparticular.length > 0) {
            id = parseInt(id);
            var rec = $filter('filter')($scope.unitlistForparticular, { id: id }, true);
            if (rec != null && rec.length > 0) {
                obj = rec[0];
            }
        }
        return obj;
    }
    $scope.selectNewAllParticulars = function () {
        var flag = ($scope.selectAllparticulars) ? false : true;
        $scope.selectAllparticulars = flag;
        for (var i = 0; i < $scope.particulars.length; i++) {
            $scope.particulars[i].isSelected = $scope.selectAllparticulars;
        }

    }
    $scope.getImpactPer = function (existingValue, value, impactType) {
        var impactvalue = 0;
        impactType = (!impactType || impactType == null) ? 'POSITIVE' : impactType;
        if ((existingValue != undefined && existingValue != '') && (value != undefined && value != '')) {
            if (existingValue > 0 && value > 0) {
                if (impactType == 'NEGATIVE') {
                    impactvalue = ((value - existingValue) / existingValue) * 100;
                } else {
                    impactvalue = ((existingValue - value) / existingValue) * 100;
                }
            }
        }
        // //console.log(existingValue + "v" + value + "I" + impactvalue);
        impactvalue = (impactvalue) ? impactvalue : 0;
        return impactvalue.toFixed(2);
    }
    $scope.form = {};
    $scope.createNewSuggPopup = function () {
        $scope.createNewSuggTitle = "Create new suggestion";
        $scope.selectedEmp = ''; //change 30-10
        $scope.suggestionTitle = '';
        $scope.sugession = '';
        $scope.execId = '';
        $scope.isAnonymous = '';
        $scope.deptId = '';
        $scope.suggestionSource.id = $scope.suggestionSourceList[0];
        $scope.problemAnalysis = '';
        $scope.lineNameList = [];
        $scope.isEditSugg = false;
        $scope.lineNameList = [];
        $scope.files = [];
        $scope.docFiles = [];
        $scope.suggImages = [];
        $scope.flagErrDept = false;
        $scope.flagErrCat = false;
        $scope.flagErrExec = false;
        $scope.flagErrSource = false;
        $scope.newSug = {};
        $scope.particularsnew = [];
        //$scope.createnewSuggForm.$setPristine();
        // //console.log($scope.form.createnewSuggForm);
        $scope.form.createnewSuggForm.$setPristine();
        $scope.form.createnewSuggForm.$setUntouched();
        if (!$scope.checkForHdConfig()) {
            $scope.pillarfocus = true;
        }
        /*----------30-02-2020---*/
        $scope.linefocus = false;
        $scope.prodfocus = false;
        $scope.machfocus = false;
        $scope.prodfocus = false;
        $("#createNewSugg")
            .modal({
                backdrop: 'static',
                keyboard: false
            });
        $scope.getAllBranchList();
        $scope.newSug.addMachineFlagnew = true;
        $scope.newSug.addMachineFlag = false;
        $scope.newSug.addOperationFlagnew = true;
        $scope.newSug.addOperationFlag = false;
        $rootScope.empDetails.branch.branchName = $rootScope.empDetails.branch.name;
        $scope.newSug.branchId = $rootScope.empDetails.branch;

        if ($scope.catbranchwise != null && $scope.catbranchwise.length > 0) {
            for (let index = 0; index < $scope.catbranchwise.length; index++) {
                $scope.catbranchwise[index].catClass = '';
            }
        }
        $scope.getCWAgencyList();
        $scope.getNewParticular($scope.newSug.branchId.branchId);
        if ($rootScope.getOrgByAlies('dcmsugar')) {
            $scope.getSuggAccessList($scope.newSug.branchId.branchId);
        }
    }
    $scope.newSug = {};
    $scope.cwAgencyList = [];
    $scope.getCWAgencyList = function () {
        if ($scope.cwAgencyList != null && $scope.cwAgencyList.length > 0) {

        } else {
            appService.httpGet('getCWAgencyList/' + $rootScope.empDetails.organization.orgId).then(function (response) {
                if (response.result) {
                    if (response.cwAgencyList != null && response.cwAgencyList.length > 0) {
                        $scope.cwAgencyList = response.cwAgencyList;
                    } else {
                        $scope.cwAgencyList = [];
                    }
                } else {
                    $scope.cwAgencyList = [];
                }
            })
        }
    }
    $scope.addnewMachineATCreate = function () {
        if ($scope.newSug.machineNameNew == undefined || $scope.newSug.machineNameNew == null || $scope.newSug.machineNameNew == '') {
            snackbar.create($filter('translate')('Please_enter_machine_no'), 4000, "error");
            return;
        }
        $scope.data = {
            "machineName": $scope.newSug.machineNameNew,
            "branchId": $scope.loggedInUserBranchId,
            "isActive": "Y",
            "productFamilyId": parseInt($scope.newSug.productId.id),
            "stageId": parseInt($scope.newSug.stageId.id),
            "productNo": {
                "id": parseInt($scope.newSug.productNoId.id)
            }
        }
        //console.log($scope.data);
        appService.httpPost($scope.data, "addMasterMachine").then(function (response) {
            $scope.globalLoadingIndicator = false;
            if (response.result == true) {
                $scope.getmachineListByproductNoId($scope.newSug.productNoId.id);
                $scope.newSug.addMachineFlag = false;
                snackbar.create($filter('translate')('Machine_added_successfully'), 4000, "success");
            } else {
                if (response.statusCode == 100)
                    snackbar.create(response.reason, 4000, "error");
                else
                    snackbar.create($filter('translate')('Something_went_wrong_Please_try_again'), 4000, "error");
            }
        });
    }

    $scope.setAddNewOperation = function () {
        consoleLog("In set Add Operation");
        if ($scope.newSug.opertionId.id == 0) {
            $scope.newSug.addOperationFlag = true
        } else {
            $scope.newSug.addOperationFlag = false
        }
    }

    $scope.addnewOperationATCreate = function () {

        if ($scope.newSug.newOperationType == undefined || $scope.newSug.newOperationType == null || $scope.newSug.newOperationType == '') {
            snackbar.create($filter('translate')('Please_enter_operation'), 4000, "error");
            return;
        }
        $scope.data = {
            "operationType": $scope.newSug.newOperationType,
            "branchId": $scope.loggedInUserBranchId,
            "isActive": "Y",
            "masterProductNo": {
                "id": parseInt($scope.newSug.productNoId.id),
            },

        }
        if ($scope.newSug.machineId) {
            $scope.data.machine = {
                id: 0,
            }
            $scope.data.machine.id = parseInt($scope.newSug.machineId.id);
        }
        //console.log($scope.data);
        $scope.globalLoadingIndicator = true;
        appService.httpPost($scope.data, "addMasterOperation").then(function (response) {
            $scope.globalLoadingIndicator = false;
            if (response.result == true) {

                if ($scope.newSug.machineId) {
                    $scope.data.machine = {
                        id: 0,
                    }
                    $scope.data.machine.id = parseInt($scope.newSug.machineId.id);
                } else {
                    $scope.data.machine = {
                        id: 0,
                    }
                }
                $scope.getMasterOperationList($scope.newSug.productNoId.id, $scope.data.machine.id);

                $scope.newSug.addOperationFlag = false;
                snackbar.create($filter('translate')('operation_type_added_successfully'), 4000, "success");
            } else {
                if (response.statusCode == 100)
                    snackbar.create(response.reason, 4000, "error");
                else
                    snackbar.create($filter('translate')('Something_went_wrong_Please_try_again'), 4000, "error");
            }
        });
    }

    $scope.frequncyList = [{
        "id": 1,
        "name": "Monthly",
        "value": "MONTHLY"
    },
    {
        "id": 1,
        "name": "Once Off",
        "value": "ONCEOFF"
    }
    ];


    $scope.resetSelectedParticular = function (selectedParticular) {
        consoleLog(selectedParticular);
        if ($scope.particulars != null) {
            for (var i = 0; i < $scope.particulars.length; i++) {
                if (selectedParticular == undefined || selectedParticular.id != $scope.particulars[i].id) {
                    $scope.particulars[i].isInitiatorSelected = false;
                }
            }
        }
    }
    $scope.isSuggPassOtherOrg = function () {
        var flag = false;
        var orgIds = [1, 28];
        if (!$scope.isEmpty($rootScope.empDetails) && $rootScope.empDetails.hasOwnProperty('organization')) {
            if (orgIds.indexOf($rootScope.empDetails.organization.orgId) > -1) {
                flag = true;
            }
        }
        return flag;
    }
    $scope.getDeptBranchWise = function (branchId) {
        if (branchId) {

        } else {
            branchId = $rootScope.empDetails.branch.branchId;
        }
        appService.httpGet("getDepartmentListForSuggestion/" + branchId)
            .then(function (response) {
                if (response.deptList != null && response.deptList.length > 0) {
                    $scope.deptbranchwise = response.deptList;
                } else {
                    $scope.deptbranchwise = [];
                }
            });
    }
    $scope.getAllBranchList = function () {
        if ($scope.allBranchList != null && $scope.allBranchList.length > 0) {
            return;
        }
        appService.httpGet("getbranchlistbyorgid/" + $rootScope.empDetails.organization.orgId)
            .then(function (response) {
                if (response.result) {
                    if (response.branchList != null && response.branchList.length > 0) {
                        var branchList = [];
                        for (let index = 0; index < response.branchList.length; index++) {
                            response.branchList[index].branchName = response.branchList[index].name;
                            if (response.branchList[index].isActive == 'Y') {
                                branchList.push(response.branchList[index]);
                            }
                        }
                        $scope.allBranchList = branchList;
                    } else {
                        $scope.allBranchList = [];
                    }
                } else {
                    $scope.allBranchList = [];
                }
            });
    }
    $scope.getNewParticular = function (branchId) {
        if ($scope.particulars != null && $filter('filter')($scope.particulars, { branch: { branchId: branchId } }, true).length > 0) {
            if ($scope.particulars != null && $scope.particulars.length != 0) {
                for (let i = 0; i < $scope.particulars.length; i++) {
                    $scope.particulars[i].isChecked = false;
                    //New Code added
                    $scope.particulars[i].selectedId = 0;
                    $scope.particulars[i].isInitiatorSelected = false;
                    $scope.particulars[i].selectedInitiatorData = {};
                    $scope.particulars[i].selectedEvalData = {};
                    $scope.particulars[i].selectedImplData = {};
                    $scope.particulars[i].existingValue = '';
                    $scope.particulars[i].value = '';
                    $scope.particulars[i].newValue = '';
                    $scope.particulars[i].evalExistingValue = '';
                    $scope.particulars[i].implExistingValue = '';
                    $scope.particulars[i].newInitImpactValue = '';
                    $scope.particulars[i].newImpactValue = '';
                    $scope.particulars[i].impactValue = '';
                    $scope.particulars[i].evalFrequency = '';
                    $scope.particulars[i].implFrequency = '';
                }
            }
            return;
        }
        appService.httpGet('getCategoryListByBranchId/' + branchId)
            .then(function (response) {
                if (response.catagoryList != null && response.catagoryList.length > 0) {
                    $scope.particulars = [];
                    $scope.catbranchwise = response.catagoryList;
                    for (var i = 0; i < response.catagoryList.length; i++) {
                        if (response.catagoryList[i].particulersList != null && response.catagoryList[i].particulersList.length > 0) {
                            for (var j = 0; j < response.catagoryList[i].particulersList.length; j++) {
                                if (response.catagoryList[i].particulersList[j].isActive == "Y") {
                                    response.catagoryList[i].particulersList[j].branch = response.catagoryList[i].branch;
                                    response.catagoryList[i].particulersList[j].category = response.catagoryList[i];
                                    $scope.particulars.push(response.catagoryList[i].particulersList[j]);
                                }
                            }
                        }
                    }
                    if ($scope.particulars != null && $scope.particulars.length != 0) {
                        for (let i = 0; i < $scope.particulars.length; i++) {
                            $scope.particulars[i].isChecked = false;
                            //New Code added
                            $scope.particulars[i].selectedId = 0;
                            $scope.particulars[i].isInitiatorSelected = false;
                            $scope.particulars[i].selectedInitiatorData = {};
                            $scope.particulars[i].selectedEvalData = {};
                            $scope.particulars[i].selectedImplData = {};
                            $scope.particulars[i].existingValue = '';
                            $scope.particulars[i].value = '';
                            $scope.particulars[i].newValue = '';
                            $scope.particulars[i].evalExistingValue = '';
                            $scope.particulars[i].implExistingValue = '';
                            $scope.particulars[i].newInitImpactValue = '';
                            $scope.particulars[i].newImpactValue = '';
                            $scope.particulars[i].impactValue = '';
                            $scope.particulars[i].evalFrequency = '';
                            $scope.particulars[i].implFrequency = '';
                        }
                    }
                } else {
                    $scope.particulars = [];
                }
            });
    }
    $scope.changeCreateSuggBranch = function (branch) {
        $scope.newSug.deptId = undefined;
        $scope.newSug.line = undefined;
        $scope.newSug.catId = undefined;
        $scope.newSug.initiatorPart = undefined;
        let loggedInBranch = $rootScope.empDetails.branch;
        if (branch && !$scope.isEmpty(branch)) {
            if ($rootScope.getOrgByAlies('dcmsugar')) {
                $scope.getSuggAccessList(branch.branchId);
            }
            $scope.getDeptBranchWise(branch.branchId);
            $scope.getNewParticular(branch.branchId);
        } else {
            if ($rootScope.getOrgByAlies('dcmsugar')) {
                $scope.getSuggAccessList(loggedInBranch.branchId);
            }
            $scope.getDeptBranchWise(loggedInBranch.branchId);
            $scope.getNewParticular(loggedInBranch.branchId);
        }
    }
    $scope.newSugg = {};
    $scope.createNewSuggestion = function (form, isValid) {
        //var validDropdownValue = $scope.validateDropdown('suggestion');
        if (isValid) {
            var formData = new FormData();
            var url = '';
            if ($scope.status == "department") {
                var formData = new FormData($("#create-suggestion-form")[0]);
                if ($scope.suggFlowConfig.isSuggSrcEnbld == 'Y' && $scope.suggestionSourceList != null && $scope.suggestionSourceList.length > 0) {
                    if ($scope.suggestionSource.id.id != null && $scope.suggestionSource.id.id != undefined && $scope.suggestionSource.id.id != '') {
                        formData.append('suggestionSource.id', $scope.suggestionSource.id.id);
                    }
                }
                formData.append("orgId", $rootScope.empDetails.organization.orgId);
                if ($scope.suggFlowConfig.isPlantEnbld == 'Y') {
                    if ($scope.isEmpty($scope.newSug.branchId)) {
                        snackbar.create('Please select plant', 5000, 'error')
                        return;
                    }
                    formData.append("branchId", $scope.newSug.branchId.branchId);
                } else {
                    formData.append("branchId ", $scope.loggedInUserBranchId);
                }
                // formData.append("branchId ", $scope.loggedInUserBranchId);
                if ($scope.newSug.isSelfImplemented == true) {
                    $scope.isSelfImplemented = 1;
                } else {
                    $scope.isSelfImplemented = 0;
                }
                formData.append('sourceType', 'portal');
                formData.append('isCntrlEnabled', $scope.suggFlowConfig.isCntrlEnbld);
                if ($scope.newSug.line != null && $scope.newSug.line != '' && $scope.newSug.line != undefined) {
                    formData.append('lineId', $scope.newSug.line.id);
                }
                //START FOR ONBEHALF SUGGESTION---------------CHANGE BY SUNANDA 30-10
                var created_empId = $scope.loggedInEmpId;
                if ($scope.newSug.isOnBehalf) {
                    if ($scope.newSug.isOnBehalfType) {
                        if ($scope.newSug.isOnBehalfType == 'emp') {
                            formData.append('isSuggOnBehalf', 'Y');
                            formData.append('createdBy.empId', $scope.loggedInEmpId);
                            formData.append("empId", $scope.newSug.selectedEmp.empId);
                            created_empId = $scope.newSug.selectedEmp.empId;
                        } else {
                            formData.append('isSuggOnBehalf', 'Y');
                            formData.append('cwId', $scope.newSug.cwId);
                            formData.append('cwName', $scope.newSug.cwName);
                            formData.append('cwAgencyId', $scope.newSug.cwAgency.id);
                            formData.append('cwEmpId', $scope.newSug.selectedCwEmp.empId);
                            if ($scope.newSug.cwMobile != null && $scope.newSug.cwMobile != undefined && $scope.newSug.cwMobile.length == 10) {
                                formData.append('contactNo', $scope.newSug.cwMobile);
                            } else {
                                snackbar.create("Please enter valid mobile number", 5000, "error");
                                return;
                            }
                            formData.append('createdBy.empId', $scope.loggedInEmpId);
                            formData.append('cwSuggestion', true);
                            created_empId = 0;
                            $scope.isSelfImplemented = 0;
                        }
                    } else {
                        snackbar.create($filter('translate')('Please_select_on_behalf_of_someone'), 3000, 'error')
                        return;
                    }
                } else {
                    // cwSugg = false;
                    formData.append('isSuggOnBehalf', 'N');
                    formData.append('createdBy.empId', $scope.loggedInEmpId);
                    formData.append("empId", $scope.loggedInEmpId);
                }

                // if ($scope.newSug.isOnBehalf == true) {
                //     formData.append('isSuggOnBehalf', 'Y');
                //     formData.append('createdBy.empId', $scope.loggedInEmpId);
                //     formData.append("empId", $scope.newSug.selectedEmp.empId);
                //     created_empId = $scope.newSug.selectedEmp.empId;
                // } else {
                //     formData.append('isSuggOnBehalf', 'N');
                //     formData.append('createdBy.empId', $scope.loggedInEmpId);
                //     formData.append("empId", $scope.loggedInEmpId);
                // }
                if ($scope.suggFlowConfig.isSelfImplementedEnbld == 'Y') {
                    formData.append('isSelfImplemented', $scope.isSelfImplemented);
                }
                url = "createSugesstion";
                if ($scope.isEditSugg == true) {
                    formData.append("sugId", $scope.suggestionDet.sugId);
                    const lastIndex = $scope.suggestionDet.sugesstionStatusAudit.length - 1;
                    if (lastIndex >= 0) {
                        formData.append("statusId", $scope.suggestionDet.sugesstionStatusAudit[lastIndex].status_master.statusId);
                    }
                    url = "updateSugesstion";
                }
                if ($scope.files != null && $scope.files.length > 0) {
                    for (var i in $scope.files) {
                        formData.append("sugImg", $scope.files[i]);
                    }
                }
                if ($scope.docFiles != null && $scope.docFiles.length > 0) {
                    for (var i in $scope.docFiles) {
                        formData.append("drawingDoc", $scope.docFiles[i]);
                    }
                }

                //START FOR CIRCLE SUGGESTION---------------CHANGE BY SUNANDA 1-1-2020
                if ($scope.newSug.activityId != undefined && $scope.newSug.activityId != null && $scope.newSug.activityId != '') {
                    formData.append('pillar.id', $scope.newSug.activityId.id);
                }

                if ($scope.newSug.circleId != null && $scope.newSug.circleId != undefined && $scope.newSug.circleId != '') {
                    if ($scope.newSug.circleId.id > 0 && $scope.newSug.circleId != undefined && $scope.newSug.circleId != null && $scope.newSug.circleId != '') {
                        formData.append('circle.id', $scope.newSug.circleId.id);
                    }
                    if ($scope.newSug.circleId.id > 0 && $scope.newSug.stageId != undefined && $scope.newSug.stageId != null && $scope.newSug.stageId != '') {
                        formData.append('stage.id', $scope.newSug.stageId.id);
                    }
                    if ($scope.newSug.circleId.id > 0 && $scope.newSug.machineId != undefined && $scope.newSug.machineId != null && $scope.newSug.machineId != '') {
                        formData.append('machine.id', $scope.newSug.machineId.id);
                    }
                    if ($scope.newSug.circleId.id > 0 && $scope.newSug.machinePartId != undefined && $scope.newSug.machinePartId != null && $scope.newSug.machinePartId != '') {
                        formData.append('machinePart.id', $scope.newSug.machinePartId.id);
                    }
                    if ($scope.newSug.circleId.id > 0 && $scope.newSug.opertionId != undefined && $scope.newSug.opertionId != null && $scope.newSug.opertionId != '') {
                        formData.append('operation.id', $scope.newSug.opertionId.id);
                    }
                    if ($scope.newSug.circleId.id > 0 && $scope.newSug.productId != undefined && $scope.newSug.productId != null && $scope.newSug.productId != '') {
                        formData.append('productFamily.id', $scope.newSug.productId.id);
                    }

                    if ($scope.newSug.circleId.id > 0 && $scope.newSug.productNoId != undefined && $scope.newSug.productNoId != null && $scope.newSug.productNoId != '') {
                        formData.append('masterProductNo.id', $scope.newSug.productNoId.id);
                    }
                }
                // ADVIK CHNAEG BY SUNANDA 4-3-2020
                // Target & Benchmark configuration for mandatory & optional condition by Sanket B. 13.05.2024
                if ($scope.newSug.target != undefined && $scope.newSug.target != null && $scope.newSug.target != '' && $scope.suggFlowConfig.isTargetEnbld == 'Y') {
                    formData.append('target', $scope.newSug.target);
                } else {
                    formData.delete('target');
                }
                if ($scope.newSug.benchmark != undefined && $scope.newSug.benchmark != null && $scope.newSug.benchmark != '' && $scope.suggFlowConfig.isBenchmarkEnbld == 'Y') {
                    formData.append('benchmark', $scope.newSug.benchmark);
                } else {
                    formData.delete('benchmark');
                }
                if ($scope.newSug.catId != undefined) {
                    if ($scope.newSug.catId.catId != undefined && $scope.newSug.catId.catId != null && $scope.newSug.catId.catId != '') {
                        formData.append('catId', $scope.newSug.catId.catId);
                    }
                }

                if ($scope.newSug.deptId != undefined && $scope.newSug.deptId != null && $scope.newSug.deptId != '') {
                    formData.append('deptId', $scope.newSug.deptId.deptId);
                }
                formData.delete('activityId');
                formData.delete('firstName');
                formData.delete('circleId');
                formData.delete('stageId');
                formData.delete('machineId');
                formData.delete('machinePartId');
                formData.delete('opertionId');
                formData.delete('line');
                formData.delete('productId');
                formData.delete('newdeptId');
                formData.delete('newCatId');
                formData.delete('productNoId');
                formData.delete('newSuggCWId');
                formData.delete('newSuggCWName');
                formData.delete('newSuggCWMobNo');
                formData.delete('newSuggCWAgency');
                //END FOR CIRCLE SUGGESTION---------------CHANGE BY SUNANDA 1-1-2020
                if ($scope.suggFlowConfig.parEnbledForInitiator == 'Y') {
                    if ($scope.particulars != null && $scope.particulars.length > 0) {
                        var selectedParticular = $filter('filter')($scope.particulars, { isInitiatorSelected: true });
                        if (selectedParticular.length > 1) {
                            snackbar.create($filter('translate')('Please_select_only_one_benefit'), 5000, 'error')
                            return;
                        }
                        if (selectedParticular != null && selectedParticular.length > 0) {
                            for (let index = 0; index < selectedParticular.length; index++) {
                                if (selectedParticular[index].tangible) {
                                    var rec = selectedParticular[index];
                                    if (rec.unit == undefined || rec.unit == '' || $scope.isEmpty(rec.unit) || rec.value == undefined || rec.value == '' || rec.value == null) {
                                        snackbar.create($filter('translate')('Please_enter_value_and_unit_for_tangible_benefit'), 5000, 'error')
                                        return;
                                    }
                                }
                            }
                        }
                        var particularCount = 0;
                        for (let index = 0; index < $scope.particulars.length; index++) {
                            //selectedId
                            if ($scope.particulars[index].selectedId == 0 && $scope.particulars[index].isInitiatorSelected) {
                                formData.append("customEvaluationParticularsList[" + particularCount + "].particular.id", $scope.particulars[index].id);
                                formData.append("customEvaluationParticularsList[" + particularCount + "].isActive", 'Y');
                                formData.append("customEvaluationParticularsList[" + particularCount + "].roleId", 4);
                                formData.append("customEvaluationParticularsList[" + particularCount + "].recommendedBy", created_empId);
                                formData.append("customEvaluationParticularsList[" + particularCount + "].action", 'ADD');
                                if ($scope.particulars[index].tangible) {
                                    formData.append("customEvaluationParticularsList[" + particularCount + "].unit", $scope.particulars[index].unit.unit);
                                    formData.append("customEvaluationParticularsList[" + particularCount + "].masterUnit.id", $scope.particulars[index].unit.id);
                                    formData.append("customEvaluationParticularsList[" + particularCount + "].frequency", $scope.particulars[index].frequency);
                                    formData.append("customEvaluationParticularsList[" + particularCount + "].value", $scope.particulars[index].value);
                                    formData.append("customEvaluationParticularsList[" + particularCount + "].existingValue", $scope.particulars[index].existingValue);
                                    formData.append("customEvaluationParticularsList[" + particularCount + "].tangible", true);
                                } else {
                                    formData.append("customEvaluationParticularsList[" + particularCount + "].tangible", false);
                                }
                                particularCount++;
                            } else if ($scope.particulars[index].selectedId > 0) {
                                if ($scope.particulars[index].isInitiatorSelected) {
                                    if ($scope.checkBenefitsValue($scope.particulars[index])) {
                                        formData.append("customEvaluationParticularsList[" + particularCount + "].id", $scope.particulars[index].selectedId);
                                        formData.append("customEvaluationParticularsList[" + particularCount + "].roleId", 4);
                                        formData.append("customEvaluationParticularsList[" + particularCount + "].recommendedBy", created_empId);
                                        formData.append("customEvaluationParticularsList[" + particularCount + "].particular.id", $scope.particulars[index].id);
                                        formData.append("customEvaluationParticularsList[" + particularCount + "].action", 'UPDATE');
                                        formData.append("customEvaluationParticularsList[" + particularCount + "].isActive", 'Y');
                                        if ($scope.particulars[index].tangible) {
                                            formData.append("customEvaluationParticularsList[" + particularCount + "].unit", $scope.particulars[index].unit.unit);
                                            formData.append("customEvaluationParticularsList[" + particularCount + "].masterUnit.id", $scope.particulars[index].unit.id);
                                            formData.append("customEvaluationParticularsList[" + particularCount + "].value", $scope.particulars[index].value);
                                            formData.append("customEvaluationParticularsList[" + particularCount + "].existingValue", $scope.particulars[index].existingValue);
                                            formData.append("customEvaluationParticularsList[" + particularCount + "].frequency", $scope.particulars[index].frequency);
                                            formData.append("customEvaluationParticularsList[" + particularCount + "].tangible", true);
                                        } else {
                                            formData.append("customEvaluationParticularsList[" + particularCount + "].tangible", false);
                                        }
                                    }
                                } else {
                                    formData.append("customEvaluationParticularsList[" + particularCount + "].id", $scope.particulars[index].selectedId);
                                    formData.append("customEvaluationParticularsList[" + particularCount + "].roleId", 4);
                                    formData.append("customEvaluationParticularsList[" + particularCount + "].recommendedBy", created_empId);
                                    formData.append("customEvaluationParticularsList[" + particularCount + "].action", 'DELETE');
                                }
                                particularCount++;
                            }
                        }
                    }
                }
            } else {
                var formData = new FormData($("#create-suggestion-form")[0]);
                formData.delete('isAnonymous');
                formData.delete('problemAnalysis');
                formData.delete('deptId');
                formData.append('sourceType', 'portal');
                if ($scope.isAnonymous == true) {
                    $scope.isAnonymous = 1;
                } else {
                    $scope.isAnonymous = 0;
                }
                formData.append("empId", $scope.loggedInEmpId);
                formData.append("orgId", $scope.loggedInUserOrgId);
                if ($scope.suggFlowConfig.isPlantEnbld == 'Y') {
                    if ($scope.isEmpty($scope.newSug.branchId)) {
                        snackbar.create('Please select plant', 5000, 'error')
                        return;
                    }
                    formData.append("branchId", $scope.newSug.branchId.branchId);
                } else {
                    formData.append("branchId ", $scope.loggedInUserBranchId);
                }
                // formData.append("branchId ", $scope.loggedInUserBranchId);
                formData.append("isExecutive", 1);
                formData.append("isAnonymous", $scope.isAnonymous);
                if ($scope.files != null && $scope.files.length > 0) {
                    for (var i in $scope.files) {
                        formData.append("sugImg", $scope.files[i]);
                    }
                }
                url = "createSugesstion";
            }

            /* Change 4 */
            $scope.isBeforeUploadImageOn = $rootScope.empDetails.productOrgConfigDet.isBeforeUploadImageOn;
            if ($scope.files == '' && $rootScope.empDetails.productOrgConfigDet.isBeforeUploadImageOn == 1 && !$scope.isEditSugg) {
                snackbar.create($filter('translate')('Please_upload_the_Before_Image'), 3000, "error");
                return;
            }
            /*-----13-07-2020----*/
            if ($scope.isEditSugg && $rootScope.empDetails.productOrgConfigDet.isBeforeUploadImageOn == 1 && ($scope.suggImages == null || $filter('filter')($scope.suggImages, { docType: 'beforeDoc' }, true).length == 0) && $scope.files == '') {
                snackbar.create($filter('translate')('Please_upload_the_Before_Image'), 3000, "error");
                return;
            }
            if ($scope.suggFlowConfig.isSuggFlowSetupcmpltd == null || $scope.suggFlowConfig.isSuggFlowSetupcmpltd == 'N' || $scope.suggFlowConfig.isSuggFlowSetupcmpltd == undefined) {
                snackbar.create($filter('translate')('Suggestion_flow_setup_admin_department'), 3000, "error");
                return;
            }
            /* var x = 0;
            for (var pair of formData.entries()) {
                console.log(pair[0] + ', ' + pair[1]);
            }
            if (x == 0) {
                return;
            } */
            $scope.flagCreateSuggSpinner = true;
            appService.uploadFileToUrl(formData, url)
                .then(function (response) {
                    $scope.flagCreateSuggSpinner = false;
                    if ($scope.status == "department") {
                        if (response.data.result) {
                            $("#createNewSugg")
                                .modal('hide');
                            localStorage.removeItem("recognitionObj");
                            if (recognition) {
                                recognition.stop();
                            }
                            $scope.isRecognizing = {};
                            if ($scope.isEditSugg == true) {
                                snackbar.create($filter('translate')('Suggestion_modified_successfully'), 5000, "success");
                                $scope.getSuggestionDetails($scope.selectedSuggId);
                                $scope.getsuggestionList('onLoad');
                                $scope.getStatusWiseCount();
                            } else {
                                $scope.newSugg.SuggId = response.data.suggestionNumber;
                                $scope.suggCreatedTitle = $filter('translate')('Awesome');
                                $scope.suggCreatedMsg = $filter('translate')('Thank_you_for_submitting_your_suggestion_We_will_keep_you_updated_on_progress');
                                $scope.newSugg.SuggIdText = 'Created Suggestion Id: ';
                                $("#successMsgCreateSugg")
                                    .modal({
                                        backdrop: 'static',
                                        keyboard: false
                                    });

                            }
                        } else {
                            if (response.data.statusCode == 100) {
                                snackbar.create(response.data.reason, 5000, "error");
                            } else {
                                snackbar.create($filter('translate')('Oops_Please_try_again'), 5000, "error");
                            }

                        }
                    } else {
                        $scope.suggCreatedTitle = "";
                        $scope.suggCreatedMsg = $filter('translate')('Your_concern_has_been_shared_We_will_keep_you_updating_about_the_progress');
                        if (response.data.result) {
                            $("#createNewSugg")
                                .modal('hide');
                            $("#successMsgCreateSugg")
                                .modal({
                                    backdrop: 'static',
                                    keyboard: false
                                });

                            localStorage.removeItem("recognitionObj");
                            if (recognition) {
                                recognition.stop();
                            }
                            $scope.isRecognizing = {};
                        } else {
                            snackbar.create($filter('translate')('Oops_Please_try_again'), 5000, "error");
                        }
                    }
                });
        } else {
            angular.forEach(form.$error.required, function (field) {
                field.$setDirty();
            });
        }
    }
    $scope.resetLang = function () {
        localStorage.removeItem("recognitionObj");
        if (recognition) {
            recognition.stop();
        }
        $scope.isRecognizing = {};
    }
    $scope.clearImage = function (index, img) {
        $scope.files.splice(index, 1);
    };
    $scope.clearDocImage = function (index, img) {
        $scope.docFiles.splice(index, 1);
    };

    $scope.validateDropdown = function (token) {
        if (token == 'suggestion') {
            var flagVal = 1;
            if ($scope.status == 'department' && !$scope.deptId && $scope.newSug.circleId == 0) {
                $scope.flagErrDept = true;
                flagVal = 0;
            }
            // if ($scope.suggFlowConfig.isSuggCatEnbld == 'Y') { }
            if (!$scope.newSug.catId) {
                $scope.flagErrCat = true;
                flagVal = 0;
            }
            if ($scope.status == 'management' && !$scope.execId) {
                $scope.flagErrExec = true;
                flagVal = 0;
            }
            // if ($scope.newSug.isOnBehalf == true) {
            //     if (!$scope.selectedEmp) {
            //         $scope.flagErrOnbehalf = true;
            //         flagVal = 0;
            //     }
            // }
            if (flagVal == 0)
                return false;
            else
                return true;
        }
    }

    $scope.previewImageForCreateSugg = function (img) {
        $scope.preiwImg = img;
    }

    // Preview Image
    /*---------------------------Image Viewer---------------------------*/
    $scope.showPreviewImg = function (selectedImgIndex, docDet) {
        $scope.selectedDocIndex = selectedImgIndex;
        $scope.viewerImages = docDet;
        $("#previewImg").modal({
            backdrop: 'static',
            keyboard: false
        });
        for (var i = 0; i < $scope.viewerImages.length; i++) {
            if (i == selectedImgIndex) {
                $scope.viewerImages[i].selected = true;
                $("#previewImg .img-holder")
                    .attr("src", $scope.viewerImages[i].src);
            } else
                $scope.viewerImages[i].selected = false;
        }
        $scope.previewImageForCreateSugg(docDet[selectedImgIndex].src);
    }
    // Change 19-3-2020
    $scope.showPreviewImgForImpl = function (selectedImgIndex, docDet) {
        $scope.selectedDocIndex = selectedImgIndex;
        $scope.viewerImages = docDet;
        $("#previewImg").modal({
            backdrop: 'static',
            keyboard: false
        });
        for (var i = 0; i < $scope.viewerImages.length; i++) {
            if (i == selectedImgIndex) {
                $scope.viewerImages[i].selected = true;
                $("#previewImg .img-holder")
                    .attr("src", $scope.viewerImages[i].src);
            } else
                $scope.viewerImages[i].selected = false;
        }
        $scope.previewImageForCreateSugg(docDet[selectedImgIndex].imgsrcImpl);
    }

    $scope.getHelpText = function (filterId) {
        if (filterId == $scope.CONST.COUNT_FILTERS.PENDING) {
            return $scope.CONST.HELP_TEXT.PENDING_ACTION;
        } else if (filterId == $scope.CONST.COUNT_FILTERS.MY_SUGG) {
            return $scope.CONST.HELP_TEXT.MY_SUGGESTION;
        } else if (filterId == 'all_sugg') {
            return $scope.CONST.HELP_TEXT.ALL_SUGGESTION;
        }
    }
    // saving Type Code(Evalation data)
    $scope.evalSavingType = {
        type: '',
        typeName: 'cost',
        amt: '',
        points: 0,
        role: ''
    };

    $scope.getSavingType = function () {
        appService.httpGet('getSavingOptionByBranchId/' + $scope.loggedInUserBranchId)
            .then(function (response) {
                if (response.result) {
                    $scope.savingTypes = response.savingOption;
                    $scope.evalSavingType.typeName = $scope.savingTypes[0].name.toLowerCase();
                    for (var i = 0; i < $scope.savingTypes.length; i++) {
                        $scope.savingTypes[i].typeName = $scope.savingTypes[i].name.toLowerCase();
                    }
                } else {
                    $scope.savingTypes = [];
                }
            })
    }

    $scope.savingOptionRoles = [];
    $scope.getSavingOption = function (id) {
        $scope.evalSavingType.option = '';
        $scope.evalSavingType.amt = '';
        $scope.evalSavingType.points = 0;
        $scope.savingOptionRoles = [];
        $scope.savingCost = [];
        if (id) {
            for (var i = 0; i < $scope.savingTypes.length; i++) {
                if (id == $scope.savingTypes[i].id) {
                    $scope.evalSavingType.typeName = $scope.savingTypes[i].name.toLowerCase();
                }
            }
            appService.httpGet('getSavingOptionRole/' + id)
                .then(function (response) {
                    if (response.result) {
                        $scope.savingOptionRoles = response.savingOptionRole;
                    } else {
                        $scope.savingOptionRoles = [];
                    }
                })
        } else {
            $scope.savingOptionRoles = [];
        }
    }

    $scope.savingCost = [];
    $scope.getSavingCost = function (id) {
        if (id) {
            appService.httpGet('getPointsForSavingBySavingOptionsRoleId/' + id + '/' + $scope.evalSavingType.type.id + '/0')
                .then(function (response) {
                    if (response.result) {
                        if (response.setPointsForSavingList != null && response.setPointsForSavingList.length > 0) {
                            for (let index = 0; index < response.setPointsForSavingList.length; index++) {
                                if (response.setPointsForSavingList[index].role != null) {
                                    response.setPointsForSavingList[index].amountRole = response.setPointsForSavingList[index].amountUpto + ' (' + response.setPointsForSavingList[index].role.name + ')';
                                } else {
                                    response.setPointsForSavingList[index].amountRole = response.setPointsForSavingList[index].amountUpto;
                                }
                            }

                        }
                        $scope.savingCost = response.setPointsForSavingList;
                    } else {
                        $scope.savingCost = [];
                    }
                })
        } else {
            $scope.savingCost = [];
        }
    }
    $scope.savingTypePoints = 0;
    $scope.setPoint = function (id) {
        for (var i = 0; i < $scope.savingCost.length; i++) {
            if ($scope.savingCost[i].id == id) {
                $scope.evalSavingType.points = $scope.savingCost[i].points;
            }
        }
    }

    $scope.SavingTypeLists = [];
    $scope.savingTypeBtn = true;
    $scope.flagSavingTypeSubmitSpinner = false;

    $scope.addSavingType = function (tmpdata) {
        var data = angular.copy(tmpdata);
        var dataindex = -1;
        for (var i = 0; i < $scope.SavingTypeLists.length; i++) {
            if ($scope.SavingTypeLists[i].amt.id == data.amt.id) {
                dataindex = i;
                break;
            }
        }
        if (dataindex != -1) {
            snackbar.create($filter('translate')('Saving_type_already_added'), 5000, "error");
            return;
        }
        $scope.savingTypeBtn = false;
        $scope.SavingTypeLists.push(data);
        $scope.evalSavingType = {
            type: $scope.savingTypes[0],
            typeName: $scope.savingTypes[0].name.toLowerCase(),
            amt: "",
            points: 0,
            role: ''
        };
    }
    $scope.savingsMainTab = 1;
    $scope.setSavingsTab = function (tabId) {
        $scope.savingsMainTab = tabId;
    };

    $scope.isSetSavingsTab = function (tabId) {
        return $scope.savingsMainTab === tabId;
    };
    $scope.resetSavingType = function () {
        $scope.evalSavingType = {
            type: $scope.savingTypes[0].id.toString(),
            typeName: $scope.savingTypes[0].typename,
            amt: '',
            points: 0
        };
        $scope.getSavingOption($scope.savingTypes[0].id);
        $scope.savingCost = [];
    }
    $scope.getValueFromList = function (list, id) {
        for (var i = 0; i < list.length; i++) {
            if (list[i].id == id) {
                return list[i];
            }
        }
    }
    $scope.removeSavingType = function (index) {
        $scope.SavingTypeLists.splice(index, 1);
    }
    $scope.DeleteSavingType = function (data) {
        $scope.flagdeleteSpinner = true;
        appService.httpPost(data, 'createEvaluationSuggestionPoints')
            .then(function (response) {
                $scope.flagdeleteSpinner = false;
                $("#confirmRemModal")
                    .modal('hide');
                if (response.result) {
                    snackbar.create($filter('translate')('Saving_type_deleted_successfully'), 5000, "success");
                    $scope.getSuggestionDetails($scope.selectedSuggId);
                } else {
                    snackbar.create($filter('translate')('Oops_Please_try_again'), 5000, "error");
                }
            });
    }
    $scope.getBenefitPointsData = function (id, roleId) {
        var rec = { dataFound: false };
        if ($scope.suggestionDet.benefitPointsAudit != null && $scope.suggestionDet.benefitPointsAudit.length > 0) {
            var data = $filter('filter')($scope.suggestionDet.benefitPointsAudit, { particularPoints: { id: id }, roleId: roleId }, true);
            if (data != null && data.length > 0) {
                data[0].frequency = data[0].particularPoints.frequency;
                rec = data[0];
                rec.dataFound = true;
            }
        }
        return rec;
    }

    $scope.suggCatbranchwise = {}
    $scope.getParticular = function (branchId) {
        appService.httpGet('getCategoryListByBranchId/' + branchId).then(function (response) {
            // //console.log(response);
            if (response.catagoryList != null && response.catagoryList.length > 0) {
                $scope.particulars = [];
                $scope.categoryList = [];
                $scope.catbranchwise = [];
                $scope.catbranchwise = response.catagoryList;
                $scope.suggCatbranchwise.categorylistData = [];
                $scope.getCatagoryList = response.catagoryList
                for (var i = 0; i < $scope.getCatagoryList.length; i++) {
                    $scope.categoryList.push($scope.getCatagoryList[i])
                }
                //console.log($scope.categoryList);

                for (var i = 0; i < response.catagoryList.length; i++) {
                    if (response.catagoryList[i].particulersList != null && response.catagoryList[i].particulersList.length > 0) {
                        for (var j = 0; j < response.catagoryList[i].particulersList.length; j++) {
                            if (response.catagoryList[i].particulersList[j].isActive == "Y") {
                                // var catObj = { catId: categoryList[i].catId, categoryName: categoryList[i].categoryName };
                                response.catagoryList[i].particulersList[j].category = response.catagoryList[i];
                                // categoryList[i].particulersList[j].catName = categoryList[i].categoryName;
                                $scope.particulars.push(response.catagoryList[i].particulersList[j]);
                            }
                        }
                    }
                }
                //console.log($scope.particulars);

                var categoryList = response.catagoryList;
                $scope.suggCatbranchwise = response.catagoryList;
                //console.log(categoryList);

                if ($scope.particulars != null && $scope.particulars.length != 0) {
                    for (let i = 0; i < $scope.particulars.length; i++) {
                        $scope.particulars[i].isChecked = false;
                        //New Code added
                        $scope.particulars[i].selectedId = 0;
                        $scope.particulars[i].isInitiatorSelected = false;
                        $scope.particulars[i].selectedInitiatorData = {};
                        $scope.particulars[i].selectedEvalData = {};
                        $scope.particulars[i].selectedImplData = {};
                        $scope.particulars[i].existingValue = '';
                        $scope.particulars[i].value = '';
                        $scope.particulars[i].newValue = '';
                        $scope.particulars[i].evalExistingValue = '';
                        $scope.particulars[i].implExistingValue = '';
                        $scope.particulars[i].newInitImpactValue = '';
                        $scope.particulars[i].newImpactValue = '';
                        $scope.particulars[i].impactValue = '';
                        $scope.particulars[i].evalFrequency = '';
                        $scope.particulars[i].implFrequency = '';
                        if (!$scope.isEmpty($scope.suggestionDet)) {
                            if ($scope.suggestionDet.customEvaluationParticularsList != null && $scope.suggestionDet.customEvaluationParticularsList.length != 0) {
                                for (let j = 0; j < $scope.suggestionDet.customEvaluationParticularsList.length; j++) {
                                    let obj = $scope.suggestionDet.customEvaluationParticularsList[j].particular;
                                    if (obj.id == $scope.particulars[i].id) {
                                        var rowCount = 1;
                                        if ($scope.suggestionDet.customEvaluationParticularsList[j].isActive == 'Y') {
                                            $scope.particulars[i].isChecked = true;
                                            $scope.particulars[i].selectedInitiatorData = $scope.getBenefitPointsData($scope.suggestionDet.customEvaluationParticularsList[j].id, 4);
                                            // if ($scope.particulars[i].selectedInitiatorData.dataFound) {
                                            //     rowCount = rowCount + 1;
                                            // }
                                            // Change For Other Benefit by @Jayshri Kolase on 05-04-2024
                                            if ($scope.particulars[i].selectedInitiatorData.dataFound) {
                                                rowCount = rowCount + 1;

                                                if ($scope.suggestionDet.sugesstionStatusAudit != null && $scope.suggestionDet.sugesstionStatusAudit.length > 0) {
                                                    for (let i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                                                        if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.AssignedForEdit.status && $scope.suggestionDet.sugesstionStatusAudit[i].actionStatus == "PENDING") {
                                                            $scope.groupingParticular($scope.suggestionDet.category);
                                                            if ($scope.suggestionDet.customEvaluationParticularsList != null && $scope.suggestionDet.customEvaluationParticularsList.length > 0) {
                                                                for (let j = 0; j < $scope.suggestionDet.customEvaluationParticularsList.length; j++) {
                                                                    if ($scope.suggestionDet.customEvaluationParticularsList[j].catId == $scope.suggestionDet.category.catId) {
                                                                        for (let k = 0; k < $scope.particulars.length; k++) {
                                                                            if ($scope.particulars[k].id == $scope.suggestionDet.customEvaluationParticularsList[j].particular.id) {
                                                                                $scope.particulars[k].isInitiatorSelected = true;
                                                                                $scope.particulars[k].isSelected = true;
                                                                                $scope.newSug.initiatorPart = $scope.particulars[k];
                                                                            }
                                                                        }
                                                                    }
                                                                    else {
                                                                        for (let k = 0; k < $scope.particulars.length; k++) {
                                                                            if ($scope.particulars[k].id == $scope.suggestionDet.customEvaluationParticularsList[j].particular.id) {
                                                                                $scope.newSug.initiatorPart = { id: 0, particulars: 'Other Benefits' };
                                                                                $scope.particulars[k].isInitiatorSelected = true;
                                                                                $scope.particulars[k].isSelected = true;
                                                                                // $scope.newSug.OtherBenefits = $scope.particulars[k];
                                                                                $scope.resetPerticularsList($scope.newSug.initiatorPart);
                                                                            }
                                                                        }

                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }

                                            //end - Change For Other Benefit by @Jayshri Kolase on 05-04-2024
                                            $scope.particulars[i].selectedEvalData = $scope.getBenefitPointsData($scope.suggestionDet.customEvaluationParticularsList[j].id, 8);
                                            if ($scope.particulars[i].selectedEvalData.dataFound) {
                                                rowCount = rowCount + 1;
                                            }
                                            $scope.particulars[i].selectedImplData = $scope.getBenefitPointsData($scope.suggestionDet.customEvaluationParticularsList[j].id, 9);
                                            if ($scope.particulars[i].selectedImplData.dataFound) {
                                                rowCount = rowCount + 1;
                                            }
                                        }
                                        $scope.particulars[i].selectedId = $scope.suggestionDet.customEvaluationParticularsList[j].id;
                                        // Change For Other Benefit by @Jayshri Kolase on 05-04-2024
                                        // $scope.particulars[i].isInitiatorSelected = true;
                                        // $scope.newSug.initiatorPart = $scope.particulars[i];
                                        //end - Change For Other Benefit by @Jayshri Kolase on 05-04-2024
                                        $scope.particulars[i].roleId = ($scope.suggestionDet.customEvaluationParticularsList[j].roleId) ? $scope.suggestionDet.customEvaluationParticularsList[j].roleId : '';
                                        $scope.particulars[i].unit = ($scope.suggestionDet.customEvaluationParticularsList[j].tangible) ? $scope.suggestionDet.customEvaluationParticularsList[j].masterUnit : '';
                                        //
                                        $scope.particulars[i].value = $scope.suggestionDet.customEvaluationParticularsList[j].value ? $scope.suggestionDet.customEvaluationParticularsList[j].value : '';
                                        //
                                        $scope.particulars[i].existingValue = $scope.suggestionDet.customEvaluationParticularsList[j].existingValue ? $scope.suggestionDet.customEvaluationParticularsList[j].existingValue : '';
                                        // 
                                        // 
                                        $scope.particulars[i].newImpactValue = $scope.suggestionDet.customEvaluationParticularsList[j].existingValue ? $scope.suggestionDet.customEvaluationParticularsList[j].existingValue : '';
                                        $scope.particulars[i].impactValue = $scope.getImpactPer($scope.particulars[i].existingValue, $scope.particulars[i].value, $scope.particulars[i].category.impactType);
                                        // 
                                        $scope.particulars[i].newInitImpactValue = $scope.getImpactPer($scope.particulars[i].existingValue, $scope.particulars[i].value, $scope.particulars[i].category.impactType);
                                        var tmpFreq = [];
                                        if ($scope.suggestionDet.customEvaluationParticularsList[j].tangible) {
                                            tmpFreq = $filter('filter')($scope.frequncyList, { value: $scope.suggestionDet.customEvaluationParticularsList[j].frequency }, true);
                                        }
                                        if (tmpFreq != null && tmpFreq.length > 0) {
                                            $scope.particulars[i].evalFrequency = tmpFreq[0];
                                            $scope.particulars[i].implFrequency = tmpFreq[0];
                                        }
                                        $scope.particulars[i].frequency = ($scope.suggestionDet.customEvaluationParticularsList[j].tangible) ? (($scope.suggestionDet.customEvaluationParticularsList[j].frequency) ? $scope.suggestionDet.customEvaluationParticularsList[j].frequency.toString() : '') : ''; //18-12-2020
                                        $scope.particulars[i].isActive = $scope.suggestionDet.customEvaluationParticularsList[j].isActive;
                                        $scope.particulars[i].rowSpan = rowCount;

                                        // if ($scope.suggestionDet.sugesstionStatusAudit != null && $scope.suggestionDet.sugesstionStatusAudit.length > 0) {
                                        //     for (let i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                                        //         if ($scope.suggestionDet.sugesstionStatusAudit[i].actionStatus == "PENDING" && ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.ReassignedToEvaluationTeam.status || $scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.ReassignedToImplPostVerification.status)) {
                                        //             $scope.isCheckEvalImplAction();

                                        //         }
                                        //     }
                                        // }
                                    }
                                }
                                //console.log($scope.particulars);
                            } else {

                            }
                        }
                    }
                }
                if (!$scope.isEmpty($scope.suggestionDet)) {
                    if ($scope.suggestionDet.sugesstionStatusAudit != null && $scope.suggestionDet.sugesstionStatusAudit.length > 0) {
                        for (let i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                            if ($scope.suggestionDet.sugesstionStatusAudit[i].actionStatus == "PENDING" && ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.ReassignedToEvaluationTeam.status || $scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.ReassignedToImplPostVerification.status)) {
                                $scope.isCheckEvalImplAction();

                            }
                        }
                    }
                }
                // //console.log($scope.particulars);
                // $scope.particulars1 = angular.copy($scope.particulars);
            } else {
                $scope.suggCatbranchwise = [];
                $scope.particulars = [];
            }
        });
    }
    // $scope.getParticular($rootScope.empDetails.branch.branchId);

    $scope.isCheckEvalImplAction = function () {
        if ($scope.particulars != null && $scope.particulars.length != 0) {
            for (let i = 0; i < $scope.particulars.length; i++) {
                $scope.particulars[i].isChecked = false;

                if ($scope.suggestionDet.customEvaluationParticularsList != null && $scope.suggestionDet.customEvaluationParticularsList.length != 0) {
                    for (let j = 0; j < $scope.suggestionDet.customEvaluationParticularsList.length; j++) {
                        let obj = $scope.suggestionDet.customEvaluationParticularsList[j].particular;
                        if (obj.id == $scope.particulars[i].id) {
                            var rowCount = 1;
                            if ($scope.suggestionDet.customEvaluationParticularsList[j].isActive == 'Y') {
                                $scope.particulars[i].isChecked = true;
                            }
                            $scope.particulars[i].selectedId = $scope.suggestionDet.customEvaluationParticularsList[j].id;
                            $scope.particulars[i].isInitiatorSelected = true;
                            $scope.newSug.initiatorPart = $scope.particulars[i];
                            // $scope.particulars[i].newUnit = $scope.suggestionDet.customEvaluationParticularsList[j].masterUnit;
                            $scope.particulars[i].newUnit = $scope.suggestionDet.customEvaluationParticularsList[j].masterUnit;
                            $scope.particulars[i].newValue = $scope.suggestionDet.customEvaluationParticularsList[j].value ? $scope.suggestionDet.customEvaluationParticularsList[j].value : '';
                            $scope.particulars[i].evalExistingValue = $scope.suggestionDet.customEvaluationParticularsList[j].existingValue ? $scope.suggestionDet.customEvaluationParticularsList[j].existingValue : '';
                            $scope.particulars[i].implExistingValue = $scope.suggestionDet.customEvaluationParticularsList[j].existingValue;
                            $scope.particulars[i].newImpactValue = $scope.getImpactPer($scope.particulars[i].implExistingValue, $scope.particulars[i].newValue, $scope.particulars[i].category.impactType)
                        }
                    }
                    //console.log($scope.particulars);
                } else {

                }
            }
        }
    }
    $scope.getParticular($rootScope.empDetails.branch.branchId);

    $scope.selectParticular = function (id) {
        if (angular.element(id)
            .prop('checked') == true)
            angular.element(id)
                .prop("checked", false);
        else
            angular.element(id)
                .prop("checked", true);
    }

    $scope.addParticulars = function () {
        var removeFlag = false;
        $scope.flagParticularSubmitSpinner = true;
        var res = [];
        $.each($("input[name='particularChk']:checked"), function () {
            var particular = $(this)
                .val();
            for (var i = 0; i < $scope.particulars.length; i++) {
                if ($scope.particulars[i].id == particular) {
                    var data = $scope.particulars[i];
                    if (!$scope.particulars[i].isChecked) {
                        var objt = {
                            "id": 0,
                            "particular": {
                                "id": data.id
                            },
                            "suggestion": {
                                "sugId": $scope.selectedSuggId
                            },
                            "createdById": $scope.loggedInEmpId,
                            "sugCreatedByEmpId": $scope.suggestionDet.emp_details.empId,
                            "points": data.points
                        };
                        res.push(objt)
                    }
                }
            }
        })
        $("input:checkbox:not(:checked)")
        $.each($("input[name='particularChk']:not(:checked)"), function () {
            var particular = $(this)
                .val();
            for (var i = 0; i < $scope.particulars.length; i++) {
                if ($scope.particulars[i].id == particular) {
                    var data = $scope.particulars[i];
                    if ($scope.particulars[i].isChecked) {
                        var objt = {
                            "id": data.selectedId,
                            "particular": {
                                "id": data.id
                            },
                            "suggestion": {
                                "sugId": $scope.selectedSuggId
                            },
                            "createdById": $scope.loggedInEmpId,
                            "sugCreatedByEmpId": $scope.suggestionDet.emp_details.empId,
                            "points": data.points
                        };
                        res.push(objt);
                        removeFlag = true;
                    }
                }
            }
        })

        if (res != null && res.length != 0) {
            appService.httpPost(res, 'createSuggestionParticulars')
                .then(function (response) {
                    $scope.flagParticularSubmitSpinner = false;
                    if (response.result) {
                        if (removeFlag) {
                            snackbar.create($filter('translate')('Particular_deleted_successfully'), 5000, "success");
                        } else {
                            snackbar.create(response.reason, 5000, "success");
                        }
                        $scope.getSuggestionDetails($scope.selectedSuggId);
                    } else {
                        snackbar.create($filter('translate')('Oops_Please_try_again'), 5000, "error");
                    }
                })
        }
    }
    $scope.flagDocBoxIndicator = false;
    $scope.getSuggestionDocList = function () {
        $scope.flagDocBoxIndicator = true;
        var data = {
            sugId: $scope.selectedSuggId
        }
        appService.httpPost(data, 'getSuggestionDocList')
            .then(function (response) {
                $scope.flagDocBoxIndicator = false;
                if (response.result) {
                    $scope.SugDocumentLists = response.docList;
                    if ($scope.SugDocumentLists != null && $scope.SugDocumentLists.length != 0) {
                        $scope.changeDocument = true;
                        for (var i = 0; i < $scope.SugDocumentLists.length; i++) {
                            for (var j = 0; j < $scope.documentLists.length; j++) {
                                if ($scope.SugDocumentLists[i].document_id == $scope.documentLists[j].id) {
                                    $scope.SugDocumentLists[i] = Object.assign({}, $scope.SugDocumentLists[i], $scope.documentLists[j]);
                                }
                            }
                        }
                    }
                } else {
                    $scope.SugDocumentLists = [];
                }
            })
    }

    $scope.setSuggestionActivity = function () {
        var suggActivityList = [];
        var selectedActivity = [];
        for (var i = 0; i < $scope.activityList.length; i++) {
            if ($scope.activityList[i].isselect) {
                var tmp = {
                    id: 0,
                    suggestion: {
                        sugId: $scope.selectedSuggId
                    },
                    activity: $scope.activityList[i]
                };
                selectedActivity.push(tmp);
            }
        }

        var updateSelectedActivity = [];
        for (var j = 0; j < $scope.suggestionDet.suggestionActivityList.length; j++) {
            var foundindex = -1;
            var activityIndex = -1;
            for (var i = 0; i < selectedActivity.length; i++) {
                if (selectedActivity[i].activity.id == $scope.suggestionDet.suggestionActivityList[j].activity.id) {
                    foundindex = j;
                    activityIndex = i;
                    break;
                }
            }
            if (foundindex != -1) {
                selectedActivity.splice(activityIndex, 1);
            } else {
                updateSelectedActivity.push($scope.suggestionDet.suggestionActivityList[j]);
            }
        }
        for (var k = 0; k < selectedActivity.length; k++) {
            updateSelectedActivity.push(selectedActivity[k]);
        }
        if (updateSelectedActivity.length == 0) {
            return;
        }
        appService.httpPost(updateSelectedActivity, 'createSuggestionActivity')
            .then(function (response) {
                if (response.result) {
                    snackbar.create($filter('translate')('Kaizen_activity_added_successfully'), 4000, "success");
                    $scope.getSuggestionDetails($scope.suggestionDet.sugId);
                } else {
                    if (response.statusCode == 100)
                        snackbar.create(response.reason, 4000, "error");
                    else
                        snackbar.create($filter('translate')('Oops_Please_try_again'), 5000, "error");
                    $scope.activityList = [];
                }
            });
    }

    $scope.selectDocument = function (id) {
        if (angular.element(id)
            .prop('checked') == true)
            angular.element(id)
                .prop("checked", false);
        else
            angular.element(id)
                .prop("checked", true);
    }

    $scope.addDocuments = function () {
        $scope.flagDocSubmitSpinner = true;
        var res = [];
        $.each($("input[name='docChk']:checked"), function () {
            var doc = $(this)
                .val();
            for (var i = 0; i < $scope.documentLists.length; i++) {
                if ($scope.documentLists[i].id == doc) {
                    var data = $scope.documentLists[i];
                    if (!$scope.documentLists[i].isChecked) {
                        var objt = {
                            suggestion: {
                                sugId: $scope.selectedSuggId
                            },
                            branch: {
                                branchId: $scope.suggestionDet.branch.branchId, //$scope.loggedInUserBranchId
                            },
                            document: {
                                id: parseInt(doc)
                            }

                        };
                        res.push(objt)
                    }
                }
            }
        })
        $("input:checkbox:not(:checked)")
        $.each($("input[name='docChk']:not(:checked)"), function () {
            var doc = $(this)
                .val();
            for (var i = 0; i < $scope.documentLists.length; i++) {
                if ($scope.documentLists[i].id == doc) {
                    var data = $scope.documentLists[i];
                    if ($scope.documentLists[i].isChecked) {
                        var objt = {
                            suggestion: {
                                sugId: $scope.selectedSuggId
                            },
                            branch: {
                                branchId: $scope.suggestionDet.branch.branchId, //$scope.loggedInUserBranchId
                            },
                            document: {
                                id: parseInt(doc)
                            }

                        };
                        res.push(objt);
                        removeFlag = true;
                    }
                }
            }
        })
        if (res != null && res.length != 0) {
            appService.httpPost(res, 'documentassignedbyeval')
                .then(function (response) {
                    if (response.result) {
                        $scope.flagDocSubmitSpinner = false;
                        $scope.getSuggestionDetails($scope.selectedSuggId);
                        $scope.getSuggestionDocList();
                        snackbar.create($filter('translate')('Documents_Suggestion_will_once_implemented_implementer'), 5000, "success");
                    } else {
                        snackbar.create($filter('translate')('Oops_Please_try_again'), 5000, "error");
                    }
                });
        }
    }
    $scope.SuggestionTemplate = {};
    /*------------HDconfiglist---------18-12-19--------change by sunanda*/
    $scope.hdConfigData = {};
    $scope.getSuggestionConfigId = function (masterId) {
        var obj = -1;
        for (var i = 0; i < $scope.suggHDConfigList.length; i++) {
            if ($scope.suggHDConfigList[i].configMaster.id == masterId) {
                obj = $scope.suggHDConfigList[i];
                break;
            }
        }
        return obj;
    }
    /*------------HDconfiglist---------18-12-19--------change by sunanda*/
    $scope.initMasterDataForSugg = function () {
        var masterDataRequest = {
            branchId: $scope.loggedInUserBranchId,
            orgId: $scope.loggedInUserOrgId,
            roleIds: [4, 6, 8, 9]
        };
        // appService.httpGetLocal('LocalJson/InitMaterRes.json')
        appService.httpPost(masterDataRequest, 'initmasterdataforsugg')
            .then(function (response) {

                if (response.result) {
                    if (response.savingOption != null && response.savingOption.length > 0) {
                        $scope.savingTypes = response.savingOption;
                        $scope.getSavingOption($scope.savingTypes[0].id);
                    } else {
                        $scope.savingTypes = [];
                    }
                    if (response.document != null) {
                        $scope.documentLists = response.document;
                    } else {
                        $scope.documentLists = [];
                    }
                    $scope.deptbranchwise = response.deptListForSugg;
                    if (response.benefitAnalysisList != null) {
                        for (let index = 0; index < response.benefitAnalysisList.length; index++) {
                            response.benefitAnalysisList[index].isselect = false;
                            response.benefitAnalysisList[index].isBenefitChecked = false;
                        }
                        $scope.benefitList = response.benefitAnalysisList;
                    } else {
                        $scope.benefitList = [];
                    }
                    if (response.orgLevelBenefitMasterList != null) {
                        $scope.orgLevelBenefitMasterList = response.orgLevelBenefitMasterList;
                    } else {
                        $scope.orgLevelBenefitMasterList = [];
                    }

                    $scope.catagoryList = [];
                    $scope.catbranchwise = [];
                    if (response.catagoryList != null) {
                        $scope.catagoryList.push({
                            categoryName: "All"
                        });
                        for (var i = 0; i < response.catagoryList.length; i++) {
                            $scope.catagoryList.push(response.catagoryList[i]);
                        }
                        $scope.suggDetailModel.catFilter = $scope.catagoryList[0];
                        $scope.listFilter.catagoryList = angular.copy($scope.catagoryList); //4-12
                        // $scope.catbranchwise = response.catagoryList;
                    }
                    $scope.departmentList = [];
                    if (response.deptList != null && response.deptList.length > 0) {
                        $scope.departmentList.push({
                            deptName: "All"
                        });
                        for (var i = 0; i < response.deptList.length; i++) {
                            $scope.departmentList.push(response.deptList[i]);
                        }
                        $scope.suggDetailModel.deptFilter = $scope.departmentList[0];
                        $scope.listFilter.departmentList = angular.copy($scope.departmentList); //4-12
                    }
                    $scope.activityList = [];
                    if (response.activityList != null) {
                        $scope.activityList = response.activityList;
                    }
                    $scope.suggDetailModel.deptFilter = $scope.departmentList[0];

                    $scope.activityList = [];
                    if (response.activityList != null) {
                        $scope.activityList = response.activityList;
                        $scope.listFilter.activityList = angular.copy($scope.activityList); //4-12
                    }
                    if (response.statusList != null && response.statusList.length > 0) {
                        var suggArr = [{
                            label: 'All'
                        }];
                        for (var i = 0; i < response.statusList.length; i++) {
                            response.statusList[i].isSelected = false;
                            suggArr.push(response.statusList[i]);
                        }
                        $scope.suggDetailModel.statusList = suggArr;
                        $scope.listFilter.statusList = angular.copy($scope.suggDetailModel.statusList); //4-12
                        $scope.suggestionPagination.selectedStatus = null; //$scope.suggDetailModel.statusList[0];
                    }
                    if (response.suggestionTemplate != null && response.suggestionTemplate.length > 0) {
                        $scope.SuggestionTemplate = response.suggestionTemplate[0];
                    } else {
                        $scope.SuggestionTemplate = null;
                    }

                    if (response.suggestionEvalMstrNomination != null && response.suggestionEvalMstrNomination.length > 0) {
                        $scope.suggestionEvalMstrNomination = response.suggestionEvalMstrNomination[0];
                    }
                    /*------------------------multiple branch --------change By sunanda/9-19-2019*/
                    if (response.branchList != null) {
                        $scope.branchListNew = response.branchList;
                        for (var j = 0; j < $scope.branchListNew.length; j++) {
                            $scope.branchListNew[j].branchName = $scope.branchListNew[j].name;
                            $scope.branchListNew[j].isSelected = true;
                            $scope.selectAllBranch = true;
                        }
                        $scope.mySuggBranchlist = angular.copy($scope.branchListNew);
                        $scope.pendingBranchlist = angular.copy($scope.branchListNew);
                        // $scope.sustainKaizenBrancList = angular.copy($scope.branchListNew);
                        //console.log($scope.mySuggBranchlist, response);
                        ////console.log($scope.pendingBranchlist);

                        if ($scope.statusCountFilter == 1) {
                            $scope.accessBranchList = $scope.pendingBranchlist;
                        }

                    }
                    $scope.suggHDConfigList = [];
                    /*------------HDconfiglist---------18-12-19--------change by sunanda*/
                    if (response.suggConfigList != null && response.suggConfigList.length > 0) {
                        $scope.suggHDConfigList = response.suggConfigList;
                        $scope.suggMasterConfigList = response.suggConfigMasterList;
                        $scope.masterConfigObj = $scope.suggMasterConfigList.reduce((json, value, key) => { json[value.configCaption] = value; return json; }, {});
                        var hdObjOptions = $scope.getSuggestionConfigId($scope.masterConfigObj.plantEvalType.id);
                        var hdObjLevel = $scope.getSuggestionConfigId($scope.masterConfigObj.createHDSugg.id);
                        //   var hdObjPlantEvalLevel = $scope.getSuggestionConfigId($scope.masterConfigObj.plantHDEvalType.id);
                        $scope.hdConfigData.hdLevel = hdObjOptions.configValue;
                        $scope.hdConfigData.hdOptions = hdObjLevel.configValue;
                        // $scope.hdConfigData.otherPlantEvalLevel = hdObjPlantEvalLevel.configValue;
                    }
                    /*------------HDconfiglist---------18-12-19--------change by sunanda*/
                } else { }

                $scope.typeFilter = $scope.defaultFilter;
                $scope.selectFilterList();
                $scope.applyFilter($scope.typeFilter);
                // $scope.getStatusWiseCount();
            });
    }

    $scope.suggHDConfigList = [];
    $scope.checkForHdConfig = function () {
        if ($scope.hdConfigData.hdLevel == undefined || $scope.hdConfigData.hdLevel == 'DEPT' || $scope.suggHDConfigList.length == 0) {
            return true;
        } else {
            return false;
        }
    }
    //Add Document
    $scope.files1 = [];
    $scope.getFileDetails1 = function (e) {
        $scope.$apply(function () {
            if ($scope.files1.length > 0) {
                snackbar.create($filter('translate')('Only_one_image_upload'), 5000, "error");
                return;
            }
            for (var i = 0; i < e.files.length; i++) {
                // var ext = e.files[i].name.match(/\.(.+)$/)[1];
                var type = e.files[i].type;
                var ext = type.split('/')[1];
                if (angular.lowercase(ext) != 'jpg' && angular.lowercase(ext) != 'jpeg' && angular.lowercase(ext) != 'png') {
                    snackbar.create($filter('translate')('Only_image_files_are_allowed_upload'), 5000, "error");
                    return;
                }
                $scope.files1.push(e.files[i])
            }
        });
        if ($scope.files1.length > 0) {
            $scope.uploadPic($scope.files1);
        }
    };

    $scope.uploadPic = function (files) {
        var formData = new FormData();
        for (var i in files) {
            formData.append("sugImg", files[i]);
        }
        formData.append("sugId", $scope.suggestionDet.sugId);
        appService.uploadFileToUrl(formData, "saveBeforeSuggestionImageDoc")
            .then(function (response) {
                if (response.data.result) {
                    snackbar.create($filter('translate')('Document_upload_succesfully'), 3000, "success");
                    // $scope.getsuggestionList('onUpdate');
                    $scope.getSuggestionListOnUpdate();
                    $scope.files1 = [];
                } else {
                    snackbar.create($filter('translate')('Oops_Please_try_again'), 5000, "error");
                }
            });
    }
    $scope.beforeImgId = '';
    $scope.removeBeforeImg = function (id) {
        $scope.beforeImgId = id;
        $('#confirmRemImgModal').modal({
            backdrop: 'static',
            keyboard: false
        });
    }
    $scope.clearDocument = function (imgdocId) {
        $scope.flagdeleteSpinner = true;
        appService.httpGet("removesugesstiondoc/" + imgdocId)
            .then(function (response) {
                $scope.flagdeleteSpinner = false;
                if (response.result) {
                    $("#confirmRemImgModal")
                        .modal("hide");
                    snackbar.create($scope.langTranslate.Document_deleted_succesfully, 3000, "success");
                    $scope.getsuggestionList('onUpdate');
                    $scope.beforeImgId = '';
                } else {
                    if (response.statusCode == 100) {
                        snackbar.create(response.reason, 5000, "error");
                    } else {
                        snackbar.create($scope.langTranslate.Oops_Please_try_again, 5000, "error");
                    }
                }
            });
    }
    //Implementation for all dept
    $scope.setAllDept = function (obj, type) {
        obj.isselect = !obj.isselect;
        var setDept = false
        for (var i = 0; i < $scope.departmentList.length; i++) {
            if (type == 'all') {
                if (obj.isselect) {
                    $scope.departmentList[i].isselect = true;
                } else {
                    $scope.departmentList[i].isselect = false;
                }
            } else {
                if ($scope.departmentList[i].deptName == 'All') {
                    $scope.departmentList[i].isselect = false;
                }
            }
            if ($scope.departmentList[i].isselect) {
                setDept = true;
            }
        }

        //Horizontal selected than hide require field
        $scope.suggestionDet.hdSelected = !setDept;
    }

    $scope.setLine = function (line, type, lineList) {
        if (type == 'single') {
            line.isselect = (line.isselect ? false : true);
            for (var i = 0; i < lineList.length; i++) {
                if (lineList[i].name == 'All') {
                    lineList[i].isselect = false;
                }
            }
        } else if (type == 'All') {
            line.isselect = line.isselect ? false : true;
            for (var i = 0; i < lineList.length; i++) {
                lineList[i].isselect = line.isselect;
            }
        }
    }


    // START FOR EVALUTION HORIZANTAL DEPLOYMENT CHANGE BY SUNANDA 9-11
    $scope.setEvalAllDept = function (obj, type) {
        obj.isEvalselect = !obj.isEvalselect;
        var setDept = false
        for (var i = 0; i < $scope.departmentList.length; i++) {
            if (type == 'all') {
                if (obj.isEvalselect) {
                    $scope.departmentList[i].isEvalselect = true;
                } else {
                    $scope.departmentList[i].isEvalselect = false;
                }
            } else {
                if ($scope.departmentList[i].deptName == 'All') {
                    $scope.departmentList[i].isEvalselect = false;
                }
            }
            if ($scope.departmentList[i].isEvalselect) {
                setDept = true;
            }
        }

        //Horizontal selected than hide require field
        $scope.suggestionDet.hdSelected = !setDept;
    }

    $scope.setEvalLine = function (line, type, lineList) {
        if (type == 'single') {
            line.isEvalselect = (line.isEvalselect ? false : true);
            for (var i = 0; i < lineList.length; i++) {
                if (lineList[i].name == 'All') {
                    lineList[i].isEvalselect = false;
                }
            }
        } else if (type == 'All') {
            line.isEvalselect = line.isEvalselect ? false : true;
            for (var i = 0; i < lineList.length; i++) {
                if ($scope.suggestionDet.lineId != lineList[i].id) {
                    lineList[i].isEvalselect = line.isEvalselect;
                }
            }
        }
    }
    // END OF  EVALUTION HORIZANTAL DEPLOYMENT CHANGE BY SUNANDA 9-11


    // START FOR IMPLEMENTION HORIZANTAL DEPLOYMENT CHANGE BY SUNANDA 9-11
    $scope.setImplLine = function (line, type, lineList) {
        if (type == 'single') {
            line.isImplselect = (line.isImplselect ? false : true);
            for (var i = 0; i < lineList.length; i++) {
                if (lineList[i].name == 'All') {
                    lineList[i].isImplselect = false;
                }
            }
        } else if (type == 'All') {
            line.isImplselect = line.isImplselect ? false : true;
            for (var i = 0; i < lineList.length; i++) {
                if ($scope.suggestionDet.lineId != lineList[i].id) {
                    lineList[i].isImplselect = line.isImplselect;
                }
            }
        }
    }
    // END OF IMPLEMENTION HORIZANTAL DEPLOYMENT CHANGE BY SUNANDA 9-11

    /** Get Suggestion list for nomination */
    $scope.getSuggestionListForNomination = function () {
        $scope.data = {
            branchId: $rootScope.empDetails.branch.branchId,
            empId: $scope.loggedInEmpId
        }
        appService.httpPost($scope.data, "getSuggestionForNomination")
            .then(function (response) {
                $scope.popupTitle = 'Suggestions List';
                $('#mySuggestionListModal').modal({
                    backdrop: 'static',
                    keyboard: false
                });
                if (response.result) {
                    $scope.suggListForNomination = response.list;

                } else {
                    $scope.suggListForNomination = [];
                }
            });
    }

    $scope.submitSuggestionForNomination = function () {

        var data = [];
        for (var i = 0; i < $scope.suggListForNomination.length; i++) {
            if ($scope.suggListForNomination[i].isSelected != undefined && $scope.suggListForNomination[i].isSelected) {
                var tmpObj = {
                    nominationId: $scope.suggestionEvalMstrNomination.id,
                    sugId: $scope.suggListForNomination[i].sugId,
                    empId: $scope.loggedInEmpId,
                    branchId: $scope.loggedInUserBranchId
                };
                data.push(tmpObj);
            }
        }
        if (data.length == 0) {
            snackbar.create($filter('translate')('Please_select_suggestion'), 8000, "error");
            return;
        }
        appService.httpPost(data, "nominateSuggestion")
            .then(function (response) {
                if (response.result) {
                    $('#mySuggestionListModal')
                        .modal('hide');
                    snackbar.create($filter('translate')('Suggestion_succesfully_nominated'), 3000, "success");
                    $scope.getStatusWiseCount();
                    $scope.getsuggestionList('onUpdate');
                    $scope.getJuryTopKiazenList();
                    $scope.getJueryStatusList();
                } else {
                    snackbar.create($filter('translate')('Oops_Please_try_again'), 5000, "error");
                }
            });
    }

    $scope.setNominateSuggRating = function (ratingArray, selectedIndex) {
        for (var i = 0; i < ratingArray.length; i++) {
            if (selectedIndex == i) {
                ratingArray[i].isSelected = true;
            } else {
                ratingArray[i].isSelected = false;
            }
        }
    }
    $scope.toastPopup = function () {
        $('#minSuggModal').modal({
            backdrop: 'static',
            keyboard: false
        });
    }
    $scope.minSuggPopup = false;
    $scope.minSugCount = 0;
    $scope.getPendingSuggestionSubmission = function () {
        let d = new Date();
        let dd = d.getDate();
        let mm = d.getMonth() + 1; //January is 0!
        let yyyy = d.getFullYear();
        var currDate = yyyy + '-' + (mm < 10 ? '0' : '') + mm + '-' + (dd < 10 ? '0' : '') + dd;
        /*----Remove branchId----*/
        appService.httpGet('getPendingSuggestionSubmissionInfo/' + $scope.loggedInEmpId).then(function (response) {
            if (response.result) {
                if (response.list != null && response.list.length > 0) {
                    let res = response.list[0];
                    var suggCount = res.suggLimit - res.suggestionSubmitted;
                    if (suggCount > 0) {
                        $scope.minSugCount = suggCount;
                        $scope.minSuggPopup = true;
                    } else {
                        localStorage.setItem('toastDate', currDate);
                        $scope.minSuggPopup = false;
                    }
                }
            } else {
                localStorage.setItem('toastDate', currDate);
                $scope.minSuggPopup = false;
            }
        })
    }
    $scope.closePopup = function () {
        let d = new Date();
        let dd = d.getDate();
        let mm = d.getMonth() + 1; //January is 0!
        let yyyy = d.getFullYear();
        var currDate = yyyy + '-' + (mm < 10 ? '0' : '') + mm + '-' + (dd < 10 ? '0' : '') + dd;
        localStorage.setItem('toastDate', currDate);
        $scope.minSuggPopup = false;
    }

    // $scope.initMasterDataForSugg();
    $scope.getSavingType();
    var localStorageDate = localStorage.getItem('toastDate');
    if (localStorageDate != null && localStorageDate != '' && localStorageDate != undefined) {
        let d = new Date();
        let dd = d.getDate();
        let mm = d.getMonth() + 1; //January is 0!
        let yyyy = d.getFullYear();
        var currDate = yyyy + '-' + (mm < 10 ? '0' : '') + mm + '-' + (dd < 10 ? '0' : '') + dd;
        if (currDate < localStorageDate) {
            $scope.getPendingSuggestionSubmission();
        }
    } else {
        $scope.getPendingSuggestionSubmission();
    }



    /*------START FOR ONBEHALF SUGGESTION---------------CHANGE BY SUNANDA 30-10------------------------------*/
    $scope.showonBehafEmployeeList = function () {
        $scope.getEmployeeList($scope.loggedInUserBranchId);
        $("#addonBehafEmployee").modal({
            backdrop: 'static',
            keyboard: false
        });
    }
    $scope.setSelectedOnbehalfEmp = function (data) {
        $("#addonBehafEmployee")
            .modal("hide");
        $scope.selectedEmp = data;
    }

    $scope.getEmployeeList = function (branchId) {
        if ($scope.employeeList != null && $filter('filter')($scope.employeeList, {
            branch: { branchId: branchId }
        }, true).length > 0) {
            $scope.flagTeamDetNotAvailMsg = false;
            $scope.flagTeamDetPopupLoading = false;
            $scope.empListByTeamType = angular.copy($scope.employeeList);
            return;
        }
        $scope.flagEmployeeListSpinner = true;
        var data = {
            branchIds: [branchId],
        }
        appService.httpPost(data, "getAllEmpListByBrannchIds")
            .then(function (response) {
                $scope.flagTblemployee = true;
                $scope.flagTeamDetNotAvailMsg = false;
                $scope.flagTeamDetPopupLoading = false;
                if (response.result) {
                    if (response.allEmpDetails != null && response.allEmpDetails.length > 0) {
                        for (let index = 0; index < response.allEmpDetails.length; index++) {
                            var name = '';
                            if (response.allEmpDetails[index].firstName) {
                                name += response.allEmpDetails[index].firstName;
                            }

                            if (response.allEmpDetails[index].lastName) {
                                if (response.allEmpDetails[index].firstName) {
                                    name += ' ';
                                }
                                name += response.allEmpDetails[index].lastName;
                            }
                            if (response.allEmpDetails[index].cmpyEmpId) {
                                name += ' (' + response.allEmpDetails[index].cmpyEmpId + ')';
                            }
                            response.allEmpDetails[index].empName = name;
                            response.allEmpDetails[index].selectedId = 0;
                        }
                        $scope.employeeList = response.allEmpDetails;
                        $scope.empListByTeamType = angular.copy(response.allEmpDetails);
                    } else {
                        $scope.employeeList = [];
                        $scope.empListByTeamType = [];
                    }
                } else {
                    $scope.employeeList = [];
                    $scope.empListByTeamType = [];
                }
            });
    }
    $scope.getEmployeeList($scope.loggedInUserBranchId);
    $scope.selectedEmpList = [];
    $scope.setSelectedTeamMember = function (data) {
        data.isSelected = (data.isSelected ? false : true);
        if (data.isSelected) {
            $scope.selectedEmpList.push(data);
        } else {
            for (var i = 0; i < $scope.selectedEmpList.length; i++) {
                if ($scope.selectedEmpList[i].empId == data.empId) {
                    $scope.selectedEmpList.splice(i, 1);
                }
            }
        }
    }
    $scope.removeSelectedTeamMember = function (data, index) {
        $scope.selectedEmpList.splice(index, 1);
        for (var i = 0; i < $scope.employeeList.length; i++) {
            if ($scope.employeeList[i].empId == data.empId) {
                $scope.employeeList[i].isSelected = false;
            }
        }

    }
    /*------END OF ONBEHALF SUGGESTION---------------CHANGE BY SUNANDA 30-10------------------------------*/
    /*------START FOR LATERAL ENTRY SUGGESTION---------------CHANGE BY SUNANDA 7-11------------------------------*/
    /*--------------------- START FOR TAB SWITCH SUGGESTION----------------------------------------*/
    $scope.setLateralTab = function (tab) {
        $scope.lateralTab = tab;
        if (tab == 1) {

        } else if (tab == 2) {
            $scope.isSet(1);
        } else if (tab == 3) {

        }

    }
    $scope.isSetLateralTab = function (tabId) {
        return $scope.lateralTab === tabId;
    };
    $scope.setLateralTab(1);
    $scope.currentlateralform = {}
    $scope.initatorClear = function (formObj) {
        $scope.currentlateralform = formObj;
    }
    $scope.closeLateralForm = function () {
        $scope.currentlateralform.createInitiatorLateralEntryForm.$setPristine();
        $scope.currentlateralform.createEvaluatorLateralEntryForm.$setPristine();
        $scope.currentlateralform.createNewlateralEntryForm.$setPristine();
        $scope.laterlEnteryDet.flagFirstTab = false;
        $scope.laterlEnteryDet.flagSecondTab = false;
        $scope.newdeptfocus = false;
    }

    $scope.setlateralFormDate = function (type) {
        if (type === 'initiator') {
            // $scope.laterlEntery.lateralInitiatorDate = $filter('date')(new Date(), 'yyyy-MM-dd');
        } else if (type === 'evaluator') {
            $scope.laterlEntery.lateralEvalDate = $scope.laterlEntery.lateralInitiatorDate;
        } else if (type === 'implementer') {
            $scope.laterlEntery.lateralImpleDate = $scope.laterlEntery.lateralEvalDate;
        }
    }


    /**/
    /*---------------------END OF TAB SWITCH SUGGESTION----------------------------------------*/
    /*---------------------START FOR CREATE LATERAL SUGGESTION----------------------------------------*/
    $scope.laterlEvalutionList = function () {
        appService.httpGet("getlistofusersbranchwise/" + $scope.loggedInUserBranchId + "/0/0/8").then(function (response) {
            if (response.result) {
                $scope.evalulterLateralList = response.deptlvlusersList;
            } else {
                $scope.evalulterLateralList = [];
            }
        });
    }
    $scope.laterlimplList = function () {
        var req = {
            "orgId": $rootScope.empDetails.organization.orgId,
            "branchId": $rootScope.empDetails.branch.branchId,
            "userType": { "id": 3 }
        }
        appService.httpPost(req, 'getSuggestionUserDetails').then(function (response) {
            $scope.flagTeamDetPopupLoading = false;
            if (response.result) {
                if (response.list != null && response.list.length > 0) {
                    $scope.implLateralList = response.list;
                } else {
                    $scope.implLateralList = [];
                }
            } else {
                $scope.implLateralList = [];
            }
        });
        /*  appService.httpGet("getemplistrolewise/" + $scope.loggedInUserBranchId + "/9").then(function (response) {
            // if (response.result) {
            //     $scope.implLateralList = response.allEmpDetails;
            // } else {
            //     $scope.implLateralList = [];
            // }
            if (response.result && response.allEmpDetails && response.allEmpDetails.length > 0) {
                $scope.implLateralList = response.allEmpDetails;
            } else {
                $scope.implLateralList = $scope.empListByTeamType;
            }
         }); */
    }

    /*----------------horizantal deployment selection-----*/
    $scope.getlateralDeptLineList = function (dept) {
        if (dept) {
            appService.httpGet("getLineNameList/" + dept.deptId).then(function (response) {
                $scope.linefocus = true;
                if (response.result) {
                    var lineData = $filter('filter')(response.lineList, { isActive: '!N' }, true);
                    dept.lineList = lineData; //response.lineList;
                    dept.lineList.push({
                        name: "All",
                        id: 0
                    });
                    dept.lineFound = true;
                    $scope.newdeptfocus = false;
                } else {
                    dept.lineFound = false;
                }
            });
        }
    }


    $scope.setLateralDept = function (obj, type) {
        obj.isLateralselect = !obj.isLateralselect;
        for (var i = 0; i < $scope.departmentList.length; i++) {
            if (type == 'all') {
                if (obj.isLateralselect) {
                    $scope.departmentList[i].isLateralselect = true;
                } else {
                    $scope.departmentList[i].isLateralselect = false;
                }
            } else {
                if ($scope.departmentList[i].deptName == 'All') {
                    $scope.departmentList[i].isLateralselect = false;
                }
            }
        }
    }

    $scope.setLateralLine = function (line, type, lineList) {
        if (type == 'single') {
            line.isLateralselect = (line.isLateralselect ? false : true);
            for (var i = 0; i < lineList.length; i++) {
                if (lineList[i].name == 'All') {
                    lineList[i].isLateralselect = false;
                }
            }
        } else if (type == 'All') {
            line.isLateralselect = line.isLateralselect ? false : true;
            for (var i = 0; i < lineList.length; i++) {
                if ($scope.laterlEntery.line.id != lineList[i].id) {
                    lineList[i].isLateralselect = line.isLateralselect;
                }
            }
        }
        ////console.log(lineList);
    }
    /*----------------horizantal deployment selection-----*/
    $scope.createLateralEntryPopup = function () {
        $scope.laterlEnteryDet.flagFirstTab = false;
        $scope.laterlEnteryDet.flagSecondTab = false;
        $scope.setLateralTab(1)
        $scope.laterlEntery = {}
        $scope.selectedEmpList = [];
        $scope.laterlEntery = {};
        $scope.evalMachineHDList = {};
        $scope.files = [];
        $scope.implFiles = [];
        $scope.resultImageFiles = [];
        $scope.currentlateralform.createInitiatorLateralEntryForm.$setPristine();
        // $scope.currentlateralform.createEvaluatorLateralEntryForm.$setPristine();
        // $scope.currentlateralform.createNewlateralEntryForm.$setPristine();
        // 11-11 chnage
        for (var i = 0; i < $scope.employeeList.length; i++) {
            $scope.employeeList[i].isSelected = false;
        }
        for (var i = 0; i < $scope.documentLists.length; i++) {
            $scope.documentLists[i].isChecked = false;
        }
        for (var i = 0; i < $scope.activityList.length; i++) {
            $scope.activityList[i].isselect = false;
        }
        for (var i = 0; i < $scope.departmentList.length; i++) {
            $scope.departmentList[i].isLateralselect = false;
            if ($scope.departmentList[i].lineList != null && $scope.departmentList[i].lineList.length > 0) {
                for (let j = 0; j < $scope.departmentList[i].lineList.length; j++) {
                    $scope.departmentList[i].lineList[j].isLateralselect = false;
                }
            }
        }
        for (var i = 0; i < $scope.benefitList.length; i++) {
            $scope.benefitList[i].isselect = false;
        }
        for (let i = 0; i < $scope.hDBranchList.length; i++) {
            $scope.hDBranchList[i].isEvalPlantselect = false
        }
        $scope.laterlEntery.tmpIsDocumentChangeRequire = false;
        $scope.getParticular($rootScope.empDetails.branch.branchId);
        $scope.laterlEvalutionList();
        $scope.machineHDList = [];
        $scope.laterlimplList();
        $("#addLateralEntry")
            .modal({
                backdrop: 'static',
                keyboard: false
            });
    }

    $scope.laterlEntery = {}
    $scope.laterlEnteryDet = {}
    /* Start Initiator validation*/
    $scope.createInitiatorlateralEntry = function (form) {
        ////console.log(form)
        if (form.$invalid) {
            angular.forEach(form.$error.required, function (field) {
                field.$setDirty();
            });
            return;
        } else {
            $scope.laterlEnteryDet.flagFirstTab = true;
            $scope.setLateralTab(2)
        }
    }
    /* End Initiator validation*/
    /* start Evalutor validation*/
    $scope.createEvaluatorLateralEntry = function (form) {
        ////console.log(form)
        if (form.$invalid) {
            angular.forEach(form.$error.required, function (field) {
                field.$setDirty();
            });
            return;
        } else {
            $scope.laterlEnteryDet.flagSecondTab = true;
            $scope.setLateralTab(3)
        }
    }
    /* Lateral HD Pillar Level API*/
    $scope.evalMachineHDList = {};
    $scope.resetLateralHDVal = function (select) {
        if (select == 'circle') {
            $scope.lateralHDStageList = [];
            $scope.lateralHDProdFamilyList = [];
            $scope.lateralHDProdNoList = [];
            $scope.lateralHDMachineList = [];
            $scope.lateralHDOperationList = [];
            $scope.evalMachineHDList.stage = undefined;
            $scope.evalMachineHDList.product = undefined;
            $scope.evalMachineHDList.productNo = undefined;
            $scope.evalMachineHDList.machine = undefined;
            $scope.evalMachineHDList.operation = undefined;
        } else if (select == 'stage') {
            $scope.lateralHDProdFamilyList = [];
            $scope.lateralHDProdNoList = [];
            $scope.lateralHDMachineList = [];
            $scope.lateralHDOperationList = [];
            $scope.evalMachineHDList.product = undefined;
            $scope.evalMachineHDList.productNo = undefined;
            $scope.evalMachineHDList.machine = undefined;
            $scope.evalMachineHDList.operation = undefined;
        } else if (select == 'prodFamily') {
            $scope.lateralHDProdNoList = [];
            $scope.lateralHDMachineList = [];
            $scope.lateralHDOperationList = [];
            $scope.evalMachineHDList.productNo = undefined;
            $scope.evalMachineHDList.machine = undefined;
            $scope.evalMachineHDList.operation = undefined;
        } else if (select == 'prodNo') {
            $scope.lateralHDMachineList = [];
            $scope.lateralHDOperationList = [];
            $scope.evalMachineHDList.machine = undefined;
            $scope.evalMachineHDList.operation = undefined;
        } else if (select == 'machine') {
            $scope.lateralHDOperationList = [];
            $scope.evalMachineHDList.operation = undefined;
        } else if (select == 'operationType') { }
    }
    // stage list by circleId 
    $scope.getLateralHDStageListByCircleId = function (circleId) {
        $scope.resetLateralHDVal('circle');
        appService.httpGet("getMasterStageByCircleId/" + $scope.loggedInUserBranchId + '/' + circleId).then(function (response) {
            if (response.result) {
                if (response.masterStageList != null && response.masterStageList.length > 0) {
                    $scope.lateralHDStageList = response.masterStageList;
                } else {
                    $scope.lateralHDStageList = [];
                }
            } else {
                $scope.lateralHDStageList = [];
            }
        });
    }
    $scope.getLateralHDProductFamilyListByStageId = function (stageId) {
        $scope.resetLateralHDVal('stage');
        appService.httpGet("getProductFamilyByStage/" + $scope.loggedInUserBranchId + '/' + stageId).then(function (response) {
            if (response.result) {
                if (response.masterProductFamilyList != null && response.masterProductFamilyList.length > 0) {
                    $scope.lateralHDProdFamilyList = response.masterProductFamilyList;
                } else {
                    $scope.lateralHDProdFamilyList = [];
                }
            } else {
                $scope.lateralHDProdFamilyList = [];
            }
        });
    }
    $scope.getLatralHDProductNoListByproductId = function (prodId) {
        $scope.resetLateralHDVal('prodFamily');
        $scope.data = {
            branchId: $scope.loggedInUserBranchId,
            productFamilyId: prodId
        }
        appService.httpPost($scope.data, "getProductNo").then(function (response) {
            if (response.result) {
                if (response.productNoList != null && response.productNoList.length > 0) {
                    $scope.lateralHDProdNoList = response.productNoList;
                } else {
                    $scope.lateralHDProdNoList = [];
                }
            } else {
                $scope.lateralHDProdNoList = [];
            }
        });
    }
    $scope.getLatralHDMachineListByproductNoId = function (prodNoId) {
        $scope.resetLateralHDVal('prodNo');
        appService.httpGet("getMachineListByProductNo/" + $scope.loggedInUserBranchId + '/' + prodNoId)
            .then(function (response) {
                if (response.result) {
                    if (response.masterMachineList != null && response.masterMachineList.length > 0) {
                        $scope.lateralHDMachineList = response.masterMachineList;
                    } else {
                        $scope.lateralHDMachineList = [];
                        if (prodNoId) {
                            $scope.getLateralHDOperationList(data, 0)
                        }
                    }
                } else {
                    $scope.lateralHDMachineList = [];
                    if (prodNoId) {
                        $scope.getLateralHDOperationList(data, 0)
                    }
                }
            });
    }
    $scope.getLateralHDOperationList = function (ProductNoId, machineId) {
        $scope.resetLateralHDVal('machine');
        $scope.data = {
            branchId: $scope.loggedInUserBranchId,
            productNoId: ProductNoId,
            machineId: machineId ? machineId : 0,
        }
        appService.httpPost($scope.data, "getMasterOperationList").then(function (response) {
            if (response.result) {
                if (response.masterOperationlist != null && response.masterOperationlist.length > 0) {
                    $scope.lateralHDOperationList = response.masterOperationlist;
                } else {
                    $scope.lateralHDOperationList = [];
                }
            } else {
                $scope.lateralHDOperationList = [];
            }
        });
    }
    /* Lateral HD Pillar Level API*/
    /* start Evalutor validation*/
    $scope.createNewlateralEntry = function (isValid, form) {
        if (isValid) {
            var formData = new FormData();
            formData.append("orgId", $scope.loggedInUserOrgId);
            formData.append("branchId ", $scope.loggedInUserBranchId);
            formData.append('sourceType', 'portal');
            formData.append('createdBy', $scope.loggedInEmpId);
            formData.append('tmtypeId', 2);
            /*---------------START FOR INITITOR----------------------*/
            formData.append("empId", $scope.laterlEntery.empId.empId);
            formData.append("cntrlEmpId", $scope.laterlEntery.cntrlEmpId.empId);
            if ($scope.laterlEntery.suggestionSource != null && $scope.laterlEntery.suggestionSource != undefined) {
                formData.append('suggestionSource', $scope.laterlEntery.suggestionSource.id.id);
            }
            if ($scope.laterlEntery.catId != null && $scope.laterlEntery.catId != undefined) {
                formData.append("catId", $scope.laterlEntery.catId.catId);
            }
            if ($scope.laterlEntery.suggestionTitle != null && $scope.laterlEntery.suggestionTitle != undefined) {
                formData.append("suggestionTitle", $scope.laterlEntery.suggestionTitle);
            }
            if ($scope.laterlEntery.problemAnalysis != null && $scope.laterlEntery.problemAnalysis != undefined) {
                formData.append("problemAnalysis", $scope.laterlEntery.problemAnalysis);
            }
            if ($scope.laterlEntery.sugession != null && $scope.laterlEntery.sugession != undefined) {
                formData.append("suggestion", $scope.laterlEntery.sugession);
            }
            //  formData.append("implAction", $scope.laterlEntery.implAction);
            if ($scope.laterlEntery.deptId != undefined && $scope.laterlEntery.deptId != null && $scope.laterlEntery.deptId != '') {
                formData.append("deptId", $scope.laterlEntery.deptId.deptId);
            }
            if ($scope.laterlEntery.line != null) {
                formData.append('lineId', $scope.laterlEntery.line.id);
            }

            if ($rootScope.empDetails.productOrgConfigDet.isBeforeUploadImageOn == 1 && ($scope.files == null || $scope.files.length == 0 || $scope.implFiles == null || $scope.implFiles.length == 0)) {
                snackbar.create('Please select before or after image', 3000, 'error')
                return;
            }
            if ($scope.files != null && $scope.files.length > 0) {
                for (var i in $scope.files) {
                    formData.append("sugImg", $scope.files[i]);
                }
            }
            if ($scope.implFiles != null && $scope.implFiles.length > 0) {
                for (var i in $scope.implFiles) {
                    formData.append("afterImg", $scope.implFiles[i]);
                }
            }
            //START FOR CIRCLE SUGGESTION---------------CHANGE BY SUNANDA 1-1-2020
            if ($scope.laterlEntery.activityId != undefined && $scope.laterlEntery.activityId != null && $scope.laterlEntery.activityId != '') {
                formData.append('pillarId', $scope.laterlEntery.activityId.id);
            }
            if ($scope.laterlEntery.circleId != null && $scope.laterlEntery.circleId != undefined) {
                if ($scope.laterlEntery.circleId.id > 0 && $scope.laterlEntery.circleId != undefined && $scope.laterlEntery.circleId != null && $scope.laterlEntery.circleId != '') {
                    formData.append('circleId', $scope.laterlEntery.circleId.id);
                }
                if ($scope.laterlEntery.stageId != undefined && $scope.laterlEntery.stageId != null && $scope.laterlEntery.stageId != '') {
                    formData.append('stageId', $scope.laterlEntery.stageId.id);
                }
                if ($scope.laterlEntery.machineId != undefined && $scope.laterlEntery.machineId != null && $scope.laterlEntery.machineId != '') {
                    formData.append('machineId', $scope.laterlEntery.machineId.id);
                }
                if ($scope.laterlEntery.opertionId != undefined && $scope.laterlEntery.opertionId != null && $scope.laterlEntery.opertionId != '') {
                    formData.append('operationId', $scope.laterlEntery.opertionId.id);
                }
                if ($scope.laterlEntery.productNoId != undefined && $scope.laterlEntery.productNoId != null && $scope.laterlEntery.productNoId != '') {
                    formData.append('masterProductNo.id', $scope.laterlEntery.productNoId.id);
                }
                if ($scope.laterlEntery.productId != undefined && $scope.laterlEntery.productId != null && $scope.laterlEntery.productId != '') {
                    formData.append('productId', $scope.laterlEntery.productId.id);
                }
            }

            if ($scope.laterlEntery.target != undefined && $scope.laterlEntery.target != null && $scope.laterlEntery.target != '') {
                formData.append('target', $scope.laterlEntery.target);
            }
            if ($scope.laterlEntery.benchmark != undefined && $scope.laterlEntery.benchmark != null && $scope.laterlEntery.benchmark != '') {
                formData.append('benchmark', $scope.laterlEntery.benchmark);
            }
            /*---------------END FOR INITITOR----------------------*/

            /*---------------START FOR EVALUATOR----------------------*/
            formData.append("evalEmpId", $scope.laterlEntery.evalEmpId.empId);
            if ($scope.laterlEntery.evaluationInputs != null && $scope.laterlEntery.evaluationInputs != undefined) {
                formData.append("summary", $scope.laterlEntery.evaluationInputs);
            }
            // ADVIK CHNAEG BY SUNANDA 4-3-2020   
            if ($scope.whyWhyAnalysisforImpl != null) {
                for (var k = 0; k < $scope.whyWhyAnalysisforImpl.length; k++) {
                    if ($scope.whyWhyAnalysisforImpl[k].whyWhyAnalysis != '') {
                        formData.append("suggestionWhyWhyAnalysis[" + k + "].name", $scope.whyWhyAnalysisforImpl[k].whyWhyAnalysis);
                    }
                }
            }

            if ($scope.laterlEntery.whatToDo != null && $scope.laterlEntery.whatToDo != undefined && $scope.laterlEntery.whatToDo != '') {
                formData.append('whatToDo', $scope.laterlEntery.whatToDo);
            }
            if ($scope.laterlEntery.howToDo != null && $scope.laterlEntery.howToDo != undefined && $scope.laterlEntery.howToDo != '') {
                formData.append('howToDo', $scope.laterlEntery.howToDo);
            }
            if ($scope.laterlEntery.benefits != null && $scope.laterlEntery.benefits != undefined && $scope.laterlEntery.benefits != '') {
                formData.append('benefits', $scope.laterlEntery.benefits);
            }
            if ($scope.laterlEntery.results != null && $scope.laterlEntery.results != undefined && $scope.laterlEntery.results != '') {
                formData.append('results', $scope.laterlEntery.results);
            }
            if ($scope.laterlEntery.kaizenIdea != null && $scope.laterlEntery.kaizenIdea != undefined && $scope.laterlEntery.kaizenIdea != '') {
                formData.append('kaizenIdea', $scope.laterlEntery.kaizenIdea);
            }
            if ($scope.laterlEntery.frquency != null && $scope.laterlEntery.frquency != undefined && $scope.laterlEntery.frquency != '') {
                formData.append('frquency', $scope.laterlEntery.frquency);
            }
            if ($scope.laterlEntery.counterMeasures != null && $scope.laterlEntery.counterMeasures != undefined && $scope.laterlEntery.counterMeasures != '') {
                formData.append('counterMeasures', $scope.laterlEntery.counterMeasures);
            }
            if ($scope.laterlEntery.rootCause != null && $scope.laterlEntery.rootCause != undefined && $scope.laterlEntery.rootCause != '') {
                formData.append('rootCause', $scope.laterlEntery.rootCause);
            }
            //start for suggestion activity
            var selectedActivity = [];
            for (var i = 0; i < $scope.activityList.length; i++) {
                if ($scope.activityList[i].isselect) {
                    var tmp = {
                        id: $scope.activityList[i].id,
                        suggestion: {
                            sugId: $scope.selectedSuggId
                        },
                        activity: $scope.activityList[i]
                    };
                    selectedActivity.push(tmp);
                }
            }
            var activecount = 0;
            if (selectedActivity != null) {
                for (var i in selectedActivity) {
                    formData.append("suggActivity[" + activecount + "].activity.id", selectedActivity[i].id);
                    activecount++;
                }
            }
            //END for suggestion activity

            //start for change document
            var selectedDocumentLists = [];
            for (var i = 0; i < $scope.documentLists.length; i++) {
                if ($scope.documentLists[i].isChecked) {
                    selectedDocumentLists.push($scope.documentLists[i]);
                }
            }
            var doccount = 0;
            if (selectedDocumentLists != null) {
                for (var i in selectedDocumentLists) {
                    formData.append("document[" + doccount + "].document.id", selectedDocumentLists[i].id);
                    doccount++;
                }
            }
            if ($scope.laterlEntery.tmpIsDocumentChangeRequire) {
                formData.append("isDocumentChangeRequire", 'N/A');
            } else {
                if ($scope.documentLists != null && $filter('filter')($scope.documentLists, { isChecked: true }, true).length == 0) {
                    formData.append("isDocumentChangeRequire", 'N/A');
                } else {
                    formData.append("isDocumentChangeRequire", 'Y');
                }
            }
            //-ADVIK CHNAEG BY SUNANDA 4-3-2020   
            var HDbranchIds = [];
            for (let i = 0; i < $scope.hDBranchList.length; i++) {
                if ($scope.hDBranchList[i].isEvalPlantselect) {
                    HDbranchIds.push({
                        branchId: $scope.hDBranchList[i].branchId
                    });
                }
            }
            var horiCount = 0;
            for (var i = 0; i < HDbranchIds.length; i++) {
                formData.append("suggestionHorizontalDept[" + horiCount + "].branchId", HDbranchIds[i].branchId);
                formData.append("suggestionHorizontalDept[" + horiCount + "].hdType", 'ORG_LEVEL');
                horiCount++;
            }

            //End of change document
            //start for horizantal department
            if ($scope.laterlEntery.deptId != null) {
                for (var k = 0; k < $scope.departmentList.length; k++) {
                    if ($scope.departmentList[k].lineFound != null && $scope.departmentList[k].lineList != null) {
                        for (var l = 0; l < $scope.departmentList[k].lineList.length; l++) {
                            var lineFound = false;
                            if ($scope.suggestionDet.suggestionHorizontalDept != null) {
                                for (var m = 0; m < $scope.suggestionDet.suggestionHorizontalDept.length; m++) {
                                    if ($scope.departmentList[k].deptId == $scope.suggestionDet.suggestionHorizontalDept[m].deptId &&
                                        $scope.departmentList[k].lineList[l].lineId == $scope.suggestionDet.suggestionHorizontalDept[m].lineId) {
                                        lineFound = true;
                                    }
                                }
                            }
                            if (!lineFound && $scope.departmentList[k].lineList[l].isLateralselect && $scope.departmentList[k].lineList[l].name != 'All') {
                                formData.append("suggestionHorizontalDept[" + horiCount + "].lineId", $scope.departmentList[k].lineList[l].id);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].deptId", $scope.departmentList[k].deptId);
                                formData.append("suggestionHorizontalDept[" + horiCount + "].hdType", 'PLANT_LEVEL');
                                horiCount++;
                            }
                        }
                    } else {
                        var deptFound = false;
                        if ($scope.suggestionDet.suggestionHorizontalDept != null) {
                            for (var m = 0; m < $scope.suggestionDet.suggestionHorizontalDept.length; m++) {
                                if ($scope.departmentList[k].deptId == $scope.suggestionDet.suggestionHorizontalDept[m].deptId &&
                                    $scope.suggestionDet.suggestionHorizontalDept[m].lineId == 0) {
                                    deptFound = true;
                                }
                            }
                        }
                        if (!deptFound && $scope.departmentList[k].isLateralselect && $scope.departmentList[k].deptName != 'All') {
                            formData.append("suggestionHorizontalDept[" + horiCount + "].deptId", $scope.departmentList[k].deptId);
                            formData.append("suggestionHorizontalDept[" + horiCount + "].hdType", 'PLANT_LEVEL');
                            horiCount++;
                        }
                    }
                }
            }

            if ($scope.laterlEntery.circleId != null) {
                if ($scope.machineHDList != null && $scope.machineHDList.length > 0) {
                    for (var l = 0; l < $scope.machineHDList.length; l++) {
                        if ($scope.machineHDList[l].machine != null && $scope.machineHDList[l].machine != undefined) {
                            formData.append("suggestionHorizontalDept[" + horiCount + "].machineId", $scope.machineHDList[l].machine.id);
                        } else {
                            formData.append("suggestionHorizontalDept[" + horiCount + "].machineId", 0);
                        }
                        formData.append("suggestionHorizontalDept[" + horiCount + "].circleId", $scope.machineHDList[l].circle.id);
                        formData.append("suggestionHorizontalDept[" + horiCount + "].stageId", $scope.machineHDList[l].stage.id);
                        formData.append("suggestionHorizontalDept[" + horiCount + "].productId", $scope.machineHDList[l].product.id);
                        formData.append("suggestionHorizontalDept[" + horiCount + "].productNoId", $scope.machineHDList[l].productNo.id);
                        formData.append("suggestionHorizontalDept[" + horiCount + "].operationId", $scope.machineHDList[l].operation.id);
                        formData.append("suggestionHorizontalDept[" + horiCount + "].hdType", 'PLANT_LEVEL');
                        horiCount++;
                    }
                }
            }
            //End for horizantal department
            /*---------------END FOR EVALUATOR----------------------*/
            /*----------------START FOR IMPLEMENTER INPUT---------------------7-11*/
            formData.append("implEmpId", $scope.laterlEntery.implEmpId.empId);
            if ($scope.laterlEntery.implAction != null && $scope.laterlEntery.implAction != undefined && $scope.laterlEntery.implAction != '') {
                formData.append("implSummary", $scope.laterlEntery.implAction);
            }
            if ($scope.laterlEntery.implactionSummary != null && $scope.laterlEntery.implactionSummary != undefined && $scope.laterlEntery.implactionSummary != '') {
                formData.append("implAction", $scope.laterlEntery.implactionSummary);
            }
            if ($scope.laterlEntery.implementedCost != null && $scope.laterlEntery.implementedCost != undefined && $scope.laterlEntery.implementedCost != '') {
                formData.append("implementedCost", $scope.laterlEntery.implementedCost);
            }
            if ($scope.laterlEntery.costEffective != null && $scope.laterlEntery.costEffective != undefined && $scope.laterlEntery.costEffective != '') {
                formData.append("costEffective", $scope.laterlEntery.costEffective);
            }
            var empIdforImplement = [];
            if ($scope.selectedEmpList != null && $scope.selectedEmpList.length > 0) {
                for (var i = 0; i < $scope.selectedEmpList.length; i++) {
                    if ($scope.selectedEmpList[i].isSelected == true) {
                        empIdforImplement.push($scope.selectedEmpList[i].empId);
                    }
                }
            }
            // ADVIK 7-3-2020  RESULT IMAGE CHANGE 
            if ($scope.resultImageFiles.length > 0) {
                for (var i in $scope.resultImageFiles) {
                    formData.append("resultDoc", $scope.resultImageFiles[i]);
                }
            }
            var canvas = $("#resultImageGraph").get(0);
            if (canvas != null && canvas != undefined && canvas != '') {
                var dataURL = canvas.toDataURL();
                formData.append("resultImageBase64", dataURL);
            }

            if (empIdforImplement != null) {
                for (var i in empIdforImplement) {
                    formData.append("empIds[" + i + "]", empIdforImplement[i]);
                }
            }

            var selectedbenefitList = [];
            for (var i = 0; i < $scope.benefitList.length; i++) {
                if ($scope.benefitList[i].isBenefitChecked) {
                    selectedbenefitList.push($scope.benefitList[i].benfitId);
                }
            }
            var benifitcount = 0;
            if (selectedbenefitList != null) {
                for (var i in selectedbenefitList) {
                    formData.append("benefitIds[" + benifitcount + "]", selectedbenefitList[i]);
                    benifitcount++;
                }
            }
            /* Date Initiation, Evaluation, Implementation */
            if ($scope.laterlEntery.lateralInitiatorDate) {
                formData.append("lateralInitiatorDate", moment($scope.laterlEntery.lateralInitiatorDate).format('YYYY-MM-DD'));
            }
            if ($scope.laterlEntery.lateralEvalDate) {
                formData.append("lateralEvalDate", moment($scope.laterlEntery.lateralEvalDate).format('YYYY-MM-DD'));
            }
            if ($scope.laterlEntery.lateralImpleDate) {
                formData.append("lateralImpleDate", moment($scope.laterlEntery.lateralImpleDate).format('YYYY-MM-DD'));
            }
            /* // Display the key/value pairs
            for (var pair of formData.entries()) {
                console.log(pair[0] + ', ' + pair[1]);
            }
            var x = 0;
            if (x === 0) {
                return;
            } */
            /*----------------END FOR IMPLEMENTER INPUT---------------------7-11*/
            appService.uploadFileToUrl(formData, "suggestion/saveLateralEntry")
                .then(function (response) {
                    ////console.log(response);
                    if ($scope.status == "department") {
                        if (response.data.result) {

                            $scope.resultImageFiles = []
                            $("#addLateralEntry")
                                .modal('hide');
                            $scope.whyWhyAnalysisforImpl = [{
                                whyWhyAnalysis: ''
                            }];
                            $scope.suggCreatedTitle = "Awesome !";
                            $scope.lateralCreatedMsg = "Kaizen added successfully!";
                            $("#latearlMsgCreateSugg")
                                .modal({
                                    backdrop: 'static',
                                    keyboard: false
                                });
                            $scope.laterlEnteryDet.flagFirstTab = false;
                            $scope.laterlEnteryDet.flagSecondTab = false;
                            // $scope.currentlateralform.createInitiatorLateralEntryForm.$setPristine();
                            // $scope.currentlateralform.createEvaluatorLateralEntryForm.$setPristine();
                            // $scope.currentlateralform.createNewlateralEntryForm.$setPristine();
                            if ($scope.statusCountFilter == 0) {
                                $scope.getsuggestionList('allSuggestion');
                            } else {
                                $scope.getsuggestionList("onUpdate");
                            }
                            $scope.getStatusWiseCount();;
                        } else {
                            if (response.statusCode == 100) {
                                snackbar.create(response.reason, 5000, "error");
                            } else {
                                snackbar.create($filter('translate')('Oops_Please_try_again'), 5000, "error");
                            }

                        }
                    }
                });
        } else {
            angular.forEach(form.$error.required, function (field) {
                field.$setDirty();
            });
        }
    }

    $scope.nextPrev = function (type) {

    }

    /*---------------------END OF CREATE LATERAL SUGGESTION----------------------------------------*/
    /*------END OF LATERAL ENTRY SUGGESTION---------------CHANGE BY SUNANDA 30-10------------------------------*/
    /*--START FOR ASSIGN TO FINANCE CONTROLLER FOR TIMELINE AT EVALUATOR-------------------------CHANGE BY SUNNANDA------------19-11-19  --*/

    //Set finance Target Date at Eval 
    $scope.setFCEvalTargetDate = function () {
        $scope.suggestionDet.fCEvalEndDate = $filter('date')(new Date(), 'yyyy-MM-dd');
        // $('.target-date-picker').datepicker({ 'update': $scope.fCEvalEndDate, 'autoclose': true, 'todayHighlight': true });
    }

    $scope.change_flag_fcEvalEndDate = function () {
        $scope.suggestionInputDetails.acceptRejectStatus = "accept";
        $scope.suggestionInputDetails.acceptRejBy = "byFCEval";
        if ($scope.suggestionDet.fCEvalEndDate == '' || $scope.suggestionDet.fCEvalEndDate == undefined || $scope.suggestionDet.fCEvalEndDate == null) {
            $scope.flagRejectSugg = true;
        } else {
            if ($scope.roleEscalationList == undefined || $scope.roleEscalationList == null) {
                $scope.getRoleEscalateInfo();
            } else {
                $scope.calculateTaskTime();
            }
            $scope.suggestionDet.fcEvalTaskDeviationInput = '';
            $scope.scrollToBottom('#suggDetailsContainer');
            $scope.flagRejectSugg = false;
        }
    }

    $scope.saveFinanceApprovalTimelineAtEval = function () {
        $scope.data = {
            "sugId": $scope.selectedSuggId,
            "statusId": $scope.CONST.STATUS.UnderFinanceApproval.statusId,
            "assignedById": parseInt($scope.loggedInEmpId),
            "branchId": $scope.suggestionDet.branch.branchId, //$scope.loggedInUserBranchId,
            "orgId": $scope.loggedInUserOrgId,
            "actionDate": $scope.suggestionDet.fCEvalEndDate,
            "summary": $scope.suggestionDet.fcEvalTaskDeviationInput
        }
        if ($scope.suggestionDet.fCEvalEndDate == '' || $scope.suggestionDet.fCEvalEndDate == undefined || $scope.suggestionDet.fCEvalEndDate == null) {
            $scope.flagRejectSugg = true;
            angular.element("#errId_fcEvalEndDate")
                .text($filter('translate')('Please_select_estimated_evaluation_time'));
            return;
        }

        if ($scope.suggestionDet.fcEvalTaskDeviation && ($scope.suggestionDet.fcEvalTaskDeviationInput == undefined || $scope.suggestionDet.fcEvalTaskDeviationInput == null)) {
            snackbar.create($filter('translate')('Please_capture_reason_timeline_deviation'), 5000, "error");
            return;
        }
        ////console.log($scope.data);
        appService.httpPost($scope.data, "saveSuggestionAcceptedTimelineDetails")
            .then(function (response) {
                $scope.flagTeamDetPopupSpinner = false;
                if (response.result) {
                    $scope.getStatusWiseCount();
                    $scope.getSuggestionListOnUpdate();
                    snackbar.create($filter('translate')('Suggestion_accepted_by_finance_controller'), 3000, "success");
                } else {
                    snackbar.create($filter('translate')('Oops_Please_try_again'), 6000, "error");
                }
            })
    }

    /*--START FOR ASSIGN TO FINANCE CONTROLLER FOR TIMELINE AT EVALUATOR-------------------------CHANGE BY SUNNANDA------------19-11-19  --*/
    /*--START FOR ASSIGN TO FINANCE CONTROLLER FOR TIMELINE AT IMPLEMENTER-------------------------CHANGE BY SUNNANDA------------19-11-19  --*/

    //Set finance Target Date at Eval 
    $scope.setFCimplTargetDate = function () {
        $scope.suggestionDet.fCImplEndDate = $filter('date')(new Date(), 'yyyy-MM-dd');
        // $('.target-date-picker').datepicker({ 'update': $scope.fCEvalEndDate, 'autoclose': true, 'todayHighlight': true });
    }

    $scope.change_flag_fCImplEndDate = function () {
        $scope.suggestionInputDetails.acceptRejectStatus = "accept";
        $scope.suggestionInputDetails.acceptRejBy = "byFCImpl";
        if ($scope.suggestionDet.fCImplEndDate == '' || $scope.suggestionDet.fCImplEndDate == undefined || $scope.suggestionDet.fCImplEndDate == null) {
            $scope.flagRejectSugg = true;
        } else {
            if ($scope.roleEscalationList == undefined || $scope.roleEscalationList == null) {
                $scope.getRoleEscalateInfo();
            } else {
                $scope.calculateTaskTime();
            }
            $scope.flagRejectSugg = false;
        }
    }

    $scope.saveFinanceControolerTimelineAtImpl = function () {
        $scope.data = {
            "sugId": $scope.selectedSuggId,
            "statusId": $scope.CONST.STATUS.UnderFinanceVerification.statusId,
            "assignedById": parseInt($scope.loggedInEmpId),
            "branchId": $scope.suggestionDet.branch.branchId, //$scope.loggedInUserBranchId,
            "orgId": $scope.loggedInUserOrgId,
            "actionDate": $scope.suggestionDet.fCImplEndDate,
            "summary": $scope.suggestionDet.fcImplTaskDeviationInput
        }
        if ($scope.suggestionDet.fCImplEndDate == '' || $scope.suggestionDet.fCImplEndDate == undefined || $scope.suggestionDet.fCImplEndDate == null) {
            $scope.flagRejectSugg = true;
            angular.element("#errId_fCImplEndDate")
                .text($filter('translate')('Please_select_estimated_evaluation_time'));
            return;
        }
        if ($scope.suggestionDet.fcImplTaskDeviation && ($scope.suggestionDet.fcImplTaskDeviationInput == undefined || $scope.suggestionDet.fcImplTaskDeviationInput == null)) {
            snackbar.create($filter('translate')('Please_capture_reason_timeline_deviation'), 5000, "error");
            return;
        }
        appService.httpPost($scope.data, "saveSuggestionAcceptedTimelineDetails")
            .then(function (response) {
                $scope.flagTeamDetPopupSpinner = false;
                if (response.result) {
                    $scope.getStatusWiseCount();
                    $scope.getSuggestionListOnUpdate();
                    snackbar.create($filter('translate')('Suggestion_accepted_by_finance_validator'), 3000, "success");
                } else {
                    if (response.statusCode == 100) {
                        snackbar.create(response.reason, 3000, "error");
                    } else {
                        snackbar.create($filter('translate')('Oops_Please_try_again'), 3000, "error");
                    }
                }
            })
    }
    /*--START FOR ASSIGN TO FINANCE CONTROLLER FOR TIMELINE AT IMPLEMENTER-------------------------CHANGE BY SUNNANDA------------19-11-19  --*/

    /*--START FOR ASSIGN TO FINANCE CONTROLLER FOR TIMELINE AT IMPLEMENTER-------------------------CHANGE BY SUNNANDA------------19-11-19  --*/

    // Doc Changes target date
    $scope.suggestionDetInput = {};
    $scope.showDocOwnerModal = function (status) {
        $scope.suggestionDetInput.ownerInputData = {};
        $scope.suggestionDetInput.ownerInputData = {
            stsAdt: status
        }
        $("#docOwnerModal")
            .modal({
                backdrop: 'static',
                keyboard: false
            });
    }
    $scope.showDocVerifierModal = function (status) {
        // $scope.suggestionDet.ownerInputData = {
        //     stsAdt: status
        // }
        $("#docVerifierModal")
            .modal({
                backdrop: 'static',
                keyboard: false
            });
    }

    $scope.showAssignedHDModal = function (status) {
        $scope.suggestionDetInput.HDInputData = {};
        $scope.suggestionDetInput.HDInputData = {
            stsAdt: status
        }
        $("#assignedHDImplModal")
            .modal({
                backdrop: 'static',
                keyboard: false
            });
    }
    $scope.setDCTargetDate = function () {
        $scope.suggestionDet.dcEndDate = $filter('date')(new Date(), 'yyyy-MM-dd');
        $scope.change_flag_DCEndDate();
    }
    $scope.flagDCEndDate = false;
    $scope.flagDCComment = false;
    $scope.change_flag_DCEndDate = function () {
        $scope.suggestionInputDetails.acceptRejectStatus = "accept";
        $scope.suggestionInputDetails.acceptRejBy = "byDC";
        $scope.flagDCComment = false;
        if ($scope.suggestionDet.dcEndDate == '' || $scope.suggestionDet.dcEndDate == undefined || $scope.suggestionDet.dcEndDate == null) {
            $scope.flagDCEndDate = true;
        } else {
            if ($scope.roleEscalationList == undefined || $scope.roleEscalationList == null) {
                $scope.getRoleEscalateInfo();
            } else {
                $scope.calculateTaskTime();
            }
            $scope.flagDCEndDate = false;
        }
    }

    $scope.$watch('suggestionDet.dcEndDate', function (newDate, oldDate) {
        if (!$scope.isEmpty($scope.suggestionDet)) {
            if ($scope.suggestionDet.hasOwnProperty('dcEndDate') && $scope.suggestionDet.dcEndDate != null && $scope.suggestionDet.dcEndDate != undefined && $scope.suggestionDet.dcEndDate != '') {
                $scope.suggestionDet.dcEndDate = moment(newDate).format('YYYY-MM-DD');
                $scope.change_flag_DCEndDate()
            }
        }
    })
    $scope.docVerifierFlag = false;
    $scope.submitDocData = function (docdata, currDocStatus) {
        var req;
        $scope.docVerifierFlag = true;
        if (currDocStatus == 'INPROCESS') {
            if ($scope.suggestionDet.dcEndDate == '' || $scope.suggestionDet.dcEndDate == undefined || $scope.suggestionDet.dcEndDate == null) {
                $scope.flagDCEndDate = true;
                $scope.docVerifierFlag = false;
                // angular.element("#errId_dcEndDate")
                //     .text("Please select target date.");
                return;
            }
            if ($scope.suggestionDet.dcTaskDeviation) {
                if ($scope.suggestionDet.dcTaskDeviationInput == '' || $scope.suggestionDet.dcTaskDeviationInput == undefined || $scope.suggestionDet.dcTaskDeviationInput == null || $scope.suggestionDet.dcTaskDeviationInput.trim().length == 0) {
                    $scope.flagDCComment = true;
                    $scope.docVerifierFlag = false;
                    // angular.element("#errId_dcEndDate")
                    //     .text("Please enter reason.");
                    return;
                }
            }
            req = {
                status: 'INPROCESS',
                actionDate: $scope.suggestionDet.dcEndDate,
                documentId: docdata.document.id,
                branchId: $scope.suggestionDet.branch.branchId, //$scope.loggedInUserBranchId,
                orgId: $rootScope.empDetails.organization.orgId,
                sugId: $scope.selectedSuggId,
                timeDeviationSummary: $scope.suggestionDet.dcTaskDeviationInput
            }
        } else if (currDocStatus == 'COMPLETED') {
            if (docdata.document.fileNameInput == '' || docdata.document.fileNameInput == undefined || docdata.document.fileNameInput == null) {
                snackbar.create($filter('translate')('Please_enter_file_name'), 5000, "error");
                $scope.docVerifierFlag = false;
                return
            }
            if (docdata.document.summaryInput == '' || docdata.document.summaryInput == undefined || docdata.document.summaryInput == null) {
                snackbar.create($filter('translate')('Please_enter_document_details'), 5000, "error");
                $scope.docVerifierFlag = false;
                return;
            }
            var implementerId = 0;
            for (var i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.ImplementationRequestAccepted.status) {
                    implementerId = $scope.suggestionDet.sugesstionStatusAudit[i].emp_details.empId;
                    break;
                }
            }
            req = {
                status: 'COMPLETED',
                validatorId: (docdata.document.document.validator != null && docdata.document.document.validator != undefined) ? docdata.document.document.validator.empId : 0,
                documentId: docdata.document.id,
                fileName: docdata.document.fileNameInput,
                summary: docdata.document.summaryInput,
                branchId: $scope.suggestionDet.branch.branchId, //$scope.loggedInUserBranchId,
                orgId: $rootScope.empDetails.organization.orgId,
                sugId: $scope.selectedSuggId,
                auditId: docdata.audit.stsadtId,
                implementedbyId: implementerId
            }
        }
        if (req) {
            appService.httpPost(req, 'suggestionDocumentUpdate')
                .then(function (response) {
                    $scope.docVerifierFlag = false;
                    if (response.result) {
                        if (currDocStatus == 'INPROCESS') {
                            $scope.getSuggestionDetailsFlag = 'onUpdate';
                            snackbar.create($filter('translate')('Accepted_by_document_owner'), 3000, "success");
                        } else {
                            $scope.getSuggestionDetailsFlag = '';
                            $scope.getStatusWiseCount();
                            snackbar.create($filter('translate')('Document_updated_successfully'), 3000, "success");
                        }
                        $scope.suggestionDet = {};
                        $scope.getsuggestionList("onUpdate");
                    } else {
                        snackbar.create($filter('translate')('Oops_Please_try_again'), 6000, "error");
                    }
                })
        }
    }

    /*----------------------------START FOR DOCUMENT UPDATE --------------------BY SUNANDA-----------------17-2-2020*/
    $scope.resultImageFiles = [];
    $scope.getFileDetailsForResultImage = function (e) {
        if ($scope.resultImageFiles.length > 0) {
            snackbar.create($filter('translate')('Only one image upload'), 5000, "error");
            return;
        }
        $scope.$apply(function () {
            for (var i = 0; i < e.files.length; i++) {
                // var type = e.files[i].type;
                var ext = e.files[i].name.match(/\.(.+)$/)[1];
                var fileSize = e.files[i].size;
                var fileNameWithExtension = e.files[i].name;
                var fileName = fileNameWithExtension.replace(/\.[^/.]+$/, ''); // Regex to remove the extension
                // var ext = type.split('/')[1];
                // if (ext != 'jpg' && ext != 'png' && ext != 'jpeg') {
                //     snackbar.create($filter('translate')('Please_select_only_image'), 6000, "error");
                //     return;
                // }
                if (fileSize > 10 * 1024 * 1024) {
                    snackbar.create($filter('translate')('Image_size_exceeds_limit'), 5000, "error");
                    const resetFile = document.getElementById("file");
                    resetFile.value = '';
                    return;
                }
                e.files[i].fileName = fileName;
                e.files[i].ext = ext;
                $scope.resultImageFiles.push(e.files[i]);
            }
        });
    };

    $scope.docFiles = [];
    $scope.getFileDetailsDoc = function (e) {
        $scope.$apply(function () {
            for (var i = 0; i < e.files.length; i++) {
                var ext = e.files[i].name.match(/\.(.+)$/)[1];
                e.files[i].ext = ext;

                //Udated Doc vaidation File size in bytes at 23-01-2024 by @Jayshri
                var fileSize = e.files[i].size;
                var fileNameWithExtension = e.files[i].name;
                e.files[i].fileName = fileName;
                e.files[i].ext = ext;
                var fileName = fileNameWithExtension.replace(/\.[^/.]+$/, ''); // Regex to remove the extension

                //Udated Doc vaidation File size in bytes at 23-01-2024 by @Jayshri
                var fileSize = e.files[i].size;
                if (fileSize > 10 * 1024 * 1024) {
                    snackbar.create($filter('translate')('Document_size_exceeds_limit'), 5000, "error");
                    const resetFile = document.getElementById("docFile");
                    resetFile.value = '';
                    return;
                }
                e.files[i].fileName = fileName;
                e.files[i].ext = ext;
                $scope.docFiles.push(e.files[i]);
            }
        });
    };

    $scope.extension = function (url) {
        // Remove everything to the last slash in URL
        if (url != undefined && url != null) {
            url = url.substr(1 + url.lastIndexOf("/"));
            // Break URL at ? and take first part (file name, extension)
            url = url.split('?')[0];
            // Sometimes URL doesn't have ? but #, so we should aslo do the same for #
            url = url.split('#')[0];
            // Now we have only extension
            url = url.split('.')[1];
            return url.toLowerCase();
        } else {
            return "";
        }

    }

    $scope.clearImagedoc = function (index, img) {
        $scope.docFiles.splice(index, 1);
    }
    $scope.submitDocDataForDocUpload = function (docdata, currDocStatus) {
        ////console.log(docdata)
        var req;
        $scope.docVerifierFlag = true;
        if (currDocStatus == 'INPROCESS') {
            if ($scope.suggestionDet.dcEndDate == '' || $scope.suggestionDet.dcEndDate == undefined || $scope.suggestionDet.dcEndDate == null) {
                $scope.flagDCEndDate = true;
                $scope.docVerifierFlag = false;
                // angular.element("#errId_dcEndDate")
                //     .text("Please select target date.");
                return;
            }
            if ($scope.suggestionDet.dcTaskDeviation) {
                if ($scope.suggestionDet.dcTaskDeviationInput == '' || $scope.suggestionDet.dcTaskDeviationInput == undefined || $scope.suggestionDet.dcTaskDeviationInput == null || $scope.suggestionDet.dcTaskDeviationInput.trim().length == 0) {
                    $scope.flagDCComment = true;
                    $scope.docVerifierFlag = false;
                    // angular.element("#errId_dcEndDate")
                    //     .text("Please enter reason.");
                    return;
                }
            }
            var date = new Date($scope.suggestionDet.dcEndDate);
            var newDate1 = $filter('date')($scope.suggestionDet.dcEndDate, "dd-MM-yyyy");
            var newDate = date.toString();

            // $scope.suggestionDet.dcEndDateString = ($scope.suggestionDet.dcEndDate).toString();
            var formData = new FormData($("#create-suggestion-docUpdateforDocOwner")[0]);
            formData.append("status", 'INPROCESS');
            formData.append("actionDate", newDate);
            formData.append("documentId ", docdata.document.id);
            formData.append('branchId', $scope.suggestionDet.branch.branchId);
            // formData.append('branchId', $scope.loggedInUserBranchId);
            formData.append('orgId', $scope.loggedInUserOrgId);
            formData.append('sugId', $scope.selectedSuggId);
            if ($scope.suggestionDet.dcTaskDeviationInput != undefined && $scope.suggestionDet.dcTaskDeviationInput != null) {
                formData.append('timeDeviationSummary', $scope.suggestionDet.dcTaskDeviationInput);
            }
        } else if (currDocStatus == 'COMPLETED') {
            if (docdata.document.fileNameInput == '' || docdata.document.fileNameInput == undefined || docdata.document.fileNameInput == null) {
                snackbar.create($filter('translate')('Please_enter_file_name'), 5000, "error");
                $scope.docVerifierFlag = false;
                return
            }
            if (docdata.document.summaryInput == '' || docdata.document.summaryInput == undefined || docdata.document.summaryInput == null) {
                snackbar.create($filter('translate')('Please_enter_document_details'), 5000, "error");
                $scope.docVerifierFlag = false;
                return;
            }
            var implementerId = 0;
            for (var i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.ImplementationRequestAccepted.status) {
                    implementerId = $scope.suggestionDet.sugesstionStatusAudit[i].emp_details.empId;
                    break;
                }
            }


            if ($scope.docFiles == '' || $scope.docFiles == undefined || $scope.docFiles == []) {
                snackbar.create($filter('translate')('Please_upload_document'), 5000, "error");
                $scope.docVerifierFlag = false;
                return;
            }
            var formData = new FormData($("#create-suggestion-docUpdateforDocOwner")[0]);
            formData.append("status", 'COMPLETED');
            if (docdata.document.document.validator != null && docdata.document.document.validator != undefined) {
                formData.append("validatorId ", docdata.document.document.validator.empId);
            } else {
                formData.append("validatorId ", 0);
            }
            formData.append("documentId ", docdata.document.id);
            formData.append("fileName ", docdata.document.fileNameInput);
            formData.append("summary ", docdata.document.summaryInput);
            formData.append('branchId', $scope.loggedInUserBranchId);
            formData.append('orgId', $rootScope.empDetails.organization.orgId);
            formData.append('sugId', $scope.selectedSuggId);
            formData.append('auditId', docdata.audit.stsadtId);
            formData.append('implementedbyId', implementerId);
            for (var i in $scope.docFiles) {
                formData.append("updatedDoc", $scope.docFiles[i]);
            }
        }
        // //console.log(req);
        // for (var pair of formData.entries()) {
        //     //console.log(pair[0] + ', ' + pair[1]);
        // }
        // var x = 0;
        // if (x == 0) {
        //     $scope.docVerifierFlag = false;
        //     return;
        // }
        if (formData) {
            appService.uploadFileToUrl(formData, 'suggestionDocumentUpdateWithDoc')
                .then(function (response) {
                    $scope.docVerifierFlag = false;
                    if (response.data.result) {
                        if (currDocStatus == 'INPROCESS') {
                            snackbar.create($filter('translate')('Accepted_by_document_owner'), 3000, "success");
                            $scope.suggestionDet = {};
                            $scope.getSuggestionDetails($scope.selectedSuggId);
                            // $('#docOwnerModal').modal('hide');

                        } else {
                            $('#docOwnerModal').modal('hide');
                            $scope.getSuggestionDetailsFlag = '';
                            $scope.getStatusWiseCount();
                            snackbar.create($filter('translate')('Document_updated_successfully'), 3000, "success");
                            $scope.suggestionDet = {};
                            $scope.docFiles = []
                            $scope.getsuggestionList("onLoad");
                        }
                    } else {
                        snackbar.create($filter('translate')('Oops_Please_try_again'), 6000, "error");
                    }
                })
        }
    }

    /*--------------------END OF DUCUMENT UPDTAE-----------------------------------------------------------------------------*/

    $scope.submitVerifyDocData = function (docdata, currDocStatus) {
        ////console.log(docdata)
        $scope.docVerifierFlag = true;
        var req;
        if (currDocStatus == 'REASSIGNTODC') {
            if (docdata.document.commentInput == undefined || docdata.document.commentInput == '' || docdata.document.commentInput == null || docdata.document.commentInput.trim().length == 0) {
                snackbar.create($filter('translate')('Please_enter_comment_reason'), 3000, "error");
                $scope.docVerifierFlag = false;
                return;
            }
            var implementerId = 0;
            for (var i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.ImplementationRequestAccepted.status) {
                    implementerId = $scope.suggestionDet.sugesstionStatusAudit[i].emp_details.empId;
                    break;
                }
            }
            req = {
                status: 'REASSIGNTODC',
                validatorId: (docdata.document.validator != null && docdata.document.validator != undefined) ? docdata.document.validator.empId : 0,
                documentId: docdata.id,
                branchId: $scope.loggedInUserBranchId,
                orgId: $scope.loggedInUserOrgId,
                sugId: $scope.selectedSuggId,
                auditId: docdata.stsadtId,
                implementedbyId: implementerId,
                summary: docdata.document.commentInput
            }
        } else if (currDocStatus == 'COMPLETED') {
            var implementerId = 0;
            for (var i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.ImplementationRequestAccepted.status) {
                    implementerId = $scope.suggestionDet.sugesstionStatusAudit[i].emp_details.empId;
                    break;
                }
            }
            req = {
                status: 'COMPLETED',
                validatorId: (docdata.document.validator != null && docdata.document.validator != undefined) ? docdata.document.validator.empId : 0,
                documentId: docdata.id,
                branchId: $scope.loggedInUserBranchId,
                orgId: $scope.loggedInUserOrgId,
                sugId: $scope.selectedSuggId,
                auditId: docdata.stsadtId,
                summary: docdata.document.commentInput,
                implementedbyId: implementerId
            }
            if (docdata.document.commentInput == undefined || docdata.document.commentInput == '' || docdata.document.commentInput == null || docdata.document.commentInput.trim().length == 0) {
                delete req.summary;
                $scope.docVerifierFlag = false;
                snackbar.create($filter('translate')('Please_enter_comment_reason'), 3000, "error");
                return;
            }
        }
        //console.log(req);
        if (req) {
            appService.httpPost(req, 'suggestionDocumentVerify')
                .then(function (response) {
                    $scope.docVerifierFlag = false;
                    if (response.result) {
                        if (currDocStatus == 'REASSIGNTODC') {
                            snackbar.create($filter('translate')('Reassign_to_document_owner'), 3000, "success");
                        } else {
                            snackbar.create($filter('translate')('Document_verified_successfully'), 3000, "success");
                        }
                        $('#docVerifierModal').modal('hide');
                        // $('#docVerifierModal').modal({ backdrop: false });
                        $scope.suggestionDet = {};
                        $scope.getsuggestionList("onUpdate");
                        $scope.getStatusWiseCount();
                    } else {
                        snackbar.create($filter('translate')('Oops_Please_try_again'), 6000, "error");
                    }
                })
        }
    }
    $scope.saveDocumentOwnerTimeline = function () {
        $scope.data = {
            "sugId": $scope.selectedSuggId,
            "statusId": $scope.CONST.STATUS.UnderDocumentChangeApproval.statusId,
            "assignedById": parseInt($scope.loggedInEmpId),
            "branchId": $scope.loggedInUserBranchId,
            "orgId": $scope.loggedInUserOrgId,
            "actionDate": $scope.suggestionDet.dcEndDate,
            "summary": $scope.suggestionDet.dcImplTaskDeviationInput
        }
        if ($scope.suggestionDet.dcEndDate == '' || $scope.suggestionDet.dcEndDate == undefined || $scope.suggestionDet.dcEndDate == null) {
            $scope.flagRejectSugg = true;
            angular.element("#errId_dcEndDate")
                .text("Please select estimated evaluation time.");
            return;
        }
        ////console.log($scope.data);
        appService.httpPost($scope.data, 'saveDocumentChangeTimeline')
            .then(function (response) {
                $scope.flagTeamDetPopupSpinner = false;
                if (response.result) {
                    $scope.getsuggestionList('onUpdate');
                    $scope.getStatusWiseCount();
                    snackbar.create($filter('translate')('Suggestion_accepted_by_finance_controller'), 3000, "success");
                } else {
                    snackbar.create($filter('translate')('Oops_Please_try_again'), 6000, "error");
                }
            })
    }
    /*--START FOR ASSIGN TO FINANCE CONTROLLER FOR TIMELINE AT IMPLEMENTER-------------------------CHANGE BY SUNNANDA------------19-11-19  --*/
    /*--START FOR SEARCH FILTER-------------------------CHANGE BY SUNNANDA---------------------3-12-19 -------- --*/
    $scope.applyFilterForList = function () {
        $scope.isFilterApplied = true;
        $scope.getStatusWiseCount();
        if ($scope.statusCountFilter == 0) {
            $scope.getsuggestionList('allSuggestion');
        } else {
            $scope.getsuggestionList("onUpdate");
        }
        $("#searchLateralPopup")
            .modal('hide');
    }
    $scope.showAllFilterPopup = function () {
        $("#searchAllFilterPopupnew").modal({
            backdrop: 'static',
            keyboard: false
        });
    }
    $scope.listFilter = {
        listdeptIds: [],
        listactivityIds: [],
        listcatIds: [],
        listsourceTypes: [],
        listsuggSource: [],
        COST_LATERAL_KAIZEN_SOURCE: [{
            id: 0,
            source: "Mobile",
            value: "mobile"
        },
        {
            id: 1,
            source: "Portal",
            value: "portal"
        },
        {
            id: 3,
            source: "Lateral Entery",
            value: "LATERAL_ENTRY"
        }
        ]
    }


    /*-------------START FOR KNOWLEDGE EBANK CHANGE 7-2-2020----------------------------------*/
    //-ADVIK CHNAEG BY SUNANDA 4-3-2020   
    $scope.whyWhyAnalysisforImpl = [{
        whyWhyAnalysis: ''
    }];
    $scope.addwhyWhyAnalysisforImpl = function () {
        $scope.whyWhyAnalysisforImpl.push({
            whyWhyAnalysis: ''
        })
    }
    $scope.removewhyWhyAnalysisforImpl = function (i) {
        $scope.whyWhyAnalysisforImpl.splice(i, 1);
    }

    // $scope.implSubTab = 1;
    $scope.currentImplSubTab = 1;
    $scope.setSubImplTab = function (tabId) {
        if ($scope.implSubTab != tabId) {
            switch ($scope.implSubTab) {
                case 1:
                    $scope.setTabContentChecked('benefits');
                    break;
                case 2:
                    $scope.setTabContentChecked('otherBenefits');
                    break;
                case 3:
                    $scope.setTabContentChecked('hzDeployment');
                    break;
                case 4:
                    $scope.setTabContentChecked('whyAnalysis');
                    break;
                case 5:
                    $scope.setTabContentChecked('kaizenSustain');
                    break;
                case 6:
                    $scope.setTabContentChecked('results');
                    break;
                case 7:
                    $scope.setTabContentChecked('financeVerification');
                    break;
                case 8:
                    $scope.setTabContentChecked('teamMembers');
                    break;
            }
        }
        $scope.implSubTab = tabId;
    };

    $scope.isSubImplSet = function (tabId) {
        return $scope.implSubTab === tabId;
    };
    $scope.getbranchWiseknowBankList = function (data) {
        $scope.listFilter.deptId = '';
        $scope.listFilter.catId = '';
        $scope.listFilter.circleId = '';
        $scope.listFilter.activityId = '';
        $scope.listFilter.stageId = '';
        $scope.listFilter.productId = '';
        $scope.listFilter.productNoId = '';
        $scope.listFilter.machineId = '';
        $scope.listFilter.operationId = '';
        if (data != null && data != undefined && data != '') {
            $scope.KnowSelectedbranchId = data;
            $scope.getDepartmentList($scope.KnowSelectedbranchId);
            $scope.getCategoryList($scope.KnowSelectedbranchId);
            $scope.getCircleListBranchWise($scope.KnowSelectedbranchId);
        }

    }
    /*-------------START FOR KNOWLEDGE EBANK CHANGE 7-2-2020----------------------------------*/


    $scope.getKnowMasterStageListByCircleId = function (data) {
        $scope.listFilter.stageId = '';
        $scope.masterStageList = [];
        $scope.listFilter.productId = '';
        $scope.productList = [];
        $scope.listFilter.productNoId = '';
        $scope.productNumberList = [];
        $scope.listFilter.machineId = '';
        $scope.machineList = [];
        $scope.listFilter.operationId = '';
        $scope.opertionList = [];
        if (data != null && data != undefined && data != '') {
            appService.httpGet("getMasterStageByCircleId/" + $scope.KnowSelectedbranchId + '/' + data).then(function (response) {
                $scope.listFilter.stageId = undefined;
                $scope.listFilter.productId = undefined;
                $scope.listFilter.machineId = undefined;
                if (response.result == true) {
                    $scope.masterStageList = response.masterStageList;
                } else {
                    $scope.masterStageList = [];
                }
            });
        }
    }


    $scope.getKnowMasterProductFamilyListByStageId = function (data) {
        $scope.listFilter.productId = '';
        $scope.productList = [];
        $scope.listFilter.productNoId = '';
        $scope.productNumberList = [];
        $scope.listFilter.operationId = '';
        $scope.opertionList = [];
        $scope.listFilter.machineId = '';
        $scope.machineList = [];
        if (data != null && data != undefined && data != '') {
            appService.httpGet("getProductFamilyByStage/" + $scope.KnowSelectedbranchId + '/' + data).then(function (response) {
                $scope.listFilter.machineId = undefined;
                $scope.listFilter.productId = undefined;
                /*-----30-03-2020---*/
                $scope.focus = false;
                $scope.prodfocus = true;
                if (response.result == true) {
                    $scope.productList = response.masterProductFamilyList;
                } else {
                    $scope.productList = [];
                }
            });
        }
    }

    $scope.getKnowMasterProductNumberListByproductId = function (data) {
        $scope.listFilter.productNoId = '';
        $scope.productNumberList = [];
        $scope.listFilter.machineId = '';
        $scope.machineList = [];
        $scope.listFilter.operationId = '';
        $scope.opertionList = [];
        if (data != null && data != undefined && data != '') {
            $scope.data = {
                branchId: $scope.KnowSelectedbranchId,
                productFamilyId: data
            }
            appService.httpPost($scope.data, "getProductNo").then(function (response) {
                if (response.result == true) {
                    $scope.productNumberList = response.productNoList;
                } else {
                    $scope.productNumberList = [];
                }
            });
        }

    }

    $scope.getKnowmachineListByproductNoId = function (data) {
        $scope.listFilter.machineId = '';
        $scope.listFilter.operationId = '';
        $scope.machineList = [];
        $scope.opertionList = [];
        if (data != null && data != undefined && data != '') {
            appService.httpGet("getMachineListByProductNo/" + $scope.KnowSelectedbranchId + '/' + data)
                .then(function (response) {
                    if (response.result == true) {
                        $scope.machineList = response.masterMachineList;
                    } else {
                        $scope.machineList = [];
                        if (data) {
                            $scope.getKnowMasterOperationList(data, 0)
                        }
                    }
                });
        }

    }

    $scope.getKnowMasterOperationList = function (ProductNoId, machineId) {
        if (ProductNoId != null && ProductNoId != undefined && ProductNoId != '') {
            $scope.globalLoadingIndicator = true;
            $scope.flagEmployeeListSpinner = false;
            $scope.flagTblemployee = false;
            $scope.data = {
                branchId: $scope.KnowSelectedbranchId,
                productNoId: ProductNoId,
                machineId: !machineId ? machineId : 0,
            }
            appService.httpPost($scope.data, "getMasterOperationList").then(function (response) {
                $scope.globalLoadingIndicator = false;
                if (response.result == true) {
                    $scope.opertionList = response.masterOperationlist;
                } else {
                    $scope.opertionList = [];
                }
            });
        }
    }
    //console.log($scope.listFilter);
    $scope.showFilterPopup = function () {
        $("#searchFilterPopup").modal({
            backdrop: 'static',
            keyboard: false
        });
    }
    $scope.listFilter.flagopenFilter = false;
    $scope.closeNav = function () {
        $scope.listFilter.flagopenFilter = false;
    }
    $scope.openNav = function () {
        $scope.listFilter.flagopenFilter = true;
    }

    $scope.selectFilterList = function () {
        $scope.listFilter.selectAllPiller = false;
        // $scope.listFilter.selectAllStatus=true;
        $scope.listFilter.selectAllDept = false;
        $scope.listFilter.selectAllCategory = false;
        $scope.listFilter.selectAllPlant = true;
        $scope.listFilter.selectAllSourceType = false;
        $scope.listFilter.selectAllSource = false;


        // for(i=0 ; i<$scope.listFilter.statusList.length ; i++){
        //     $scope.listFilter.statusList[i].isSelectStatus=true;
        // }

        for (i = 0; i < $scope.listFilter.COST_LATERAL_KAIZEN_SOURCE.length; i++) {
            $scope.listFilter.COST_LATERAL_KAIZEN_SOURCE[i].isSelectSourceType = false;
        }
        for (i = 0; i < $scope.listFilter.suggestionSourceList.length; i++) {
            $scope.listFilter.suggestionSourceList[i].isSelectSource = false;
        }
        for (i = 0; i < $scope.listFilter.departmentList.length; i++) {
            $scope.listFilter.departmentList[i].isSelectDept = false;
        }
        if ($scope.listFilter.accessBranchList != undefined && $scope.listFilter.accessBranchList != null) {
            for (i = 0; i < $scope.listFilter.accessBranchList.length; i++) {
                $scope.listFilter.accessBranchList[i].isSelectBranch = true;
            }
        }
        for (i = 0; i < $scope.listFilter.catagoryList.length; i++) {
            if ($scope.listFilter.catagoryList.categoryName != 'All') {
                $scope.listFilter.catagoryList[i].isSelectCategory = false;
            }
        }
        for (i = 0; i < $scope.listFilter.activityList.length; i++) {
            $scope.listFilter.activityList[i].isSelectPiller = false;
        }

        /*------KNOWLEDGE LIST FOR SEARCH------12-5*/
        $scope.listFilter.accessBranchKnowList = angular.copy($scope.listFilter.accessBranchList);
        /*------LATERAL LIST FOR SEARCH------12-5*/
        $scope.listFilter.suggestionSourceLateralList = angular.copy($scope.listFilter.suggestionSourceList);
        $scope.listFilter.departmentLateralList = angular.copy($scope.listFilter.departmentList);
        $scope.listFilter.accessBranchLateralList = angular.copy($scope.listFilter.accessBranchList);
        $scope.listFilter.catagoryLateralList = angular.copy($scope.listFilter.catagoryList);
        $scope.listFilter.activityLateralList = angular.copy($scope.listFilter.activityList);
    }
    /*---------START FOR MULTIPLE PILLER-----------------------------*/
    $scope.pillerToggle = function () {
        $('.deptwrapperPiller .listPiller')
            .slideToggle('fast');
    }
    $scope.togglePillerDiv = function (event) {
        var $trigger = $(".deptwrapperPiller");
        if ($trigger !== event.target && !$trigger.has(event.target)
            .length) {
            $(".listPiller").slideUp("fast");
        }
    }
    $scope.selectAllPiller = function () {
        //console.log("test");
        var flag = ($scope.listFilter.selectAllPiller) ? false : true;
        $scope.listFilter.selectAllPiller = flag;
        for (var i = 0; i < $scope.listFilter.activityList.length; i++) {
            $scope.listFilter.activityList[i].isSelectPiller = $scope.listFilter.selectAllPiller;
        }
        $scope.pillerToggle();
    }
    $scope.setPillerSelected = function (x) {
        x.isSelectPiller = (x.isSelectPiller) ? false : true;
        for (var i = 0; i < $scope.listFilter.activityList.length; i++) {
            if (!$scope.listFilter.activityList.isSelectPiller) {
                $scope.listFilter.selectAllPiller = false;
            }
        }
        $scope.pillerToggle();
    }
    /*--------END FOR MULTIPLE PILLER----------------------------*/
    /*---------START FOR MULTIPLE SOURCE-----------------------------*/
    $scope.sourceTypeToggle = function () {
        $('.deptwrapperSource .listSource')
            .slideToggle('fast');
    }
    $scope.toggleSourceDiv = function (event) {
        var $trigger = $(".deptwrapperSource");
        if ($trigger !== event.target && !$trigger.has(event.target)
            .length) {
            $(".deptwrapperSourc").slideUp("fast");
        }
    }
    $scope.selectAllSource = function () {
        //console.log("test");
        var flag = ($scope.listFilter.selectAllSource) ? false : true;
        $scope.listFilter.selectAllSource = flag;
        for (var i = 0; i < $scope.listFilter.suggestionSourceList.length; i++) {
            $scope.listFilter.suggestionSourceList[i].isSelectSource = $scope.listFilter.selectAllSource;
        }
        $scope.sourceToggle();
    }
    $scope.setSourceSelected = function (x) {
        x.isSelectSource = (x.isSelectSource) ? false : true;
        for (var i = 0; i < $scope.listFilter.suggestionSourceList.length; i++) {
            if (!$scope.listFilter.suggestionSourceList.isSelectSource) {
                $scope.listFilter.selectAllSource = false;
            }
        }
        $scope.sourceToggle();
    }
    /*--------END FOR MULTIPLE SOURCE----------------------------*/
    /*---------START FOR MULTIPLE DEPARTMENT-----------------------------*/

    $scope.NewDeptToggle = function () {
        $('.deptwrapperNewDept .listNewDept')
            .slideToggle('fast');
    }
    $scope.toggleNewDeptDiv = function (event) {
        var $trigger = $(".deptwrapperNewDept");
        if ($trigger !== event.target && !$trigger.has(event.target)
            .length) {
            $(".listNewDept").slideUp("fast");
        }
    }
    $scope.selectAllDeptL = function () {
        //console.log("test");
        var flag = ($scope.listFilter.selectAllDept) ? false : true;
        $scope.listFilter.selectAllDept = flag;
        for (var i = 0; i < $scope.listFilter.departmentList.length; i++) {
            $scope.listFilter.departmentList[i].isSelectDept = $scope.listFilter.selectAllDept;
        }
        $scope.NewDeptToggle();
    }
    $scope.setDeptLSelected = function (x) {
        x.isSelectDept = (x.isSelectDept) ? false : true;
        for (var i = 0; i < $scope.listFilter.departmentList.length; i++) {
            if (!$scope.listFilter.departmentList.isSelectDept) {
                $scope.listFilter.selectAllDept = false;
            }
        }
        $scope.NewDeptToggle();
    }
    /*--------END FOR MULTIPLE DEPARTMENT----------------------------*/
    /*---------START FOR MULTIPLE CATEGORY-----------------------------*/
    $scope.CategoryToggle = function () {
        $('.deptwrapperCategory .listCategory')
            .slideToggle('fast');
    }
    $scope.toggleSourceDiv = function (event) {
        var $trigger = $(".deptwrapperCategory");
        if ($trigger !== event.target && !$trigger.has(event.target)
            .length) {
            $(".listCategory").slideUp("fast");
        }
    }
    $scope.selectAllCategory = function () {
        //console.log("test");
        var flag = ($scope.listFilter.selectAllCategory) ? false : true;
        $scope.listFilter.selectAllCategory = flag;
        for (var i = 0; i < $scope.listFilter.catagoryList.length; i++) {
            $scope.listFilter.catagoryList[i].isSelectCategory = $scope.listFilter.selectAllCategory;
        }
        $scope.CategoryToggle();
    }
    $scope.setSelectedCategory = function (x) {
        x.isSelectCategory = (x.isSelectCategory) ? false : true;
        for (var i = 0; i < $scope.listFilter.catagoryList.length; i++) {
            if (!$scope.listFilter.catagoryList.isSelectCategory) {
                $scope.listFilter.selectAllCategory = false;
            }
        }
        $scope.CategoryToggle();
    }
    /*--------END FOR MULTIPLE CATEGORY----------------------------*/
    /*---------START FOR MULTIPLE BRANCH-----------------------------*/
    $scope.selectAllPlant = function () {
        //console.log("test");
        var flag = ($scope.listFilter.selectAllPlant) ? false : true;
        $scope.listFilter.selectAllPlant = flag;
        for (var i = 0; i < $scope.listFilter.accessBranchList.length; i++) {
            $scope.listFilter.accessBranchList[i].isSelectBranch = $scope.listFilter.selectAllPlant;
        }
        $scope.deptToggle();
    }
    $scope.setSelectedPlant = function (x) {
        x.isSelectBranch = (x.isSelectBranch) ? false : true;
        for (var i = 0; i < $scope.listFilter.accessBranchList.length; i++) {
            if (!$scope.listFilter.accessBranchList.isSelectBranch) {
                $scope.listFilter.selectAllPlant = false;
            }
        }
        $scope.deptToggle();
    }
    /*--------END FOR MULTIPLE BRANCH----------------------------*/

    /*-------START FOR SOURCE TYPE---------*/
    $scope.sourceToggle = function () {
        $('.deptwrapperSourceType .listSourceType')
            .slideToggle('fast');
    }
    $scope.toggleSourceDiv = function (event) {
        var $trigger = $(".deptwrapperTypeSource");
        if ($trigger !== event.target && !$trigger.has(event.target)
            .length) {
            $(".deptwrapperTypeSource").slideUp("fast");
        }
    }
    $scope.selectAllSourceType = function () {
        //console.log("test");
        var flag = ($scope.listFilter.selectAllSourceType) ? false : true;
        $scope.listFilter.selectAllSourceType = flag;
        for (var i = 0; i < $scope.listFilter.COST_LATERAL_KAIZEN_SOURCE.length; i++) {
            $scope.listFilter.COST_LATERAL_KAIZEN_SOURCE[i].isSelectSourceType = $scope.listFilter.selectAllSourceType;
        }
        $scope.sourceTypeToggle();
    }
    $scope.setSourceTypeSelected = function (x) {
        x.isSelectSourceType = (x.isSelectSourceType) ? false : true;
        for (var i = 0; i < $scope.listFilter.COST_LATERAL_KAIZEN_SOURCE.length; i++) {
            if (!$scope.listFilter.COST_LATERAL_KAIZEN_SOURCE.isSelectSourceType) {
                $scope.listFilter.selectAllSourceType = false;
            }
        }
        $scope.sourceTypeToggle();
    }
    /*---END FOR SOURCE TYPE*/

    $scope.applySearchFilter = function () {
        if ($scope.statusCountFilter == 0) {
            $scope.getsuggestionList('allSuggestion');
        } else {
            $scope.getsuggestionList('onLoad');
        }
        $scope.getStatusWiseCount();
    }
    /*--END FOR SEARCH FILTER-------------------------CHANGE BY SUNNANDA---------------------3-12-19 -------- --*/

    /*---START FOR ACEPT EVALUTAOR HD SUGGESTI0N----------CHANGE BY SUNANDA----------------------18-12-19----------------*/
    $scope.acceptByEvalHD = function () {
        if ($scope.suggestionDet.evalTaskDeviation && ($scope.suggestionDet.evalTaskDeviationInput == undefined || $scope.suggestionDet.evalTaskDeviationInput == null)) {
            snackbar.create($filter('translate')('Please_capture_reason_timeline_deviation'), 5000, "error");
            return;
        }
        var requestData = {
            "branchId": $scope.loggedInUserBranchId,
            "orgId": $scope.loggedInUserOrgId,
            "sugId": $scope.selectedSuggId,
            "statusId": $scope.CONST.STATUS.EvaluationRequestAccepted.statusId,
            "empId": $scope.loggedInEmpId,
            "endDate": $scope.newSug.evalEndDate,
        };

        if ($scope.suggestionDet.evalTaskDeviationInput == '' || $scope.suggestionDet.evalTaskDeviationInput == null || $scope.suggestionDet.evalTaskDeviationInput == undefined) {
            requestData.summary = $scope.suggestionDet.evalTaskDeviationInput;
        }
        for (var i = 0; i < $scope.suggestionDet.evaluationTeamList.length; i++) {
            if (parseInt($scope.suggestionDet.evaluationTeamList[i].empId) == parseInt($scope.loggedInEmpId)) {
                requestData.sugTrackId = $scope.suggestionDet.evaluationTeamList[i].sugTrackId;
            }
        }
        consoleLog(requestData);
        appService.httpPost(requestData, "acceptedByEvalHD")
            .then(function (response) {
                if (response.result) {
                    $scope.getsuggestionList('onUpdate');
                    $scope.getStatusWiseCount();
                    $scope.flagHDDept = false;
                    $scope.flagHDLine = false;
                    $scope.flagErrCatHD = false;
                    $scope.newSug.deptId = '';
                    $scope.newSug.line = '';
                    $scope.newSug.catId = '';
                    snackbar.create($filter('translate')('Suggestion_accepted_by_evaluator'), 3000, "success");
                } else {
                    snackbar.create($filter('translate')('Oops_Please_try_again'), 3000, "error");
                }
            });
    }

    /*---------ACEPT EVALUTAOR HD SUGGESTI0N----------CHANGE BY SUNANDA----------------------18-12-19----------------*/
    /*---START FOR CIRCLE SUGGETION----------CHANGE BY SUNANDA----------------------1-1-2020----------------*/
    /*------------START FOR OPERTION LIST-----------------BY SUNANDA-----------------1-1-2020------------*/
    // 19-5-2020
    $scope.getMasterOperationList = function (ProductNoId, machineId) {
        $scope.globalLoadingIndicator = true;
        $scope.flagEmployeeListSpinner = false;
        $scope.flagTblemployee = false;
        if (machineId == -1) {
            $scope.newSug.addMachineFlag = true;
            return;
        }
        $scope.data = {
            branchId: $scope.loggedInUserBranchId,
            productNoId: ProductNoId,
            machineId: machineId ? machineId : 0,
        }
        appService.httpPost($scope.data, "getMasterOperationList").then(function (response) {
            $scope.globalLoadingIndicator = false;
            $scope.opertionList = [];
            if ($scope.newSug.addOperationFlagnew) {
                $scope.opertionList.push({
                    "operationType": "Add Operation",
                    "id": 0
                });
            }
            if (response.result == true) {
                for (var i = 0; i < response.masterOperationlist.length; i++) {
                    $scope.opertionList.push(response.masterOperationlist[i]);
                    if ($scope.newSug.addOperationFlagnew) {
                        if ($scope.newSug.newOperationType == response.masterOperationlist[i].operationType) {
                            $scope.newSug.opertionId = response.masterOperationlist[i];
                        }
                    }
                }
                $scope.newSug.newOperationType = '';
            }
        });
    }
    /*------------END FOR OPERTION LIST-----------------BY SUNANDA-----------------1-1-2020-----------*/

    /*------------START FOR CIRCLE LIST-----------------BY SUNANDA-----------------1-1-2020-----------*/
    $scope.circleList = [];
    $scope.getCircleList = function () {
        $scope.circleList = [];
        appService.httpGet("getCircleList/" + $scope.loggedInUserBranchId)
            .then(function (response) {
                if (response.result == true) {
                    $scope.circleList.push({
                        id: 0,
                        circleName: 'NA'
                    })
                    for (var i = 0; i < response.circleList.length; i++) {
                        $scope.circleList.push(response.circleList[i]);
                    }

                } else {
                    $scope.circleList = [];
                }
            });
    }
    $scope.getCircleListBranchWise = function (branchId) {
        appService.httpGet("getCircleList/" + branchId)
            .then(function (response) {
                if (response.result == true) {
                    $scope.circleList = response.circleList;
                } else {
                    $scope.circleList = [];
                }
            });
    }
    /*------------END FOR CIRCLE LIST-----------------BY SUNANDA-----------------1-1-2020-----------*/
    /*------------START FOR STAGE LIST-----------------BY SUNANDA-----------------1-1-2020------------*/
    $scope.getMasterStageList = function (branchId) {
        appService.httpGet("getMasterStageList/" + branchId)
            .then(function (response) {
                if (response.result == true) {
                    $scope.masterStageList = response.masterStageList;
                } else {
                    $scope.masterStageList = [];
                }
            });
    }
    // stage list by circleId
    $scope.getMasterStageListByCircleId = function (data) {
        appService.httpGet("getMasterStageByCircleId/" + $scope.loggedInUserBranchId + '/' + data).then(function (response) {
            $scope.newSug.stageId = undefined;
            $scope.newSug.productId = undefined;
            $scope.newSug.deptId = undefined; //chnage 4-7-2020
            $scope.newSug.machineId = undefined;
            $scope.listFilter.stageId = undefined;
            $scope.listFilter.productId = undefined;
            $scope.listFilter.machineId = undefined;
            $scope.laterlEntery.deptId = undefined; //chnage 16-7-2020
            $scope.laterlEntery.stageId = undefined;
            $scope.laterlEntery.productId = undefined;
            $scope.laterlEntery.machineId = undefined;
            $scope.laterlEntery.productNoId = undefined;
            // $scope.laterlEntery.deptId = undefined;
            $scope.newSug.productNoId = undefined;
            $scope.listFilter.productNoId = undefined;
            /*----26-03-2020---*/
            $scope.pillarfocus = false;
            $scope.circlefocus = true;
            if (response.result == true) {
                $scope.masterStageList = response.masterStageList;
                $scope.focus = true;
            } else {
                $scope.masterStageList = [];
                $scope.focus = false;
            }
        });
    }


    /*------------END FOR STAGE LIST-----------------BY SUNANDA-----------------1-1-2020----------*/
    /*--------START FOR PRODUCT NUMBER LIST-------------------------------------------------*/
    $scope.getMasterProductNumberListByproductId = function (data) {
        $scope.data = {
            branchId: $scope.loggedInUserBranchId,
            productFamilyId: data
        }
        appService.httpPost($scope.data, "getProductNo").then(function (response) {
            if (response.result == true) {
                $scope.productNumberList = response.productNoList;
            } else {
                $scope.productNumberList = [];
            }
        });
    }
    /*--------END FOR PRODUCT NUMBER LIST-------------------------------------------------*/

    /*------------START FOR MACHINE LIST-----------------BY SUNANDA-----------------1-1-2020------------*/
    $scope.getmachineListByproductNoId = function (data) {
        appService.httpGet("getMachineListByProductNo/" + $scope.loggedInUserBranchId + '/' + data)
            .then(function (response) {
                if (response.result == true) {
                    $scope.machineList = [];
                    // 19-5-2018
                    if ($scope.newSug.addMachineFlagnew) {
                        $scope.machineList.push({
                            "machineName": "Add Machine",
                            "id": -1
                        });
                    }
                    for (var i = 0; i < response.masterMachineList.length; i++) {
                        $scope.machineList.push(response.masterMachineList[i]);
                        if ($scope.newSug.addMachineFlagnew) {
                            if ($scope.newSug.machineNameNew == response.masterMachineList[i].machineName) {
                                $scope.newSug.machineId = response.masterMachineList[i];
                                //console.log($scope.newSug.machineId);
                                $scope.getMasterOperationList($scope.newSug.productNoId.id, $scope.newSug.machineId.id)
                            }
                        }
                    }
                    $scope.newSug.machineNameNew = '';
                    //     for (var i = 0; i < $scope.machineList.length; i++) {

                    // }
                } else {
                    $scope.machineList = [];
                    if (data) {
                        $scope.getMasterOperationList(data, 0)
                    }
                }
            });
    }
    $scope.getMasterMachineList = function (branchId) {
        appService.httpGet("getMasterMachineList/" + branchId)
            .then(function (response) {
                if (response.result == true) {
                    $scope.machineList = response.masterMachineList;
                } else {
                    $scope.machineList = [];
                }
            });
    }
    // machine list by productId
    $scope.getMasterMachineListBbyProductId = function (data) {
        appService.httpGet("getMachineByProductId/" + $scope.loggedInUserBranchId + '/' + data)
            .then(function (response) {
                // $scope.newSug.productId=undefined;
                $scope.newSug.machineId = undefined;
                $scope.listFilter.machineId = undefined;
                /*----30-03-2020---*/
                $scope.prodfocus = false;
                $scope.machfocus = true;
                if (response.result == true) {
                    $scope.machineList = response.masterMachineList;

                } else {
                    $scope.machineList = [];
                }
            });
    }
    /*------------END FOR MACHINE LIST-----------------BY SUNANDA-----------------1-1-2020------------*/


    /*------------START FOR MACHINE PART LIST-----------------BY SUNANDA-----------------1-1-2020-----------*/
    $scope.getMasterMachinePartList = function (branchId) {
        appService.httpGet("getMasterMachinePartList/" + branchId)
            .then(function (response) {
                if (response.result == true) {
                    $scope.machinePartList = response.machinePartList;
                } else {
                    $scope.machinePartList = [];
                }
            });
    }
    /*------------END FOR MACHINE PART LIST-----------------BY SUNANDA----------------1-1-2020-------------*/


    /*---------START FOR PRODUCT FAMILY LIST-----------------BY SUNANDA -----------------2-2-2020---------*/
    $scope.getMasterProductFamilyList = function (branchId) {
        $scope.listFilter.productNoId = ''
        $scope.productNumberList = [];
        appService.httpGet("getMasterProductFamilyList/" + branchId)
            .then(function (response) {
                if (response.result == true) {
                    $scope.productList = response.masterProductFamilyList;
                } else {
                    $scope.productList = [];
                }
            });
    }

    //  productList by stageId
    $scope.getMasterProductFamilyListByStageId = function (data) {
        appService.httpGet("getProductFamilyByStage/" + $scope.loggedInUserBranchId + '/' + data).then(function (response) {
            $scope.newSug.machineId = undefined;
            $scope.listFilter.machineId = undefined;
            $scope.listFilter.productId = undefined;
            $scope.newSug.productId = undefined;
            $scope.newSug.productNoId = undefined;
            $scope.listFilter.productNoId = undefined;
            /*-----30-03-2020---*/
            $scope.focus = false;
            $scope.prodfocus = true;
            if (response.result == true) {
                $scope.productList = response.masterProductFamilyList;
            } else {
                $scope.productList = [];
            }
        });
    }
    /*---------END FOR PRODUCT FAMILY LIST-----------------BY SUNANDA -----------------2-2-2020---------*/
    /*----------START FOR EXPORT TPM SUGGESTION--------------23-1-2020-------------BY SUNANDA*/

    $scope.setExportDataold = function (res) {
        //console.log(res);
        var rec = res;
        $scope.exportProject = angular.copy(res);
        var teamMember = [];
        var activityName = [];
        var analysis = [];
        if ($scope.exportProject.sugImplTeam != null && $scope.exportProject.sugImplTeam != undefined && $scope.exportProject.sugImplTeam.length > 0) {
            for (var i = 0; i < $scope.exportProject.sugImplTeam.length; i++) {
                teamMember.push($scope.exportProject.sugImplTeam[i].empName);
            }
            $scope.exportProject.teamMemberNames = teamMember.join();

        }

        $scope.exportProject.activityName = "";
        for (var i = 0; i < $scope.activityList.length; i++) {
            //console.log("selected activity", $scope.activityList[i].isselect);
            $scope.activityList[i].isselect = false;
            if ($scope.suggestionDet.suggestionActivityList != null && $filter('filter')($scope.suggestionDet.suggestionActivityList, { activity: { id: $scope.activityList[i].id } }, true).length > 0) {
                $scope.activityList[i].isselect = true;
                $scope.exportProject.activityName += "<td style='border: 1px solid black;border-collapse: collapse;text-align: center;background:#00B050'><span style='padding:2px;font-size: 12px;font-weight: 500;'> " + $scope.activityList[i].activityName + " </span></td>";
            } else {
                $scope.exportProject.activityName += "<td style='border: 1px solid black;border-collapse: collapse;text-align: center;'><span style='padding:2px;font-size: 12px;font-weight: 500;'> " + $scope.activityList[i].activityName + " </span></td>";
            }
        }

        $scope.suggestionDet.createdHDHTMLlist = "";
        if ($scope.suggestionDet.suggestionHDList != null) {
            for (var i = 0; i < $scope.suggestionDet.suggestionHDList.length; i++) {
                $scope.suggestionDet.createdHDHTMLlist += "<tr style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left;'>" +
                    "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left; '>" + (i + 1) + "</td>" +
                    "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left; '>" + $scope.suggestionDet.suggestionHDList[i].branchName + "</td>" +
                    "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left;'>" + $filter('date')(new Date($scope.suggestionDet.suggestionHDList[i].filterCreatedDate), 'MMM d, y ') + "</td>" +
                    " <td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left; '>" + $scope.suggestionDet.suggestionHDList[i].hdEvalName + "</td>" +
                    "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left; '>" + $scope.suggestionDet.suggestionHDList[i].label + "</td>" +
                    "</tr>";
            }
        }

        /*-----------31-03-2020-----------------*/
        // filterCreatedDate
        $scope.suggestionDet.createdHDcirclelist = "";
        if ($scope.suggestionDet.suggestionHorizontalDept != null) {
            for (var i = 0; i < $scope.suggestionDet.suggestionHorizontalDept.length; i++) {
                $scope.suggestionDet.createdHDcirclelist += "<tr style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left;'>" +
                    "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left; '>" + (i + 1) + "</td>" +
                    "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left; '>" + $scope.suggestionDet.suggestionHorizontalDept[i].circleName + "</td>" +
                    "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left;'>" + $scope.suggestionDet.suggestionHorizontalDept[i].stageName + "</td>" +
                    " <td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left; '>" + $scope.suggestionDet.suggestionHorizontalDept[i].productName + "</td>" +
                    "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left; '>" + $scope.suggestionDet.suggestionHorizontalDept[i].machineName + "</td>" +
                    "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left; '>" + $filter('date')(new Date($scope.suggestionDet.suggestionHorizontalDept[i].targetDate), 'MMM d, y ') + "</td>" +
                    "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left; '>" + $scope.suggestionDet.suggestionHorizontalDept[i].hdEvalName + "</td>" +
                    "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left; '>" + $scope.suggestionDet.suggestionHorizontalDept[i].actionStatus + "</td>" +
                    "</tr>";
            }
        }

        $scope.suggestionDet.createdHDcirclelist = "";
        if ($scope.suggestionDet.suggestionHorizontalDept != null) {


            for (var i = 0; i < $filter('filter')($scope.suggestionDet.suggestionHorizontalDept, { hdType: 'PLANT_LEVEL' }, true).length; i++) {
                if ($scope.suggestionDet.suggestionHorizontalDept[i].hdType == 'PLANT_LEVEL') {
                    for (let j = 0; j < $scope.departmentList.length; j++) {
                        if ($scope.suggestionDet.suggestionHorizontalDept[i].deptId == $scope.departmentList[j].deptId) {
                            $scope.suggestionDet.suggestionHorizontalDept[i].name = $scope.departmentList[j].deptName;
                        }
                    }
                    if ($scope.suggestionDet.suggestionHorizontalDept[i].hdEvalName == undefined || $scope.suggestionDet.suggestionHorizontalDept[i].hdEvalName == null) {
                        $scope.suggestionDet.suggestionHorizontalDept[i].hdEvalName = 'N/A';
                    }
                    if ($scope.suggestionDet.suggestionHorizontalDept[i].actionStatus == 'PENDING') {
                        $scope.suggestionDet.suggestionHorizontalDept[i].status = 'Pending For Implementation';
                    } else if ($scope.suggestionDet.suggestionHorizontalDept[i].actionStatus == 'COMPLETED') {
                        $scope.suggestionDet.suggestionHorizontalDept[i].status = 'Implemented';
                    }
                    $scope.suggestionDet.createdHDDeptlist += "<tr style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left;'>" +
                        "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left; '>" + (i + 1) + "</td>" +
                        "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left;'>" + $scope.suggestionDet.suggestionHorizontalDept[i].name + "</td>" +
                        " <td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left; '>" + $filter('date')(new Date($scope.suggestionDet.suggestionHorizontalDept[i].targetDate), 'MMM d, y ') + "</td>" +
                        "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left; '>" + $scope.suggestionDet.suggestionHorizontalDept[i].hdEvalName + "</td>" +
                        "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left; '>" + $scope.suggestionDet.suggestionHorizontalDept[i].status + "</td>" +
                        "</tr>";
                }

            }
        }

        /*---------------------------------------------------------*/
        $scope.exportProject.category = "";
        if ($scope.catbranchwise != null && $scope.catbranchwise.length > 0) {
            for (let index = 0; index < $scope.catbranchwise.length; index++) {
                if ($scope.suggestionDet.category != null) {
                    if ($scope.suggestionDet.category.catId == $scope.catbranchwise[index].catId) {
                        $scope.exportProject.category += "<td style='border: 1px solid black;border-collapse: collapse;text-align: center;background:#00B050;'><span style='padding:2px;font-size: 12px;font-weight: 500;'>" + $scope.catbranchwise[index].categoryName[0] + "</span></td>";
                    } else {
                        $scope.exportProject.category += "<td style='border: 1px solid black;border-collapse: collapse;text-align: center;'><span style='padding:2px;font-size: 12px;font-weight: 500;'>" + $scope.catbranchwise[index].categoryName[0] + "</span></td>"
                    }
                } else {
                    $scope.exportProject.category += "<td style='border: 1px solid black;border-collapse: collapse;text-align: center;'><span style='padding:2px;font-size: 12px;font-weight: 500;'>" + $scope.catbranchwise[index].categoryName[0] + "</span></td>"
                }
            }
        }

        /*------32-03-2020---*/
        $scope.exportProject.analysis = []
        for (let i = 0; i < $scope.suggestionDet.suggestionWhyWhyAnalysis.length; i++) {
            analysis.push($scope.suggestionDet.suggestionWhyWhyAnalysis[i].name);
        }
        $scope.exportProject.analysis = analysis.join();
        //console.log($scope.exportProject.analysis);
    }
    $scope.setExportData = function (res) {
        //console.log(res);
        var rec = res;
        $scope.exportProject = angular.copy(res);
        var teamMember = [];
        var activityName = [];
        var analysis = [];
        if ($scope.exportProject.sugImplTeam != null && $scope.exportProject.sugImplTeam != undefined && $scope.exportProject.sugImplTeam.length > 0) {
            for (var i = 0; i < $scope.exportProject.sugImplTeam.length; i++) {
                teamMember.push($scope.exportProject.sugImplTeam[i].empName);
            }
            $scope.exportProject.teamMemberNames = teamMember.join();
        }
        $scope.exportProject.result = "";
        if ($scope.checkForHdConfig() && $scope.suggestionDet.implSummary != null) {
            $scope.exportProject.result = $scope.suggestionDet.implSummary;
        }
        if (!$scope.checkForHdConfig() && $scope.implwhyWhyAnalysisData != null) {
            $scope.exportProject.result = $scope.implwhyWhyAnalysisData.results;
        }
        $scope.exportProject.activityName = "";
        for (var i = 0; i < $scope.activityList.length; i++) {
            // //console.log("selected activity", $scope.activityList[i].isselect);
            // $scope.suggestionDet.pillar != null && $scope.activityList[i].id == $scope.suggestionDet.pillar.id
            $scope.activityList[i].isselect = false;
            if ($scope.suggestionDet.suggestionActivityList != null && $filter('filter')($scope.suggestionDet.suggestionActivityList, { activity: { id: $scope.activityList[i].id } }, true).length > 0) {
                $scope.activityList[i].isselect = true;
                $scope.exportProject.activityName += "<td style='border: 1px solid black;border-collapse: collapse;text-align: center;background:#00B050'><span style='padding:2px;font-size: 12px;font-weight: 500;'> " + $scope.activityList[i].activityName + " </span></td>";
            } else {
                $scope.exportProject.activityName += "<td style='border: 1px solid black;border-collapse: collapse;text-align: center;'><span style='padding:2px;font-size: 12px;font-weight: 500;'> " + $scope.activityList[i].activityName + " </span></td>";
            }
        }
        //console.log($scope.activityList);

        $scope.suggestionDet.createdHDHTMLlist = "";
        if ($scope.suggestionDet.suggestionHDList != null) {
            for (var i = 0; i < $scope.suggestionDet.suggestionHDList.length; i++) {
                $scope.suggestionDet.createdHDHTMLlist += "<tr style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left;'>" +
                    "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left; '>" + (i + 1) + "</td>" +
                    "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left; '>" + $scope.suggestionDet.suggestionHDList[i].branchName + "</td>" +
                    "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left;'>" + $filter('date')(new Date($scope.suggestionDet.suggestionHDList[i].filterCreatedDate), 'MMM d, y ') + "</td>" +
                    " <td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left; '>" + $scope.suggestionDet.suggestionHDList[i].hdEvalName + "</td>" +
                    "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left; '>" + $scope.suggestionDet.suggestionHDList[i].label + "</td>" +
                    "</tr>";
            }
        }

        /*-----------31-03-2020-----------------*/
        $scope.suggestionDet.createdHDcirclelist = "";
        $scope.suggestionDet.columCircle = " ";
        if ($scope.suggestionDet.circle != null) {
            $scope.suggestionDet.columCircle += "<td style='border: 0.5px solid black;border-collapse: collapse;padding: 5px;text-align: left;font-weight: bold;'>" + 'SR.NO.' + "</td>" +
                "<td style='border: 0.5px solid black;border-collapse: collapse;padding: 5px;text-align: left;font-weight: bold;'>" + "<div>" + 'Circle' + "</div>" + "</td>" +
                "<td style='border: 0.5px solid black;border-collapse: collapse;padding: 5px;text-align: left;font-weight: bold;'>" + 'Operation Type' + "</td>" +
                "<td style='border: 0.5px solid black;border-collapse: collapse;padding: 5px;text-align: left;font-weight: bold;'>" + 'TDC' + "</td>" +
                "<td style='border: 0.5px solid black;border-collapse: collapse;padding: 5px;text-align: left;font-weight: bold;'>" + 'RESP' + "</td>" +
                "<td style='border: 0.5px solid black;border-collapse: collapse;padding: 5px;text-align: left;font-weight: bold;'>" + 'Status' + "</td>";
            $scope.suggestionDet.createdHDcirclelist = "";
            if ($scope.suggestionDet.suggestionHorizontalDept != null) {
                $scope.plantHDsuggestionHorizontalDept = $filter('filter')($scope.suggestionDet.suggestionHorizontalDept, { hdType: 'PLANT_LEVEL' }, true);
                for (var i = 0; i < $scope.plantHDsuggestionHorizontalDept.length; i++) {
                    if ($scope.plantHDsuggestionHorizontalDept[i].hdEvalName != null && $scope.plantHDsuggestionHorizontalDept[i].hdEvalName != undefined) {
                        var hdEvalName = $scope.plantHDsuggestionHorizontalDept[i].hdEvalName;
                    } else {
                        var hdEvalName = 'N/A';
                    }
                    // if ($scope.suggestionDet.suggestionHorizontalDept[i].hdType == "PLANT_LEVEL") {
                    $scope.suggestionDet.createdHDcirclelist += "<tr style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left;'>" +
                        "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left; '>" + (i + 1) + "</td>" +
                        "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left; '>" + "<div>" + $scope.plantHDsuggestionHorizontalDept[i].circleName + "</div>" + "</td>" +
                        "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left;'>" + "<div>" + $scope.plantHDsuggestionHorizontalDept[i].operationType + "</div>" + "</td>" +
                        "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left; '>" + $filter('date')(new Date($scope.plantHDsuggestionHorizontalDept[i].targetDate), 'MMM d, y ') + "</td>" +
                        "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left; '>" + hdEvalName + "</td>" +
                        "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left; '>" + $scope.plantHDsuggestionHorizontalDept[i].actionStatus + "</td>" +
                        "</tr>";
                    // }

                }
            }
        }


        if ($scope.suggestionDet.dept != null) {
            $scope.suggestionDet.columCircle += "<td style='border: 0.5px solid black;border-collapse: collapse;padding: 5px;text-align: left;font-weight: bold;'>" + 'SR.NO.' + "</td>" +
                "<td style='border: 0.5px solid black;border-collapse: collapse;padding: 5px;text-align: left;font-weight: bold;'>" + "<div>" + 'Department' + "</div>" + "</td>" +
                "<td style='border: 0.5px solid black;border-collapse: collapse;padding: 5px;text-align: left;font-weight: bold;'>" + 'Line' + "</td>" +
                "<td style='border: 0.5px solid black;border-collapse: collapse;padding: 5px;text-align: left;font-weight: bold;'>" + 'TDC' + "</td>" +
                "<td style='border: 0.5px solid black;border-collapse: collapse;padding: 5px;text-align: left;font-weight: bold;'>" + 'RESP' + "</td>" +
                "<td style='border: 0.5px solid black;border-collapse: collapse;padding: 5px;text-align: left;font-weight: bold;'>" + 'Status' + "</td>";
            for (var i = 0; i < $filter('filter')($scope.suggestionDet.suggestionHorizontalDept, { hdType: 'PLANT_LEVEL' }, true).length; i++) {

                if ($scope.suggestionDet.suggestionHorizontalDept[i].hdType == "PLANT_LEVEL") {
                    for (let j = 0; j < $scope.departmentList.length; j++) {
                        if ($scope.suggestionDet.suggestionHorizontalDept[i].deptId == $scope.departmentList[j].deptId) {
                            $scope.suggestionDet.suggestionHorizontalDept[i].name = $scope.departmentList[j].deptName;
                        }
                    }
                    if ($scope.suggestionDet.suggestionHorizontalDept[i].hdEvalName == undefined || $scope.suggestionDet.suggestionHorizontalDept[i].hdEvalName == null) {
                        $scope.suggestionDet.suggestionHorizontalDept[i].hdEvalName = 'N/A';
                    }
                    if ($scope.suggestionDet.suggestionHorizontalDept[i].actionStatus == 'PENDING') {
                        $scope.suggestionDet.suggestionHorizontalDept[i].status = 'Pending For Implementation';
                    } else if ($scope.suggestionDet.suggestionHorizontalDept[i].actionStatus == 'COMPLETED') {
                        $scope.suggestionDet.suggestionHorizontalDept[i].status = 'Implemented';
                    }
                    $scope.suggestionDet.createdHDcirclelist += "<tr style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left;'>" +
                        "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left; '>" + (i + 1) + "</td>" +
                        "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left;'>" + "<div>" + $scope.suggestionDet.suggestionHorizontalDept[i].name + "</div>" + "</td>" +
                        "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left;'>" + $scope.suggestionDet.suggestionHorizontalDept[i].lineName + "</td>" +
                        " <td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left; '>" + $filter('date')(new Date($scope.suggestionDet.suggestionHorizontalDept[i].targetDate), 'MMM d, y ') + "</td>" +
                        "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left; '>" + $scope.suggestionDet.suggestionHorizontalDept[i].hdEvalName + "</td>" +
                        "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left; '>" + $scope.suggestionDet.suggestionHorizontalDept[i].status + "</td>" +
                        "</tr>";
                }

            }
        }

        /*---------------------------------------------------------*/
        $scope.exportProject.category = "";
        if ($scope.catbranchwise != null && $scope.catbranchwise.length > 0) {
            for (let index = 0; index < $scope.catbranchwise.length; index++) {
                if ($scope.suggestionDet.category != null) {
                    if ($scope.suggestionDet.category.catId == $scope.catbranchwise[index].catId) {
                        $scope.exportProject.category += "<td style='border: 1px solid black;border-collapse: collapse;text-align: center;background:#00B050;'><span style='padding:2px;font-size: 12px;font-weight: 500;'>" + $scope.catbranchwise[index].categoryName[0] + "</span></td>";
                    } else {
                        $scope.exportProject.category += "<td style='border: 1px solid black;border-collapse: collapse;text-align: center;'><span style='padding:2px;font-size: 12px;font-weight: 500;'>" + $scope.catbranchwise[index].categoryName[0] + "</span></td>"
                    }
                } else {
                    $scope.exportProject.category += "<td style='border: 1px solid black;border-collapse: collapse;text-align: center;'><span style='padding:2px;font-size: 12px;font-weight: 500;'>" + $scope.catbranchwise[index].categoryName[0] + "</span></td>"
                }
            }
        }

        /*------32-03-2020---*/
        $scope.exportProject.analysis = []
        for (let i = 0; i < $scope.suggestionDet.suggestionWhyWhyAnalysis.length; i++) {
            $scope.exportProject.analysis += "<div>" + "<span style='font-weight: bold;'>" + 'Why' + (i + 1) + ":" + " </span>" + $scope.suggestionDet.suggestionWhyWhyAnalysis[i].name + "</div>"
        }
        //console.log($scope.exportProject.analysis);
    }

    $scope.tpmkaizenExportUrl = $sce.trustAsResourceUrl($rootScope.appDomain + 'downloadTPMKkaizenFile');
    $scope.exportTpmKaizen = function () {
        var formData = new FormData();
        var content = angular.element('#tpmKaizenDetails1')
            .val();
        formData.append("content", content);
        $rootScope.flagpageloadindicator = true;
        var d = $q.defer();
        $http.post($scope.tpmkaizenExportUrl, formData, {
            transformRequest: angular.identity,
            responseType: 'arraybuffer',
            headers: {
                'Content-Type': undefined,
                'Authorization': Auth.getToken()
            }
        })
            .then(function (response) {
                $rootScope.flagpageloadindicator = false;
                var a = document.createElement("a");
                document.body.appendChild(a);
                a.style = "display: none";
                var fileName = 'Kaizen_Suggestion_' + $scope.suggestionDet.suggestionNumber + '.pdf';
                var blob = new Blob([response.data], {
                    type: 'application/pdf'
                });
                var url = URL.createObjectURL(blob);
                a.href = url;
                a.download = fileName;
                a.click();
                window.URL.revokeObjectURL(url);
                d.resolve(response);
            })
            .catch(function (error) {
                $rootScope.flagpageloadindicator = false;
                d.resolve(error.data);
            });
        return d.promise;
    }

    // $scope.kaizenExportUrl = $sce.trustAsResourceUrl($rootScope.appDomain + 'downloadFile'); => Portrait view (Vertical)
    // $scope.tpmkaizenExportUrl = $sce.trustAsResourceUrl($rootScope.appDomain + 'downloadTPMKkaizenFile'); => Landscape view (Horizontal)

    $scope.exportStandardKaizen = function () {
        var formData = new FormData();
        var content = angular.element('#exportStandardKaizen')
            .val();
        formData.append("content", content);
        $rootScope.flagpageloadindicator = true;
        var d = $q.defer();
        $http.post($scope.kaizenExportUrl, formData, {
            transformRequest: angular.identity,
            responseType: 'arraybuffer',
            headers: {
                'Content-Type': undefined,
                'Authorization': Auth.getToken()
            }
        })
            .then(function (response) {
                $rootScope.flagpageloadindicator = false;
                var a = document.createElement("a");
                document.body.appendChild(a);
                a.style = "display: none";
                var fileName = 'Kaizen_Suggestion_' + $scope.suggestionDet.suggestionNumber + '.pdf';
                var blob = new Blob([response.data], {
                    type: 'application/pdf'
                });
                var url = URL.createObjectURL(blob);
                a.href = url;
                a.download = fileName;
                a.click();
                window.URL.revokeObjectURL(url);
                d.resolve(response);
            })
            .catch(function (error) {
                $rootScope.flagpageloadindicator = false;
                d.resolve(error.data);
            });
        return d.promise;
    }
    /*--------------------START FOR PILLER LEVEL HORIZONATL DEPLOYEMENT---------------------------CHANGE BY SUNANDA --------------24-2-2020*/
    $scope.setEvalAllPillar = function () {
        var setDept = false
        for (var i = 0; i < $scope.activityList.length; i++) {
            if ($scope.activityList[i].isEvalPillarselect) {
                setDept = true;
            }
        }
        //Horizontal selected than hide require field
        $scope.suggestionDet.hdSelected = !setDept;
    }
    // 16-3-2020
    $scope.setEvalAllMachine = function () {
        var setDept = false
        for (var i = 0; i < $scope.machineList.length; i++) {
            if ($scope.machineList[i].isEvalMachineSelect) {
                setDept = true;
            }
        }
        //Horizontal selected than hide require field
        $scope.suggestionDet.hdSelected = !setDept;
    }
    $scope.setEvalAllPlant = function () {
        var setDept = false
        for (var i = 0; i < $scope.hDBranchList.length; i++) {
            if ($scope.hDBranchList[i].isEvalPlantselect) {
                setDept = true;
            }
        }
        if ($scope.machineHDList.length > 0) {
            setDept = true;
        }
        //Horizontal selected than hide require field
        $scope.suggestionDet.hdSelected = !setDept;
    }

    //select Circle for HD
    $scope.setEvalCirclePillar = function (obj) {
        //  obj.isEvalCircleselect = !obj.isEvalCircleselect;
        var setDept = false
        for (var i = 0; i < $scope.circleList.length; i++) {
            if (obj.isEvalCircleselect) {
                $scope.circleList[i].isEvalCircleselect = false;
            } else {
                $scope.circleList[i].isEvalCircleselect = true;
            }
        }
    }

    $scope.setImplAllPillar = function (obj) {
        obj.isImplPillarselect = !obj.isImplPillarselect;
        var setDept = false
        for (var i = 0; i < $scope.activityList.length; i++) {
            if (obj.isImplPillarselect) {
                $scope.activityList[i].isImplPillarselect = true;
            } else {
                $scope.activityList[i].isImplPillarselect = false;
            }
            if ($scope.activityList[i].isImplPillarselect) {
                setDept = true;
            }
        }
        //Horizontal selected than hide require field
        $scope.suggestionDet.hdSelected = !setDept;
    }
    //select Circle for HD
    $scope.setImplCirclePillar = function (obj) {
        obj.isImplCircleselect = !obj.isImplCircleselect;
        for (var i = 0; i < $scope.circleList.length; i++) {
            if (obj.isImplCircleselect) {
                $scope.circleList[i].isImplCircleselect = true;
            } else {
                $scope.circleList[i].isImplCircleselect = false;
            }
        }
    }

    //select Plant for HD
    $scope.setEvalPlant = function (obj) {
        obj.isEvalPlantselect = !obj.isEvalPlantselect;
        for (var i = 0; i < $scope.hDBranchList.length; i++) {
            if (obj.isEvalPlantselect) {
                $scope.hDBranchList[i].isEvalPlantselect = true;
            } else {
                $scope.hDBranchList[i].isEvalPlantselect = false;
            }
        }
    }

    $scope.getbranchlistbyorgid = function () {
        appService.httpGet("getbranchlistbyorgid/" + $scope.loggedInUserOrgId)
            .then(function (response) {
                if (response.result == true) {
                    $scope.hDBranchList = response.branchList;
                } else {
                    $scope.hDBranchList = [];
                }
            });
    }

    /*--------------------END OF PILLER LEVEL HORIZONATL DEPLOYEMENT---------------------------CHANGE BY SUNANDA --------------24-2-2020*/

    /*----------START FOR EXPORT TPM SUGGESTION--------------23-1-2020-------------BY SUNANDA*/
    $scope.getbranchlistbyorgid();
    $scope.getCircleList();
    // $scope.getMasterMachinePartList($scope.loggedInUserBranchId);
    // $scope.getMasterMachineList($scope.loggedInUserBranchId);
    // $scope.getMasterStageList($scope.loggedInUserBranchId);
    $scope.getMasterOperationList($scope.loggedInUserBranchId);
    // $scope.getMasterProductFamilyList($scope.loggedInUserBranchId);
    /*---END  OF CIRCLE SUGGETION ------------------CHANGE BY SUNANDA---------------------------1-1-2020-----------------*/

    /*---START FOR PARENT KAIZEN DETAILS 3-3-2020 BY SUNANDA --------------------------------------*/
    $scope.setParentExportData = function (res) {
        //console.log(res);
        var rec = res;
        $scope.parentexportProject = angular.copy(res);
        var teamMember = [];
        var activityName = [];
        if ($scope.parentexportProject.sugImplTeam != null && $scope.parentexportProject.sugImplTeam != undefined && $scope.exportProject.sugImplTeam.length > 0) {
            for (var i = 0; i < $scope.parentexportProject.sugImplTeam.length; i++) {
                teamMember.push($scope.parentexportProject.sugImplTeam[i].empName);
            }
            $scope.parentexportProject.teamMemberNames = teamMember.join();

        }
        $scope.parentexportProject.activityName = "";
        for (var i = 0; i < $scope.activityList.length; i++) {
            $scope.parentexportProject.activityName += "<td style='border: 1px solid black;border-collapse: collapse;padding: 5px;text-align: left;'>" + $scope.activityList[i].activityName + "</td>";
        }

        $scope.parentexportProject.category = "";
        if ($scope.catbranchwise != null && $scope.catbranchwise.length > 0) {
            for (var i = 0; i < $scope.catbranchwise.length; i++) {
                if ($scope.catbranchwise[i].catId == $scope.suggestionDet.category.catId) {
                    $scope.parentexportProject.category += "<span style='width: 30px;border: 1px solid #000;margin: 1px;position: relative;padding:5px;font-weight:bold;'>" + $scope.catbranchwise[i].categoryName[0] + "<div style='position: absolute;right: 0px;top:-3px;'><span style='font-size:12px;color: #615b5b;font-weight:bold;'>&#10003;</span></div></span>";
                } else {
                    $scope.parentexportProject.category += "<span style='width: 30px;border: 1px solid #000;margin: 1px;position: relative;padding:5px;'>" + $scope.catbranchwise[i].categoryName[0] + "</span>";
                }
            }
        }
    }

    $scope.getParentSuggestionDetails = function () {
        appService.httpGet("getSuggestionDetails/" + $scope.suggestionDet.parentSuggestionHDId)
            .then(function (response) {
                $scope.flagSuggDetLoader = false;
                $scope.isExecutiveSugg = false;
                $scope.flagSuggDetBoxIndicator = false;
                $scope.isSelectedSuggestionEdited = false;
                $scope.parentKaizanDetails = {}
                if (response != null && response.status == "success") {
                    //Clearing the models bound to the inputs of suggestion details block
                    $scope.clearSuggDetFields();

                    $scope.parentKaizanDetails = response.sugesstionDetails;
                    // $scope.setExportData(response.sugesstionDetails);
                    $scope.parentKaizanDetails.changeDocInput = '';
                    $scope.parentKaizanDetails.docFileName = '';
                    for (var i = 0; i < ($scope.parentKaizanDetails.implTeamList)
                        .length; i++) {
                        if ($scope.parentKaizanDetails.implTeamList[i].implInputs == 'null') {
                            $scope.parentKaizanDetails.implTeamList[i].implInputs = '';
                        }
                    }
                    for (var i = 0; i < ($scope.suggestionDet.sugEmpDocDetails)
                        .length; i++) {
                        if ($scope.suggestionDet.parentKaizanDetails[i].url != null && $scope.parentKaizanDetails.sugEmpDocDetails[i].url.lastIndexOf('.') != null)
                            $scope.suggestionDet.parentKaizanDetails[i].ext = $scope.parentKaizanDetails.sugEmpDocDetails[i].url.substring($scope.parentKaizanDetails.sugEmpDocDetails[i].url.lastIndexOf('.') + 1);
                    }


                    //Detecting that suggestion is assigned for executive or not [i.e. executive flow is there are not]
                    if ($scope.parentKaizanDetails.isExecutive == 1) {
                        $scope.isExecutiveSugg = true;
                    }
                    if ($scope.parentKaizanDetails.implBenefitAnalysisList.length > 0 && $scope.parentKaizanDetails.implBenefitAnalysisList != null) {
                        var str = [];
                        for (var i = 0; i < $scope.parentKaizanDetails.implBenefitAnalysisList.length; i++) {
                            str.push($scope.parentKaizanDetails.implBenefitAnalysisList[i].benefitAnalysis.benefits);
                        }
                        $scope.kaizenExportFormatedData.benefits = str.toString();
                    }
                    if ($scope.parentKaizanDetails.document != null && $scope.parentKaizanDetails.document.length != 0) {
                        $scope.parentKaizanDetails.doc = {};
                        for (var i = 0; i < $scope.parentKaizanDetails.document.length; i++) {
                            if ($scope.parentKaizanDetails.document[i].fileName != null || $scope.parentKaizanDetails.document[i].fileName != '') {
                                $scope.parentKaizanDetails.doc.fileName = $scope.parentKaizanDetails.document[i].fileName;
                            } else {
                                $scope.parentKaizanDetails.doc.fileName = 'N/A';
                            }
                            if ($scope.parentKaizanDetails.document[i].document.documentName != null || $scope.parentKaizanDetails.document[i].document.documentName != '') {
                                $scope.parentKaizanDetails.doc.docName = $scope.parentKaizanDetails.document[i].document.documentName;
                            } else {
                                $scope.parentKaizanDetails.doc.docName = 'N/A';
                            }
                            if ($scope.parentKaizanDetails.document[i].document.owner.firstName != null || $scope.parentKaizanDetails.document[i].document.owner.firstName != '' || $scope.parentKaizanDetails.document[i].document.owner.lastName != '' || $scope.parentKaizanDetails.document[i].document.owner.lastName != null) {
                                $scope.parentKaizanDetails.doc.ownerName = $scope.parentKaizanDetails.document[i].document.owner.firstName + ' ' + $scope.parentKaizanDetails.document[i].document.owner.lastName;
                            }
                        }
                    } else {
                        $scope.parentKaizanDetails.doc = {};
                    }
                    for (var i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                        if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.Implemented.status) {
                            $scope.parentKaizanDetails.kaizanEndDate = $filter('date')(new Date($scope.suggestionDet.sugesstionStatusAudit[i].createdDate), 'MMM d, y');
                            $scope.suggestionDet.ownerDetails = [];
                            if ($scope.suggestionDet.document != null && $scope.suggestionDet.document.length != 0) {
                                for (var j = 0; j < $scope.suggestionDet.document.length; j++) {
                                    if ($scope.suggestionDet.document[j].status == 'COMPLETED') {
                                        var objt = {
                                            ownerName: $scope.suggestionDet.document[j].document.owner.firstName + ' ' + $scope.suggestionDet.document[j].document.owner.lastName,
                                            docName: $scope.suggestionDet.document[j].document.documentName,
                                            docDate: $scope.suggestionDet.document[j].updatedDate
                                        }
                                        $scope.suggestionDet.ownerDetails.push(objt);
                                    }
                                }
                            }
                        }
                    }



                    //Check selected kaizen activity
                    if ($scope.activityList != null && $scope.activityList.length > 0) {
                        for (var k = 0; k < $scope.activityList.length; k++) {
                            $scope.activityList[k].isselect = false;
                        }
                    }

                    if ($scope.parentKaizanDetails.suggestionActivityList != null && $scope.parentKaizanDetails.suggestionActivityList.length > 0) {

                        for (var i = 0; i < $scope.parentKaizanDetails.suggestionActivityList.length; i++) {
                            for (var j = 0; j < $scope.activityList.length; j++) {
                                if ($scope.parentKaizanDetails.suggestionActivityList[i].activity.id == $scope.activityList[j].id) {
                                    $scope.activityList[j].isselect = true;
                                    break;
                                }
                            }
                        }
                    }
                    //end check selected kaizen activity

                    //check selected benifts
                    for (var k = 0; k < $scope.orgLevelBenefitMasterList.length; k++) {
                        $scope.orgLevelBenefitMasterList[k].isselect = false;
                    }
                    if ($scope.parentKaizanDetails.implBenefitAnalysisList != null && $scope.parentKaizanDetails.implBenefitAnalysisList.length > 0) {
                        for (var i = 0; i < $scope.parentKaizanDetails.implBenefitAnalysisList.length; i++) {
                            for (var j = 0; j < $scope.orgLevelBenefitMasterList.length; j++) {
                                if ($scope.orgLevelBenefitMasterList[j].benfitId == $scope.parentKaizanDetails.implBenefitAnalysisList[i].benefitAnalysis.benfitId) {
                                    $scope.orgLevelBenefitMasterList[j].isselect = true
                                    break;
                                }
                            }
                        }
                    }
                    //$scope.setDocumentStatusData();
                    if ($scope.parentKaizanDetails.sugEmpDocDetails != null && $filter('filter')($scope.parentKaizanDetails.sugEmpDocDetails, { docType: 'beforeDoc' }, true).length > 0) {
                        $scope.parentKaizanDetails.beforeImgArray = $filter('filter')($scope.parentKaizanDetails.sugEmpDocDetails, { docType: 'beforeDoc' }, true);
                    } else {
                        $scope.parentKaizanDetails.beforeImgArray = [];
                    }

                    //4 block summary
                    $scope.parentKaizanDetails.blocksummery = {};
                    if ($scope.parentKaizanDetails.sugEmpDocDetails != null && $filter('filter')($scope.parentKaizanDetails.sugEmpDocDetails, { docType: 'beforeDoc' }, true).length > 0) {
                        $scope.parentKaizanDetails.blocksummery.beforeImg = $filter('filter')($scope.parentKaizanDetails.sugEmpDocDetails, { docType: 'beforeDoc' }, true);
                    } else {
                        $scope.parentKaizanDetails.blocksummery.beforeImg = [];
                    }
                    var benefits = [];
                    if ($scope.parentKaizanDetails.implBenefitAnalysisList != null && $scope.parentKaizanDetails.implBenefitAnalysisList.length > 0) {
                        for (var i = 0; i < $scope.parentKaizanDetails.implBenefitAnalysisList.length; i++) {
                            benefits.push($scope.parentKaizanDetails.implBenefitAnalysisList[i].benefitAnalysis.benefits);
                        }
                        $scope.parentKaizanDetails.blocksummery.benefits = benefits.join();
                    }
                    //Category
                    var category = [];
                    var text = "";
                    if ($scope.orgLevelBenefitMasterList != null && $scope.orgLevelBenefitMasterList.length > 0) {
                        for (var i = 0; i < $scope.orgLevelBenefitMasterList.length; i++) {
                            //category.push($scope.benefitList[i].benefits[0]);
                            if ($scope.orgLevelBenefitMasterList[i].branch.branchId == $scope.parentKaizanDetails.branch.branchId) {
                                if ($scope.orgLevelBenefitMasterList[i].isselect) {
                                    text += "<span style='width: 30px;border: 1px solid #000;margin: 1px;position: relative;padding:5px;font-weight:bold;'>" + $scope.orgLevelBenefitMasterList[i].benefits[0] + "<div style='position: absolute;right: 0px;top:-3px;'><span style='font-size:12px;color: #615b5b;font-weight:bold;'>&#10003;</span></div></span>";
                                } else {
                                    text += "<span style='width: 30px;border: 1px solid #000;margin: 1px;position: relative;padding:5px;'>" + $scope.orgLevelBenefitMasterList[i].benefits[0] + "</span>";
                                }
                            }
                        }
                        $scope.parentKaizanDetails.blocksummery.category = text;
                    }
                    //Controller
                    for (var i = 0; i < $scope.parentKaizanDetails.sugesstionStatusAudit.length; i++) {
                        if ($scope.parentKaizanDetails.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.SuggestionAssigned.status) {
                            $scope.parentKaizanDetails.blocksummery.controller = $scope.parentKaizanDetails.sugesstionStatusAudit[i].emp_details;
                        }
                    }
                    //Evaluator
                    var evalNames = [];
                    if ($scope.parentKaizanDetails.evaluationTeamList != null && $scope.parentKaizanDetails.evaluationTeamList.length > 0) {
                        for (var i = 0; i < $scope.parentKaizanDetails.evaluationTeamList.length; i++) {
                            evalNames.push($scope.parentKaizanDetails.evaluationTeamList[i].empName);
                        }
                        $scope.parentKaizanDetails.blocksummery.evaluator = evalNames.join();
                    }
                    //Implementor
                    var implNames = [];
                    if ($scope.parentKaizanDetails.implTeamList != null && $scope.parentKaizanDetails.implTeamList.length > 0) {
                        for (var i = 0; i < $scope.parentKaizanDetails.implTeamList.length; i++) {
                            implNames.push($scope.parentKaizanDetails.implTeamList[i].empName);
                        }
                        $scope.parentKaizanDetails.blocksummery.implementor = implNames.join();
                    }
                    //Change 27-1-2020 
                    if ($scope.parentKaizanDetails.sugesstionStatusAudit != null && $scope.parentKaizanDetails.sugesstionStatusAudit.length > 0) {
                        for (var i = 0; i < $scope.parentKaizanDetails.sugesstionStatusAudit.length; i++) {
                            if ($scope.parentKaizanDetails.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.UnderFinanceApproval.status) {
                                $scope.parentKaizanDetails.blocksummery.financeController = $scope.parentKaizanDetails.sugesstionStatusAudit[i].emp_details.firstName + ' ' + $scope.parentKaizanDetails.sugesstionStatusAudit[i].emp_details.lastName;
                            }
                        }
                    }
                    if ($scope.parentKaizanDetails.sugesstionStatusAudit != null && $scope.parentKaizanDetails.sugesstionStatusAudit.length > 0) {
                        for (var i = 0; i < $scope.parentKaizanDetails.sugesstionStatusAudit.length; i++) {
                            if ($scope.parentKaizanDetails.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.UnderFinanceVerification.status) {
                                $scope.parentKaizanDetails.blocksummery.financeValidator = $scope.parentKaizanDetails.sugesstionStatusAudit[i].emp_details.firstName + ' ' + $scope.parentKaizanDetails.sugesstionStatusAudit[i].emp_details.lastName;
                            }
                        }
                    }
                    //Change Document
                    var document = [];
                    if ($scope.parentKaizanDetails.document != null && $scope.parentKaizanDetails.document.length > 0) {
                        for (let index = 0; index < $scope.parentKaizanDetails.document.length; index++) {
                            if ($scope.parentKaizanDetails.document[index].status == 'COMPLETED') {
                                var rec = $scope.parentKaizanDetails.document[index];
                                document.push(rec.document.documentName);
                            }
                        }
                        $scope.parentKaizanDetails.blocksummery.document = document.join();
                    }
                } else {
                    snackbar.create($filter('translate')('Oops_Please_try_again'), 4000, "error");
                }
                if ($scope.suggestionList.length == 0) {
                    $scope.suggestionDet = {};
                }
                if ($scope.parentKaizanDetails.suggestionTrackerDetails != null && $scope.parentKaizanDetails.suggestionTrackerDetails.length > 0) {
                    for (let i = 0; i < $scope.parentKaizanDetails.suggestionTrackerDetails.length; i++) {
                        if ($scope.parentKaizanDetails.suggestionTrackerDetails[i].team_type_master != null) {
                            if ($scope.parentKaizanDetails.suggestionTrackerDetails[i].team_type_master.type == 'Implementation') {
                                $scope.parentImplwhyWhyAnalysisData = $scope.parentKaizanDetails.suggestionTrackerDetails[i];
                            }
                        }
                    }
                }
                // $scope.scrollToBottom("suggestionDet");
            });
    }
    //sugesstionDetails
    $scope.selectedRejection = [];
    $scope.getRejectionListDetails = function (sugId) {
        $scope.getSelectedRejection = [];

        $scope.selectedSuggId = sugId;
        //console.log($scope.selectedSuggId);
        $scope.getReject = {
            "sugId": $scope.selectedSuggId
        }
        appService.httpPost($scope.getReject, "getsuggData").then(function (response) {
            if (response.result) {
                if (response.data.rejectionList != null && response.data.rejectionList.length > 0) {
                    $scope.getSelectedRejection = response.data.rejectionList;
                    for (let y = 0; y < $scope.getSelectedRejection.length; y++) {
                        $scope.selectAud = $scope.getSelectedRejection[y].stsadtId
                    }
                }
            } else {
                if (response.statusCode == 100) {
                    $scope.statusMessage = response.reason;
                    $("#statusMessageModal")
                        .modal({
                            backdrop: 'static',
                            keyboard: false
                        });;
                } else {
                    snackbar.create("Error occured while getting rejection reason", 3000, "error");
                }
            }
        })
    }
    $scope.selectFilterAllRejection = function () {
        var flag = ($scope.selectAllRejection) ? false : true;
        //console.log(flag);
        $scope.selectAllRejection = flag;
        $scope.selectRejArray = []
        if ($scope.getRejectionList != null && $scope.getRejectionList.length > 0) {
            for (var i = 0; i < $scope.getRejectionList.length; i++) {
                $scope.getRejectionList[i].isSelected = $scope.selectAllRejection;
                //console.log($scope.getRejectionList[i].isSelected);
                $scope.selectRejArray.push($scope.getRejectionList[i].id)
                //console.log($scope.selectRejArray);
            }
            $scope.count = $filter('filter')($scope.getRejectionList, { isSelected: true }, true).length;
            //console.log($scope.count);
        }
        else {
            $scope.selectRejArray = [];
        }
    }
    $scope.isOther = false;
    $scope.isRejectByEval = false;
    //$scope.isSelectAnotherScru = false;
    $scope.isDropdownRejImpl = false;
    $scope.isDropdownRejEval = false;
    $scope.count = 0;
    $scope.selectRejArray = [];
    $scope.onRejection = function () {
        $scope.isOther = true;
        if ($scope.isOther == true) {
            $scope.isDropdownRej = false;
        }
        //$scope.rejectionToggle();
    }
    $scope.isImplementerRej = false;
    $scope.onImplementerReject = function () {
        $scope.isImplementerRej = true;
        // $scope.isImplementerRej = !$scope.isImplementerRej
        if ($scope.isImplementerRej == true) {
            $scope.isDropdownRejImpl = false;
        }
    }
    $scope.onImplementerRejectModal = function () {
        $scope.isDropdownRejImpl = true;
        $scope.isImplementerRej = false
    }
    $scope.isEvaluatorReject = false
    $scope.onEvaluatorReject = function () {
        $scope.isEvaluatorReject = true;
        if ($scope.isEvaluatorReject == true) {
            $scope.isDropdownRejEval = false;
        }
    }

    $scope.onFinanceController = function () {
        // $scope.isFinanceReject = true;
        // if($scope.isFinanceReject == true){
        $scope.isDropdownRejFc = true;
        $scope.isFinanceReject = false;
        $scope.isSubmitFinanace = true

        // }
    }
    $scope.isFinanceReject = false;
    $scope.onFinanceOther = function () {
        $scope.isFinanceReject = true;
        if ($scope.isFinanceReject == true) {
            $scope.isDropdownRejFc = false;
            $scope.isSubmitFinanace = true;
        }
    }
    $scope.setFilterRejectionSelected = function (data) {
        //console.log(data);
        $scope.selectRejArray = [];
        $scope.selectedRejId = data.id;
        //console.log($scope.selectedRejId)
        data.isSelected = (data.isSelected) ? false : true;
        //console.log(data.isSelected);
        //console.log($scope.getRejectionList);
        if ($scope.getRejectionList != null && $scope.getRejectionList.length > 0) {
            for (var i = 0; i < $scope.getRejectionList.length; i++) {
                ////console.log($scope.selectRejArray)
                if (!$scope.getRejectionList[i].isSelected) {
                    $scope.getRejectionList[i].isSelected = false;
                    //console.log($scope.getRejectionList[i].isSelected)
                    $scope.selectAllRejection = false;

                }
                else {
                    $scope.selectRejArray.push($scope.getRejectionList[i].id)
                }
            }
            $scope.count = $filter('filter')($scope.getRejectionList, { isSelected: true }, true).length;
            $scope.selectAllRejection = ($scope.getRejectionList.length == $scope.count);
            //console.log($scope.count);
        }
        //console.log($scope.selectRejArray);
        // $scope.rejectionToggle();
        // $scope.secondRejectionToggle();
        // $scope.implementerRejection();

    }

    $scope.dropDownRejectionList = function () {
        $scope.getRejectionList = []
        appService.httpGet("getSuggRejectionReason/" + $rootScope.empDetails.organization.orgId + "/" + $scope.suggestionDet.branch.branchId).then(function (response) {
            $scope.rejectionListLoding = false;
            if (response.result) {
                if (response.data != null && response.data.length > 0) {
                    $scope.getRejectionList = response.data;
                }
                else {
                    $scope.getRejectionList = [];
                }

            }
            else {
                $scope.getRejectionList = [];
            }
        })
    }
    $scope.showParentKaizanDetails = function () {
        $scope.getParentSuggestionDetails();
        $("#parentKaizenModal")
            .modal({
                backdrop: 'static',
                keyboard: false
            });
        // if ($scope.SuggestionTemplate.template.templateName == 'PillarKaizen') {
        //     $("#parentkaizenData")
        //         .modal({
        //     backdrop: 'static',
        //         keyboard: false
        // });
        // } else {
        //     $("#parentKaizanDetailsforHD")
        //         .modal({
        //     backdrop: 'static',
        //         keyboard: false
        // });
        // }
    }
    /*----END OF PARENT KAIZEN DETAILS 3-3-2020 BY SUNANDA -----------------------------------------*/
    /*--------------START FOR HD MACHINE DATA-------------*/
    $scope.machineHDList = [];
    $scope.addmachineHDList = function (tmpdata) {
        if ($scope.isEmpty(tmpdata)) {
            snackbar.create($filter('translate')('Please_select_data'), 5000, "error");
            return;
        }
        if (tmpdata.operation == null || tmpdata.operation == undefined || tmpdata.operation == '') {
            snackbar.create($filter('translate')('Please_select_operation'), 5000, "error");
            return;
        }
        if ($scope.machineHDList != null && $scope.machineHDList.length > 0) {
            for (let i = 0; i < $scope.machineHDList.length; i++) {
                if ($scope.machineHDList[i].operation.id == tmpdata.operation.id) {
                    snackbar.create("Already Exist", 5000, "error");
                    return;
                }
            }
        }
        var data = angular.copy(tmpdata);
        $scope.machineHDList.push(data);
        var setDept = false
        if ($scope.machineHDList.length > 0) {
            setDept = true;
        }
        for (var i = 0; i < $scope.hDBranchList.length; i++) {
            if ($scope.hDBranchList[i].isEvalPlantselect) {
                setDept = true;
            }
        }
        //Horizontal selected than hide require field
        $scope.suggestionDet.hdSelected = !setDept;
        // $scope.evalMachineHDList = {
        //     circle: null,
        //     stage: null,
        //     product: null,
        //     productNo: null,
        //     machine: null,
        //     operation: null
        // };
        $scope.evalMachineHDList = {};
    }

    $scope.removeHDMachine = function (index) {
        $scope.machineHDList.splice(index, 1);
    }

    $scope.implMachineHDList = [];
    $scope.addimplMachineHDList = function (tmpdata) {
        tmpdata.id = 0;
        for (let i = 0; i < $scope.implMachineHDList.length; i++) {
            if ($scope.implMachineHDList[i].operation.id == tmpdata.operation.id) {
                snackbar.create($filter('translate')('Already_Exist'), 5000, "error");
                return;
            }
        }
        var data = angular.copy(tmpdata);
        $scope.implMachineHDList.push(data);
    }
    $scope.removeImplHDMachine = function (index) {
        $scope.implMachineHDList.splice(index, 1);
    }

    $scope.WhyWhyAnlysisTip = {
        whywhyAnalysisToolTip: "Analytics showing as how the real root cause was identified",
        rootCause: "Root Cause is basically reason for the problem",
        counterMeasures: "Action taken to prevent the problem",
        kaizenIdea: "Suggestion  for the problem",
        result: "Outcome post implementation of suggestion",
        whatToDo: "Indicating 'what to check/audit to ensure that kaizen will be effective in long run'",
        howToDo: "Indicating 'how to check/audit to ensure that kaizen will be effective in long run'",
        frquency: "Repetation of check /audit"
    }

    $scope.getSuggestionTypeDetail = function (data, branch) {
        if (data && branch) {
            appService.httpGet("suggestion/getSuggestionTypeDetail/" + data + '/' + branch)
                .then(function (response) {
                    if (response.result) {
                        $scope.parentSuggType = response.suggestionDTO;
                    } else {
                        $scope.parentSuggType = {};
                    }
                });
        }
    }
    //  25-5-2020
    $scope.CloseGuestSugg = function () {
        $scope.data = {
            // $scope.CONST.STATUS.GSCloseWithoutImplementation.statusId
            statusId: $scope.CONST.STATUS.GSCloseWithoutImplementation.statusId,
            sugId: $scope.selectedSuggId,
            summary: $scope.suggestionDet.guestComment,
            empId: parseInt($scope.loggedInEmpId),
            branchId: $scope.loggedInUserBranchId,
            orgId: $scope.loggedInUserOrgId
        }
        //console.log($scope.data);
        // return
        appService.httpPost($scope.data, "closeGSSuggestionByEvalHD")
            .then(function (response) {
                $scope.suggestionDet.closeGuest = false;
                if (response.status == "success") {
                    $scope.suggestionDet = {};
                    $scope.getSuggestionDetails($scope.selectedSuggId);
                    snackbar.create($filter('translate')('Suggestion_closed_successfully'), 5000, "success");
                    $scope.getsuggestionList('onUpdate');
                    $scope.getStatusWiseCount();
                } else {
                    snackbar.create($filter('translate')('Oops_Please_try_again'), 5000, "error");
                }
            });
    }
    // Change For Other Benefit by @Jayshri Kolase on 05-04-2024

    // $scope.groupingParticular = function (rec) {
    //     if (rec) {
    //         $scope.newSug.initiatorPart = undefined;
    //         if ($scope.particulars != null && $scope.particulars.length > 0) {
    //             for (let index = 0; index < $scope.particulars.length; index++) {
    //                 $scope.particulars[index].isInitiatorSelected = false;
    //                 if (rec) {
    //                     if ($scope.particulars[index].category.catId == rec.catId) {
    //                         $scope.particulars[index].type = '';
    //                     } else {
    //                         $scope.particulars[index].type = 'Others';
    //                     }
    //                 } else {
    //                     $scope.particulars[index].type = '';
    //                 }
    //             }
    //         }
    //     }
    //     //console.log($scope.particulars);
    // }

    $scope.particularsnew = [];
    $scope.groupingParticular = function (rec) {
        $scope.particularsnew = [];
        if (rec) {
            $scope.newSug.initiatorPart = undefined;
            if ($scope.particulars != null && $scope.particulars.length > 0) {
                for (let index = 0; index < $scope.particulars.length; index++) {
                    $scope.particulars[index].isInitiatorSelected = false;
                    if (rec) {
                        if ($scope.particulars[index].category.catId == rec.catId) {
                            $scope.particulars[index].type = '';
                            $scope.particulars[index].isSelected = false;
                            $scope.particularsnew.push($scope.particulars[index]);
                        } else {
                            $scope.particulars[index].type = 'Other category benefits';
                            $scope.particulars[index].isSelected = false;
                        }
                    } else {
                        $scope.particulars[index].type = '';
                    }
                }
                $scope.particularsnew.push({ id: 0, particulars: "Other Benefits", type: "" });
                //console.log($scope.particulars);
                //console.log($scope.particularsnew);
            }
        }

    }
    $scope.clearBenefit = function () {
        $scope.particularsnew = [];
    }
    $scope.setPerticularsSelected = function (status) {
        for (var i = 0; i < $scope.particulars.length; i++) {
            if (status.isSelected) {
                $scope.particulars[i].isSelected = false;
            }
            else {
                $scope.particulars[i].isSelected = true;
            }
            if ($scope.particulars[i].id !== status.id) {
                $scope.particulars[i].isSelected = false;
                $scope.particulars[i].isInitiatorSelected = false;
            }
            if ($scope.particulars[i].id === status.id) {
                $scope.newSug.initiatorPart = $scope.particulars[i];
                $scope.particulars[i].isInitiatorSelected = true;
            }
        }
        var statusListSelectedCount = $filter('filter')($scope.particulars, { isSelected: true }, true).length;
        $scope.selectAllStatus = ($scope.particulars.length == statusListSelectedCount);
        if ($scope.selectAllStatus) {
            $scope.statusToggle();
        }
    }
    $scope.resetPerticularsList = function (selectedParticular) {
        //console.log(selectedParticular)
        //console.log($scope.newSug.catId)
        if (selectedParticular.particulars == "Other Benefits") {
            for (let i = 0; i < $scope.particulars.length; i++) {
                $scope.particulars[i].isSelected = false;
                if ($scope.particulars[i].type == "Other category benefits") {
                    $scope.particularsnew.push($scope.particulars[i]);
                }
            }
            //console.log($scope.particularsnew)
            // event.stopPropagation();
        }
        else {
            for (let i = 0; i < $scope.particularsnew.length; i++) {
                if ($scope.particularsnew[i].id == 0) {
                    $scope.particularsnew[i].isSelected = false;
                }
            }
            if ($scope.newSug.catId.catId == selectedParticular.category.catId) {
                $scope.groupingParticular(selectedParticular.category)
            }
        }
    }
    $scope.benefitToggle = function () {
        $('.benefitWrapper .benefitList')
            .slideToggle('fast');
    }
    $scope.toggleBenefitDiv = function (event) {
        var $trigger = $(".benefitWrapper");
        if ($trigger !== event.target && !$trigger.has(event.target)
            .length) {
            $('.benefitList').slideUp("fast");
        }
    }

    // START FOR SIMILAR SUGGESTION  27-8-2020
    $scope.duplicationPaginate = {
        current: 1,
        total: 0,
        perPage: 5,
        maxsize: 5
    }
    $scope.onSimilarSuggPaginationClick = function (number) {
        $scope.duplicationPaginate.current = number;
    }
    $scope.showSimilarSugg = function () {
        $scope.duplicationPaginate = {
            current: 1,
            total: 0,
            perPage: 5,
            maxsize: 5
        }
        $scope.similarsuggestionList = [];
        $scope.suggestionInputDetails.acceptRejectStatus = 'Duplication';
        $scope.data = {
            "sugId": $scope.selectedSuggId,
            "branchId": $scope.loggedInUserBranchId,
            "suggestion": $scope.suggestionDet.suggestionTitle + ' ' + $scope.suggestionDet.problemAnalysis + ' ' + $scope.suggestionDet.sugession,
        };
        appService.httpPost($scope.data, "findSimilarSuggestions")
            .then(function (response) {
                if (response.result) {
                    if (response.hasOwnProperty('similarSuggCount')) {
                        $scope.duplicationPaginate.total = response.similarSuggCount;
                    }
                    if (response.similarSugList != null && response.similarSugList.length > 0) {
                        for (let index = 0; index < response.similarSugList.length; index++) {
                            if (response.similarSugList[index].sugId != $scope.suggestionDet.sugId) {
                                $scope.similarsuggestionList.push(response.similarSugList[index]);
                            }
                        }
                    } else {
                        $scope.similarsuggestionList = [];
                    }
                } else {
                    $scope.similarsuggestionList = [];
                }
            });
        $("#modelSimilarSugg").modal({
            backdrop: 'static',
            keyboard: false
        });
    }

    $scope.setActivityInfo = function () {
        if ($scope.activityList != null && $scope.activityList.length > 0) {
            for (let index = 0; index < $scope.activityList.length; index++) {
                if ($scope.activityList[index].activityName == 'KK') {
                    $scope.activityList[index].desc = 'Cost saving, Ergonomic improvements, Productivity/OEE improvement, Setup time reduction, delivery method or delivery time to customer, etc.';
                    $scope.activityList[index].fullForm = 'Kobetsu-Kaizen or Focused improvement';
                } else if ($scope.activityList[index].activityName == 'JH') {
                    $scope.activityList[index].desc = 'Any Abnormality elimination (Out of the 7) , simplifying the CLITA tasks, reducing the CLITA time taken, closure of any audit points related to JH Pillar/JH activities.';
                    $scope.activityList[index].fullForm = 'Jishu-Hozen or Autonomous Maintenance';
                } else if ($scope.activityList[index].activityName == 'QM') {
                    $scope.activityList[index].desc = 'Internal defect/scrap reduction, improving rejection handling, to avoid Customer complaint - both reported or proactive, improvement in child part packaging/storage/handling, closure of any audit points related to Quality Systems, etc.';
                    $scope.activityList[index].fullForm = 'Quality Maintenance';
                } else if ($scope.activityList[index].activityName == 'PM') {
                    $scope.activityList[index].desc = 'Improvement points for - PM activities, PM adherence, improving quality of PM done by concerned team.';
                    $scope.activityList[index].fullForm = 'Planned Maintenance';
                } else if ($scope.activityList[index].activityName == 'SH') {
                    $scope.activityList[index].desc = 'Improving safety aspects in work area, elimination of near miss concerns, improvement in health and hygiene of employees, reducing any harmful effects on environment, etc.';
                    $scope.activityList[index].fullForm = 'Safety, Health and Environment';
                } else if ($scope.activityList[index].activityName == 'OTPM') {
                    $scope.activityList[index].desc = 'Improvements related to shopfloor office areas, common areas in lines, etc.';
                    $scope.activityList[index].fullForm = 'Office Total Productive Maintenance';
                } else if ($scope.activityList[index].activityName == 'ET') {
                    $scope.activityList[index].desc = 'Related to On-Job-Training methods, skill matrix methodology followed, closure of any audit points related to training, etc.';
                    $scope.activityList[index].fullForm = 'Education and Training';
                } else if ($scope.activityList[index].activityName == 'DM') {
                    $scope.activityList[index].desc = 'This pillar is responsible for the development of systems within the company, so that company can grow.';
                    $scope.activityList[index].fullForm = 'Development Management';
                }
            }
        }
    }
    $scope.getActivityList = function () {
        appService.httpGet('getActivityList')
            .then(function (response) {
                if (response.result) {
                    if (response.activityList != null && response.activityList.length > 0) {
                        $scope.activityList = response.activityList;
                        $scope.setActivityInfo();
                    } else {
                        $scope.activityList = [];
                    }
                } else {
                    $scope.activityList = [];
                }
            })
    }
    //Modal for Pillar Information
    $scope.getPillarInfo = function () {
        if ($scope.activityList != null && $scope.activityList.length > 0) {
            $scope.setActivityInfo();
        } else {
            $scope.getActivityList();
        }
        // $scope.setActivityInfo();
        $("#pillarInfoModal")
            .modal({
                backdrop: 'static',
                keyboard: false
            });
    }
    $scope.isMahle = function () {
        var flag = false;
        if ($rootScope.empDetails != null && $rootScope.empDetails != undefined) {
            var alies = $rootScope.empDetails.organization.alies;
            if (alies != null && !angular.isUndefined(alies) && alies == 'mahle') {
                flag = true;
            }
        }
        return flag;
    }
    // END OF SIMILAR SUGGESTION
    /*-----------------End Tab 1 code------------------------------------------------------------------------------------------------*/
    $scope.KaizenSustenanceMon = {};
    $scope.getKaizenSustenanceMonitoring = function (filterId, caption) {
        $scope.captionName = caption
        $scope.KaizenSustenanceMon.selectedfilterId = filterId;
        console.log($scope.suggestionList)
        // $scope.staticPagination = {
        //     currentPage: 1,
        //     limit: 10,
        //     maxSize: 5,
        //     myCurrentPage: 1
        // }
        $scope.getKaizenSustenanceMonitoringDetails($scope.selectedfilterId);
        $("#kaizenSustenanceMonitoring")
            .modal({
                backdrop: 'static',
                keyboard: false
            });
    }
    $scope.getKaizenSustenanceMonitoringDetails = function (data) {
        $scope.data = {
            orgId: $scope.loggedInUserOrgId,
            // branchId: $scope.selectBranchId,
            branchIds: [],
            caption: $scope.captionName,
            suggestionLevel: "WITHIN_PLANT",
            typeId: $scope.statusCountFilter,
            assignedToId: $scope.loggedInEmpId,
            // "filterId": data,
            // "limit": 10,
            // "offset": 0
        }
        if ($scope.guestBranchList != undefined || $scope.guestBranchList != null) {
            for (var index = 0; index < $scope.guestBranchList.length; index++) {
                if ($scope.guestBranchList[index].isSelected) {
                    $scope.data.branchIds.push(parseInt($scope.guestBranchList[index].branchId));
                }
            }
        }
        var url = "getsuggestionlistnew"
        $scope.globalLoadingIndicator = true;
        $scope.flagEmployeeListSpinner = false;
        $scope.flagTblemployee = false;
        $scope.showTable = true;
        appService.httpPost($scope.data, url)
            .then(function (response) {
                if (response.result == true) {
                    $scope.globalLoadingIndicator = false;
                    $scope.kaizenSustenanceMonitoringList = response.sugessionsByEmpIdList;
                    console.log($scope.kaizenSustenanceMonitoringList)

                    for (var index = 0; index < $scope.kaizenSustenanceMonitoringList.length; index++) {
                        var name = '';
                        if ($scope.kaizenSustenanceMonitoringList[index].firstName) {
                            name += $scope.kaizenSustenanceMonitoringList[index].firstName;
                        }

                        if ($scope.kaizenSustenanceMonitoringList[index].lastName) {
                            if ($scope.kaizenSustenanceMonitoringList[index].firstName) {
                                name += ' ';
                            }
                            name += $scope.kaizenSustenanceMonitoringList[index].lastName;
                        }

                        $scope.kaizenSustenanceMonitoringList[index].empName = name;
                    }

                    console.log($scope.kaizenSustenanceMonitoringList);


                } else {
                    // $scope.getsuggestionList('onLoad');
                    $scope.kaizenSustenanceMonitoringList = [];
                }
            });
    }

    $scope.getExportKaizenSustenanceMonitoring = function () {
        var today = new Date();
        var date = today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate();
        var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
        var dateTime = date + ' ' + time;
        var exportDataTmp = [];

        for (var i = 0; i < $scope.kaizenSustenanceMonitoringList.length; i++) {

            var SuggNumber = $scope.kaizenSustenanceMonitoringList[i].createdSuggestionNumber;

            exportDataTmp.push({
                "Employee Name": $scope.kaizenSustenanceMonitoringList[i].empName || "-",
                "Suggestion Id": $scope.kaizenSustenanceMonitoringList[i].suggestionNumber || "-",
                "Suggestion Title": $scope.kaizenSustenanceMonitoringList[i].suggestionTitle || "-",
                "Department": $scope.kaizenSustenanceMonitoringList[i].deptName || "-",
                "Suggestion Source": $scope.kaizenSustenanceMonitoringList[i].suggestionSource || "-",
                "Category": $scope.kaizenSustenanceMonitoringList[i].catName || "-",
                "Benefit": $scope.kaizenSustenanceMonitoringList[i].particulars || "-",
                "Current Status": $scope.kaizenSustenanceMonitoringList[i].label || "-",
            });
        }
        // alasql('SELECT * INTO XLSX("SuggestionDetails.xlsx",{headers:true}) FROM ?', [exportDataTmp]);
        ExcelExportService.exportDataToExcel(exportDataTmp, 'Suggestion Details', 'Suggestion_Details');
    }
    $scope.setDeptBranchWiseTab = 'branch';
    $scope.setDeptBranchWise = function (tab) {
        $scope.setDeptBranchWiseTab = tab;
        if (tab == 'branch') {
            $scope.setSelectedDeptIdForGraph = 0;
            $scope.getBenefitWiseCount($scope.graphFromDt, $scope.graphToDt);
            $scope.getStatusGraph($scope.graphFromDt, $scope.graphToDt);
            $scope.getCostEffect($scope.graphFromDt, $scope.graphToDt);
        } else {
            $scope.selectGraphDeptId = $scope.selectGraphDeptId;
            $scope.setGraphDeptWise($scope.selectGraphDeptId);
        }
    }
    $scope.setSelectedDeptIdForGraph = 0;
    $scope.setGraphDeptWise = function (dept) {
        $scope.setSelectedDeptIdForGraph = dept;
        $scope.getBenefitWiseCount($scope.graphFromDt, $scope.graphToDt);
        $scope.getStatusGraph($scope.graphFromDt, $scope.graphToDt);
        $scope.getCostEffect($scope.graphFromDt, $scope.graphToDt);
    }

    /*-----------------End Tab 2  code------------------------------------------------------------------------------------------------*/
    /*-----------------Tab 3  code----------------------------------------------------------------------------------------------------*/

    $scope.exportKaizenData = function () {
        var formData = new FormData();
        var content = angular.element('#kaizenDetails')
            .val();
        formData.append("content", content);
        $rootScope.flagpageloadindicator = true;
        var d = $q.defer();
        $http.post($scope.kaizenExportUrl, formData, {
            transformRequest: angular.identity,
            responseType: 'arraybuffer',
            headers: {
                'Content-Type': undefined,
                'Authorization': Auth.getToken()
            }
        })
            .then(function (response) {
                $rootScope.flagpageloadindicator = false;
                var a = document.createElement("a");
                document.body.appendChild(a);
                a.style = "display: none";
                var fileName = 'Kaizen_Suggestion_' + $scope.suggestionDet.suggestionNumber + '.pdf';
                var blob = new Blob([response.data], {
                    type: 'application/pdf'
                });
                var url = URL.createObjectURL(blob);
                a.href = url;
                a.download = fileName;
                a.click();
                window.URL.revokeObjectURL(url);
                d.resolve(response);
            })
            .catch(function (error) {
                $rootScope.flagpageloadindicator = false;
                d.resolve(error.data);
            });
        return d.promise;
    }

    /*-----------------End Tab 3  code------------------------------------------------------------------------*/
    $scope.changeLanguage = function (x) {
        var portalurl = window.location.hostname;
        //var portalurl = $location.absUrl().split('?')[0]
        if (x == 2) {
            appService.httpGetLocal("translations/suggestion-mr.json")
                .then(function (response) {
                    $scope.langTranslate = response;
                });
        }
        if (x == 1) {
            appService.httpGetLocal("i18n/Suggestion/en.json")
                .then(function (response) {
                    $scope.langTranslate = response;
                });
        }
    }
    // $scope.changeLanguage($rootScope.empDetails.langName.langId);

    //$scope.changeLanguage('en');
    $scope.getTabId = function () {
        var name = 'tabId';
        var url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        var tab = decodeURIComponent(results[2].replace(/\+/g, " "));
        if (tab != 1) {
            $scope.initMasterDataForSugg();
            $scope.getBranchAccessSetup();
            $scope.setMainTab(parseInt(tab), '');
            $scope.resetRzSlider();
        }
    }
    // $scope.getTabId();

    /*-------------------------Get Comment Details------------------------*/
    $scope.getEvalcommentDetails = function () {
        if (!$scope.isEmpty($scope.suggestionDet) && $scope.suggestionDet.sugesstionStatusAudit != null && $scope.suggestionDet.sugesstionStatusAudit.length > 0) {
            var tmpRec = $filter('filter')($scope.suggestionDet.sugesstionStatusAudit, { status_master: { status: $scope.CONST.STATUS.EvaluationRequestAccepted.status } }, true);
            if (tmpRec != null && tmpRec.length > 0) {
                appService.httpGet("getSuggestionComments/" + $scope.selectedSuggId)
                    .then(function (response) {
                        if (response.result) {
                            $scope.suggestionComment = response.suggestionComments;
                        } else {
                            $scope.suggestionComment = [];
                        }
                    });
            }
        }
    }

    $scope.addComment = function () {
        $scope.Evaldata = null;
        if ($scope.suggestionDet.sugesstionStatusAudit != null && $scope.suggestionDet.sugesstionStatusAudit.length > 0) {
            var tmpRec = $filter('filter')($scope.suggestionDet.sugesstionStatusAudit, { status_master: { status: $scope.CONST.STATUS.EvaluationRequestAccepted.status } }, true);
            if (tmpRec != null && tmpRec.length > 0) {
                $scope.Evaldata = tmpRec[0];
            }
        }
        $scope.suggestionDet.comment = '';
        $scope.getEvalcommentDetails();
        $("#addComment").modal({
            backdrop: 'static',
            keyboard: false
        });
    }

    $scope.submitComment = function (x) {
        $scope.submitSpinner = true;
        if ($scope.suggestionDet.comment == '' || $scope.suggestionDet.comment == null || $scope.suggestionDet.comment == undefined) {
            snackbar.create($filter('translate')('Please_Enter_Comment'), 4000, "error");
            $scope.submitSpinner = false;
            return;
        }
        $scope.data = {
            "comment": $scope.suggestionDet.comment,
            "commentsRaisedById": $rootScope.empDetails.empId,
            "sugDet": {
                "sugId": $scope.selectedSuggId
            }
        };
        appService.httpPost($scope.data, "saveSuggestionComments")
            .then(function (response) {
                $scope.submitSpinner = false;
                if (response.result) {
                    // snackbar.create("Comment added successfully", 4000, "success");
                    snackbar.create($filter('translate')('Comment_added_successfully'), 4000, "success");
                    $scope.clearComments();
                    $scope.getEvalcommentDetails();
                    $("#addComment")
                        .modal('hide');
                } else {
                    snackbar.create($filter('translate')('Oops_Please_try_again'), 5000, "error");
                }
            });
    }

    $scope.clearComments = function () {
        $scope.suggestionDet.comment = '';
    }
    /*--------------------------------------------------------top3 kizan -------------------change1-------------------7/13/19-----change by sunanda*/
    $scope.getSuggestionEvalParametersList = function () {
        appService.httpGet("getSuggestionEvalParameters")
            .then(function (response) {
                if (response.result) {
                    $scope.suggestionEvalParametersList = response.suggestionKaizenParameter;
                }
            });
    }

    $scope.getSuggestionEvalRatingsList = function () {
        appService.httpGet("getSuggestionEvalRatings/" + $scope.loggedInUserBranchId)
            .then(function (response) {
                if (response.result) {
                    $scope.suggestionEvalRatingsList = response.suggestionKaizenRating;
                }
            });
    }

    $scope.getSuggestionEvalRatingsList();
    $scope.getSuggestionEvalParametersList();
    /*----------------------------------------------save jury input--------------------------------------------------------- */
    $scope.juryInputSave = function (jury, actionType) {
        $scope.parameterListNew = jury.parameterList;
        $scope.juryDatanew = jury;
        $scope.sugAssignedToJury = [];
        if ($scope.juryDatanew.inputType == 'PRODUCTION_HEAD' && actionType == 'UPDATE') {
            for (var j = 0; j < jury.ratingList.length; j++) {
                if (jury.ratingList[j].isSelected == true) {
                    $scope.sugAssignedToJury.push({
                        "sugAssignedToJury": {
                            "id": jury.jAssinedToId,
                        },
                        "phRatingId": jury.ratingList[j].id,
                        "phRating": jury.ratingList[j].scale,
                        "isPlantHead": 1
                    });
                }
            }
        } else if ($scope.juryDatanew.inputType == 'JURY' && actionType == 'UPDATE') {
            var totalRating = 0;
            for (var i = 0; i < $scope.parameterListNew.length; i++) {
                for (var k = 0; k < $scope.juryDatanew.suggestionEvalJuryInput.length; k++) {
                    if ($scope.parameterListNew[i].id == $scope.juryDatanew.suggestionEvalJuryInput[k].parameterId) {
                        for (var j = 0; j < $scope.parameterListNew[i].ratingList.length; j++) {
                            if ($scope.parameterListNew[i].ratingList[j].isSelected == true) {
                                totalRating = totalRating + $scope.parameterListNew[i].ratingList[j].scale;
                                $scope.sugAssignedToJury.push({
                                    "id": $scope.juryDatanew.suggestionEvalJuryInput[k].id,
                                    "sugAssignedToJury": {
                                        "id": $scope.juryDatanew.jAssinedToId,
                                    },
                                    "parameterId": $scope.parameterListNew[i].id,
                                    "ratingId": $scope.parameterListNew[i].ratingList[j].id,
                                    "juryRating": $scope.parameterListNew[i].ratingList[j].scale,
                                    "totalRating": 0
                                });
                            }
                        }
                    }
                }
            }
            //push total Rating on parameterListNew
            for (var index = 0; index < $scope.sugAssignedToJury.length; index++) {
                $scope.sugAssignedToJury[index].totalRating = totalRating;
            }
        } else if ($scope.juryDatanew.inputType == 'PRODUCTION_HEAD' && actionType == 'ADD') {
            for (var j = 0; j < jury.ratingList.length; j++) {
                if (jury.ratingList[j].isSelected == true) {
                    $scope.sugAssignedToJury.push({
                        "sugAssignedToJury": {
                            "id": jury.jAssinedToId,
                        },
                        "phRatingId": jury.ratingList[j].id,
                        "phRating": jury.ratingList[j].scale,
                        "isPlantHead": 1

                    });
                }
            }
        } else if ($scope.juryDatanew.inputType == 'JURY' && actionType == 'ADD') {
            var totalRating = 0;
            for (var i = 0; i < $scope.parameterListNew.length; i++) {
                for (var j = 0; j < $scope.parameterListNew[i].ratingList.length; j++) {
                    if ($scope.parameterListNew[i].ratingList[j].isSelected == true) {
                        totalRating = totalRating + $scope.parameterListNew[i].ratingList[j].scale;
                        $scope.sugAssignedToJury.push({
                            "sugAssignedToJury": {
                                "id": $scope.juryDatanew.jAssinedToId,
                            },
                            "parameterId": $scope.parameterListNew[i].id,
                            "ratingId": $scope.parameterListNew[i].ratingList[j].id,
                            "juryRating": $scope.parameterListNew[i].ratingList[j].scale,
                        });
                    }
                }
            }
            if ($scope.sugAssignedToJury.length < 6) {
                snackbar.create($filter('translate')('Please_submit_all_inputs'), 5000, "error");
                return;
            }
            for (var index = 0; index < $scope.sugAssignedToJury.length; index++) {
                $scope.sugAssignedToJury[index].totalRating = totalRating;
            }
        }

        appService.httpPost($scope.sugAssignedToJury, "submitSuggestionJuryInputs")
            .then(function (response) {
                if (response.result == true) {
                    if (jury.jStatus == "COMPLETED") {
                        // snackbar.create("Jury ratings modified successfully.", 4000, "success");
                        snackbar.create($filter('translate')('Jury_ratings_modified_successfully'), 4000, "success");
                        $scope.getsuggestionList();
                        $scope.getJuryTopKiazenList();
                        $scope.getJueryStatusList();
                        jury.isupdate = false;
                    } else {
                        //snackbar.create("Jury rating submitted successfully.", 4000, "success");
                        snackbar.create($filter('translate')('Jury_rating_submitted_successfully'), 4000, "success");
                        $scope.getsuggestionList();
                        $scope.getJuryTopKiazenList();
                        $scope.getJueryStatusList();
                        jury.isupdate = false;
                    }
                } else {
                    snackbar.create($filter('translate')('Oops_Please_try_again'), 5000, "error");
                }
            });
    }

    /*---------------------------------------------------update jury input----------------------------17/7/19----------------change by sunanda */
    $scope.juryInputupdate = function (data) {
        data.isupdate = true;
    }

    $scope.getWinnerKizan4block = function (tmpjury) {
        $scope.getSuggestionDetails(tmpjury.sugId)
        $("#topkizan4block").modal({
            backdrop: 'static',
            keyboard: false
        });
    }

    //Submit Sustenance Audit
    $scope.sustenanceAuditBtn = false;
    $scope.submitSustenanceData = function (valid, form) {
        $scope.sustenanceAuditBtn = true;
        if (form.$invalid) {
            angular.forEach(form.$error.required, function (field) {
                field.$setDirty();
                $scope.sustenanceAuditBtn = false;
            });
            return;
        }
        if (valid) {
            var req = {
                "currentValue": $scope.suggestionDet.sustenanceAuditData.currentValue,
                "createdBy": $scope.loggedInEmpId,
                "updatedBy": $scope.loggedInEmpId,
                "auditorRemark": $scope.suggestionDet.sustenanceAuditData.auditorRemark,
                "suggestionSustenance": {
                    "sugId": $scope.selectedSuggId
                },
                "sustenanceAudit": {
                    "id": $scope.suggestionDet.sustenanceAuditData.questions[0].id
                },
                "stsId": 130
            }
            appService.httpPost(req, 'test/submitSustenanceAuditInputs').then(function (response) {
                $scope.sustenanceAuditBtn = false;
                if (response.result) {
                    snackbar.create($filter('translate')('Sustenance_audit_completed_successfully'), 4000, "success");
                    $scope.getsuggestionList('onUpdate');
                    $scope.getStatusWiseCount();
                } else {
                    snackbar.create($filter('translate')('Oops_Please_try_again'), 5000, "error");
                }
            })
        }
    }
    $scope.setNextVerificationDate = function () {
        $scope.suggestionDet.sustenanceAuditData.nextSustenaceAuditDate = $filter('date')(new Date(), 'yyyy-MM-dd');
        $('.target-date-picker').datepicker({ 'update': $scope.suggestionDet.sustenanceAuditData.nextSustenaceAuditDate, 'autoclose': true, 'todayHighlight': true });
    }

    $scope.submitSustenanceDataNew = function (valid, form) {
        $scope.sustenanceAuditBtn = true;
        if (form.$invalid) {
            angular.forEach(form.$error.required, function (field) {
                field.$setDirty();
                $scope.sustenanceAuditBtn = false;
            });
            return;
        }
        if (valid) {
            var req = {
                "createdBy": $scope.loggedInEmpId,
                "updatedBy": $scope.loggedInEmpId,
                "sugId": $scope.selectedSuggId,
                "auditorId": $scope.loggedInEmpId,
                "benefitVerifyReq": $scope.suggestionDet.sustenanceAuditData.benefitValueY,
                "action": "",
                "sustenanceBenefits": [],
                "isKaizenExist": 'N',
                "remarks": $scope.suggestionDet.sustenanceAuditData.sustenaceRemarks
            }
            if ($scope.suggestionDet.sustenanceAuditData.currentValue == 'Y') {
                req.isKaizenExist = 'Y'
            } else {
                if ($scope.suggestionDet.failedReason != null && $scope.suggestionDet.failedReason != undefined && $scope.suggestionDet.failedReason != '') {
                    req.failedReason = $scope.suggestionDet.failedReason;
                }
            }
            if ($scope.suggestionInputDetails.flagsustanceKaizen) {
                req.action = "FAILED_AND_CLOSED"
            } else if ($scope.suggestionInputDetails.flagCloseKaizen) {
                req.action = "CLOSE_KAIZEN"
            } else if ($scope.suggestionDet.sustenanceAuditData.setNextDate) {
                req.action = "CONTINUE_VERIFICATION";
                req.verificationReq = true;
                req.verificationDt = $scope.suggestionDet.sustenanceAuditData.nextSustenaceAuditDate;
            }
            if (req.action == '') {
                snackbar.create('Please select the action', 5000, "error");
                $scope.sustenanceAuditBtn = false;
                return;
            }
            $scope.sustenanceBenefits = [];
            if ($scope.suggestionDet.sustenanceAuditData.benefitValueY) {
                for (let index = 0; index < $scope.suggestionDet.customEvaluationParticularsList.length; index++) {
                    if ($scope.suggestionDet.customEvaluationParticularsList[index].isActive == 'Y') {
                        if ($scope.suggestionDet.customEvaluationParticularsList[index].tangible) {
                            $scope.sustenanceBenefits.push({
                                "auditorId": $scope.loggedInEmpId,
                                "benefits": {
                                    "id": $scope.suggestionDet.customEvaluationParticularsList[index].id
                                },
                                "unit": $scope.suggestionDet.customEvaluationParticularsList[index].unit.id,
                                "value": $scope.suggestionDet.customEvaluationParticularsList[index].value
                            })
                        } else {
                            $scope.sustenanceBenefits.push({
                                "auditorId": $scope.loggedInEmpId,
                                "benefits": {
                                    "id": $scope.suggestionDet.customEvaluationParticularsList[index].id
                                },
                            })
                        }
                    }


                }
            }
            req.sustenanceBenefits = $scope.sustenanceBenefits;
            appService.httpPost(req, 'saveSustenanceAuditorInputs').then(function (response) {
                $scope.sustenanceAuditBtn = false;
                if (response.result) {
                    $('#sustainceInputModal').modal('hide');
                    if ($scope.suggestionInputDetails.flagCloseKaizen) {
                        snackbar.create($filter('translate')('Sustenance_Audit_Sustained_Successfully'), 4000, "success")
                    } else if ($scope.suggestionInputDetails.flagsustanceKaizen) {
                        snackbar.create($filter('translate')('Sustenance_Audit_Sustained_Successfully_Sustenance_Audit_Failed_and_Close_Successfully'), 4000, "success")
                    } else {
                        snackbar.create($filter('translate')('Sustenance_Audit_Continue_Verification_Successfully'), 4000, "success");
                    }

                    $scope.getsuggestionList('onUpdate');
                    $scope.getStatusWiseCount();
                } else {
                    snackbar.create($filter('translate')('Oops_Please_try_again'), 5000, "error");
                }
            })
        }
    }
    // 12-12-2020
    $scope.showkaizenMonitorDetails = function (sugId, onSuggSelect, sourceType, auditorName) {
        $scope.getSuggestionDetails(sugId, onSuggSelect, sourceType);
        $scope.selectedAuditorName = auditorName;
        $("#sustanceModal").modal({
            backdrop: 'static',
            keyboard: false
        });
    }
    $scope.focusdata = function (type, data, circlevalue) {
        //console.log(data);
        //console.log(circlevalue);
        $scope.suggfocus = false;
        (!type || data == 'DEPT') && ($scope.newdeptfocus = true);
        if (circlevalue && data == 'PILLER') {
            $scope.newdeptfocus = true;
            $scope.focus = false;
            $scope.machfocus = false;
        } else {
            $scope.newdeptfocus = false;
        }
        $scope.pillarfocus = true;
    }

    $scope.lateralfocus = function () {
        $scope.newdeptfocus = false;
        $scope.linefocus = true;
        $scope.suggfocus = true;
    }

    $scope.pillardata = function () {
        $scope.circlefocus = true;
    }

    /*--------------RESULT IMAGE  */
    $scope.graphLabels = [{
        label: undefined,
        value: undefined,
        series: undefined
    }];
    $scope.addRemoveRow = function (index, type) {
        if (type == 'add') {
            var newObj = {
                label: undefined,
                value: undefined,
                series: undefined
            }
            $scope.graphLabels.push(newObj);
        } else {
            $scope.graphLabels.splice(index, 1);
        }
    }
    $scope.clearAllGraphData = function () {
        $scope.dashboardData = {};
        $scope.graphLabels = [{
            label: undefined,
            value: undefined,
            series: undefined
        }];
        $scope.dashboardData.selectedTypeId = $scope.graphTypeList[0];
    }

    $scope.graphTypeList = [{
        id: 1,
        "type": 'Line Chart'
    },
    {
        id: 1,
        "type": 'Bar Chart'
    }
    ];
    $scope.dashboardData = {}
    $scope.dashboardData.selectedTypeId = $scope.graphTypeList[0];
    $scope.generateData = function () {
        if ($scope.graphLabels != null && $scope.graphLabels.length > 0) {

            for (let i = 0; i < $scope.graphLabels.length; i++) {
                if ($scope.graphLabels[i].series == undefined && $scope.graphLabels[i].series == null) {
                    $scope.graphLabels[i].series = "";
                }
            }
            // if ($filter('filter')($scope.graphLabels, { series: '' }, true).length == 0) {

            //     $scope.dashboardData.graphType = 'chart-bar';
            //     $scope.dashboardData.generatedGraph = dashboardGraphFactory.getLevelWiseDefect($scope.graphLabels, 'amt', true);
            //     // $scope.dashboardData.generatedGraph = { "Series": [], "Dataset": [637473], "Label": ["MAY-20"], "graphOption": { "responsive": true, "maintainAspectRatio": false, "scales": { "xAxes": [{ "scaleLabel": { "display": true, "labelString": "Months", "fontColor": "black", "fontSize": 14 }, "ticks": { "fontColor": "black", "fontSize": 14 } }], "yAxes": [{ "scaleLabel": { "display": true, "labelString": "CTC", "fontColor": "black", "fontSize": 14 }, "ticks": { "fontColor": "black", "fontSize": 14, "suggestedMin": 0, "beginAtZero": true } }] }, "legend": { "display": false, "position": "bottom" }, "tooltips": { "enabled": false }, "hover": { "animationDuration": 0 }, "elements": { "line": { "fill": false, "borderColor": "#56A3FC" } }, "animation": { "duration": 1 }, "layout": { "padding": { "top": 30 } } }, "colors": [] }
            // } else {
            //     $scope.dashboardData.graphType = 'chart-line';
            //     $scope.dashboardData.generatedGraph = dashboardGraphFactory1.getLevelWiseDefect($scope.graphLabels, '', true);
            // }
            $scope.dashboardData.generatedGraph = dashboardGraphFactory1.getLevelWiseDefect($scope.graphLabels, '', '');
            $scope.dashboardData.generatedGraph.graphOption.scales.xAxes[0].offset = true;
            $scope.dashboardData.generatedGraph.graphOption.elements.line.fill = false;
            $scope.dashboardData.generatedGraph.graphOption.scales.xAxes[0].scaleLabel.labelString = $scope.dashboardData.xAxeslabel;
            $scope.dashboardData.generatedGraph.graphOption.scales.yAxes[0].scaleLabel.labelString = $scope.dashboardData.yAxeslabel;
        }
    }

    $scope.gerateResultgraph = function () {
        $('#GenerateGraph').modal({
            backdrop: 'static',
            keyboard: false
        });
    }

    /*-----------------------Filter START (23-06-2020)------------------------------------*/
    $scope.setFilterDeptSelected = function (branch) {
        branch.isSelected = (branch.isSelected) ? false : true;
        for (var i = 0; i < $scope.accessBranchList.length; i++) {
            if (!$scope.accessBranchList.isSelected) {
                $scope.selectAllBranch = false;
            }
        }
        if ($filter('filter')($scope.accessBranchList, { isSelected: true }, true).length == 1) {
            var tmpBranch = $filter('filter')($scope.accessBranchList, { isSelected: true }, true);
            if (tmpBranch[0] != null && tmpBranch[0].branchId != undefined) {
                $scope.getDepartmentList(tmpBranch[0].branchId);
                $scope.getCategoryList(tmpBranch[0].branchId);
            }
        }
        var accessBranchListSelectedCount = $filter('filter')($scope.accessBranchList, { isSelected: true }, true).length;
        $scope.selectAllBranch = ($scope.accessBranchList.length == accessBranchListSelectedCount);
        if ($scope.selectAllBranch) {
            $scope.deptToggle();
        }
    }

    $scope.selectFilterAllDepartment = function () {
        var flag = ($scope.selectAllBranch) ? false : true;
        //console.log(flag);
        $scope.selectAllBranch = flag;
        for (var i = 0; i < $scope.accessBranchList.length; i++) {
            $scope.accessBranchList[i].isSelected = $scope.selectAllBranch;
        }
        // 26-6-2020 by sunanda
        if ($filter('filter')($scope.accessBranchList, { isSelected: true }, true).length == 1) {
            var tmpBranch = $filter('filter')($scope.accessBranchList, { isSelected: true }, true);
            if (tmpBranch[0] != null && tmpBranch[0].branchId != undefined) {
                $scope.getDepartmentList(tmpBranch[0].branchId);
                $scope.getCategoryList(tmpBranch[0].branchId);
            }
        }
        if ($scope.selectAllBranch) {
            $scope.deptToggle();
        }
    }
    /*-----------------------Filter START (23-06-2020)------------------------------------*/
    $scope.statusToggle = function () {
        $('.statusWrapper .statusList')
            .slideToggle('fast');
    }
    $scope.toggleStatusDiv = function (event) {
        var $trigger = $(".statusWrapper");
        if ($trigger !== event.target && !$trigger.has(event.target)
            .length) {
            $('.statusList').slideUp("fast");
        }
    }
    $scope.setStatusSelected = function (status) {
        status.isSelected = (status.isSelected) ? false : true;
        for (var i = 0; i < $scope.suggDetailModel.statusList.length; i++) {
            if (!$scope.suggDetailModel.statusList.isSelected) {
                $scope.selectAllStatus = false;
            }
        }
        var statusListSelectedCount = $filter('filter')($scope.suggDetailModel.statusList, { isSelected: true }, true).length;
        $scope.selectAllStatus = ($scope.suggDetailModel.statusList.length == statusListSelectedCount);
        if ($scope.selectAllStatus) {
            $scope.statusToggle();
        }
    }

    $scope.selectFilterAllStatus = function () {
        var flag = ($scope.selectAllStatus) ? false : true;
        //console.log(flag);
        $scope.selectAllStatus = flag;
        for (var i = 0; i < $scope.suggDetailModel.statusList.length; i++) {
            $scope.suggDetailModel.statusList[i].isSelected = $scope.selectAllStatus;
        }
        if ($scope.selectAllStatus) {
            $scope.statusToggle();
        }
    }

    $scope.handleKeyPress = function (event) {
        if (event.keyCode === 13) {
            if ($scope.suggDetailModel.searchBy.id !== '' && $scope.suggDetailModel.searchBy.id !== 2) {
                $scope.searchFilterData('');
            }
        }
    }
    $scope.emptySearchInput = function () {
        $scope.suggDetailModel.suggestionNumber = '';
    }
    $scope.searchFilterData = function (data) {
        $scope.suggDetailModel.searchModule = true;
        if (data == '') {
            if (!$scope.suggDetailModel.suggestionNumber || $scope.suggDetailModel.suggestionNumber == '' || $scope.suggDetailModel.suggestionNumber == undefined) {
                $scope.suggDetailModel.searchModule = false;
                return;
            }
            $scope.suggDetailModel.searchById = true;
            $scope.getStatusWiseCount();
            if ($scope.statusCountFilter == 0) {
                $scope.getsuggestionList('allSuggestion');
            } else {
                $scope.getsuggestionList("onUpdate");
            }
        } else {
            // $scope.suggDetailModel.searchBy = $scope.searchList[0];
            $scope.suggDetailModel.suggestionNumber = '';
            $scope.suggDetailModel.searchById = false;
            $scope.getStatusWiseCount();
            if ($scope.statusCountFilter == 0) {
                $scope.getsuggestionList('allSuggestion');
            } else {
                $scope.getsuggestionList("onUpdate");
            }
        }
    }


    $scope.searchFilterPopup = function () {
        // $scope.suggDetailModel.searchBy = $scope.searchList[0];
        $scope.suggDetailModel.suggestionNumber = '';

        if (!$scope.suggDetailModel.searchModule) {
            $scope.suggDetailModel.searchModule = false;
        }
        if ($scope.typeFilter == 6 || $scope.typeFilter == 7) {
            $('#searchLateralPopup').modal({
                backdrop: 'static',
                keyboard: false
            });
        } else {
            $('#searchPopup').modal({
                backdrop: 'static',
                keyboard: false
            });
        }

    }
    $scope.isFilterApplied = false;
    $scope.searchApplyFilter = function () {
        $scope.isFilterApplied = true;
        $scope.suggDetailModel.searchModule = true;
        if ($scope.suggDetailModel.deptFilter.deptName != "All") {
            $scope.suggestionPagination.selectedDeptId = $scope.suggDetailModel.deptFilter.deptId;
            $scope.suggDetailModel.selectedDeptName = $scope.suggDetailModel.deptFilter.deptName;
        } else {
            $scope.suggestionPagination.selectedDeptId = 0;
            $scope.suggDetailModel.selectedDeptName = '';
        }

        if ($scope.suggDetailModel.catFilter.categoryName != "All") {
            $scope.suggestionPagination.selectedCatId = $scope.suggDetailModel.catFilter.catId;
            $scope.suggDetailModel.selectedCategoryName = $scope.suggDetailModel.catFilter.categoryName;
        } else {
            $scope.suggestionPagination.selectedCatId = 0;
            $scope.suggDetailModel.selectedCategoryName = '';
        }

        $scope.getStatusWiseCount();
        if ($scope.statusCountFilter == 0) {
            $scope.getsuggestionList('allSuggestion');
        } else {
            $scope.getsuggestionList("onUpdate");
        }
        $scope.flagfillterApply = true;
        $scope.flagapplydata = false;
        $('#searchPopup').modal('hide');
    }

    $scope.closedFilter = function (type) {
        $scope.suggestionPagination.current = 1;
        $scope.resetSuggestionFilter();
        if ($scope.typeFilter == 6 || $scope.typeFilter == 7) {
            $scope.suggestionPagination.fromDt = '';
            $scope.suggestionPagination.toDt = '';
            $scope.listFilter.branchId = '';
            $scope.listFilter.deptId = '';
            $scope.listFilter.catId = '';
            $scope.listFilter.activityId = '';
            $scope.listFilter.circleId = '';
            $scope.listFilter.stageId = '';
            $scope.listFilter.productId = '';
            $scope.listFilter.productNoId = '';
            $scope.listFilter.machineId = '';
            $scope.listFilter.operationId = '';
            $scope.listFilter.sourceId = '';
            $scope.listFilter.sourceTypeId = '';
            $scope.suggDetailModel.suggestionNumber = '';
            if (type == 'clearFilter') {
                $scope.getStatusWiseCount();
                $scope.getsuggestionList();
            }
            $('#searchLateralPopup').modal('hide');
        } else {
            $scope.suggDetailModel.searchModule = false;
            $scope.suggDetailModel.searchBy = $scope.searchList[1];
            $scope.suggDetailModel.selectedLevel = $scope.suggestionLevelList[0];
            // $scope.suggDetailModel.selectBranchForSerch = '';
            $scope.suggDetailModel.searchById = false;
            $scope.suggDetailModel.suggestionNumber = '';
            // $scope.suggDetailModel.deptFilter.deptName = "All";
            $scope.suggestionPagination.selectedDeptId = 0;
            $scope.suggDetailModel.catFilter = '';
            $scope.suggDetailModel.deptFilter = '';
            // $scope.suggDetailModel.catFilter.categoryName = "All";
            $scope.suggestionPagination.selectedCatId = 0;
            $scope.suggDetailModel.selectedCategoryName = '';
            $scope.suggestionPagination.selectedStatus = null;
            $scope.suggDetailModel.fromDt = '';
            $scope.suggDetailModel.toDt = '';
            $scope.suggDetailModel.suggPriorityFilter = '';
            if ($scope.pendingBranchlist != undefined || $scope.pendingBranchlist != null) {
                for (var index = 0; index < $scope.pendingBranchlist.length; index++) {
                    $scope.pendingBranchlist[index].isSelected = true
                }
            }
            if ($scope.mySuggBranchlist != undefined || $scope.mySuggBranchlist != null) {
                for (var index = 0; index < $scope.mySuggBranchlist.length; index++) {
                    $scope.mySuggBranchlist[index].isSelected = true;
                }
            }
            if ($scope.onholdBranchlist != undefined || $scope.onholdBranchlist != null) {
                for (var index = 0; index < $scope.onholdBranchlist.length; index++) {
                    $scope.onholdBranchlist[index].isSelected = true;
                }
            }
            if ($scope.allBranchaccessList != undefined || $scope.allBranchaccessList != null) {
                for (var index = 0; index < $scope.allBranchaccessList.length; index++) {
                    $scope.allBranchaccessList[index].isSelected = true;
                }
            }
            if ($scope.suggDetailModel.statusList != null && $scope.suggDetailModel.statusList.length > 0) {
                $scope.selectAllStatus = false;
                for (let index = 0; index < $scope.suggDetailModel.statusList.length; index++) {
                    $scope.suggDetailModel.statusList[index].isSelected = false;
                }
            }
            if (type == 'clearFilter') {
                $scope.getStatusWiseCount();
                if ($scope.statusCountFilter == 0) {
                    $scope.getsuggestionList('allSuggestion');
                } else {
                    $scope.getsuggestionList("onUpdate");
                }
            }
            $scope.flagfillterApply = false;
            $scope.flagapplydata = true;
            $('#searchPopup').modal('hide');
        }
    }

    $scope.getMasterUnitsList = function () {
        var data = {
            branchId: $rootScope.empDetails.branch.branchId
        }
        appService.httpPost(data, "getMasterUnitList").then(function (response) {
            if (response.result) {
                if (response.unitList != null && response.unitList.length > 0) {
                    $scope.unitlistForparticular = response.unitList;
                } else {
                    $scope.unitlistForparticular = [];
                }
            } else {
                $scope.unitlistForparticular = [];
            }
        });
    }
    $scope.getMasterUnitsList();

    $scope.getUnitDet = function (id) {
        var obj = {};
        if ($scope.unitlistForparticular != null && $scope.unitlistForparticular.length > 0) {
            id = parseInt(id);
            var rec = $filter('filter')($scope.unitlistForparticular, { id: id }, true);
            if (rec != null && rec.length > 0) {
                obj = rec[0];
            }
        }
        return obj;
    }
    $scope.evalInputData = {};
    $scope.evalInputModal = function (modalType, data, status) {
        $scope.evalInputData = {};
        $scope.evalInputData = {
            rec: data,
            stsAdt: status
        }
        if (modalType == 'change_doc') {
            if (!$scope.checkToDisplayPending(status)) {
                $scope.getSuggestionDocList();
            }
            $("#changeDocumentModal")
                .modal({
                    backdrop: 'static',
                    keyboard: false
                });
        } else if (modalType == 'kaizenActivity') {
            $("#kaizenActivityModal")
                .modal({
                    backdrop: 'static',
                    keyboard: false
                });
        } else if (modalType == 'savingType') {
            if ($scope.suggestionDet.status_master.statusId == $scope.CONST.STATUS.EvaluationRequestAccepted.statusId && status.status_master.statusId == $scope.CONST.STATUS.EvaluationRequestAccepted.statusId) {
                if ($scope.savingTypes != null && $scope.savingTypes.length > 0) {
                    $scope.evalSavingType = {
                        type: $scope.savingTypes[0],
                        typeName: $scope.savingTypes[0].name.toLowerCase(),
                        amt: '',
                        points: 0,
                        role: ''
                    };
                }
            }
            $("#savingTypeModal")
                .modal({
                    backdrop: 'static',
                    keyboard: false
                });
        } else if (modalType == 'OtherBenefit') {
            if ($scope.suggestionDet.sourceType == 'HD') {
                if ($scope.isEmpty($scope.suggestionDet.hdCatId) || $scope.suggestionDet.hdCatId == undefined || $scope.suggestionDet.hdCatId == null || $scope.suggestionDet.hdCatId == '') {
                    snackbar.create($filter('translate')('Please_select_category'), 3000, 'error');
                    return;
                } else {
                    // updated on 24-01-2024 by @Jayshri Kolase for set updated category 
                    if ($scope.suggestionDet.customEvaluationParticularsList.length > 0 && $scope.suggestionDet.customEvaluationParticularsList != null) {
                        for (let i = 0; i < $scope.suggCatbranchwise.length; i++) {
                            for (let j = 0; j < $scope.suggestionDet.customEvaluationParticularsList.length; j++) {
                                if ($scope.suggCatbranchwise[i].catId == $scope.suggestionDet.customEvaluationParticularsList[j].catId && $scope.suggestionDet.customEvaluationParticularsList[j].isActive == "Y") {
                                    $scope.suggestionDet.selectedCatName = $scope.suggCatbranchwise[i].categoryName;
                                    $scope.suggestionDet.selectedEvalCatId = $scope.suggCatbranchwise[i].catId;
                                }

                            }
                        }
                    }
                    else {
                        $scope.suggestionDet.selectedCatName = !$scope.isEmpty($scope.suggestionDet.hdCatId) ? $scope.suggestionDet.hdCatId.categoryName : '';
                        $scope.suggestionDet.selectedEvalCatId = $scope.suggestionDet.category.catId;

                    }
                }
            } else {
                // updated on 24-01-2024 by @Jayshri Kolase for set updated category 
                if ($scope.suggestionDet.customEvaluationParticularsList.length > 0 && $scope.suggestionDet.customEvaluationParticularsList != null) {
                    for (let i = 0; i < $scope.suggCatbranchwise.length; i++) {
                        for (let j = 0; j < $scope.suggestionDet.customEvaluationParticularsList.length; j++) {
                            if ($scope.suggCatbranchwise[i].catId == $scope.suggestionDet.customEvaluationParticularsList[j].catId && $scope.suggestionDet.customEvaluationParticularsList[j].isActive == "Y") {
                                $scope.suggestionDet.selectedCatName = $scope.suggCatbranchwise[i].categoryName;
                                $scope.suggestionDet.selectedEvalCatId = $scope.suggCatbranchwise[i].catId;
                            }

                        }
                    }
                }
                else {
                    $scope.suggestionDet.selectedCatName = !$scope.isEmpty($scope.suggestionDet.category) ? $scope.suggestionDet.category.categoryName : '';
                    $scope.suggestionDet.selectedEvalCatId = $scope.suggestionDet.category.catId;
                }
            }
            if ($scope.checkToDisplayPending(status)) {
                $scope.suggestionDet.evalSustenanceflow = true;
                if ($scope.suggestionDet.sustenanceAuditorList == null || $scope.suggestionDet.sustenanceAuditorList.length == 0) {
                    $scope.getSustenaceAuditor();
                }
            } else {
                if ($scope.particulars != null && $scope.particulars.length > 0) {
                    var selectedPart = $filter('filter')($scope.particulars, { isChecked: true }, true);
                    if (selectedPart != null && selectedPart.length > 0) {
                        // updated on 24-01-2024 by @Jayshri Kolase for set updated category 
                        if ($scope.suggestionDet.customEvaluationParticularsList.length > 0 && $scope.suggestionDet.customEvaluationParticularsList != null) {
                            for (let i = 0; i < $scope.suggCatbranchwise.length; i++) {
                                for (let j = 0; j < $scope.suggestionDet.customEvaluationParticularsList.length; j++) {
                                    if ($scope.suggCatbranchwise[i].catId == $scope.suggestionDet.customEvaluationParticularsList[j].catId && $scope.suggestionDet.customEvaluationParticularsList[j].isActive == "Y") {
                                        $scope.suggestionDet.selectedCatName = $scope.suggCatbranchwise[i].categoryName;
                                        $scope.suggestionDet.selectedEvalCatId = $scope.suggCatbranchwise[i].catId;
                                    }

                                }
                            }
                        }
                        else {
                            $scope.suggestionDet.selectedCatName = selectedPart[0].category.categoryName;
                            $scope.suggestionDet.selectedEvalCatId = $scope.suggestionDet.category.catId;
                        }
                    }
                }
                if ($scope.suggestionDet.sustenanceAuditorList == null || $scope.suggestionDet.sustenanceAuditorList.length == 0) {
                    $scope.getSustenaceAuditor();
                }
            }
            $("#otherBebefitModal")
                .modal({
                    backdrop: 'static',
                    keyboard: false
                });
        } else if (modalType == 'HD') {
            if ($scope.suggestionDet.sourceType == 'HD') {
                $scope.getSuggestionTypeDetail($scope.suggestionDet.suggestionHD.parentSuggId, $scope.suggestionDet.suggestionHD.branchId);
            }
            if ($scope.hdConfigData.hdLevel == 'PILLER') {
                if ($scope.circleList != null && $scope.circleList.length > 0) {
                    $scope.newCircleList = [];
                    for (let index = 0; index < $scope.circleList.length; index++) {
                        if ($scope.circleList[index].id != 0) {
                            $scope.newCircleList.push($scope.circleList[index]);
                        }
                    }
                }
            }
            $("#horizontalModal")
                .modal({
                    backdrop: 'static',
                    keyboard: false
                });
        } else if (modalType == 'recommendation') {
            $("#recommendationModal")
                .modal({
                    backdrop: 'static',
                    keyboard: false
                });
        }
    }

    $scope.analysisRecommendTabsFillStatus = {
        changeDoc: false,
        kaizenActivity: false,
        otherBenefits: false,
        horizontalDeployment: false,
        recommendation: false,
    }
    $scope.checkAnalysisRecommendTabsFillStatus = function (tab) {
        if (tab == 'change_doc') {
            $scope.analysisRecommendTabsFillStatus.changeDoc = false;
            for (var i = 0; i < $scope.documentLists.length; i++) {
                if ($scope.documentLists[i].isChecked) {
                    $scope.analysisRecommendTabsFillStatus.changeDoc = true;
                    break;
                }
            }

            if ($scope.suggestionDet.tmpIsDocumentChangeRequire) {
                $scope.analysisRecommendTabsFillStatus.changeDoc = true;
            }
        } else if (tab == 'kaizen_activity') {
            $scope.analysisRecommendTabsFillStatus.kaizenActivity = false;
            for (var i = 0; i < $scope.activityList.length; i++) {
                if ($scope.activityList[i].isselect) {
                    $scope.analysisRecommendTabsFillStatus.kaizenActivity = true;
                    break;
                }
            }
        } else if (tab == 'other_benefits') {
            $scope.analysisRecommendTabsFillStatus.otherBenefits = false;
            for (var i = 0; i < $scope.particulars.length; i++) {
                if ($scope.particulars[i].isChecked) {
                    $scope.analysisRecommendTabsFillStatus.otherBenefits = true;
                    break;
                }
            }
        } else if (tab == 'horizontal_deployment') {
            $scope.analysisRecommendTabsFillStatus.horizontalDeployment = false;
            for (var i = 0; i < $scope.departmentList.length; i++) {
                if ($scope.departmentList[i].isEvalselect) {
                    $scope.analysisRecommendTabsFillStatus.horizontalDeployment = true;
                    break;
                }
            }

            if ($scope.suggestionDet.isHDRequire) {
                $scope.analysisRecommendTabsFillStatus.horizontalDeployment = true;
            }
        } else if (tab == 'recommendation') {
            $scope.analysisRecommendTabsFillStatus.recommendation = false;
            if ($scope.suggestionDet.recommendationData.ideaAwardRecommEval) {
                $scope.analysisRecommendTabsFillStatus.recommendation = true;
            } else if ($scope.suggestionDet.recommendationData.implAwardRecommEval) {
                $scope.analysisRecommendTabsFillStatus.recommendation = true;
            }
        }
    }

    $scope.implInputData = {};
    $scope.implInputModal = function (modalType, status) {
        $scope.implInputData = {};
        $scope.implInputData = {
            currentDiv: modalType,
            stsAdt: status
        }
        if ($scope.suggestionDet.sustenanceAuditorId) {
            $scope.implInputData.sustenanceAuditorId = $scope.suggestionDet.sustenanceAuditorId.toString();
        }
        if (modalType == 'implemented') {
            $scope.setImplTab(1);
            $scope.implFiles = [];
            $scope.resultImageFiles = [];
            if ($scope.suggFlowConfig.isBenefitsEnbld == 'Y') {
                $scope.getBenefitAnalysisList($scope.suggestionDet.branch.branchId);
                $scope.setSubImplTab(1);
            } else if ($scope.suggFlowConfig.isImplParticularsEnbld == 'Y') {
                $scope.setSubImplTab(2);
            } else if ($scope.suggFlowConfig.isImplHorizDplymntEnbld == 'Y') {
                $scope.setSubImplTab(3)
            } else if ($scope.suggFlowConfig.isWhyWhyAnalysisEnbld == 'Y') {
                $scope.setSubImplTab(4);
            } else if ($scope.suggFlowConfig.isKaizenSustainanceEnbld == 'Y') {
                $scope.setSubImplTab(5);
            } else {
                $scope.setSubImplTab(6);
            }
            if ($scope.suggestionDet.sourceType == 'HD') {
                $scope.getSuggestionTypeDetail($scope.suggestionDet.suggestionHD.parentSuggId, $scope.suggestionDet.suggestionHD.branchId);
            }
            if ($scope.hdConfigData.hdLevel == 'PILLER') {
                if ($scope.circleList != null && $scope.circleList.length > 0) {
                    $scope.newCircleList = [];
                    for (let index = 0; index < $scope.circleList.length; index++) {
                        if ($scope.circleList[index].id != 0) {
                            $scope.newCircleList.push($scope.circleList[index]);
                        }
                    }
                }
            }
            if ($scope.suggFlowConfig.isImplParticularsEnbld == 'Y') {
                // updated on 24-01-2024 by @Jayshri Kolase for set updated category 
                if ($scope.suggestionDet.customEvaluationParticularsList.length > 0 && $scope.suggestionDet.customEvaluationParticularsList != null) {
                    for (let i = 0; i < $scope.suggCatbranchwise.length; i++) {
                        for (let j = 0; j < $scope.suggestionDet.customEvaluationParticularsList.length; j++) {
                            if ($scope.suggCatbranchwise[i].catId == $scope.suggestionDet.customEvaluationParticularsList[j].catId && $scope.suggestionDet.customEvaluationParticularsList[j].isActive == "Y") {
                                $scope.suggestionDet.selectedCatName = $scope.suggCatbranchwise[i].categoryName;
                                $scope.suggestionDet.selectedEvalCatId = $scope.suggCatbranchwise[i].catId;
                            }

                        }
                    }
                }
                else {
                    $scope.suggestionDet.selectedCatName = $scope.suggestionDet.category.categoryName;
                    $scope.suggestionDet.selectedEvalCatId = $scope.suggestionDet.category.catId;

                }
            }

            if ($scope.suggestionDet.sustenanceAuditorList == null || $scope.suggestionDet.sustenanceAuditorList.length == 0) {
                $scope.getSustenaceAuditor();
            }
            if ($scope.employeeList != null && $filter('filter')($scope.employeeList, {
                branch: { branchId: $scope.suggestionDet.branch.branchId }
            }, true).length > 0) {

            } else {
                $scope.getEmployeeList($scope.suggestionDet.branch.branchId);
            }
            const employee = $scope.employeeList.find(emp => emp.empId === empDetail.empId);
            if (employee != undefined || employee) {
                employee.isSelected = true;
                if (!$scope.selectedEmpList.some(selectedEmp => selectedEmp.empId === empDetail.empId)) {
                    empDetail.isSelected = true;
                    $scope.selectedEmpList.push(empDetail);
                }
            }
            else {
                $scope.employeeList.push(empDetail);
                for (let i = 0; i < $scope.employeeList.length; i++) {
                    if ($scope.employeeList[i].empId == empDetail.empId) {
                        selectedEmp.isSelected = true;
                        $scope.selectedEmpList.push(empDetail);
                    }
                }

            }
            $("#implementedModal")
                .modal({
                    backdrop: 'static',
                    keyboard: false
                });
        } else if (modalType == 'onHold') {
            $scope.setImplTab(2);
            $("#onHoldModal")
                .modal({
                    backdrop: 'static',
                    keyboard: false
                });
        } else if (modalType == 'rejected') {
            $scope.setImplTab(3);
            $("#implRejectedModal")
                .modal({
                    backdrop: 'static',
                    keyboard: false
                });
        }
    }
    $scope.toggleParticular = function () {
        $('.wrapperForPart .listForPart')
            .slideToggle('fast');
    }
    $scope.toggleParticularDiv = function (event) {
        var $trigger = $(".wrapperForPart");
        if ($trigger !== event.target && !$trigger.has(event.target)
            .length) {
            $(".listForPart")
                .slideUp("fast");
        }
    }
    $scope.isAccessImplTab = function (tabId) {
        var flag = false;
        if (tabId == 1 && $scope.suggFlowConfig.isBenefitsEnbld == 'Y') {
            flag = true;
        } else if (tabId == 2 && $scope.suggFlowConfig.isImplParticularsEnbld == 'Y') {
            flag = true;
        } else if (tabId == 3 && $scope.suggFlowConfig.isImplHorizDplymntEnbld == 'Y') {
            flag = true;
        } else if (tabId == 4 && $scope.suggFlowConfig.isWhyWhyAnalysisEnbld == 'Y') {
            flag = true;
        } else if (tabId == 5 && $scope.suggFlowConfig.isKaizenSustainanceEnbld == 'Y') {
            flag = true;
        } else if (tabId == 6) {
            flag = true;
        } else if (tabId == 7 && $scope.suggFlowConfig.isFinVerifEnbld == 'Y') {
            flag = true;
        } else if (tabId == 8) {
            flag = true;
        }
        return flag;
    }
    $scope.nextPreviousAction = function (type, number) {
        if (type == 'next') {
            for (let index = number + 1; index <= 8; index++) {
                if ($scope.isAccessImplTab(index)) {
                    $scope.setSubImplTab(index);
                    break;
                }
            }
        } else {
            number = number - 1;
            for (let index = number; index >= 1; index--) {
                // var newNumber = number + 1;
                if ($scope.isAccessImplTab(index)) {
                    $scope.setSubImplTab(index);
                    break;
                }
            }
        }
    }

    $scope.tabContentChecked = {
        benefits: false,
        markBenefitsAsClicked: false,
        otherBenefits: false,
        markOtherBenefitsAsClicked: false,
        hzDeployment: false,
        markHzDeployementClicked: false,
        whyAnalysis: false,
        kaizenSustain: false,
        results: false,
        financeVerification: false,
        teamMembers: false,
        markTeamMemberAsClicked: false,
    }
    $scope.setTabContentChecked = function (tabName) {
        if (tabName == "benefits") {
            if ($scope.tabContentChecked.markBenefitsAsClicked) {
                $scope.tabContentChecked.benefits = false;
                $scope.benefitList.forEach(element => {
                    if (element.isBenefitChecked) {
                        $scope.tabContentChecked.benefits = true;
                    }
                });
            }
        } else if (tabName == "otherBenefits") {
            if ($scope.tabContentChecked.markOtherBenefitsAsClicked) {
                $scope.tabContentChecked.otherBenefits = false;
                $scope.particulars.forEach(element => {
                    if (element.isChecked) {
                        $scope.tabContentChecked.otherBenefits = true;
                    }
                });
            }
        } else if (tabName == "hzDeployment") {
            if ($scope.tabContentChecked.markHzDeployementClicked) {
                $scope.tabContentChecked.hzDeployment = false;
                var flagInternal = false, flagPlantLvl = false;
                $scope.departmentList.forEach(element => {
                    if (element.isImplselect) {
                        element.lineList.forEach(elementLine => {
                            if (elementLine.isImplselect) {
                                //$scope.tabContentChecked.hzDeployment = true;
                                flagInternal = true;
                            }
                        });
                    }
                });

                $scope.hDBranchList.forEach(element => {
                    if (element.name != $scope.suggestionDet.branch.name && element.isEvalPlantselect) {
                        //$scope.tabContentChecked.hzDeployment = true;
                        flagPlantLvl = true;
                    }
                });

                if (flagInternal || flagPlantLvl) {
                    $scope.tabContentChecked.hzDeployment = true;
                }
            }
        } else if (tabName == "whyAnalysis") {
            $scope.tabContentChecked.whyAnalysis = false;

            $scope.whyWhyAnalysisforImpl.forEach(element => {
                if (element.whyWhyAnalysis != null && element.whyWhyAnalysis != '') {
                    $scope.tabContentChecked.whyAnalysis = true;
                }
            });

            if ($scope.suggestionDet.rootCause != null && $scope.suggestionDet.rootCause != '') {
                $scope.tabContentChecked.whyAnalysis = true;
            }
            if ($scope.suggestionDet.counterMeasures != null && $scope.suggestionDet.counterMeasures != '') {
                $scope.tabContentChecked.whyAnalysis = true;
            }
            if ($scope.suggestionDet.kaizenIdea != null && $scope.suggestionDet.kaizenIdea != '') {
                $scope.tabContentChecked.whyAnalysis = true;
            }
            if ($scope.suggestionDet.benefits != null && $scope.suggestionDet.benefits != '') {
                $scope.tabContentChecked.whyAnalysis = true;
            }
        } else if (tabName == "kaizenSustain") {
            $scope.tabContentChecked.kaizenSustain = false;

            if ($scope.suggestionDet.whatToDo != null && $scope.suggestionDet.whatToDo != '') {
                $scope.tabContentChecked.kaizenSustain = true;
            }
            if ($scope.suggestionDet.howToDo != null && $scope.suggestionDet.howToDo != '') {
                $scope.tabContentChecked.kaizenSustain = true;
            }
            if ($scope.suggestionDet.frquency != null && $scope.suggestionDet.frquency != '') {
                $scope.tabContentChecked.kaizenSustain = true;
            }
        } else if (tabName == "results") {
            $scope.tabContentChecked.results = false;

            if ($scope.implData.implSummary != null && $scope.implData.implSummary != '') {
                $scope.tabContentChecked.results = true;
            }
            if ($scope.implFiles != null && $scope.implFiles.length > 0) {
                $scope.tabContentChecked.results = true;
            }
            //console.log($scope.implFiles.length + " " + $scope.implBeforFiles.length);
            if ($scope.implData.implactionSummary != null && $scope.implData.implactionSummary != '') {
                $scope.tabContentChecked.results = true;
            }
            if ($scope.checkForHdConfig()) {
                if ($scope.resultImageFiles != null && $scope.resultImageFiles.length > 0) {
                    $scope.tabContentChecked.results = true;
                }
            }
            //console.log($scope.resultImageFiles.length + " " + $scope.resultImageBeforFiles.length);
            if ($scope.suggFlowConfig.isSafetyEnbld == 'Y') {
                if ($scope.suggestionDet.ehsbenefit) {
                    if ($scope.implData.safetImplactionSummary && $scope.implData.safetImplactionSummary != '') {
                        $scope.tabContentChecked.results = true;
                    }
                }
            }
            if ($scope.suggFlowConfig.isPCNNoEnbld == 'Y') {
                if ($scope.suggestionDet.pcnNumber && $scope.suggestionDet.pcnNumber != '') {
                    $scope.tabContentChecked.results = true;
                }
            }
            if (!$scope.checkForHdConfig()) {
                if ($scope.suggestionDet.results != null && $scope.suggestionDet.results != '') {
                    $scope.tabContentChecked.results = true;
                }
            }
        } else if (tabName == "financeVerification") {
            $scope.tabContentChecked.financeVerification = false;

            if ($scope.suggestionDet.implfinanceflow) {
                if ($scope.suggestionDet.implfc != undefined && $scope.suggestionDet.implfc != null) {
                    $scope.tabContentChecked.financeVerification = true;
                }
            }
            if ($scope.implData.implementedCost != null && $scope.implData.implementedCost != '' && $scope.implData.implementedCost > 0) {
                $scope.tabContentChecked.financeVerification = true;
            }
            if ($scope.implData.costEffective != null && $scope.implData.costEffective != '' && $scope.implData.costEffective > 0) {
                $scope.tabContentChecked.financeVerification = true;
            }
        } else if (tabName == "teamMembers") {
            if ($scope.tabContentChecked.markTeamMemberAsClicked) {
                $scope.tabContentChecked.teamMembers = false;
                if ($scope.employeeList != undefined && $scope.employeeList != null && $scope.employeeList.length > 0) {
                    $scope.employeeList.forEach(element => {
                        if (element.isSelected) {
                            $scope.tabContentChecked.teamMembers = true;
                        }
                    });
                }
            }
        }
    }

    $scope.schemePolicy = {
        flag: false
    };
    $scope.isSuggSchemePolicy = function () {
        $scope.schemePolicy.flag = false;
        var req = {
            orgId: $rootScope.empDetails.organization.orgId
        }
        appService.httpPost(req, 'getSuggestionPolicyDoc').then(function (response) {
            if (response.result) {
                if (!$scope.isEmpty(response.suggestionFlowConfig)) {
                    $scope.schemePolicy.docUrl = response.suggestionFlowConfig.suggPolicyDocUrl;
                    $scope.schemePolicy.flag = true;
                } else {
                    $scope.schemePolicy.flag = false;
                }
            } else {
                $scope.schemePolicy.flag = false;
            }
        }).catch(function (error) {
            $scope.schemePolicy.flag = false;
        })
    }
    $scope.downloadFile = function (url) {
        window.open(url, '_blank');
    };
    $scope.isSuggSchemePolicy();
    // Sustaince Modal
    $scope.showSustainceModal = function () {
        $("#sustainceInputModal")
            .modal({
                backdrop: 'static',
                keyboard: false
            });
    }
    //Export & View Kaizen
    $scope.viewKaizenModal = function () {
        $scope.underFinanceApprovalList = [];

        for (var i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
            if ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.UnderFinanceVerification.status) {
                $scope.underFinanceApprovalList.push($scope.suggestionDet.sugesstionStatusAudit[i]);
            }
        }
        //console.log($scope.underFinanceApprovalList);
        $("#kaizenExportModal")
            .modal({
                backdrop: 'static',
                keyboard: false
            });
    }
    // $scope.setStyle = function () {
    //     const demoClasses = document.getElementsByClassName('enjoyhint');
    //     demoClasses[0].setAttribute('style', 'z-index:9999');
    //     const demoClasses1 = document.getElementsByClassName('enjoyhint_disable_events');
    //     //console.log(demoClasses1);
    //     for (let index = 0; index < demoClasses1.length; index++) {
    //         demoClasses1[index].style.setProperty("top", "0px", "important");
    //         demoClasses1[index].style.setProperty("bottom", "0px", "important");
    //         demoClasses1[index].style.setProperty("left", "0px", "important");
    //         demoClasses1[index].style.setProperty("right", "0px", "important");
    //     }
    // }

    var enjoyhint_script_steps = [{
        'next .tabSuggestions-Suggestions': $scope.CONST_HELP_STMT.HOME_SCREEN.Suggestion_Tab,
        'nextButton': { className: "myNext", text: "Next" },
        'skipButton': { className: "mySkip", text: "Skip" }
    },
    // {
    //     'next .tabSuggestions-Dashboard': 'This tab displays all suggestion information in form of graphs.',
    //     'nextButton': { className: "myNext", text: "Next" },
    //     'skipButton': { className: "mySkip", text: "Skip" }
    // },
    // {
    //     'next .tabSuggestions-Reports': 'This tab displays all suggestion information in form reports.',
    //     'nextButton': { className: "myNext", text: "Next" },
    //     'skipButton': { className: "mySkip", text: "Skip" }
    // },
    // {
    //     'next .tabSuggestions-WinnersBoard': 'This tab displays all Winners the winner may be Employee Of the Month,Department Of the Month etc.',
    //     'nextButton': { className: "myNext", text: "Next" },
    // },
    // {
    //     'next .tabSuggestions-Redeem': 'This tab will help user to use there point for purchasing something',
    //     'nextButton': { className: "myNext", text: "Next" },
    //     'skipButton': { className: "mySkip", text: "Skip" }
    // },
    // {
    //     'next .tabSuggestions-HD': 'This tab displays all HD Suggestion details .',
    //     'nextButton': { className: "myNext", text: "Next" },
    // },
    // {
    //     'next .tabSuggestions-Guest': 'This tab will displays that suggestion which was created by Guest user who has not authority to give suggestion.',
    //     'nextButton': { className: "myNext", text: "Next" },
    // },
    // {
    //     'next .tabSuggestions-Customer': 'This tab will displays the user who had visited the website who had given the valuable feedback on it.',
    //     'nextButton': { className: "myNext", text: "Next" },
    //     'skipButton': { className: "mySkip", text: "Skip" }
    // },
    // {
    //     'next .tabSuggestions-nominate': 'tabSuggestions-Dashboard.',
    //     'nextButton': { className: "myNext", text: "Next" },
    // },
    {
        'next .my-Pending': $scope.CONST_HELP_STMT.HOME_SCREEN.My_Pending_Action_Tab,
        'nextButton': { className: "myNext", text: "Next" }
    },
    {
        'next .my-Suggestions': $scope.CONST_HELP_STMT.HOME_SCREEN.My_Suggestions_Tab,
        'nextButton': { className: "myNext", text: "Next" },
        // 'skipButton': { className: "mySkip", text: "Skip" }
    },
    {
        'next .all-Suggestions': $scope.CONST_HELP_STMT.HOME_SCREEN.All_Suggestions,
        'nextButton': { className: "myNext", text: "Next" }
    },
    {
        'next .Clear-Filter-Search-Button': $scope.CONST_HELP_STMT.HOME_SCREEN.Clear_Filter_Search_Button,
        'nextButton': { className: "myNext", text: "Next" }
    },
    {
        'next .Export-Excel': $scope.CONST_HELP_STMT.HOME_SCREEN.Export_Excel,
        'nextButton': { className: "myNext", text: "Next" },
        // 'skipButton': { className: "mySkip", text: "Skip" }
    },

    {
        'next .Add-On-Search': $scope.CONST_HELP_STMT.HOME_SCREEN.Add_On_Search,
        'nextButton': { className: "myNext", text: "Next" }
    },
    {
        'next .Search-Field': $scope.CONST_HELP_STMT.HOME_SCREEN.Search_Field,
        'nextButton': { className: "myNext", text: "Next" },
        // 'skipButton': { className: "mySkip", text: "Skip" }
    },
    {
        'next .Home-Points': $scope.CONST_HELP_STMT.HOME_SCREEN.Points,
        'nextButton': { className: "myNext", text: "Next" }
    },
    {
        'click .Create-Button': $scope.CONST_HELP_STMT.HOME_SCREEN.Create_Sugg_Button,
        'shape': 'circle',
        'radius': 30,
        'showSkip': false,
        'nextButton': { className: "mySkip", text: "Got it!!" },
    }
    ];
    $scope.homeScreenHelp = {};
    $scope.homeScreenHelp.flagHomehelp = false;
    $scope.starthomeScreenHelp = function () {
        $scope.homeScreenHelp.flagHomehelp = true;
        var enjoyhint_instance = new EnjoyHint({});
        enjoyhint_instance.set(enjoyhint_script_steps);
        enjoyhint_instance.run();
    }

    var enjoyhint_create_sugg_steps = [{
        'next .On_Behalf_Suggestion': $scope.CONST_HELP_STMT.CREATE_SUGGESTION.On_Behalf_Suggestion,
        'nextButton': { className: "myNext", text: "Next" },
    }, {
        'next .Self_Implement': $scope.CONST_HELP_STMT.CREATE_SUGGESTION.Self_Implement,
        'showSkip': false,
        'nextButton': { className: "mySkip", text: "Got It!!" },
    },];

    $scope.startCreateSuggHelp = function () {
        $scope.scrollToBottom('#createSuggScroll');
        setTimeout(function () {
            $scope.homeScreenHelp.flagCreateSugg = true;
            var enjoyhint_create_sugg_instance = new EnjoyHint({});
            enjoyhint_create_sugg_instance.set(enjoyhint_create_sugg_steps);
            enjoyhint_create_sugg_instance.run();
        }, 1000);
    }

    var enjoyhint_controller_steps = [{
        // 'click .btn': { className: 'helpDisbled' },
        'next .Accept_Assign': $scope.CONST_HELP_STMT.CONTROLLER_SCREEN.Accept_Assign,
        'nextButton': { className: "myNext", text: "Next" },
    }, {
        'next .Reject_Button': $scope.CONST_HELP_STMT.CONTROLLER_SCREEN.Reject_Button,
        'nextButton': { className: "myNext", text: "Next" },
    }, {
        'next .Reassign_to_Initiator': $scope.CONST_HELP_STMT.CONTROLLER_SCREEN.Reassign_to_Initiator,
        'nextButton': { className: "myNext", text: "Next" },
    }, {
        'next .Pass_to_Peer': $scope.CONST_HELP_STMT.CONTROLLER_SCREEN.Pass_to_Peer,
        'nextButton': { className: "myNext", text: "Next" },
    }, {
        'next .Check_Duplication': $scope.CONST_HELP_STMT.CONTROLLER_SCREEN.Check_Duplication,
        'nextButton': { className: "mySkip", text: "Got It!!" },
    }

    ];
    $scope.homeScreenHelp.flagCtrlhelp = false;
    $scope.startControllerHelp = function () {
        $scope.homeScreenHelp.flagCtrlhelp = true;
        var enjoyhint_controller_instance = new EnjoyHint({});
        enjoyhint_controller_instance.set(enjoyhint_controller_steps);
        enjoyhint_controller_instance.run();
    }

    var enjoyhint_evaluator_steps = [{
        'next .Change_Document': $scope.CONST_HELP_STMT.EVALUATOR_SCREEN.Change_Document,
        'nextButton': { className: "myNext", text: "Next" },
    }, {
        'next .Kaizen_Activity': $scope.CONST_HELP_STMT.EVALUATOR_SCREEN.Kaizen_Activity,
        'nextButton': { className: "myNext", text: "Next" },
    }, {
        'next .Saving_Type': $scope.CONST_HELP_STMT.EVALUATOR_SCREEN.Saving_Type,
        'nextButton': { className: "myNext", text: "Next" },
    }, {
        'next .Particulars': $scope.CONST_HELP_STMT.EVALUATOR_SCREEN.Particulars,
        'nextButton': { className: "myNext", text: "Next" },
    }, {
        'next .Horizontal_Deployment': $scope.CONST_HELP_STMT.EVALUATOR_SCREEN.Horizontal_Deployment,
        'nextButton': { className: "myNext", text: "Next" },
    },
    {
        'next .Analysis_Summary': $scope.CONST_HELP_STMT.EVALUATOR_SCREEN.Analysis_Summary,
        'nextButton': { className: "myNext", text: "Next" },
    }, {
        'next .Override_Initiator_Category': $scope.CONST_HELP_STMT.EVALUATOR_SCREEN.Override_Initiator_Category,
        'nextButton': { className: "myNext", text: "Next" },
    }, {
        'next .Budgetary_Cost': $scope.CONST_HELP_STMT.EVALUATOR_SCREEN.Budgetary_Cost,
        'nextButton': { className: "myNext", text: "Next" },
    }, {
        'next .SAP_Code': $scope.CONST_HELP_STMT.EVALUATOR_SCREEN.SAP_Code,
        'nextButton': { className: "myNext", text: "Next" },
    }, {
        'next .Assign_For_Implementation_Button': $scope.CONST_HELP_STMT.EVALUATOR_SCREEN.Assign_For_Implementation_Button,
        'nextButton': { className: "myNext", text: "Next" },
    }, {
        'next .Eval_Reject_Button': $scope.CONST_HELP_STMT.EVALUATOR_SCREEN.Eval_Reject_Button,
        'nextButton': { className: "myNext", text: "Next" },
    },

    ];

    $scope.starEvaluatorHelp = function () {
        // $scope.scrollToBottom(EvalHelp);
        // angular.element(".EvalHelp")
        //     .mCustomScrollbar("update");
        // setTimeout(function() {
        //     angular.element(".EvalHelp")
        //         .mCustomScrollbar("scrollTo", "bottom");
        // }, 100);
        var enjoyhint_evaluator_instance = new EnjoyHint({});
        enjoyhint_evaluator_instance.set(enjoyhint_evaluator_steps);
        enjoyhint_evaluator_instance.run();
    }

    var enjoyhint_implementer_steps = [{
        'next .implemented_tab': $scope.CONST_HELP_STMT.IMPLEMENTER_SCREEN.Implemented_Tab,
        'nextButton': { className: "myNext", text: "Next" },
    }, {
        'next .on_hold_tab': $scope.CONST_HELP_STMT.IMPLEMENTER_SCREEN.On_Hold_Tab,
        'nextButton': { className: "myNext", text: "Next" },
    }, {
        'next .reject_tab': $scope.CONST_HELP_STMT.IMPLEMENTER_SCREEN.Reject_Tab,
        'nextButton': { className: "myNext", text: "Next" },
    }, {
        'next .approximate_implementation_cost': $scope.CONST_HELP_STMT.IMPLEMENTER_SCREEN.Approximate_Implementation_Cost,
        'nextButton': { className: "myNext", text: "Next" },
    }, {
        'next .annual_savings': $scope.CONST_HELP_STMT.IMPLEMENTER_SCREEN.Annual_Savings,
        'nextButton': { className: "myNext", text: "Next" },
    }

    ];

    $scope.starImplementerHelp = function () {
        var enjoyhint_implementer_instance = new EnjoyHint({});
        enjoyhint_implementer_instance.set(enjoyhint_implementer_steps);
        enjoyhint_implementer_instance.run();
    }

    /* Month Diff */
    $scope.monthDiff = function (d1, d2) {
        var months;
        months = (d2.getFullYear() - d1.getFullYear()) * 12;
        months -= d1.getMonth();
        months += d2.getMonth();
        return months <= 0 ? 0 : months;
    }
    $scope.resetSustenanceFlag = function () {
        $scope.suggestionDet.sustenanceAuditData.setNextDate = false;
        $scope.suggestionInputDetails.nextSustenaceAuditDate = '';
        $scope.suggestionInputDetails.flagCloseKaizen = true;
        $scope.suggestionInputDetails.flagsustanceKaizen = false;
    }
    $scope.sustainanceCloseOrNot = function () {
        var flag = false;
        var monthDiffVal = 6;
        var currentDate = new Date();
        if (!$scope.isEmpty($rootScope.empDetails) && $rootScope.empDetails != null && $rootScope.empDetails != undefined) {
            var alies = $rootScope.empDetails.organization.alies;
            if (alies != null && !angular.isUndefined(alies) && alies == 'rpl') {
                if (!$scope.isEmpty($scope.suggestionDet) && ($scope.suggestionDet.sugesstionStatusAudit != null && $filter('filter')($scope.suggestionDet.sugesstionStatusAudit, { status_master: { status: $scope.CONST.STATUS.Implemented.status } }, true).length > 0)) {
                    var implRec = $filter('filter')($scope.suggestionDet.sugesstionStatusAudit, { status_master: { status: $scope.CONST.STATUS.Implemented.status } }, true);
                    var implDate = new Date(implRec[0].createdDate);
                    if ($scope.monthDiff(implDate, currentDate) < monthDiffVal) {
                        flag = true;
                    }
                }
            }
        }
        return flag;
    }
    /*-----------------------------------------------------------------------*/
    // by manoj
    $scope.setJuryTab = function (tab) {
        $scope.juryTab = tab;
        /*if (tab == 1) {
            $scope.FilterGroupName = "GROUP1"
        } else if (tab == 2) {
            $scope.FilterGroupName = "GROUP2"
        } else if (tab == 3) {
            $scope.FilterGroupName = "GROUP3"
        } else {
            $scope.FilterGroupName = "GROUP4"
        }*/
        $scope.nominationId = $scope.suggestionPagination.selectedMonth.id;
        $scope.getStatusWiseCount();
        $scope.getsuggestionList();
        $scope.getJuryTopKiazenList();
        $scope.getJueryStatusList();
        $scope.getJuryList();
    }

    $scope.isSetJuryTab = function (tabId) {
        return $scope.juryTab === tabId;
    };

    $scope.getNominationDateListData = function () {
        $scope.data = {
            "branchId": $scope.loggedInUserBranchId,
            "type": $scope.isSelectJuryTab
        }
        if ($scope.isSelectJuryTab == 'NOMINATION') {
            $scope.data.type = $scope.isSelectJuryTab;
        }
        //console.log($scope.data);
        appService.httpPost($scope.data, "getNominationDateList")
            .then(function (response) {
                //console.log(response)
                if (response.result == true) {
                    if (response.evalMstrNominationList != null && response.evalMstrNominationList.length > 0) {
                        $scope.NominationDateList = response.evalMstrNominationList;
                        for (let index = 0; index < $scope.NominationDateList.length; index++) {
                            //console.log($scope.arrMonths[$scope.NominationDateList[index].month] - 1);
                            $scope.NominationDateList[index].monthYearNew = $scope.arrMonths[($scope.NominationDateList[index].month) - 1] + " " + $scope.NominationDateList[index].year;
                        }
                        $scope.suggestionPagination.selectedMonth = $scope.NominationDateList[0];
                        $scope.nominationId = $scope.NominationDateList[0].id;
                        //console.log(response, $scope.NominationDateList)
                    } else {
                        $scope.NominationDateList = [];
                    }
                } else {
                    $scope.NominationDateList = [];
                }
            });
    }
    $scope.getNominationDateListData();
    // $scope.isPublishDisabled = function() {
    //     var flag = false;
    //     var date = new Date();
    //     var year = date.getFullYear();
    //     var month = date.getMonth() + 1;
    //     var day = date.getDay();
    //     if ($scope.suggestionPagination.selectedMonth != undefined && $scope.suggestionPagination.selectedMonth != null) {
    //         if (($scope.suggestionPagination.selectedMonth.month == month) && ($scope.suggestionPagination.selectedMonth.year == year)) {
    //             flag = true;
    //         }
    //     }
    //     return flag;
    // }
    $scope.juryInputSave = function (jury, actionType, sugRow) {
        $scope.parameterListNew = jury.parameterList;
        $scope.juryDatanew = jury;
        $scope.sugAssignedToJury = [];
        if ($scope.juryDatanew.inputType == 'PRODUCTION_HEAD' && actionType == 'UPDATE') {
            for (var j = 0; j < jury.ratingList.length; j++) {
                if (jury.ratingList[j].isSelected == true) {
                    $scope.sugAssignedToJury.push({
                        "sugAssignedToJury": {
                            "id": jury.jAssinedToId,
                        },
                        "phRatingId": jury.ratingList[j].id,
                        "phRating": jury.ratingList[j].scale,
                        "isPlantHead": 1
                    });
                }
            }
        } else if ($scope.juryDatanew.inputType == 'JURY' && actionType == 'UPDATE') {
            var totalRating = 0;
            for (var i = 0; i < $scope.parameterListNew.length; i++) {
                for (var k = 0; k < $scope.juryDatanew.suggestionEvalJuryInput.length; k++) {
                    if ($scope.parameterListNew[i].id == $scope.juryDatanew.suggestionEvalJuryInput[k].parameterId) {
                        for (var j = 0; j < $scope.parameterListNew[i].ratingList.length; j++) {
                            if ($scope.parameterListNew[i].ratingList[j].isSelected == true) {
                                totalRating = totalRating + $scope.parameterListNew[i].ratingList[j].scale;
                                $scope.sugAssignedToJury.push({
                                    "id": $scope.juryDatanew.suggestionEvalJuryInput[k].id,
                                    "sugAssignedToJury": {
                                        "id": $scope.juryDatanew.jAssinedToId,
                                    },
                                    "parameterId": $scope.parameterListNew[i].id,
                                    "ratingId": $scope.parameterListNew[i].ratingList[j].id,
                                    "juryRating": $scope.parameterListNew[i].ratingList[j].scale,
                                    "totalRating": 0,
                                    "browniePoints": sugRow.points
                                });
                            }
                        }
                    }
                }
            }
            //push total Rating on parameterListNew
            for (var index = 0; index < $scope.sugAssignedToJury.length; index++) {
                $scope.sugAssignedToJury[index].totalRating = totalRating;
            }
        } else if ($scope.juryDatanew.inputType == 'PRODUCTION_HEAD' && actionType == 'ADD') {
            for (var j = 0; j < jury.ratingList.length; j++) {
                if (jury.ratingList[j].isSelected == true) {
                    $scope.sugAssignedToJury.push({
                        "sugAssignedToJury": {
                            "id": jury.jAssinedToId,
                        },
                        "phRatingId": jury.ratingList[j].id,
                        "phRating": jury.ratingList[j].scale,
                        "isPlantHead": 1

                    });
                }
            }
        } else if ($scope.juryDatanew.inputType == 'JURY' && actionType == 'ADD') {
            var totalRating = 0;
            for (var i = 0; i < $scope.parameterListNew.length; i++) {
                for (var j = 0; j < $scope.parameterListNew[i].ratingList.length; j++) {
                    if ($scope.parameterListNew[i].ratingList[j].isSelected == true) {
                        totalRating = totalRating + $scope.parameterListNew[i].ratingList[j].scale;
                        $scope.sugAssignedToJury.push({
                            "sugAssignedToJury": {
                                "id": $scope.juryDatanew.jAssinedToId,
                            },
                            "parameterId": $scope.parameterListNew[i].id,
                            "ratingId": $scope.parameterListNew[i].ratingList[j].id,
                            "juryRating": $scope.parameterListNew[i].ratingList[j].scale,
                            "browniePoints": sugRow.points
                        });
                    }
                }
            }
            if ($scope.sugAssignedToJury.length < 6) {
                snackbar.create("Please submit all inputs.", 5000, "error");
                return;
            }
            for (var index = 0; index < $scope.sugAssignedToJury.length; index++) {
                $scope.sugAssignedToJury[index].totalRating = totalRating;
            }
        }

        appService.httpPost($scope.sugAssignedToJury, "submitSuggestionJuryInputs")
            .then(function (response) {
                if (response.result == true) {
                    if (jury.jStatus == "COMPLETED") {
                        snackbar.create("Jury ratings modified successfully.", 4000, "success");
                        $scope.getStatusWiseCount();
                        $scope.getsuggestionList();
                        $scope.getJuryTopKiazenList();
                        $scope.getJueryStatusList();
                        jury.isupdate = false;
                    } else {
                        snackbar.create("Jury rating submitted successfully.", 4000, "success");
                        $scope.getsuggestionList();
                        jury.isupdate = false;
                    }
                } else {
                    snackbar.create("Oops!! Please try again.", 3000, "error");
                }
            });
    }
    $scope.cardSelected = function (selectedCardId) {

        for (var i = 0; i < $scope.juryData.length; i++) {
            $scope.juryData[i].isSelectedCard = false;
            if ($scope.juryData[i].suggestionNumber == selectedCardId) {
                $scope.juryData[i].isSelectedCard = true;
            } else {
                $scope.juryData[i].isSelectedCard = false;
            }
        }
        //console.log(selectedCardId, $scope.juryData)
    }
    /// by manoj
    $scope.modifySuggFrom = {};
    $scope.updateSuggestionData = function () {
        $("#editModal").modal({
            backdrop: 'static',
            keyboard: false
        });
        $scope.suggDataForModify = angular.copy($scope.suggestionDet);
    }
    $scope.updateNewData = function (form) {
        $scope.flagModifySuggSpinner = true;
        if (form.$invalid) {
            angular.forEach(form.$error.required, function (field) {
                field.$setDirty();
                $scope.flagModifySuggSpinner = false;
            });
            return;
        }

        $scope.data = {
            "sugg_id": $scope.suggDataForModify.sugId
        }
        if ($scope.suggestionDet.problemAnalysis != $scope.suggDataForModify.problemAnalysis) {
            $scope.data.problemAnalysis = $scope.suggDataForModify.problemAnalysis
        }

        if ($scope.suggestionDet.problemAnalysis != $scope.suggDataForModify.sugession) {
            $scope.data.suggestion = $scope.suggDataForModify.sugession
        }

        if ($scope.suggestionDet.problemAnalysis != $scope.suggDataForModify.suggestionTitle) {
            $scope.data.suggestionTitle = $scope.suggDataForModify.suggestionTitle
        }
        appService.httpPost($scope.data, "modifySugesstionDetails")
            .then(function (response) {
                $scope.flagModifySuggSpinner = false;
                if (response.result) {
                    $("#editModal").modal('hide');
                    snackbar.create($filter('translate')('Suggestion_Updated_Successfully'), 5000, "success");
                    $scope.getSuggestionListOnUpdate();
                } else {
                    $scope.flagModifySuggSpinner = false;
                    if (response.statusCode == 100) {
                        snackbar.create(response.reason, 5000, "success");
                    } else {
                        snackbar.create($filter('translate')('Error_occured_Please_try_again'), 5000, "success");
                    }
                }
            });
    }
    $scope.dateRangePickerOptions = {
        "singleDatePicker": true,
        "drops": "up",
        "maxDate": moment(),
        // "startDate": moment().subtract(1, 'months'),
        // "endDate": moment()
    }
    //<--- Nomination & Jurry Assessment by Sanket B.--->
    $scope.isSelectJuryTab = ($rootScope.checkSubMenuAccess('Suggestions', 'Suggestions-Nomination')) ? 'NOMINATION' : 'ASSESSMENT';
    $scope.selectJuryTab = function (tab) {
        $scope.isSelectJuryTab = tab;
        if ($scope.isSelectJuryTab == 'NOMINATION') {
            $scope.getDeptList();
        } else {
            $scope.setJuryTab();
        }
    }

    $scope.setNomination = function () {
        $scope.data = {
            "orgId": $scope.loggedInUserOrgId,
            "branchId": $scope.loggedInUserBranchId,
            "year": $scope.suggestionPagination.selectedMonth.year,
            "month": $scope.suggestionPagination.selectedMonth.month
        }
        if ($scope.selectDeptIdsList != null && $scope.selectDeptIdsList.length > 0) {
            $scope.data.deptIds = $scope.selectDeptIdsList;
        }
        $scope.flagJuryDetIndicator = true;
        appService.httpPost($scope.data, "getSuggestionNominationList").then(function (response) {
            //console.log(response)
            $scope.flagJuryDetIndicator = false;
            if (response.result) {
                $scope.nominationList = response.list;
                if (response.list != null && response.list.length > 0) {
                    $scope.nominationList = response.list;
                    for (var i = 0; i < $scope.nominationList.length; i++) {
                        $scope.nominationList[i].implementedDate = ($scope.nominationList[i].implementedDate) ? $filter('date')(new Date($scope.nominationList[i].implementedDate), "MMM d, y") : '';
                    }
                } else {
                    $scope.nominationList = [];
                }
            } else {
                $scope.nominationList = [];
                if (response.statusCode == 100) {
                    snackbar.create(response.reason, 5000, "error");
                } else if (response.statusCode == 500) {
                    snackbar.create($filter('translate')('Error_occured_Please_try_again'), 5000, "error");
                }
            }
        })
    }

    $scope.flagBeforeSuggSelection = false;
    $scope.selectAllSuggestion = function () {
        var flag = ($scope.selectAllSugg) ? false : true;
        $scope.selectAllSugg = flag;
        $scope.flagBeforeSuggSelection = $scope.selectAllSugg
        for (var i = 0; i < $scope.nominationList.length; i++) {
            $scope.nominationList[i].selectedSugg = $scope.selectAllSugg;
        }
    }

    $scope.setSuggSelected = function (data) {
        $scope.flagBeforeSuggSelection = false;
        data.selectedSugg = (data.selectedSugg) ? false : true;
        for (var i = 0; i < $scope.nominationList.length; i++) {
            if ($scope.nominationList[i].selectedSugg) {
                $scope.flagBeforeSuggSelection = true;
            }
        }
        var count = $filter('filter')($scope.nominationList, { selectedSugg: true }, true).length;
        if (count == $scope.nominationList.length) {
            $scope.selectAllSugg = true;
        } else {
            $scope.selectAllSugg = false;
        }
    }

    $scope.assignForAssessment = function () {
        $scope.selectSuggId = [];
        for (var i = 0; i < $scope.nominationList.length; i++) {
            if ($scope.nominationList[i].selectedSugg) {
                $scope.selectSuggId.push($scope.nominationList[i].sugId);
            }
        }
        if ($scope.selectSuggId.length == undefined || $scope.selectSuggId.length == null || $scope.selectSuggId.length == 0) {
            snackbar.create($filter('translate')('Please select kaizen for nomination'), 3000, "error");
            return;
        } else {
            $scope.data = {
                "orgId": $scope.loggedInUserOrgId,
                "suggIds": $scope.selectSuggId,
                "branchId": $scope.loggedInUserBranchId,
                "nominationBy": $scope.loggedInEmpId,
                "nominationId": $scope.suggestionPagination.selectedMonth.id
            }
            appService.httpPost($scope.data, "nominationSuggestion").then(function (response) {
                if (response.result) {
                    snackbar.create($filter('translate')('Kaizen successfully nominated for assessment'), 4000, "success");
                    // $scope.setNomination();
                    $scope.getDeptList();
                } else {
                    snackbar.create($filter('translate')("Oop's please try again"), 3000, "error");
                    return;
                }
            })
        }
    }
    $scope.openJuryDetailModal = function () {
        $("#juryDetails").modal("show");
    }
    //<--- Nomination & Jurry Assessment End by Sanket B.--->
    $scope.statusListConfig = {
        scrollButtons: {
            scrollAmount: '170px', // scroll amount when button pressed
            enable: true // enable scrolling buttons by default
        },
        scrollInertia: 0, // adjust however you want
        axis: 'x', // enable 2 axis scrollbars by default,
        autoHideScrollbar: false,
        advanced: {
            updateOnContentResize: true
        },
    }

    /* Author - Jayshri 
    Date - 22/12/2023
    Function - Check the impletementation verification is on or off
    return - Check the impletementation verification is on or off
    */
    $scope.isImplVerification = false;
    $scope.getRoleAccessList = function () {
        appService.httpGet("getlistofroleaccessnew/" + $rootScope.empDetails.organization.orgId + "/" + $rootScope.empDetails.branch.branchId + "/" + 9 + '/' + $rootScope.empDetails.productOrgConfigDet.product.id).then(function (response) {
            $scope.menuList = response.menuDataList;
            for (var i = 0; i < $scope.menuList.length; i++) {
                if ($scope.menuList[i].menuName == "Settings") {
                    for (var j = 0; j < $scope.menuList[i].subMenuList.length; j++) {
                        if ($scope.menuList[i].subMenuList[j].subMenuName == "Implementation Verification") {
                            $scope.isImplVerification = true;
                        }
                        else {
                            $scope.isImplVerification = false;
                        }
                    }
                };
            };
        });
    }

    $scope.getRoleAccessList();

    /* Author - Jayshri 
    Date - 22/12/2023
    Function - Check Priority if available 
    return - Check Priority if available 
    */
    $scope.checkPriority = function () {
        if ($scope.suggestionDet) {
            if ($scope.suggestionDet.suggPriority) {

                if ($scope.suggestionDet.suggPriority == "H") {
                    $scope.suggestionDet.suggPriority = { id: "H", name: "High" }
                }
                else if ($scope.suggestionDet.suggPriority == "M") {
                    $scope.suggestionDet.suggPriority = { id: "M", name: "Medium" }
                }
                else if ($scope.suggestionDet.suggPriority == "L") {
                    $scope.suggestionDet.suggPriority = { id: "L", name: "Medium" }
                }
                //console.log($scope.suggestionDet.suggPriority)
            }
        }
    }

    $scope.flagCheckRejStatus = false;
    $scope.flagCheckCommentStatus = false;

    /* Author - Jayshri 
    Date - 22/12/2023
    Function - Check rejection status by evaluator when assigning futuristic commitee
    return - Check rejection status by evaluator when assigning futuristic commitee
    */
    $scope.checkRejStatus = function (status) {
        if (status == "YES") {
            $scope.flagCheckRejStatus = true;
            $scope.flagCheckCommentStatus = false;
            $scope.suggestionDet.futuristicSummary = "";
        }
        if (status == "NO") {
            $scope.flagCheckCommentStatus = true;
            $scope.flagCheckRejStatus = false;
            $scope.suggestionDet.rejectionReason = "";
        }
        $scope.suggestionDet.actionStatus = status;
    }

    /* Author - Jayshri 
    Date - 22/12/2023
    Function - Futuristic Committee Submission
    return - Futuristic Committee Submission
    */
    $scope.futuristicCommitteeSubmission = function () {
        var alies = $rootScope.empDetails.organization.alies;
        //console.log($scope.suggestionDet.futuristicSummary);
        $scope.futuristicMsg = "";
        if (($scope.suggestionDet.futuristicSummary === undefined || $scope.suggestionDet.futuristicSummary === "") && ($scope.suggestionDet.rejectionReason == undefined || $scope.suggestionDet.rejectionReason == "")) {
            snackbar.create($filter('translate')('Please_enter_comment'), 5000, "error");
            return;
        }
        if ($scope.suggestionDet.actionStatus == "YES") {
            if (alies == "gmr") {
                $scope.futuristicMsg = "Idea rejected by futuristic commitee successfully."
            }
            else {
                $scope.futuristicMsg = "Suggestion rejected by futuristic commitee successfully."
            }

        }
        if ($scope.suggestionDet.actionStatus == "NO") {
            if (alies == "gmr") {
                $scope.futuristicMsg = "Idea assigned to evaluator successfully.";
            }
            else {
                $scope.futuristicMsg = "Suggestion assigned to evaluator successfully.";
            }

        }
        $scope.data = {
            "sugId": $scope.selectedSuggId,
            "sugTrackId": $scope.suggestionDet.evaluationTeamList[0].sugTrackId,
            "assigned_by": parseInt($scope.loggedInEmpId),
            "updatedBy": parseInt($scope.loggedInEmpId),
            "createdBy": parseInt($scope.loggedInEmpId),
            "actionStatus": $scope.suggestionDet.actionStatus,
            "statusId": $scope.CONST.STATUS.AssignToFuturisticCommittee.statusId,
            // "comment": $scope.suggestionDet.futuristicSummary
        }
        if ($scope.suggestionDet.actionStatus == "YES") {
            $scope.data.comment = $scope.suggestionDet.rejectionReason
        }
        if ($scope.suggestionDet.actionStatus == "NO") {
            $scope.data.comment = $scope.suggestionDet.futuristicSummary
        }

        appService.httpPost($scope.data, "futuristicCommitteeSubmission")
            .then(function (response) {
                if (response.result == true) {
                    snackbar.create($filter('translate')($scope.futuristicMsg), 4000, "success");
                    // $scope.getSuggestionListOnUpdate();
                    // $scope.getsuggestionList("");
                    $scope.getsuggestionList('onLoad');
                    $scope.getStatusWiseCount();

                } else {
                    snackbar.create($filter('translate')('Error_occured_Please_try_again'), 5000, "error");

                }
            });
    }

    $scope.verifyImplDetails = function (modalType, status) {
        $scope.implInputData = {};
        $scope.implInputData = {
            currentDiv: modalType,
            stsAdt: status
        }
        if ($scope.suggestionDet.sustenanceAuditorId) {
            $scope.implInputData.sustenanceAuditorId = $scope.suggestionDet.sustenanceAuditorId.toString();
        }
        $scope.isDepartmentSelected();
        // $scope.isBenefitBeforChecked();
        if (modalType == 'implemented') {
            $scope.setImplTab(1);
            // $scope.implFiles = [];
            // $scope.resultImageFiles = [];
            if ($scope.suggFlowConfig.isBenefitsEnbld == 'Y') {
                $scope.getBenefitAnalysisList($scope.suggestionDet.branch.branchId);
                $scope.setSubImplTab(1);
            } else if ($scope.suggFlowConfig.isImplParticularsEnbld == 'Y') {
                $scope.setSubImplTab(2);
            } else if ($scope.suggFlowConfig.isImplHorizDplymntEnbld == 'Y') {
                $scope.setSubImplTab(3)
            } else if ($scope.suggFlowConfig.isWhyWhyAnalysisEnbld == 'Y') {
                $scope.setSubImplTab(4);
            } else if ($scope.suggFlowConfig.isKaizenSustainanceEnbld == 'Y') {
                $scope.setSubImplTab(5);
            } else {
                $scope.setSubImplTab(6);
            }
            if ($scope.suggestionDet.sourceType == 'HD') {
                $scope.getSuggestionTypeDetail($scope.suggestionDet.suggestionHD.parentSuggId, $scope.suggestionDet.suggestionHD.branchId);
            }
            if ($scope.hdConfigData.hdLevel == 'PILLER') {
                if ($scope.circleList != null && $scope.circleList.length > 0) {
                    $scope.newCircleList = [];
                    for (let index = 0; index < $scope.circleList.length; index++) {
                        if ($scope.circleList[index].id != 0) {
                            $scope.newCircleList.push($scope.circleList[index]);
                        }
                    }
                }
            }
            if ($scope.suggFlowConfig.isImplParticularsEnbld == 'Y') {
                // updated on 24-01-2024 by @Jayshri Kolase for set updated category 
                if ($scope.suggestionDet.customEvaluationParticularsList.length > 0 && $scope.suggestionDet.customEvaluationParticularsList != null) {
                    for (let i = 0; i < $scope.suggCatbranchwise.length; i++) {
                        for (let j = 0; j < $scope.suggestionDet.customEvaluationParticularsList.length; j++) {
                            if ($scope.suggCatbranchwise[i].catId == $scope.suggestionDet.customEvaluationParticularsList[j].catId && $scope.suggestionDet.customEvaluationParticularsList[j].isActive == "Y") {
                                $scope.suggestionDet.selectedCatName = $scope.suggCatbranchwise[i].categoryName;
                                $scope.suggestionDet.selectedEvalCatId = $scope.suggCatbranchwise[i].catId;
                            }
                        }
                    }
                }
                else {
                    $scope.suggestionDet.selectedCatName = $scope.suggestionDet.category.categoryName;
                    $scope.suggestionDet.selectedEvalCatId = $scope.suggestionDet.category.catId;
                }
            }
            if ($scope.suggestionDet.sustenanceAuditorList == null || $scope.suggestionDet.sustenanceAuditorList.length == 0) {
                $scope.getSustenaceAuditor();
            }
            if ($scope.employeeList != null && $filter('filter')($scope.employeeList, {
                branch: { branchId: $scope.suggestionDet.branch.branchId }
            }, true).length > 0) {
            } else {
                $scope.getEmployeeList($scope.suggestionDet.branch.branchId);
            }
            $("#viewImplementedModal")
                .modal({
                    backdrop: 'static',
                    keyboard: false
                });
        }
    }
    $scope.verifyImplDetails = function (modalType, status) {
        $scope.implInputData = {};
        $scope.implInputData = {
            currentDiv: modalType,
            stsAdt: status
        }
        if ($scope.suggestionDet.sustenanceAuditorId) {
            $scope.implInputData.sustenanceAuditorId = $scope.suggestionDet.sustenanceAuditorId.toString();
        }
        $scope.isDepartmentSelected();
        // $scope.isBenefitBeforChecked();
        if (modalType == 'implemented') {
            $scope.setImplTab(1);
            // $scope.implFiles = [];
            // $scope.resultImageFiles = [];
            if ($scope.suggFlowConfig.isBenefitsEnbld == 'Y') {
                $scope.getBenefitAnalysisList($scope.suggestionDet.branch.branchId);
                $scope.setSubImplTab(1);
            } else if ($scope.suggFlowConfig.isImplParticularsEnbld == 'Y') {
                $scope.setSubImplTab(2);
            } else if ($scope.suggFlowConfig.isImplHorizDplymntEnbld == 'Y') {
                $scope.setSubImplTab(3)
            } else if ($scope.suggFlowConfig.isWhyWhyAnalysisEnbld == 'Y') {
                $scope.setSubImplTab(4);
            } else if ($scope.suggFlowConfig.isKaizenSustainanceEnbld == 'Y') {
                $scope.setSubImplTab(5);
            } else {
                $scope.setSubImplTab(6);
            }
            if ($scope.suggestionDet.sourceType == 'HD') {
                $scope.getSuggestionTypeDetail($scope.suggestionDet.suggestionHD.parentSuggId, $scope.suggestionDet.suggestionHD.branchId);
            }
            if ($scope.hdConfigData.hdLevel == 'PILLER') {
                if ($scope.circleList != null && $scope.circleList.length > 0) {
                    $scope.newCircleList = [];
                    for (let index = 0; index < $scope.circleList.length; index++) {
                        if ($scope.circleList[index].id != 0) {
                            $scope.newCircleList.push($scope.circleList[index]);
                        }
                    }
                }
            }
            /* if ($scope.suggFlowConfig.isImplParticularsEnbld == 'Y') {
                // updated on 24-01-2024 by @Jayshri Kolase for set updated category 
                if ($scope.suggestionDet.customEvaluationParticularsList.length > 0 && $scope.suggestionDet.customEvaluationParticularsList != null) {
                    for (let i = 0; i < $scope.suggCatbranchwise.length; i++) {
                        for (let j = 0; j < $scope.suggestionDet.customEvaluationParticularsList.length; j++) {
                            if ($scope.suggCatbranchwise[i].catId == $scope.suggestionDet.customEvaluationParticularsList[j].catId && $scope.suggestionDet.customEvaluationParticularsList[j].isActive == "Y") {
                                $scope.suggestionDet.selectedCatName = $scope.suggCatbranchwise[i].categoryName;
                                $scope.suggestionDet.selectedEvalCatId = $scope.suggCatbranchwise[i].catId;
                            }
                        }
                    }
                }
                else {
                    $scope.suggestionDet.selectedCatName = $scope.suggestionDet.category.categoryName;
                    $scope.suggestionDet.selectedEvalCatId = $scope.suggestionDet.category.catId;
                }
            } */
            if ($scope.suggestionDet.sustenanceAuditorList == null || $scope.suggestionDet.sustenanceAuditorList.length == 0) {
                $scope.getSustenaceAuditor();
            }
            if ($scope.employeeList != null && $filter('filter')($scope.employeeList, {
                branch: { branchId: $scope.suggestionDet.branch.branchId }
            }, true).length > 0) {
            } else {
                $scope.getEmployeeList($scope.suggestionDet.branch.branchId);
            }
            if ($scope.suggestionDet.suggestionTrackerDetails != null) {
                for (let i = 0; i < $scope.suggestionDet.suggestionTrackerDetails.length; i++) {
                    if ($scope.suggestionDet.suggestionTrackerDetails[i].team_type_master != null) {
                        if ($scope.suggestionDet.suggestionTrackerDetails[i].team_type_master.type == 'Implementation') {
                            $scope.resultData = $scope.suggestionDet.suggestionTrackerDetails[i];
                        }
                    }
                }
            }
            // Assuming resultData.isEHSBenefit contains 'YES' or 'NO'
            $scope.checkboxValueEHS = $scope.resultData.isEHSBenefit === 'YES';
            $("#viewImplementedModal")
                .modal({
                    backdrop: 'static',
                    keyboard: false
                });
        }
    }
    // Check selected benifits
    $scope.isBenefitChecked = function (benefit) {
        for (let i = 0; i < $scope.suggestionDet.implBenefitAnalysisList.length; i++) {
            if (benefit.benfitId == $scope.suggestionDet.implBenefitAnalysisList[i].benefitAnalysis.benfitId) {
                return true;
            }
        }
    };
    /* Author - Sanket B. (Modifier)
    Date - 21/12/2023 
    Function - To get the department selected by Implementer
    Return - HD selected Department
    */
    $scope.isDepartmentSelected = function () {
        if ($scope.departmentList != null && $scope.departmentList.length > 0) {
            for (let j = 0; j < $scope.departmentList.length; j++) {
                let found = false;
                for (let i = 0; i < $scope.suggestionDet.suggestionHorizontalDept.length; i++) {
                    if ($scope.departmentList[j].deptId === $scope.suggestionDet.suggestionHorizontalDept[i].deptId) {
                        found = true;
                        break;
                    }
                }
                $scope.departmentList[j].isImplselect = found;
                // //console.log(`Dept Name: ${$scope.departmentList[j].deptName}, isImplselect: ${$scope.departmentList[j].isImplselect}`);
            }
        }
        // //console.log($scope.departmentList);
    };
    // Check Implemented data filled by implementor by Jayshri
    /* Author - Sanket B. (Modifier)
    Date - 21/12/2023 
    Purpose - to get Implemented data captured by Implementor.
    Return - Details captured by Implementer.
    */
    $scope.implBeforFiles = [];
    $scope.checkImplData = function (suggData) {
        $scope.implBeforFiles = [];
        $scope.resultImageBeforFiles = [];
        //console.log(suggData);
        $scope.selectedEmpList = [];
        if ($scope.employeeList != null && $filter('filter')($scope.employeeList, {
            branch: { branchId: suggData.branch.branchId }
        }, true).length > 0) {
            for (let index = 0; index < $scope.employeeList.length; index++) {
                $scope.employeeList[index].isSelected = false;
                $scope.employeeList[index].selectedId = 0;
            }
        } else {
            $scope.getEmployeeList(suggData.branch.branchId);
        }
        if (suggData.sugImplTeam != null && suggData.sugImplTeam.length > 0) {
            $scope.checkEmpTeam();
        }
        else {
            for (var i = 0; i < $scope.employeeList.length; i++) {
                $scope.employeeList[i].isSelected = false;
            }
        }
        if ($scope.suggestionDet.suggestionActivityList != null && $scope.suggestionDet.suggestionActivityList.length > 0) {
            $scope.isActivityBeforChecked();
        }
        if (suggData.ehsbenefit != undefined && suggData.ehsbenefit != "" && suggData.ehsbenefit == "Yes") {
            $scope.suggestionDet.ehsbenefit = true;
            $scope.implData.safetImplactionSummary = suggData.safetyImplemention;
        }
        else {
            $scope.suggestionDet.ehsbenefit = false;
            $scope.implData.safetImplactionSummary = null
        }
        $scope.whyWhyAnalysisforImplSuggDet = suggData.suggestionWhyWhyAnalysis;
        if ($scope.suggestionDet.sugesstionStatusAudit != null && $scope.suggestionDet.sugesstionStatusAudit.length > 0) {
            for (let i = 0; i < $scope.suggestionDet.sugesstionStatusAudit.length; i++) {
                if ($scope.suggestionDet.sugesstionStatusAudit[i].actionStatus == "PENDING" && (($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.ReassignedToImplPostVerification.status) ||
                    ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.AssignedForImplVerification.status) || ($scope.suggestionDet.sugesstionStatusAudit[i].status_master.status == $scope.CONST.STATUS.ReassignedToImplPostFincVerification.status))) {
                    if (suggData.suggestionWhyWhyAnalysis != null && suggData.suggestionWhyWhyAnalysis.length > 0) {
                        $scope.whyWhyAnalysisforImpl = [];
                        for (let i = 0; i < suggData.suggestionWhyWhyAnalysis.length; i++) {
                            $scope.whyWhyAnalysisforImpl.push({ whyWhyAnalysis: suggData.suggestionWhyWhyAnalysis[i].name, id: suggData.suggestionWhyWhyAnalysis[i].id })
                        }
                    }
                    $scope.resultImageBeforFiles = [];
                    if (suggData.resultDocUrl != "" && suggData.resultDocUrl != undefined) {
                        $scope.resultImageBeforFiles.push({ imgsrc: suggData.resultDocUrl });
                    }
                    $scope.implBeforFiles = [];
                    if (suggData.implementedDocDetails != null && suggData.implementedDocDetails.length > 0) {
                        let maxSuggDocId = 0; // Initialize maxSuggDocId with a value lower than any expected suggDocId
                        for (let j = 0; j < suggData.implementedDocDetails.length; j++) {
                            const currentSuggDocId = suggData.implementedDocDetails[j].suggdocId;
                            // Check if the current suggDocId is greater than the current maximum
                            if (currentSuggDocId > maxSuggDocId) {
                                maxSuggDocId = currentSuggDocId;
                                if ($scope.implBeforFiles) {
                                    // Clear the existing entries and push the current element
                                    $scope.implBeforFiles = [{ imgsrcImpl: suggData.implementedDocDetails[j].url }];
                                }
                            }
                        }
                    }
                }
            }
        }
        // PCR & PCN Number Changes by Jayshri - 22-01-2024
        if (suggData.pcrNo != null && suggData.pcrNo != "") {
            $scope.suggestionDet.pcrNumber = suggData.pcrNo;
        }
        else {
            $scope.suggestionDet.pcrNumber = "";
        }
        if (suggData.pcnNo != null && suggData.pcnNo != "") {
            $scope.suggestionDet.pcnNumber = suggData.pcnNo;
        }
        else {
            $scope.suggestionDet.pcnNumber = "";
        }
        $scope.implData.implSummary = suggData.implSummary;
        $scope.implData.implactionSummary = suggData.implementationAction;
        //console.log($scope.implFiles)
        $scope.suggestionDet.rootCause = suggData.suggestionTrackerDetails[suggData.suggestionTrackerDetails.length - 1].rootCause;
        $scope.suggestionDet.counterMeasures = suggData.suggestionTrackerDetails[suggData.suggestionTrackerDetails.length - 1].counterMeasures;
        $scope.suggestionDet.kaizenIdea = suggData.suggestionTrackerDetails[suggData.suggestionTrackerDetails.length - 1].kaizenIdea;
        $scope.suggestionDet.benefits = suggData.suggestionTrackerDetails[suggData.suggestionTrackerDetails.length - 1].benefits;
        $scope.suggestionDet.whatToDo = suggData.suggestionTrackerDetails[suggData.suggestionTrackerDetails.length - 1].whatToDo; // 21/12/2023  by Sanket B.
        $scope.suggestionDet.howToDo = suggData.suggestionTrackerDetails[suggData.suggestionTrackerDetails.length - 1].howToDo;
        $scope.suggestionDet.frquency = suggData.suggestionTrackerDetails[suggData.suggestionTrackerDetails.length - 1].frquency;
        $scope.implData.implementedCost = suggData.suggestionTrackerDetails[suggData.suggestionTrackerDetails.length - 1].implementedCost;
        $scope.implData.costEffective = suggData.suggestionTrackerDetails[suggData.suggestionTrackerDetails.length - 1].costEffective;
        $scope.suggestionDet.implSummary = suggData.implSummary;
        $scope.suggestionDet.implactionSummary = suggData.suggestionTrackerDetails[suggData.suggestionTrackerDetails.length - 1].implementationAction;
        if ($scope.suggestionDet.FCData != '' && $scope.suggestionDet.FCData != undefined) {
            $scope.isFcAvailable($scope.suggestionDet.FCData);
        }
    }
    /* Author - Jayshri 
    Date - 22/12/2023
    Function - Check emp is a selected as a team meamber or not
    return - Check emp is a selected as a team meamber or not
    */
    $scope.checkEmpTeam = function () {
        $scope.selectedEmpList = [];
        for (var i = 0; i < $scope.employeeList.length; i++) {
            $scope.employeeList[i].isSelected = false;
            $scope.employeeList[i].selectedId = 0;
        }
        if ($scope.suggestionDet.sugImplTeam != null && $scope.suggestionDet.sugImplTeam.length > 0) {
            for (let j = 0; j < $scope.employeeList.length; j++) {
                for (let i = 0; i < $scope.suggestionDet.sugImplTeam.length; i++) {
                    // && $scope.employeeList[j].isSelected != true
                    if ($scope.employeeList[j].empId === $scope.suggestionDet.sugImplTeam[i].empId) {
                        $scope.employeeList[j].isSelected = true;
                        $scope.employeeList[j].selectedId = $scope.suggestionDet.sugImplTeam[i].id;
                        $scope.selectedEmpList.push($scope.employeeList[j]);
                    }
                }
            }
        }
        //console.log($scope.selectedEmpList)
    }
    /* Author - Jayshri 
    Date - 22/12/2023
    Function - To get the Benifit Details
    return - Benifit Details
    */
    $scope.isBenefitBeforChecked = function () {
        if ($scope.suggestionDet.implBenefitAnalysisList != null && $scope.suggestionDet.implBenefitAnalysisList.length > 0)
            for (let j = 0; j < $scope.benefitList.length; j++) {
                for (let i = 0; i < $scope.suggestionDet.implBenefitAnalysisList.length; i++) {
                    if ($scope.benefitList[j].benfitId == $scope.suggestionDet.implBenefitAnalysisList[i].benefitAnalysis.benfitId && $scope.benefitList[j].benfitId != true) {
                        $scope.benefitList[j].isBenefitChecked = true;
                    }
                }
            }
    };
    /* Author - Jayshri 
    Date - 22/12/2023
    Function - To get the Department Details
    return - Department Details
    */
    $scope.isHdDeptBeforeCheck = function () {
        if ($scope.suggestionDet.suggestionHorizontalDept != null && $scope.suggestionDet.suggestionHorizontalDept.length > 0) {
            $scope.suggestionDet.isHDRequire = true;
            $scope.suggestionDet.hdSelected = false;
            for (let i = 0; i < $scope.departmentList.length; i++) {
                for (let j = 0; j < $scope.suggestionDet.suggestionHorizontalDept.length; j++) {
                    if ($scope.departmentList[i].deptId == $scope.suggestionDet.suggestionHorizontalDept[j].deptId && ($scope.departmentList[i].isImplselect != true || $scope.departmentList[i].isEvalselect != true)) {
                        $scope.departmentList[i].isImplselect = true;
                        $scope.departmentList[i].isEvalselect = true;
                        $scope.getImplDeptLineList($scope.departmentList[i], 'New');
                    }
                }
            }
        }
    }
    /* Author - Sanket B. (Modifier)
    Date - 21/12/2023
    Function - To get the Finance Verifier
    return - FC verifier details
    */
    $scope.isFcAvailable = function (data) {
        //console.log(data);
        if ($scope.FCList != null && $scope.FCList.length > 0) {
            $scope.suggestionDet.implfinanceflow = true;
            for (let i = 0; i < $scope.FCList.length; i++) {
                if (data.fcId == $scope.FCList[i].empId) {
                    $scope.suggestionDet.implfc = $scope.FCList[i];
                }
            }
        }
    }
    // @author Jayshri Kolase Dec - 12 - 2023
    // @param Check Activity
    // @comments Check Activity If existing stage selected
    $scope.isActivityBeforChecked = function () {
        if ($scope.suggestionDet.suggestionActivityList != null && $scope.suggestionDet.suggestionActivityList.length > 0) {
            for (let i = 0; i < $scope.activityList.length; i++) {
                for (let j = 0; j < $scope.suggestionDet.suggestionActivityList.length; j++) {
                    if ($scope.suggestionDet.suggestionActivityList[j].activity.id == $scope.activityList[i].id && $scope.activityList[i].isselect != true) {
                        $scope.activityList[i].isselect = true;
                    }
                }
            }
        }
    }
    // @author Jayshri Kolase Dec - 12 - 2023
    // @param Check Document
    // @comments Check Documents If existing stage selected
    $scope.isdocumentBeforeCheck = function () {
        if ($scope.suggestionDet.document != null && $scope.suggestionDet.document.length > 0) {
            for (let i = 0; i < $scope.documentLists.length; i++) {
                for (let j = 0; j < $scope.suggestionDet.document.length; j++) {
                    if ($scope.documentLists[i].id == $scope.suggestionDet.document[j].document.id && $scope.documentLists[i].isChecked != true) {
                        $scope.documentLists[i].isChecked = true;
                    }
                }
            }
        }
    }
    // @author Jayshri Kolase Dec - 12 - 2023
    // @param check Implementation Verify Details
    // @comments check Implementation Verify Details
    $scope.flagCheckVerify = false;
    $scope.flagCheckReassign = false;
    $scope.flagVerifySpinner = false;
    $scope.flagReassignSpinner = false;
    $scope.checkImplVerify = function (action) {
        if (action == 1) {
            $scope.flagVerifySpinner = true;
            $scope.flagReassignSpinner = false;
            $scope.flagCheckVerify = true;
            $scope.flagCheckReassign = false;
            $scope.suggestionDet.implReassignCmd = "";
        }
        if (action == 2) {
            $scope.flagReassignSpinner = true;
            $scope.flagVerifySpinner = false;
            $scope.flagCheckReassign = true;
            $scope.flagCheckVerify = false;
            $scope.suggestionDet.flagCheckVerify = "";
        }
        $scope.suggestionDet.isImplAction = action;
    }
    /* Author - Jayshri 
    Date - 22/12/2023
    Function - Implementation Verification Details
    return - Implementation Verification Details
    */
    $scope.verificationImplSubmission = function (action) {
        $scope.implVerifyMsg = "";
        $scope.subSummary = "";
        if (action == 1) {
            $scope.implVerifyMsg = "Implementation Verification Successfully.";
            $scope.subSummary = $scope.suggestionDet.implVerifyCmd;
        }
        else if (action == 2) {
            if ($scope.suggestionDet.implReassignCmd == undefined || $scope.suggestionDet.implReassignCmd == "") {
                snackbar.create($filter('translate')('Please_enter_comment'), 5000, "error");
                return;
            }
            else {
                if (alies == "gmr") {
                    $scope.implVerifyMsg = "Idea reassigned to implementer for modification.";
                }
                else {
                    $scope.implVerifyMsg = "Suggestion reassigned to implementer for modification.";
                }
                $scope.subSummary = $scope.suggestionDet.implReassignCmd;
            }
        }
        $scope.data = {
            "sugId": $scope.selectedSuggId,
            "statusId": $scope.CONST.STATUS.AssignedForImplVerification.statusId,
            "actionType": action,
            "updatedBy": parseInt($scope.loggedInEmpId),
            "createdBy": parseInt($scope.loggedInEmpId),
            "comment": $scope.subSummary,
            "branchId": $scope.suggestionDet.branch.branchId,
            "implementedbyId": $scope.suggestionDet.sugesstionStatusAudit[$scope.suggestionDet.sugesstionStatusAudit.length - 2].emp_details.empId
        }
        appService.httpPost($scope.data, "verificationImplSubmission")
            .then(function (response) {
                $scope.flagVerifySpinner = false;
                $scope.flagReassignSpinner = false;
                if (response.result == true) {
                    snackbar.create($filter('translate')($scope.implVerifyMsg), 4000, "success");
                    $scope.getsuggestionList('onLoad');
                    $scope.getsuggestionList("");
                    $scope.getStatusWiseCount();
                } else {
                    snackbar.create($filter('translate')('Error_occured_Please_try_again'), 5000, "error");
                }
            });
    }
    /* Author - Jayshri Kolase
    Date - 22/12/2023
    Function - Get Suggestion Theme
    return - Get Suggestion Theme
    */
    $scope.themeList = [];
    $scope.getSuggTheme = function () {
        const req = {
            "branchId": $rootScope.empDetails.branch.branchId,
            "isActive": "Y"
        }
        appService.httpPost(req, "getSuggTheme")
            .then(function (response) {
                if (response.result) {
                    if (response.data != null && response.data.length > 0) {
                        $scope.themeList = response.data;
                    }
                    else {
                        $scope.themeList = [];
                    }
                }
                else {
                    $scope.themeList = [];
                }
            });
    }
    $scope.getSuggTheme();
    /* Author - Jayshri Kolase
    Date - 22/12/2023
    Function - Get Suggestion Theme
    return - Get Suggestion Theme
    */
    $scope.isSuggestionHDEvaluatoer = false;
    $scope.isSuggestionHDTopHdKaizen = false;
    $scope.isSuggestionHDConcfigData = false;
    $scope.getHDSuggestionConfigList = function (branchId) {
        appService.httpGet("getSuggestionConfigList/" + $rootScope.empDetails.organization.orgId + "/" + branchId)
            .then(function (response) {
                //console.log("------------HD Configuration List----------------");
                if (response.result == true) {
                    consoleLog(response.suggConfigList);
                    $scope.suggestionConfig = response.suggConfigList;
                    var hdObjOptions = $scope.getSuggestionConfigIds($scope.masterConfigObj.plantEvalType.id);
                    var hdObjLevel = $scope.getSuggestionConfigIds($scope.masterConfigObj.createHDSugg.id);
                    $scope.hdConfigData.hdLevel = hdObjOptions.configValue;
                    $scope.hdConfigData.hdOptions = hdObjLevel.configValue;
                    //console.log("HD COnfig Data" + $scope.hdConfigData)
                    for (let i = 0; i < $scope.suggestionConfig.length; i++) {
                        if ($scope.suggestionConfig[i].configMaster.configCaption == "ByEvaluator/ImplementerKaizenHD") {
                            if ($scope.suggestionConfig[i].configValue == 'Y') {
                                $scope.isSuggestionHDEvaluatoer = true;
                            }
                            else {
                                $scope.isSuggestionHDEvaluatoer = false;
                            }
                        }
                        if ($scope.suggestionConfig[i].configMaster.configCaption == "TopHdKaizen") {
                            if ($scope.suggestionConfig[i].configValue == 'Y') {
                                $scope.isSuggestionHDTopHdKaizen = true;
                            }
                            else {
                                $scope.isSuggestionHDTopHdKaizen = false;
                            }
                        }
                        if ($scope.suggestionConfig[i].configValue == "OPT_FOR_OTH_PLANTS") {
                            $scope.isSuggestionHDConcfigData = true;
                        }
                    }
                    // $scope.hdConfigData.otherPlantEvalLevel = hdObjPlantEvalLevel.configValue;
                    $scope.addUpdateConfigRequest = [];
                    //console.log($scope.isSuggestionHDEvaluatoer);
                    //console.log($scope.isSuggestionHDTopHdKaizen);
                    //console.log($scope.isSuggestionHDConcfigData);
                } else {
                    $scope.suggestionConfig = [];
                    $scope.hdConfigData = {}
                }
            });
    }
    $scope.getSuggestionConfigIds = function (masterId) {
        var obj = -1;
        for (var i = 0; i < $scope.suggestionConfig.length; i++) {
            if ($scope.suggestionConfig[i].configMaster.id == masterId) {
                obj = $scope.suggestionConfig[i];
                break;
            }
        }
        return obj;
    }
    $scope.setSelectedCtaegory = function (data) {
        //console.log(data);
        $scope.suggestionDet.selectedCatName = data.categoryName;
        $scope.suggestionDet.selectedEvalCatId = data.catId;
    }
    /* Author - Jayshri Kolase
    Date - 14/02/2024
    Function - Get Department List on logged in user branch
    return - Get Department List on logged in user branch
    */
    $scope.getDeptList = function () {
        appService.httpGet("getdepartmentlistbybranchid/" + $scope.loggedInUserBranchId)
            .then(function (response) {
                //console.log("----------------Departments List API Response----------------");
                if (response.result) {
                    $scope.selectDeptIdsList = [];
                    if (response.deptList != null && response.deptList.length > 0) {
                        $scope.deptList = response.deptList;
                        if ($scope.deptList != null && $scope.deptList.length > 0) {
                            for (let i = 0; i < $scope.deptList.length; i++) {
                                $scope.deptList[i].isSelected = false;
                            }
                            $scope.selectAllDeptJurry = false;
                            for (var j = 0; j < $scope.deptList.length; j++) {
                                if ($scope.deptList[j].isSelected) {
                                    $scope.selectDeptIdsList.push($scope.deptList[j].deptId);
                                }
                            }
                        }
                        $scope.setNomination();
                    } else {
                        $scope.deptList = [];
                        $scope.selectDeptIdsList = [];
                    }
                } else {
                    $scope.deptList = [];
                    $scope.selectDeptIdsList = [];
                }
            });
    }
    $scope.selectDeptIdsList = [];
    /* Author - Jayshri Kolase
    Date - 14/02/2024
    Function - set selected department for Jurry
    return - set selected department for Jurry
    */
    $scope.setDeptJurrySelected = function (dept) {
        $scope.selectDeptIdsList = [];
        dept.isSelected = (dept.isSelected) ? false : true;
        for (var i = 0; i < $scope.deptList.length; i++) {
            if (!$scope.deptList.isSelected) {
                $scope.selectAllDeptJurry = false;
            }
        }
        var deptListSelectedCount = $filter('filter')($scope.deptList, { isSelected: true }, true).length;
        $scope.selectAllDeptJurry = ($scope.deptList.length == deptListSelectedCount);
        for (var i = 0; i < $scope.deptList.length; i++) {
            if ($scope.deptList[i].isSelected) {
                $scope.selectDeptIdsList.push($scope.deptList[i].deptId);
            }
        }
        $scope.setNomination();
        //console.log($scope.selectDeptIdsList);
        if ($scope.selectAllDeptJurry) {
            $scope.deptJurryToggle();
        }
    }
    /* Author - Jayshri Kolase
    Date - 14/02/2024
    Function - toggle department dropdown
    return - toggle department dropdown
    */
    $scope.deptJurryToggle = function () {
        $('.deptJurryWrapper .deptList')
            .slideToggle('fast');
    }
    /* Author - Jayshri Kolase
    Date - 14/02/2024
    Function - select or deselect all department
    return - select or deselect all department
    */
    $scope.selectFilterAllDeptJurry = function () {
        $scope.selectDeptIdsList = [];
        var flag = ($scope.selectAllDeptJurry) ? false : true;
        //console.log(flag);
        $scope.selectAllDeptJurry = flag;
        for (var i = 0; i < $scope.deptList.length; i++) {
            $scope.deptList[i].isSelected = $scope.selectAllDeptJurry;
        }
        for (var i = 0; i < $scope.deptList.length; i++) {
            if ($scope.deptList[i].isSelected) {
                $scope.selectDeptIdsList.push($scope.deptList[i].deptId);
            }
        }
        $scope.setNomination();
        if ($scope.selectAllDeptJurry) {
            $scope.deptJurryToggle();
        }
    }
    /* Author - Jayshri Kolase
    Date - 14/02/2024
    Function - toggle department dropdown
    return - toggle department dropdown
    */
    $scope.toggleDeptJurryDiv = function (event) {
        var $trigger = $(".deptJurryWrapper");
        if ($trigger !== event.target && !$trigger.has(event.target)
            .length) {
            $(".deptList").slideUp("fast");
        }
    }
    /* Author - Jayshri Kolase
        Date - 14/02/2024
        Function - Change Nomination list on month change
        return - Change Nomination list on month change
        */
    $scope.setDeptNomination = function () {
        if ($scope.deptList != null && $scope.deptList.length > 0) {
            for (let i = 0; i < $scope.deptList.length; i++) {
                $scope.deptList[i].isSelected = false;
            }
            $scope.selectAllDeptJurry = false;
            for (var j = 0; j < $scope.deptList.length; j++) {
                if ($scope.deptList[j].isSelected) {
                    $scope.selectDeptIdsList.push($scope.deptList[j].deptId);
                }
            }
        }
        $scope.setNomination();
    }
    $scope.performAction = function (action) {
        $scope.showCommentButon = true
        if (action == 'reject') {
            $scope.showComment = true;
        } else if (action == 'verify') {
            $scope.showComment = false;
        }
    };
    $scope.rejectSectionImpl = function (data) {
        //console.log(data);
        if ($scope.suggestionInputDetails.fcvarifycomment == null || $scope.suggestionInputDetails.fcvarifycomment == undefined) {
            snackbar.create($filter('translate')('Please_Enter_Comment'), 4000, "error");
            return;
        }
        var req = {
            "sugId": $scope.suggestionDet.sugId,
            "statusId": data.status_master.statusId,
            "summary": $scope.suggestionInputDetails.fcvarifycomment,
        }
        //console.log(req);
        appService.httpPost(req, "finVerificationImplReassign")
            .then(function (response) {
                if (response.result) {
                    $scope.getsuggestionList("");
                    $scope.getStatusWiseCount();
                    snackbar.create($filter('translate')('Suggestion successfully reassign to implementer'), 4000, "success");
                }
                else {
                    snackbar.create($filter('translate')('Error_occured_Please_try_again'), 5000, "error");
                }
            });
    }
    $scope.updateCFM = function (data) {
        if (data) {
            $scope.cfmValue = 'Y';
        } else {
            $scope.cfmValue = 'N';
        }
    }
    $scope.approveCFM = function (data) {
        if (data) {
            $scope.cfmApprove = 'Y';
        } else {
            $scope.cfmApprove = 'N';
        }
    }
    // <!-- /* Author - Jayshri Kolase Purpose - Logged in employee name should not display in on behalf employee.*/ -->
    $scope.excludeCurrentEmployee = function (item) {
        return item.empId !== $scope.empDetails.empId;
    };
    $scope.checkMaxLengthForTextarea = function (field, maxLength) {
        if (field.length > 1000 && maxLength == 'Present_Problem_laterl') {
            $scope.laterlEntery.problemAnalysis = $scope.laterlEntery.problemAnalysis.substring(0, 1000);
            $scope.currentlateralform.createInitiatorLateralEntryForm.sugession.$setValidity('maxlength', true);
        }
        if (field.length > 1000 && maxLength == 'Suggestion_lateral') {
            $scope.laterlEntery.sugession = $scope.laterlEntery.sugession.substring(0, 1000);
            $scope.currentlateralform.createInitiatorLateralEntryForm.sugession.$setValidity('maxlength', true);
        }
        if (field.length > 1000 && maxLength == 'Present_Problem') {
            $scope.newSug.problemAnalysis = $scope.newSug.problemAnalysis.substring(0, 1000);
            $scope.form.createnewSuggForm.sugession.$setValidity('maxlength', true);
        } else {
            if (field.length > 1000 && maxLength == 'Suggestion') {
                $scope.newSug.sugession = $scope.newSug.sugession.substring(0, 1000);
                $scope.form.createnewSuggForm.sugession.$setValidity('maxlength', true);
            }
        }
    };
    $scope.checkMaxLength = function (caption) {
        if (caption == "suggestionTitleLaterl") {
            if ($scope.laterlEntery.suggestionTitle.length > 255) {
                $scope.laterlEntery.suggestionTitle = $scope.laterlEntery.suggestionTitle.substring(0, 255);
                $scope.currentlateralform.createInitiatorLateralEntryForm.suggestionTitle.$setValidity('maxlength', true);
            }
            else {
                $scope.currentlateralform.createInitiatorLateralEntryForm.suggestionTitle.$setValidity('maxlength', true);
            }
        }
        if (caption == 'suggeston_title') {
            if ($scope.newSug.suggestionTitle.length > 255) {
                $scope.newSug.suggestionTitle = $scope.newSug.suggestionTitle.substring(0, 255);
                $scope.form.createnewSuggForm.suggestionTitle.$setValidity('maxlength', true);
            } else {
                $scope.form.createnewSuggForm.suggestionTitle.$setValidity('maxlength', true);
            }
        }
    };
    $scope.spokenText = '';  // Final concatenated text
    $scope.interimText = ''; // Real-time interim text
    $scope.langInput = {};
    $scope.isRecognizing = {};
    $scope.langList = [
        { id: 'en-IN', name: 'English' },
        { id: 'mr-IN', name: 'Marathi' },
        { id: 'hi-IN', name: 'Hindi' },
        { id: 'gu-IN', name: 'Gujarati' },
        { id: 'kn-IN', name: 'Kannada' },
        { id: 'ta-IN', name: 'Tamil' },
        { id: 'ja-JP', name: 'Japanese' }
    ]
    $scope.langInput.langId = $scope.langList[0].id;
    // Check if browser supports the Web Speech API
    var recognition = null;
    if ('webkitSpeechRecognition' in window) {
        recognition = new webkitSpeechRecognition();
    } else if ('SpeechRecognition' in window) {
        recognition = new SpeechRecognition();
    }
    if (!('webkitSpeechRecognition' in window)) {
        alert('Sorry, your browser does not support speech recognition.');
    } else {
        recognition = new webkitSpeechRecognition();
        recognition.continuous = true; // Keep recognizing even after the user pauses
        recognition.interimResults = true; // Show interim results while speaking
        // recognition.lang = 'en-IN';
        // Event when speech is recognized
        recognition.onresult = function (event) {
            console.log($scope.newSug[$scope.langInput.inputField]);
            if (!$scope.newSug[$scope.langInput.inputField] || $scope.newSug[$scope.langInput.inputField].trim().length == 0) {
                $scope.newSug[$scope.langInput.inputField] = '';
            }
            var interim_transcript = ''; // To display instant speech
            var final_transcript = '';   // To store the finalized speech
            // Loop through the results
            for (var i = event.resultIndex; i < event.results.length; ++i) {
                if (event.results[i].isFinal) {
                    if ($scope.newSug[$scope.langInput.inputField].length + event.results[i][0].transcript.length <= $scope.langInput.maxChars) {
                        final_transcript += event.results[i][0].transcript + ' ';
                    } else {
                        recognition.stop(); // Stop recognition when limit is reached
                        // alert('Character limit reached!');
                        break;
                    }
                    // Concatenate final results
                    // final_transcript += event.results[i][0].transcript + ' ';
                } else {
                    // Display interim results instantly
                    interim_transcript += event.results[i][0].transcript;
                }
            }
            // Set real-time display for interim results
            $scope.interimText = interim_transcript;
            // Append only the finalized sentences to spokenText
            $scope.newSug[$scope.langInput.inputField] += final_transcript;
            $scope.$apply(); // Ensure AngularJS updates the view
        };
        recognition.onerror = function (event) {
            console.log("Speech recognition error: ", event.error);
        };
        recognition.onend = function () {
            console.log("Speech recognition ended.");
        };
    }
    // Function to start speech recognition
    $scope.startRecognition = function () {
        if (recognition) {
            recognition.lang = ($scope.langInput.langId) ? $scope.langInput.langId : 'en-IN';
            // $scope.langInput.isRecognizing = true;
            $scope.isRecognizing = [];
            $scope.isRecognizing[$scope.langInput.inputField] = true;
            recognition.start();
        }
    };
    // Function to stop speech recognition
    $scope.stopRecognition = function () {
        if (recognition) {
            // $scope.langInput.isRecognizing = false;
            $scope.isRecognizing = [];
            $scope.isRecognizing[$scope.langInput.inputField] = false;
            recognition.stop();
        }
    };
    $scope.startRecording = function (inputType, maxChars) {
        $scope.langInput.inputField = (inputType) ? inputType : '';
        $scope.langInput.maxChars = maxChars;
        if (localStorage.getItem('recognitionObj')) {
            let tmpData = JSON.parse(localStorage.getItem('recognitionObj'));
            if (!$scope.isEmpty(tmpData) && tmpData.empId === $rootScope.empDetails.empId) {
                $scope.langInput.langId = tmpData.langId;
                $scope.startRecognition();
            }
        } else {
            $("#langRecognitionPopup").modal({
                backdrop: 'static',
                keyboard: false
            });
        }
    }
    $scope.updateRecognitionLanguage = function () {
        let tmpObj = { empId: $rootScope.empDetails.empId, langId: $scope.langInput.langId };
        localStorage.setItem('recognitionObj', JSON.stringify(tmpObj));
        $("#langRecognitionPopup").modal('hide');
        $scope.startRecognition();
    }
    $scope.isPillarConfigFlag = false;
    $scope.checkForPillarSugg = function () {
        appService.httpGet("checkForPillarSugg/" + $rootScope.empDetails.organization.orgId)
            .then(function (response) {
                if (response.result) {
                    if (response.pillarConfig) {
                        $scope.isPillarConfigFlag = true;
                    }
                    else {
                        $scope.isPillarConfigFlag = false;
                    }
                }
            });
    }
}]);


app.constant('CONST_RESOURCES', (function () {
    // Use the variable in your constants

    var today = new Date();
    var dd = '';
    if (today.getDay() != 0) {
        //console.log("if condition " + today.getDate());
        dd = today.getDate() + 1;
    } else {
        //console.log("else condition " + today.getDate());
        dd = today.getDate() + 1;
    }
    var mm = today.getMonth() + 1; //January is 0!

    var yyyy = today.getFullYear();
    if (dd < 10) {
        dd = '0' + dd;
    }
    if (mm < 10) {
        mm = '0' + mm;
    }

    var toDate = yyyy + '-' + mm + '-' + dd;

    var today = new Date();
    var dd = '';
    if (today.getDay() != 0) {
        dd = today.getDate();
    } else {
        dd = today.getDate();
    }
    var mm = today.getMonth(); //January is 0!

    var yyyy = today.getFullYear();
    if (dd < 10) {
        dd = '0' + dd;
    }
    if (mm < 10) {
        mm = '0' + mm;
    }
    var fromDate = yyyy + '-' + mm + '-' + dd;

    return {
        DEFAULT_DATE: {
            from: fromDate,
            to: toDate
        },
        TEAM_TYPE: {
            HR: "HR",
            EVALUATION: 1,
            IMPLEMENTATION: 2,
            ANALYSIS: 3,
            EVALFC: 4, //while assign first time to fc
            IMPLFC: 5, // Not Using Any where
            APPROVEDBYFC: 6 //when approved by fc,
        },
        STATUS: {
            CREATED: {
                id: 1,
                status: "Created",
                label: "New"
            },
            HR_REJECTS: {
                id: 3,
                status: "HRRejects",
                label: "Suggestion Declined"
            },
            HR_ACCEPTS: {
                id: 4,
                status: "HRAccepts",
                label: "Suggestion Accepted",
                labels: ["Suggestion Accepted by Supervisor",
                    "Suggestion Accepted by Head of Department",
                    "Suggestion Accepted by Plant Head"
                ],
                labelSuppText: "Suggestion Accepted By"
            },
            EVALUATION_ASSIGNED: {
                id: 5,
                status: "EvaluationAssigned",
                label: "Suggestion Assigned For Evaluation"
            },
            EVALUATION_ACCEPTED: {
                id: 7,
                status: "EvaluationRequestAccepted",
                label: "Suggestion Accepted By Evaluation Team"
            },
            EVALUATION_REJECTED: {
                id: 8,
                status: "EvaluationRequestRejected",
                label: "Rejected by Evaluation Team"
            },
            EVALUATION_INPUT_SUBMITTED: {
                id: 9,
                status: "EvaluationInputSubmitted",
                label: "Inputs Submitted"
            },
            IMPLEMENTATION_RECOMMENDED: {
                id: 11,
                status: "ImplementationRecommended",
                label: "Recommended For Implementation"
            },
            IMPLEMENTATION_NOT_RECOMMENDED: {
                id: 12,
                status: "ImplementationNotRecommended",
                label: "Rejected By Evaluation Team"
            },
            IMPLEMENTATION_ASSIGNED: {
                id: 14,
                status: "ImplementationAssigned",
                label: "Assinged for Implementation"
            },
            IMPLEMENTATION_REQUEST_ACCEPTED: {
                id: 15,
                status: "ImplementationRequestAccepted",
                label: "Implementation Request Accepted"
            },
            IMPLEMENTATION_REQUEST_REJECTED: {
                id: 16,
                status: "ImplementationRequestRejected",
                label: "Implementation Request Rejected"
            },
            IMPLEMENTATION_INPUT_SUBMITTED: {
                id: 17,
                status: "ImplementationInputSubmitted",
                label: "Implementation Input Submitted"
            },
            IMPLEMENTED: {
                id: 19,
                status: "Implemented",
                label: "Suggestion Implemented"
            },
            CANCELLED: {
                id: 20,
                status: "Cancelled",
                label: "Cancelled"
            },
            IMPLEMENTATION_ON_HOLD: {
                id: 21,
                status: "ImplementationOnHold",
                label: "Implementation On Hold"
            },
            CLOSED: {
                id: 22,
                status: "closed",
                label: "Suggestion closed"
            },
            EVALUATION_RECOMMENDED: {
                id: 23,
                status: "EvaluationRecommended",
                label: "Implementation Recommended"
            },
            EVALUATION_NOT_RECOMMENDED: {
                id: 24,
                status: "EvaluationNotRecommended",
                label: "Rejected By Evaluation Team"
            },
            EVALUATION_REQUEST_DECLINED: {
                id: 25,
                status: "EvaluationRequestDecline",
                label: "Suggestion Declined By Evaluation Team"
            },
            IMPLEMENTATION_REQUEST_DECLINED: {
                id: 26,
                status: "ImplementationRequestDeclined",
                label: "Suggestion Declined by Implementation Team"
            },
            SUGGESTION_ASSIGNED: {
                id: 27,
                status: "SuggestionAssigned",
                labels: ["Suggestion Assinged For Scrutinization",
                    "Suggestion Assinged For Scrutinization",
                    "Suggestion Assinged For Scrutinization"
                ],
                labelSuppText: "Suggestion Assinged For",
                label: "Suggestion Assinged For Scrutinization"
            },
            SUGGESTION_DECLINED: {
                id: 28,
                status: "SuggestionDeclined",
                label: "Suggestion Rejected By Scrutinizer",
                labels: ["Suggestion Rejected by Supervisor",
                    "Suggestion Rejected by Head of Department",
                    "Suggestion Rejected by Plant Head"
                ],
                labelSuppText: "Suggestion Rejected By"
            },
            SUGGESTION_DECLINED_BY_HEAD: {
                id: 29,
                status: "SuggestionDeclinedByHead",
                label: "Suggestion is closed by top level management"
            },
            ASSIGNED_FOR_EDIT: {
                id: 30,
                status: "AssignedForEdit",
                label: "Suggestion is assigned to originator"
            },
            EDITED_BY_CREATOR: {
                id: 31,
                status: "EditedByCreator",
                label: "Edited By Creator"
            },
            ASSIGNED_TO_EXECUTIVE: {
                id: 32,
                status: "AssignedToExecutive",
                label: "Assigned To Executive"
            },
            ACCEPTED_BY_EXECUTIVE: {
                id: 33,
                status: "AcceptedByExecutive",
                label: "Accepted By Executive"
            },
            REJECTED_BY_EXECUTIVE: {
                id: 34,
                status: "RejectedByExecutive",
                label: "Rejected By Executive"
            },
            SUGGESTION_ASSIGNED_BY_EXECUTIVE: {
                id: 35,
                status: "SuggestionAssignedByExecutive",
                label: "Assigned By Executive"
            },
            ASSIGNED_CONCERN_TO_MGMT: {
                id: 36,
                status: "Assigned Concern",
                label: "Assigned Concern To Management"
            },
            ASSIGNED_CONCERN_TO_CONTROLLER: {
                id: 37,
                status: "AssignedConcernToController",
                label: "Assinged Suggestion/Concern For Further Action"
            },
            CLOSED_CONCERN: {
                id: 38,
                status: "ConcernClosed",
                label: "Concern Closed"
            }
        },
        ROLES: {
            GREENTIN_SUPERADMIN: 1,
            SUPERADMIN: 2,
            ROLE_ADMIN: 3,
            EMPLOYEE: 4,
            EXECUTIVE: 5,
            CONTROLLER: 6,
            CONTROLLERLEVELUP: 7,
            EVALUATOR: 8,
            IMPLEMENTER: 9,
            FINANCE_CONTROLLER: 10,
            ORG_EXECUTIVE: 11,
            CELL_LEADER: 12,
            STAFF_PERSON: 13,
            PLANT_PERSON: 14,
            AUDITOR: 15,
            FINANCE_APPROVAL: 22,
            DOCUMENT_OWNER: 23

        },
        COUNT_FILTERS: {
            PENDING: 1,
            MY_SUGG: 2,
            ALL_SUGG: 4
        },
        CONCERN_COUNT_FILTERS: {
            PENDING: 1,
            OPEN_CONCERN: 4,
            CLOSED_CONCERN: 5,
            MY_CONCERN: 3,
            ALL_CONCERN: 2
        },
        HELP_TEXT: {
            PENDING_ACTION: {
                TITLE: "My Pending Action",
                IS_SINGLE_TEXT: true,
                TEXT: "List of all suggestions which user needs to act upon."
            },
            MY_SUGGESTION: {
                TITLE: "My Suggestions",
                IS_SINGLE_TEXT: true,
                TEXT: "All suggestions which user have worked upon including his/her own posted suggestions."
            },
            ALL_SUGGESTION: {
                TITLE: "All Suggestions",
                IS_SINGLE_TEXT: true,
                TEXT: "List of all suggestions for all departments within branch."
            },
            DASHBOARD: {
                TOTAL_USERS: {
                    TITLE: "Total Users",
                    IS_SINGLE_TEXT: true,
                    TEXT: "Number of employees/users added through myeNovation portal."
                },
                ACTIVE_USERS: {
                    TITLE: "Active Users",
                    IS_SINGLE_TEXT: true,
                    TEXT: "Users who have verified account and logged in at least once."
                },
                PARTICIPATION_INDEX: {
                    TITLE: "Participation Index",
                    IS_SINGLE_TEXT: true,
                    TEXT: "Number of unique users who have posted suggestions."
                },
                TOTAL_SUGG: {
                    TITLE: "Total Suggestions",
                    IS_SINGLE_TEXT: true,
                    TEXT: "Total number of suggestions submitted within branch."
                },
                IMPLTED_SUGG: {
                    TITLE: "Implemented Suggestions",
                    IS_SINGLE_TEXT: true,
                    TEXT: "Total number of suggestions implemented within branch."
                },
                TOTAL_CONCERNS: {
                    TITLE: "Total Concerns",
                    IS_SINGLE_TEXT: true,
                    TEXT: "Total number of concerns within selected period."
                },
                CLOSED_CONCERNS: {
                    TITLE: "Closed Concerns",
                    IS_SINGLE_TEXT: true,
                    TEXT: "All closed concerns within selected period."
                },
                OPEN_CONCERNS: {
                    TITLE: "Closed Concerns",
                    IS_SINGLE_TEXT: true,
                    TEXT: "All open concerns within selected period."
                },
                COST_SAVING: {
                    TITLE: "Cost Saving",
                    IS_SINGLE_TEXT: true,
                    TEXT: "Annual cost saving by implementing suggestions."
                },
                IMPL_COST: {
                    TITLE: "Implementation Cost",
                    IS_SINGLE_TEXT: true,
                    TEXT: "Amount spent for implementing suggestions."
                }
            },
            CONCERN: {
                PENDING_ACTION: {
                    TITLE: "My Pending Actions",
                    IS_SINGLE_TEXT: true,
                    TEXT: "Concern(s) which need to act upon"
                },
                OPEN_CONCERN: {
                    TITLE: "Open Concerns",
                    IS_SINGLE_TEXT: true,
                    TEXT: "All concerns which user has assigned for an action and are still open."
                },
                CLOSED_CONCERN: {
                    TITLE: "Closed Concerns",
                    IS_SINGLE_TEXT: true,
                    TEXT: "All concerns which user has assigned for an action and are closed."
                },
                MY_CONCERN: {
                    TITLE: "My Concerns",
                    IS_SINGLE_TEXT: true,
                    TEXT: "Concern(s) raised by user."
                },
                ALL_CONCERN: {
                    TITLE: "All Concerns",
                    IS_SINGLE_TEXT: true,
                    TEXT: "Total number of concerns raised so far."
                }
            },
            AUDITOR: {
                PENDING_ACTION: {
                    TITLE: "My Pending Actions",
                    IS_SINGLE_TEXT: true,
                    TEXT: "List of all template which user needs to act upon."
                },
                MY_AUDIT: {
                    TITLE: "My Audits",
                    IS_SINGLE_TEXT: true,
                    TEXT: "All in progress inspections/audits."
                },
                TEMPLATES: {
                    TITLE: "My Templates",
                    IS_SINGLE_TEXT: true,
                    TEXT: "Provision to create & publish templates."
                }
            }
        },
        CONST_HELP: {
            HOME_SCREEN: {
                Suggestion_Tab: "This tab includes sub tab like My Pending Actions,My Suggestion & All Suggestions",
                My_Pending_Action_Tab: "This tab displays all suggestions on which user need to take some action",
                My_Suggestions_Tab: "This tab helps user to track progress of all suggestions he created or worked upon.",
                All_Suggestions: "This tab displays all suggestion which was created or taken action",
                Dashboard_Tab: "	This tab displays all suggestion information in form of graphs",
                Reports: "This tab displays all suggestion information in form reports",
                Winners_Board: "This tab displays all Winners the winner may be Employee Of the Month,Department Of the Month etc.",
                HD_Monitoring: "This tab displays all HD Suggestion details ",
                Reddem_Points: "This tab will help user to use there point for purchasing something",
                Guest_Suggestion: "This tab will displays that suggestion which was created by Guest user who has not authority to give suggestion",
                Customer_Feedback: "This tab will displays the user who had visited the website who had given the valuable feedback on it",
                Knowledge_Bank: "This tab will displays that suggestion which we want to have same suggestion in another branch",
                Lateral_Suggestion: "This tab will displays that suggestion which we had create or implement in parralely or latterly",
                Create_Sugg_Button: "It will displays the create suggestion screen to create a suugestion to the users",
                Points: "This will display points when user create a suggestion or take actions on it",
                Export_Excel: "This will export suggestion on basis of which tab selected if user select My Pending Actions tab then all My Pending Actions Suggestion will display in that Excel same for My Suggestion Tab & All Suggestion Tab",
                Clear_Filter_Search_Button: "This button allows user to clear to clear or remove the Filter which we had selected Apply Filter Button This will help user to show the limited suggestion as per he need",
                Add_On_Search: "This will help user to search by parameters like Suggestion Id,My Created Suggestion,Employee Id & Employee Name",
                Search_Field: "This will help user to search the Selected Suggestion"
            },
            CREATE_SUGGESTION: {
                On_Behalf_Suggestion: "If user has not access then on clicking on it the another user will create a suggestion for that user",
                Self_Implement: "The user who had created the suggestion has provision to implement the suggestion by clicking on it"
            },
            CONTROLLER_SCREEN: {
                Accept_Assign: "This button will accept a suggestion from controller & assign it to the Evaluator",
                Reject_Button: "This button will help controller to reject a suggestion which was created",
                Reassign_to_Initiator: "This button will helps controller to reassign a suggestion to the user which has created a suggestion",
                Pass_to_Peer: "This button will give a controller provision to pass a suggestion to another controller",
                Check_Duplication: "This button will displays all suggestions which were same which was created by user or some fieldare same then it will display that suggestion"
            },
            EVALUATOR_SCREEN: {
                Change_Document: "This tab will help Evaluator if he want to add document to more clarify the Suggestion",
                Kaizen_Activity: "This tab will display all TPM's activity which are 8 type of it",
                Saving_Type: "This tab will describe that the suggestion which was provided from that what we are saving Cost or Time ",
                Particulars: "This tab will display all Particulars. ",
                Horizontal_Deployment: "This tab will give provision to  Evaluator to select that departments to which suggestion should implement",
                Analysis_Summary: "Evaluator should provide a detailed Summary of Suggestion",
                Override_Initiator_Category: "Evaluator should override the Category which was selected by the Iniator",
                Budgetary_Cost: "Should provide the Budgetary cost by the Evaluator",
                SAP_Code: "Evaluator should able to enter SAP code",
                Reject_Button: "Finance Controller has provision to Reject the cost which was entered by the Evaluator",
                Assign_For_Implementation_Button: "This button will assign a suggestion to Implementer to implement it",
                Eval_Reject_Button: "This button will help Evaluator to reject the suggestion"
            },
            IMPLEMENTER_SCREEN: {
                Implementation_Action: "Should provide the information about what implementer had taken action to solve the issue",
                Approximate_Implementation_Cost: "Enter the cost which was required to implement the suggestion",
                Annual_Savings: "Enter that cost which we had save while implementing a suggestion",
                Implemented_Tab: "This tab allows implementer to implement the suggestion",
                On_Hold_Tab: "This tab helps implementer to keep the suggestion On Hold",
                Reject_Tab: "This tab will allow implementer to reject the suggestion",
            }
        }
    }
})());


app.filter('shortName', function () {
    return function (x) {
        var shortName = "",
            nameTokens = [];
        x = x.trim();
        nameTokens = x.split(" ");
        nameTokens.forEach(function (token) {
            shortName += (token[0]) ? token[0] : ''
        });
        return shortName;
    };
});

app.filter('replaceVal', function () {
    return function (input) {
        if (input == null || input == "") {
            input = input.replace('null', '');
        }
        return input;
    }
});

app.filter('filterUnderEval', function () {
    return function (items, statusIds) {
        var filtered = [];
        angular.forEach(items, function (item) {
            if (statusIds.includes(item.status_master.statusId)) {
                filtered.push(item);
            }
        });
        return filtered;
    };
});

app.directive('showtab',
    function () {
        return {
            link: function (scope, element, attrs) {
                element.click(function (e) {
                    e.preventDefault();
                    $(element)
                        .tab('show');
                });
            }
        };
    }
);

app.directive("repeatEnd", function () {
    return {
        restrict: "A",
        link: function (scope, element, attrs) {
            if (scope.$last) {
                scope.$eval(attrs.repeatEnd);
            }
        }
    };
});

app.directive('bsTooltip', function () {
    return {
        restrict: 'A',
        link: function (scope, element, attrs) {
            $(element)
                .hover(function () {
                    // on mouseenter
                    $(element)
                        .tooltip('show');
                }, function () {
                    // on mouseleave
                    $(element)
                        .tooltip('hide');
                });
        }
    };
});

app.filter('ifEmpty', function () {
    return function (input, defaultValue) {
        if (angular.isUndefined(input) || input === null || input === '' || input === "null") {
            return defaultValue;
        }
        return input;
    }
});

app.directive('dScrollHorizontally', function () {
    return {
        restrict: 'A',
        link: function (scope, elem, attr) {
            scope.scrollToRight = function () {
                elem[0].scrollLeft += Number(attr.dScrollHorizontally);
            }

            scope.scrollToLeft = function () {
                elem[0].scrollLeft -= Number(attr.dScrollHorizontally);
            }

        }
    }
})
app.filter('startFrom', function () {
    return function (input, start) {
        if (input) {
            start = +start;
            return input.slice(start);
        }
        return [];
    };
});

app.filter('propsFilter', function () {
    return function (items, props) {
        var out = [];

        if (angular.isArray(items)) {
            var keys = Object.keys(props);

            items.forEach(function (item) {
                var itemMatches = false;

                for (var i = 0; i < keys.length; i++) {
                    var prop = keys[i];
                    var text = props[prop].toLowerCase();
                    if (item[prop].toString().toLowerCase().indexOf(text) !== -1) {
                        itemMatches = true;
                        break;
                    }
                }

                if (itemMatches) {
                    out.push(item);
                }
            });
        } else {
            // Let the output be the input untouched
            out = items;
        }

        return out;
    };
});

app.constant('FILTER_RESOURCES', (function () {
    return {
        PENDING: 1,
        UNDER_EVAL: 2,
        FINAL: 4
    };
})());

app.factory('sharedService', function ($rootScope) {
    var sharedService = {};
    sharedService.message = '';

    sharedService.prepForBroadcast = function (msg) {
        this.message = msg;
        this.broadcastItem();
    };

    sharedService.broadcastItem = function () {
        $rootScope.$broadcast('handleBroadcast');
    };

    return sharedService;
})
app.factory('SuggMasterData', function ($rootScope, $http, myeNovationConstant) {
    return {
        setEmpBrowniePoints: function () {
            var data = {
                "mu_k": $rootScope.empDetails.uinUserId,
                //"userId": $rootScope.empDetails.empId
            };
            $http({
                method: 'POST',
                data: data,
                // url: myeNovationConstant.current.resourceServer + 'getEmployeeDetailsById',
                url: appDomain + 'getEmployeeDetailsById',
                // url: appDomain + 'getEmployeeByEmpId/' + $rootScope.empDetails.empId,
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json',
                    'Authorization': $rootScope.empDetails.authToken
                },
                timeout: 180000 // request timeout is set to 60 seconds
            })
                .then(function (response) {
                    var res = response.data;
                    //console.log(res)
                    if (res.result) {
                        var profile = JSON.parse(localStorage.getItem('userDet'));
                        profile.points = res.empDetails.points;
                        localStorage.setItem("userDet", JSON.stringify(profile));
                        $rootScope.empDetails = JSON.parse(localStorage.getItem('userDet'));
                    } else {

                    }
                })
                .catch(function (error) {
                    error.data;
                });
        },
        getMandetoryField: function () {
            $http({
                method: 'GET',
                // url: myeNovationConstant.current.resourceServer + 'getProductOrgConfigData/' + $rootScope.empDetails.branch.branchId,
                url: appDomain + 'getProductOrgConfigData/' + $rootScope.empDetails.branch.branchId,
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json',
                    'Authorization': $rootScope.empDetails.authToken
                },
                timeout: 180000 // request timeout is set to 60 seconds
            })
                .then(function (response) {
                    //console.log(response);
                    var res = response.data;
                    if (res.result) {
                        var rec = res.productorglist[0];
                        var empDetails = JSON.parse(localStorage.getItem('userDet'));
                        empDetails.productOrgConfigDet = rec;
                        empDetails = JSON.stringify(empDetails);
                        localStorage.setItem('userDet', empDetails);
                        $rootScope.empDetails = JSON.parse(localStorage.getItem('userDet'));
                    } else {

                    }
                })
                .catch(function (error) {
                    error.data;
                });
        }
    }
});
app.constant('CONST_HELP', (function () {
    return {
        HOME_SCREEN: {
            Suggestion_Tab: "This tab includes sub tab like My Pending Actions,My Suggestion & All Suggestions",
            My_Pending_Action_Tab: "This tab displays all suggestions on which user need to take some action",
            My_Suggestions_Tab: "This tab helps user to track progress of all suggestions he created or worked upon.",
            All_Suggestions: "This tab displays all suggestion which was created or taken action",
            Dashboard_Tab: "	This tab displays all suggestion information in form of graphs",
            Reports: "This tab displays all suggestion information in form reports",
            Winners_Board: "This tab displays all Winners the winner may be Employee Of the Month,Department Of the Month etc.",
            HD_Monitoring: "This tab displays all HD Suggestion details ",
            Reddem_Points: "This tab will help user to use there point for purchasing something",
            Guest_Suggestion: "This tab will displays that suggestion which was created by Guest user who has not authority to give suggestion",
            Customer_Feedback: "This tab will displays the user who had visited the website who had given the valuable feedback on it",
            Knowledge_Bank: "This tab will displays that suggestion which we want to have same suggestion in another branch",
            Lateral_Suggestion: "This tab will displays that suggestion which we had create or implement in parralely or latterly",
            Create_Sugg_Button: "It will displays the create suggestion screen to create a suugestion to the users",
            Points: "This will display points when user create a suggestion or take actions on it",
            Export_Excel: "This will export suggestion on basis of which tab selected if user select My Pending Actions tab then all My Pending Actions Suggestion will display in that Excel same for My Suggestion Tab & All Suggestion Tab",
            Clear_Filter_Search_Button: "This button allows user to clear to clear or remove the Filter which we had selected Apply Filter Button This will help user to show the limited suggestion as per he need",
            Add_On_Search: "This will help user to search by parameters like Suggestion Id,My Created Suggestion,Employee Id & Employee Name",
            Search_Field: "This will help user to search the Selected Suggestion"
        },
        CREATE_SUGGESTION: {
            On_Behalf_Suggestion: "If user has not access then on clicking on it the another user will create a suggestion for that user",
            Self_Implement: "The user who had created the suggestion has provision to implement the suggestion by clicking on it"
        },
        CONTROLLER_SCREEN: {
            Accept_Assign: "This button will accept a suggestion from controller & assign it to the Evaluator",
            Reject_Button: "This button will help controller to reject a suggestion which was created",
            Reassign_to_Initiator: "This button will helps controller to reassign a suggestion to the user which has created a suggestion",
            Pass_to_Peer: "This button will give a controller provision to pass a suggestion to another controller",
            Check_Duplication: "This button will displays all suggestions which were same which was created by user or some fieldare same then it will display that suggestion"
        },
        EVALUATOR_SCREEN: {
            Change_Document: "This tab will help Evaluator if he want to add document to more clarify the Suggestion",
            Kaizen_Activity: "This tab will display all TPM's activity which are 8 type of it",
            Saving_Type: "This tab will describe that the suggestion which was provided from that what we are saving Cost or Time ",
            Particulars: "This tab will display all Particulars. ",
            Horizontal_Deployment: "This tab will give provision to  Evaluator to select that departments to which suggestion should implement",
            Analysis_Summary: "Evaluator should provide a detailed Summary of Suggestion",
            Override_Initiator_Category: "Evaluator should override the Category which was selected by the Iniator",
            Budgetary_Cost: "Should provide the Budgetary cost by the Evaluator",
            SAP_Code: "Evaluator should able to enter SAP code",
            Reject_Button: "Finance Controller has provision to Reject the cost which was entered by the Evaluator",
            Assign_For_Implementation_Button: "This button will assign a suggestion to Implementer to implement it",
            Eval_Reject_Button: "This button will help Evaluator to reject the suggestion"
        },
        IMPLEMENTER_SCREEN: {
            Implementation_Action: "Should provide the information about what implementer had taken action to solve the issue",
            Approximate_Implementation_Cost: "Enter the cost which was required to implement the suggestion",
            Annual_Savings: "Enter that cost which we had save while implementing a suggestion",
            Implemented_Tab: "This tab allows implementer to implement the suggestion",
            On_Hold_Tab: "This tab helps implementer to keep the suggestion On Hold",
            Reject_Tab: "This tab will allow implementer to reject the suggestion",
        }
    }
})());