<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PPT Generator</title>
  <script src="https://cdn.jsdelivr.net/npm/pptxgenjs/dist/pptxgen.bundle.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f8fafc; color: #333; }
    h2 { color: #0088CC; }
    input, button { padding: 10px; margin-top: 10px; border-radius: 6px; border: 1px solid #ccc; }
    button { background: #0088CC; color: #fff; border: none; cursor: pointer; }
    button:hover { background: #006fa1; }
    .progress { width: 100%; background: #e5e7eb; border-radius: 6px; overflow: hidden; margin-top: 20px; }
    .progress-bar { height: 22px; width: 0%; background: #4caf50; text-align: center; color: white; font-size: 12px; line-height: 22px; }
    #status { margin-top: 10px; font-weight: bold; color: #374151; }
  </style>
</head>
<body>
  <h2>Internal Audit PPT Generator</h2>
  <input type="file" id="jsonFile" accept=".json">
  <button onclick="handleFile()">Upload & Generate PPT</button>

  <div class="progress">
    <div id="progressBar" class="progress-bar">0%</div>
  </div>
  <div id="status">Waiting for file...</div>

  <script>
    function updateProgress(percent, message) {
      let bar = document.getElementById("progressBar");
      bar.style.width = percent + "%";
      bar.textContent = percent + "%";
      document.getElementById("status").textContent = message;
    }

    function handleFile() {
      let fileInput = document.getElementById("jsonFile").files[0];
      if (!fileInput) {
        alert("Please select a JSON file!");
        return;
      }
      let reader = new FileReader();
      reader.onload = function (e) {
        let data = JSON.parse(e.target.result);
        generatePpt(data);
      };
      reader.readAsText(fileInput);
    }

    async function generatePpt(data) {
      let pptx = new PptxGenJS();

      updateProgress(10, "Creating Info Slide...");
      // Slide 1: Info
      let slide1 = pptx.addSlide();
      if (data.logo1) slide1.addImage({ path: data.logo1, x: 0.5, y: 0.2, w: 1.5, h: 1.5 });
      if (data.logo2) slide1.addImage({ path: data.logo2, x: 8, y: 0.2, w: 1.5, h: 1.5 });
      slide1.addText(data.info.title1, { x: 3, y: 1, w: 5, h: 1, fontSize: 18, bold: true });
      slide1.addText(data.info.mainTitle, { x: 3, y: 2, w: 5, h: 1, fontSize: 26, bold: true, color: "0088CC" });

      updateProgress(25, "Creating Introduction Slide...");
      // Slide 2: Introduction as table
      let slide2 = pptx.addSlide();
      slide2.addText("Introduction", { x: 0.5, y: 0.3, fontSize: 24, bold: true, color: "0088CC" });
      let introTable = data.introduction.map(row => [row.label, row.value]);
      slide2.addTable(introTable, {
        x: 0.5, y: 1.2, w: 8.5, fontSize: 14,
        border: { pt: 0.5, color: "DDDDDD" },
        colW: [3, 5],
        rowH: 0.6,
        tableRow: [{ fill: "FFFFFF" }, { fill: "F9FAFB" }],
        colOpts: [
          { bold: true, color: "FFFFFF", fill: "0088CC", align: "left", valign: "middle" }, // labels
          { color: "000000", align: "left", valign: "middle" } // values
        ]
      });

      updateProgress(40, "Creating Audit Criteria Slide...");
      // Slide 3: Audit Criteria
      let slide3 = pptx.addSlide();
      slide3.addText("Audit Criteria", { x: 0.5, y: 0.3, fontSize: 24, bold: true, color: "0088CC" });
      slide3.addText("Objective: " + data.criteria.objective, { x: 0.5, y: 1, w: 8.5, fontSize: 14 });
      slide3.addTable(data.criteria.table, {
        x: 0.5, y: 2, w: 5, fontSize: 12,
        border: { pt: 1, color: "999999" },
        colW: [2.5, 2.5],
        align: "left", valign: "middle",
        rowH: 0.5,
        tableHeader: { fill: "0088CC", color: "FFFFFF", bold: true, fontSize: 13 },
        tableRow: [{ fill: "FFFFFF" }, { fill: "F3F4F6" }]
      });
      slide3.addText("3A approach of auditing:", { x: 6, y: 2, fontSize: 16, bold: true, color: "374151" });
      slide3.addText(data.criteria.approach.join("\n"), { x: 6, y: 2.5, fontSize: 14 });

      updateProgress(55, "Creating Methodology Slide...");
      // Slide 4: Audit Methodology
      let slide4 = pptx.addSlide();
      slide4.addText("Audit Methodology", { x: 0.5, y: 0.5, fontSize: 24, bold: true, color: "0088CC" });
      slide4.addText(data.methodology, { x: 0.7, y: 1.5, bullet: true, fontSize: 14, w: 8 });

      updateProgress(70, "Creating Audit Plan Day 1...");
      // Slide 5: Audit Plan Day 1
      let slide5 = pptx.addSlide();
      slide5.addText("Audit Plan - Day 1", { x: 0.5, y: 0.5, fontSize: 24, bold: true, color: "0088CC" });
      slide5.addTable(data.plan.day1, {
        x: 0.5, y: 1.5, w: 8.5, fontSize: 12,
        border: { pt: 1, color: "DDDDDD" },
        colW: [2, 3, 3],
        rowH: 0.5,
        tableHeader: { fill: "374151", color: "FFFFFF", bold: true, fontSize: 13 },
        tableRow: [{ fill: "FFFFFF" }, { fill: "F9FAFB" }]
      });

      updateProgress(85, "Creating Audit Plan Day 2...");
      // Slide 6: Audit Plan Day 2
      let slide6 = pptx.addSlide();
      slide6.addText("Audit Plan - Day 2", { x: 0.5, y: 0.5, fontSize: 24, bold: true, color: "0088CC" });
      slide6.addTable(data.plan.day2, {
        x: 0.5, y: 1.5, w: 8.5, fontSize: 12,
        border: { pt: 1, color: "DDDDDD" },
        colW: [2, 3, 3],
        rowH: 0.5,
        tableHeader: { fill: "374151", color: "FFFFFF", bold: true, fontSize: 13 },
        tableRow: [{ fill: "FFFFFF" }, { fill: "F9FAFB" }]
      });

      updateProgress(95, "Creating Thank You Slide...");
      // Slide 7: Thank You
      let slide7 = pptx.addSlide();
      slide7.addText("Thank You!", { x: 3, y: 2, fontSize: 36, bold: true, color: "0088CC" });
      if (data.thankImage) slide7.addImage({ path: data.thankImage, x: 3, y: 3, w: 3, h: 2 });

      updateProgress(100, "Generating PPT file...");
      await pptx.writeFile({ fileName: data.fileName || "Internal_Audit_Plan.pptx" });
      document.getElementById("status").textContent = "âœ… PPT Generated Successfully!";
    }
  </script>
</body>
</html>
